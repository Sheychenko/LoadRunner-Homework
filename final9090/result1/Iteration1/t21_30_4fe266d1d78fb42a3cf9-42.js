/*! For license information please see 4fe266d1d78fb42a3cf9-42.js.LICENSE */
webpackJsonp([42],{1174:function(e,t,o){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var i in t=arguments[o])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&i(t,e,o);return s(t,e),t},r=this&&this.__rest||function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(o[n[i]]=e[n[i]])}return o},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DateTimePicker=t.DateTimeFieldGroup=void 0;var d=a(o(135)),c=o(1596),u=o(350),h=l(o(344)),b=o(179),g=o(138),f=o(180),p=o(140),m=l(o(1176)),_={day:"2-digit",month:"2-digit",year:"numeric"},v={hour:"2-digit",minute:"2-digit"};t.DateTimeFieldGroup=function(e){var t=e.label,o=r(e,["label"]);return d.default.createElement(g.Text,{className:m.default.field,typography:"body-short-m",color:"secondary",as:"label"},d.default.createElement(h.default,{className:m.default.label,loc:t}),d.default.createElement(f.DateTimeField,n({view:"default",size:"s"},o)))};t.DateTimePicker=function(e){var o=e.value,n=e.onChange,i=e.onAction,s=e.onCancel,a=e.minDate,r=e.maxDate,l=d.useCallback(function(e){if(e.value)return o?void n(function(e,t){var o=new Date(e);return o.setDate(t.getDate()),o.setMonth(t.getMonth()),o.setFullYear(t.getFullYear()),o}(o,e.value)):n(e.value)},[n,o]),g=d.useCallback(function(e){if(e.value)return o?void n(function(e,t){var o=new Date(e);return o.setTime(t.getTime()),o}(o,e.value)):n(e.value)},[n,o]);return d.default.createElement("div",{className:m.default.root},d.default.createElement(c.LocaleProvider,{locale:u.getLocale()},d.default.createElement(b.Calendar,{view:"default",size:"s",value:o,onChange:l,min:a,max:r,autoFocus:!0}),d.default.createElement("div",{className:m.default.row},d.default.createElement(t.DateTimeFieldGroup,{value:o,onChange:l,formatOptions:_,min:a,max:r,label:"compose-react/DatetimePicker_Date"}),d.default.createElement(t.DateTimeFieldGroup,{value:o,onChange:g,formatOptions:v,label:"compose-react/DatetimePicker_Time"})),d.default.createElement("div",{className:m.default.row},d.default.createElement(p.Button,{className:m.default.button,view:"action",size:"s",onClick:i},d.default.createElement(h.default,{loc:"compose-react/DatetimePicker_Confirm"})),d.default.createElement(p.Button,{className:m.default.button,view:"default",size:"s",onClick:s},d.default.createElement(h.default,{loc:"compose-react/DatetimePicker_Cancel"})))))}},1176:function(e,t){e.exports={root:"DateTimePicker__root--YzyxJ",row:"DateTimePicker__row--2VZkE",field:"DateTimePicker__field--2KQU1",label:"DateTimePicker__label--3h43O",button:"DateTimePicker__button--2mJLo"}},1595:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DateTimePicker=void 0;var n=o(1174);Object.defineProperty(t,"DateTimePicker",{enumerable:!0,get:function(){return n.DateTimePicker}})},1598:function(e,t,o){"use strict";var n=this&&this.__read||function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,i,s=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.useElement=void 0;var i=o(135);t.useElement=function(e){var t=n(i.useState(null),2),o=t[0],s=t[1];return{setElement:i.useCallback(function(t){s(t),null===e||void 0===e||e(t)},[e]),elementRef:i.useMemo(function(){return{current:o}},[o]),element:o}}},226:function(e,t,o){Jane.module("toolbar.js",function(){"use strict";o(5534),o(5535),o(5537),o(5539),o(5544),o(5597)})},5534:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137);o.n(n);yr.externals["get-first-symbol-length"]=function(e){var t=e.codePointAt(0);return t?String.fromCodePoint(t).length:0},yr.externals["is-folder-disabled-in-move"]=function(e){return n.FoldersDisabledMoveInto.includes(e)}},5535:function(e,t,o){o(5536)},5536:function(e,t){ns.action.define("toolbar.settings.button.remove",function(e,t){var o=t.button,n=Daria.userToolbar.deactivateButton(o);return _.isArray(n)&&(Daria.userToolbar.set(),ns.events.trigger("daria:vToolbarSettings:buttonToggled")),!1})},5537:function(e,t,o){o(5538)},5538:function(e,t){function o(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Daria.userToolbar={mSettings:function(){return this._mSettings||(this._mSettings=ns.Model.get("settings")),this._mSettings},_KEY:"tb_mail_mailbox",_KEY_ACTIVATED:"tb_mail_mailbox_act",_getSettingsValue:function(){var e=this.mSettings().getSetting(this._KEY);return Array.isArray(e)?e:_.isObject(e)&&e.default||[]},_cache:null,validate:function(e){return _.filter(e,function(e){switch(e.id){case Daria.Constants.TOOLBAR_BUTTONS.LABEL:var t=ns.Model.get("labels");return t&&t.getLabelById(e.settings.label);case Daria.Constants.TOOLBAR_BUTTONS.INFOLDER:var o=e.settings.tabId,n=e.settings.folder,i=o||n;return Boolean(Daria.areFoldersTabsEnabled()&&ns.Model.get("tabs").getTab(i))||ns.Model.get("folders").getFolderById(n);case Daria.Constants.TOOLBAR_BUTTONS.SENDON:return e.settings.email&&Jane.FormValidation.checkEmail(e.settings.email)}return!0})},get:function(e){return _.isNull(this._cache)&&(this._cache=this._getSettingsValue()),this._cache=this.validate(this._cache),e?this._getSettingsByButtonId(this._cache,e)||null:this._cache},_getActionsSettings:function(e){e=e||this._cache;var t=this.mSettings().getSetting(this._KEY);return _.isObject(t)?function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?o(Object(i),!0).forEach(function(t){n(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}({},t,{default:e}):{default:e}},set:function(e){var t=new Vow.Promise;return this.mSettings().setSettings(n({},this._KEY,this._getActionsSettings(e)),function(o){o?t.fulfill(e):t.reject("error set settings for user toolbar")}),t},activate:function(){var e=new Vow.Promise;return this.mSettings().setSettingOn(this._KEY_ACTIVATED,function(){e.fulfill()}),e},isActivated:function(){return!Daria.Config.NO_SETTINGS&&this.mSettings().isSet(this._KEY_ACTIVATED)},getCustomizableButtonName:function(e){var t=this.get(e);if(t)switch(e){case Daria.Constants.TOOLBAR_BUTTONS.LABEL:return ns.Model.get("labels").getLabelById(t.settings.label).name;case Daria.Constants.TOOLBAR_BUTTONS.INFOLDER:var o=t.settings.folder;if(Daria.areFoldersTabsEnabled()){var n=t.settings.tabId,i=n||o,s=ns.Model.get("tabs").getTab(i);return s?s.get(".title"):ns.Model.get("folders").getFolderById(o).name}return ns.Model.get("folders").getFolderById(o).name;case Daria.Constants.TOOLBAR_BUTTONS.SENDON:return t.settings.email;default:return}},activateButton:function(e,t){var o={id:e,settings:t},n=_.findIndex(this._cache,{id:e});return-1!==n?this._cache[n]=o:this._cache.push(o),this._cache},deactivateButton:function(e){return this._cache=_.reject(this._cache,{id:e}),this._cache},isButtonActivated:function(e){return _.isNull(this._cache)&&(this._cache=this._getSettingsValue()),Boolean(this._getSettingsByButtonId(this._cache,e))},invalidateCache:function(){this._cache=null},_getSettingsByButtonId:function(e,t){return _.find(e,{id:t})}}},5539:function(e,t,o){o(5540),o(5541),o(5542),o(5543)},5540:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137);o.n(n);!function(){var e=[{id:Daria.Constants.TOOLBAR_BUTTONS.MAIN_SELECT_ALL,action:"select-all",iconId:"mail--Inbox-CheckboxCheckMark-Small",title:i18n("%Shortcuts_key_Select_all"),accessKey:Daria.Shortcuts.getShortcutLabelFor("Select_all","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.MAIN_DESELECT_ALL,action:"deselect-all",iconId:"mail--Inbox-CheckboxCheckMark-Small",title:i18n("%Toolbar_Снять_выделение"),accessKey:Daria.Shortcuts.getShortcutLabelFor("Select_all","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.DRAFT_FINISH,icon:"Compose",name:i18n("%Toolbar_Дописать"),title:i18n("%Toolbar_Дописать")},{id:Daria.Constants.TOOLBAR_BUTTONS.ADD_TEMPLATE,icon:"AddTemplate",name:i18n("%Toolbar_Создать_шаблон")},{id:Daria.Constants.TOOLBAR_BUTTONS.EDIT,action:"compose-edit",icon:"Edit",name:i18n("%Изменить"),_visible:function(){if(!Daria.isMessagePage())return!1;var e=ns.Model.get("messages-checked");if(1!==e.getCount())return!1;var t=e.getCheckedMessages()[0];return ns.Model.get("folders").isFolder(t.getFolderId(),n.DraftTemplateLikeFoldersShort)}},{id:Daria.Constants.TOOLBAR_BUTTONS.REPLY,action:"reply",icon:"Reply",name:i18n("%Toolbar_Ответить"),title:i18n("%Toolbar_Ответить")+Daria.Shortcuts.getShortcutLabelFor("Reply","message",!0),_visible:function(){if(Daria.isMessagePage()){var e=ns.Model.get("messages-checked");if(1===e.getCount()){var t=e.getCheckedMessages()[0];return!ns.Model.get("folders").isFolder(t.getFolderId(),n.DraftTemplateLikeFoldersShort)}}return!0},accessKey:Daria.Shortcuts.getShortcutLabelFor("Reply","message")},{id:Daria.Constants.TOOLBAR_BUTTONS.REPLY_ALL,action:"reply-all",icon:"Replyall",name:i18n("%Toolbar_Ответить_всем"),title:i18n("%Toolbar_Ответить_всем")+Daria.Shortcuts.getShortcutLabelFor("Reply_all","message",!0),_visible:function(){if(Daria.isMessagePage()){var e=ns.Model.get("messages-checked");if(1===e.getCount()){var t=e.getCheckedMessages()[0];return!ns.Model.get("folders").isFolder(t.getFolderId(),n.DraftTemplateLikeFoldersShort)}}return!0},accessKey:Daria.Shortcuts.getShortcutLabelFor("Reply_all","message")},{id:Daria.Constants.TOOLBAR_BUTTONS.FORWARD,action:"forward",icon:"Forward",name:i18n("%Toolbar_Переслать"),title:i18n("%Toolbar_Переслать")+Daria.Shortcuts.getShortcutLabelFor("Forward","messages",!0),_visible:function(){return!ns.Model.get("folders").isFolder(ns.page.current.params.current_folder,[n.WellKnownFolderSymbol.TEMPLATE])},accessKey:Daria.Shortcuts.getShortcutLabelFor("Forward","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.DELETE,action:"remove",folderAction:"folder.messages-remove",icon:"Delete",actionParams:function(){var e={};return"message"===ns.page.current.page&&(e.ignoreUnsavedDraft=!0),e},name:i18n("%Toolbar_Удалить"),title:i18n("%Toolbar_Удалить")+Daria.Shortcuts.getShortcutLabelFor("Delete_selected","messages",!0),accessKey:Daria.Shortcuts.getShortcutLabelFor("Delete_selected","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.SPAM,action:"tospam",icon:"Spam",name:i18n("%Toolbar_Это_спам"),title:i18n("%Toolbar_Это_спам")+Daria.Shortcuts.getShortcutLabelFor("Label_spam","message",!0),accessKey:Daria.Shortcuts.getShortcutLabelFor("Label_spam","message")},{id:Daria.Constants.TOOLBAR_BUTTONS.NOT_SPAM,action:"notspam",icon:"Unspam",name:i18n("%Toolbar_Не_спам")},{id:Daria.Constants.TOOLBAR_BUTTONS.MARK_AS_READ,action:"mark",folderAction:"folder.current-mark-read",icon:"Read",name:i18n("%Toolbar_Прочитано"),title:i18n("%Toolbar_Прочитано")+Daria.Shortcuts.getShortcutLabelFor("Label_read","messages",!0),accessKey:Daria.Shortcuts.getShortcutLabelFor("Label_read","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.MARK_AS_UNREAD,action:"unmark",icon:"Unread",name:i18n("%Toolbar_Не_прочитано"),title:i18n("%Toolbar_Не_прочитано")+Daria.Shortcuts.getShortcutLabelFor("Label_unread","messages",!0),accessKey:Daria.Shortcuts.getShortcutLabelFor("Label_unread","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.UNSUBSCRIBE_ONE,action:"unsubscribe-one",icon:"Unsubscribe_all",name:i18n("%Toolbar_Unsubscribe_One")},{id:Daria.Constants.TOOLBAR_BUTTONS.UNSUBSCRIBE_ALL,action:"unsubscribe-all",icon:"Unsubscribe_all",name:i18n("%Toolbar_Unsubscribe_All")},{id:Daria.Constants.TOOLBAR_BUTTONS.REPLY_LATER,name:i18n("%Toolbar_Reply_Later"),icon:"Reply_later",nameArrow:!0},{id:Daria.Constants.TOOLBAR_BUTTONS.ARCHIVE,action:"archive",icon:"Archive",name:i18n("%Toolbar_Archive"),title:i18n("%Toolbar_Archive")+Daria.Shortcuts.getShortcutLabelFor("Archive","messages",!0),description:i18n("%Toolbar_Archive_Description"),settings:{},accessKey:Daria.Shortcuts.getShortcutLabelFor("Archive","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.MARK_IMPORTANT,action:"mark-important",icon:"MarkImportant",name:i18n("%Labels_Toolbar_Important"),title:i18n("%Labels_Toolbar_Important")+Daria.Shortcuts.getShortcutLabelFor("Label_important","messages",!0),accessKey:Daria.Shortcuts.getShortcutLabelFor("Label_important","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.MARK_UNIMPORTANT,action:"mark-unimportant",icon:"MarkUnimportant",name:i18n("%Labels_Toolbar_Important"),title:i18n("%Labels_Toolbar_Important")+Daria.Shortcuts.getShortcutLabelFor("Label_important","messages",!0),accessKey:Daria.Shortcuts.getShortcutLabelFor("Label_important","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.LABELS_ACTIONS,icon:"Tag",name:i18n("%Toolbar_Label"),nameArrow:!0,title:i18n("%Toolbar_Label")+Daria.Shortcuts.getShortcutLabelFor("Labels_dialog","messages",!0),description:i18n("%Toolbar_Label_Description"),accessKey:Daria.Shortcuts.getShortcutLabelFor("Labels_dialog","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.FOLDERS_ACTIONS,icon:"Folder",name:i18n("%Toolbar_Infolder"),nameArrow:!0,title:i18n("%Toolbar_Infolder")+Daria.Shortcuts.getShortcutLabelFor("Folders_dialog","messages",!0),description:i18n("%Toolbar_Infolder_Description"),accessKey:Daria.Shortcuts.getShortcutLabelFor("Folders_dialog","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.PIN,action:"pin",icon:"Pin",name:i18n("%Pinned_Запинить_письмо"),_visible:function(){if(Daria.isMessagePage()){var e=ns.Model.get("messages-checked");if(1===e.getCount()){var t=e.getCheckedMessages()[0];return!ns.Model.get("folders").isFolder(t.getFolderId(),n.DraftTemplateLikeFoldersShort)}}return!0}},{id:Daria.Constants.TOOLBAR_BUTTONS.UNPIN,action:"unpin",icon:"Pin_active",name:i18n("%Pinned_Распинить_письмо"),_visible:function(){if(Daria.isMessagePage()){var e=ns.Model.get("messages-checked");if(1===e.getCount()){var t=e.getCheckedMessages()[0];return!ns.Model.get("folders").isFolder(t.getFolderId(),n.DraftTemplateLikeFoldersShort)}}return!0}},{id:Daria.Constants.TOOLBAR_BUTTONS.SENDON,action:"sendon",icon:"SmartForward",name:i18n("%Toolbar_Sendon"),originalName:i18n("%Toolbar_Sendon"),title:i18n("%Toolbar_Sendon")+Daria.Shortcuts.getShortcutLabelFor("Sendon","messages",!0),description:i18n("%Toolbar_Sendon_Description"),settings:{email:null},isCustom:!0,_settingsValidate:function(e){var t=[];return e.email?Jane.FormValidation.checkEmail(e.email)||t.push("sendon_check_email"):t.push("sendon_empty_email"),t},accessKey:Daria.Shortcuts.getShortcutLabelFor("Sendon","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.INFOLDER,action:"infolder",icon:"MagicFolder",name:i18n("%Toolbar_Infolder"),originalName:i18n("%Toolbar_Infolder"),title:i18n("%Toolbar_Infolder")+Daria.Shortcuts.getShortcutLabelFor("Infolder","messages",!0),description:i18n("%Toolbar_Infolder_Description"),settings:{folder:null},settingsDeps:function(){return Daria.areFoldersTabsEnabled()?["folders","tabs"]:["folders"]},isCustom:!0,_settingsValidate:function(e){var t=[];if(e.folder||t.push("folder_empty"),Daria.areFoldersTabsEnabled()&&/tab/.test(e.folder)){var o=ns.Model.get("folders").getFidBySymbol(n.WellKnownFolderSymbol.INBOX);e.tabId=e.folder.substring(4),e.folder=o}return t},accessKey:Daria.Shortcuts.getShortcutLabelFor("Infolder","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.LABEL,action:"toggleLabel",icon:"MagicTag",name:i18n("%Toolbar_Label"),originalName:i18n("%Toolbar_Label"),title:i18n("%Toolbar_Label")+Daria.Shortcuts.getShortcutLabelFor("Defined_label","messages",!0),description:i18n("%Toolbar_Label_Description"),settings:{label:null},settingsDeps:["labels"],isCustom:!0,_settingsValidate:function(e){var t=[];return e.label||t.push("label_empty"),t},accessKey:Daria.Shortcuts.getShortcutLabelFor("Defined_label","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.TEMPLATE,action:"reply-tmpl",icon:"Template",name:i18n("%Toolbar_Template"),title:i18n("%Toolbar_Template")+Daria.Shortcuts.getShortcutLabelFor("Defined_reply","messages",!0),description:i18n("%Toolbar_Template_Description"),settings:{tmpl:null},settingsDeps:["messages"],isCustom:!0,_settingsDepsParams:function(){var e=Vow.promise();return ns.Model.get("folders").createTemplateFolder().then(function(t){e.fulfill({current_folder:t.fid,first:0,last:500})},function(){e.reject("Error set settings deps params")}),e},_settingsValidate:function(e){var t=[];return e.tmpl||t.push("template_empty"),t},accessKey:Daria.Shortcuts.getShortcutLabelFor("Defined_reply","messages")},{id:Daria.Constants.TOOLBAR_BUTTONS.MORE,icon:"More",name:i18n("%Toolbar_More")},{id:Daria.Constants.TOOLBAR_BUTTONS.TOOLBAR_SETTINGS,action:"customize",iconId:"mail--Settings",name:i18n("%Toolbar_Settings"),settings:{},settingsHide:!0},{id:Daria.Constants.TOOLBAR_BUTTONS.ABOOK_SELECT_ALL,action:"abook.select-all",iconId:"mail--Inbox-CheckboxCheckMark-Small",title:i18n("%АК_Выделить_все_контакты")},{id:Daria.Constants.TOOLBAR_BUTTONS.ABOOK_DESELECT_ALL,action:"abook.deselect-all",iconId:"mail--Inbox-CheckboxCheckMark-Small",title:i18n("%Toolbar_Снять_выделение")},{id:Daria.Constants.TOOLBAR_BUTTONS.ABOOK_ADD,action:"mail-common.person-popup",iconId:"mail--MainToolbar-AddContact",name:i18n("%Toolbar_Добавить_контакт")},{id:Daria.Constants.TOOLBAR_BUTTONS.ABOOK_REMOVE,action:"abook.remove-contacts",iconId:"mail--MainToolbar-Delete",name:i18n("%Toolbar_Удалить"),droppable:!0},{id:Daria.Constants.TOOLBAR_BUTTONS.ABOOK_TO_GROUP,action:"abook.groups-dropdown",iconId:"mail--MainToolbar-AddGroup",name:i18n("%АК_Добавить_в_группу"),droppable:!0},{id:Daria.Constants.TOOLBAR_BUTTONS.ABOOK_OUT_OF_GROUP,action:"abook.remove-contacts-from-group",iconId:"mail--MainToolbar-DeleteGroup",name:i18n("%АК_Удалить_из_группы"),droppable:!0},{id:Daria.Constants.TOOLBAR_BUTTONS.ABOOK_RESTORE,action:"abook.open-backups-dialog",iconId:"mail--MainToolbar-Restored",name:i18n("%AK_Восстановить")},{id:Daria.Constants.TOOLBAR_BUTTONS.ABOOK_MORE,action:"abook.toolbar-more-actions",iconId:"mail--MainToolbar-More",name:i18n("%Toolbar_More")},{id:Daria.Constants.TOOLBAR_BUTTONS.TRANSLATE,action:"translate.show-infoline",name:i18n("%Message_Translate"),iconId:"mail--MainToolbar-Translate",_visible:ns.False},{id:Daria.Constants.TOOLBAR_BUTTONS.PRINT,name:i18n("%Message_Распечатать"),_visible:ns.False,_getExData:function(){return{href:"".concat(Daria.api.print,"?mid=").concat(ns.page.current.params.ids,"&_uid=").concat(Daria.uid),attrs:{target:"_blank"}}}},{id:Daria.Constants.TOOLBAR_BUTTONS.FILTERS_CREATE,name:i18n("%Message_Создать_правило"),_visible:ns.False,_getExData:function(){return{href:"#setup/filters-create?message="+ns.page.current.params.ids,class:["ns-action"],attrs:{"data-click-action":"message.counter-filters-create"}}}},{id:Daria.Constants.TOOLBAR_BUTTONS.MESSAGE_SOURCE,name:i18n("%Message_Свойства_письма"),_visible:ns.False,_getExData:function(){return{href:"".concat(Daria.api["message-source"],"/").concat(Daria.uid,"/").concat(ns.page.current.params.ids,"/yandex_email.eml"),class:["ns-action","js-toolbar-item-message-properties"],attrs:{target:"_blank","data-click-action":"message.counter-properties"}}}}];ns.Model.define("all-toolbar-buttons",{events:{"ns-model-init":"onInit"},methods:{onInit:function(){this.setData(e)},getButtonById:function(e){return _.find(this.getData(),{id:e})},getButtonsByIds:function(e){return _.filterValuesContainingPropValue(this.getData(),"id",e)},getOrExtendButton:function(e){return _.isString(e)?this.getButtonById(e):_.extend({},this.getButtonById(e.id),e)},getButtonsByDeclarations:function(e){return _.map(e,this.getOrExtendButton,this)}}})}()},5541:function(e,t){ns.Model.define("toolbar",{split:{items:".item",params:{id:".id"},model_id:"toolbar-button"},params:{layout:null},events:{"ns-model-init":"onInit"},methods:{onInit:function(){this.setData({buttons:[]})},preprocessData:function(e){return e.buttons&&(e.item=e.buttons),delete e.buttons,e.fixed=!1,e},setFixedSupport:function(e){Jane.watcher.set("toolbar.allowfixed",Boolean(e))},getFixedSupport:function(){return Jane.watcher.get("toolbar.allowfixed")},toggleFixed:function(e){return this.get(".fixed")!==e&&(this.set(".fixed",e),!0)},isFixed:function(){return Boolean(this.get(".fixed"))},areSettingsEnabled:function(){return Boolean(this.get(".settings"))},getById:function(e){return _.find(this.models,function(t){return t.get(".id")===e})}}},ns.ModelCollectionStatic)},5542:function(e,t){!function(){var e=function(){return Vow.fulfill()};ns.Model.define("toolbar-button",{params:{id:null},ctor:function(){this.toShow=no.True,this.toEnable=no.True,this.init=no.nop,this.getSettingsDepsParams=e,this.validateSettings=no.True,this.getExData=_.noop,this.getSettingsDeps=this._getSettingsDeps.bind(this)},methods:{hasDataChanged:function(){return Boolean(!this.data)},preprocessData:function(t){var o=t._visible;return this.toShow=o||no.True,o=t._enable,this.toEnable=o||no.True,o=t._init,this.init=o||no.nop,o=t._settingsDepsParams,this.getSettingsDepsParams=o||e,"function"==typeof t.settingsDeps&&(this.getSettingsDeps=t.settingsDeps),o=t._settingsValidate,this.validateSettings=o||no.True,this.getExData=t._getExData||_.noop,_.pick(t,function(e,t){return"_"!==t.charAt(0)})},setName:function(e){_.isUndefined(e)?this.resetName():this.setIfChanged(".name",e)},resetName:function(){var e=this.get(".originalName");e&&this.set(".name",e)},isModelWithSettings:function(){return Boolean(this.get(".settings"))},getType:function(){return this.get(".type")},_getSettingsDeps:function(){return this.get(".settingsDeps")},isValid:no.True}},ns.ModelStatic)}()},5543:function(e,t){ns.Model.define("mops-confirmation",{events:{"ns-model-init":"onInit"},methods:{onInit:function(){this.setData({})},getData:function(){return this.getMops()},getMops:function(){return{action:this.data.action||null,callback:this.data.callback||null,onCancel:this.data.onCancel||null,count:this.data.count||0}},setMops:function(e){this.setData(e)}}},ns.ModelStatic),ns.action.define("mops-confirmation.clear",function(){ns.Model.get("mops-confirmation").setMops({})})},5544:function(e,t,o){o(5545),o(5546),o(5552),o(5553),o(5554),o(5594),o(5595),o(5596)},5545:function(e,t){function o(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}ns.View.edefine("folders-actions",{models:{folders:!1},events:{"ns-view-init":"onInit","ns-view-show":"onShow","ns-view-hide":"onHide","click@show .js-action":"onClickAction","click@show .js-folder-new":"createNewFolder","keydown@show .js-search-input":"_onSearchInput","daria:vScrollerMessages:scroll@show":"closePopup","daria:vScrollerMessage:scroll@show":"closePopup","toolbar.fixed@show":"closePopup"},yateModule:"toolbar",methods:{elContentSelector:".js-folder-name",elSelector:".js-kbd-fldr-nav:visible",skipElSelector:"b-folders__folder_current",selectedClass:"b-folders__folder_kbd-selected",newListSelector:".mail-FilterList-List .js-folder-new",onInit:function(){this._filterRefresh=_.debounce(this._filterRefresh,100),this.resetKdbSelection=_.debounce(this.resetKdbSelection,150)},onShow:function(){this.$foldersHolder=this.$node.find(".js-folders-list"),this.$searchInput=this.$node.find(".js-search-input"),this.filterByMessagesChecked()},onHide:function(){this._filterRefresh.cancel(),this.resetKdbSelection.cancel(),this.$foldersHolder=null,this.$searchInput=null},onClickAction:function(e){var t=ns.action.getParams(e.currentTarget),o=$(e.currentTarget).data("click-action"),n=this._getCheckedModel(),i=Daria.areFoldersTabsEnabled()&&t.tabId,s=i&&i===this.disabledTabId;return!(!i&&t.fid===this.disabledFolderFid||s||("folders.add"===o?this.createNewFolder(t):(n.runAction(o,t),this.closePopup()),e.preventDefault(),1))},open:function(e,t,o){var n=this;this.__mMessagesChecked=t,this._isOpen=!0;var i=this.getOpenOptions(o);return this.update().then(function(){var t=Jane.tt("toolbar:mail-FilterList-popup");n.nbPopup=nb.block(t),n.nbPopup.setContent(n.node),n.nbPopup.open(_.extend(i,{where:e})),n.bindEvents(),n.bindEvents();var s=_.once(function(){n._isOpen=!1,n.unbindEvents(),n.destroy(),_.defer(function(){n.nbPopup.destroy()})});jpath(o,".isInMore")[0]&&n.nbPopup.on("nb-opened",function(){return $(t).find("input").focus()}),n.nbPopup.on("nb-closed",s)})},bindEvents:function(){this.nbPopup.$node.on("mousedown",this._preventDefaultAndStopPropagation)},unbindEvents:function(){this.nbPopup.$node.off("mousedown",this._preventDefaultAndStopPropagation)},getFolderName:function(){return this.$searchInput&&this.$searchInput.length?$.trim(this.$searchInput.val()):""},createNewFolder:function(e){this.closePopup(),e=$.extend(e||{},{name:this.getFolderName(),toolbar:!0,mMessagesChecked:this._getCheckedModel()}),ns.action.run("folders.add",e)},closePopup:function(){nb.trigger("popup-close")},infilteredList:function(e){for(var t=this.filteredList,o=0,n=t.length;o<n;o++)if(t[o].title===e)return!0;return!1},filterFolders:function(e){return this.filteredList=$.grep(this.activeFolders,function(t){var o=!e||!t.current&&0===t.title.indexOf(e);return t.$node.toggleClass("g-hidden",!o),o}),this.filteredList.length},resetKdbSelection:function(){var e=this;e.visibleList[e.kbdSelected]&&e.visibleList[e.kbdSelected].$node.removeClass(e.selectedClass),$(e.newListSelector).removeClass(e.selectedClass),e.visibleList=[],$(e.elSelector).each(function(t,o){var n=$(o);n.hasClass(e.skipElSelector)||e.visibleList.push({$node:n,title:n.find(e.elContentSelector).text()})}),e.kbdSelected=null},makeFakeFolder:function(e){var t=Jane.tt("toolbar:new-fake-folder",{name:e,"name-param":encodeURIComponent(e)});this.$fakeFolder?this.$fakeFolder.replaceWith(t):this.$foldersHolder.append(t),this.$fakeFolder=$(t),this.visibleList.push({title:"fake folder",$node:this.$fakeFolder})},removeFakeFolder:function(){var e=this.$fakeFolder;e&&(e.remove(),this.$fakeFolder=null)},filterByMessagesChecked:function(){var e,t;if(this.activeFolders=[],this.filteredList=[],this.visibleList=[],Daria.areFoldersTabsEnabled()){var n,i,s=this._processTabs(),a=s.active,r=s.visible;(n=this.activeFolders).push.apply(n,o(a)),(i=this.visibleList).push.apply(i,o(r))}var l=this._processFolders(),d=l.active,c=l.visible;(e=this.activeFolders).push.apply(e,o(d)),(t=this.visibleList).push.apply(t,o(c)),this.removeFakeFolder(),this.prevSearch=null,this.$searchInput.val(""),this.filterFolders(""),this.resetKdbSelection()},_processFolders:function(){var e=this,t=this._getCheckedModel(),o=t.getCount(),n=t.getFolders(),i=this.$node;return Object.keys(n).reduce(function(t,s){var a=n[s]===o;a&&(e.disabledFolderFid=s);var r=i.find(".folder-"+s).toggleClass("b-folders__folder_current",a),l=r.find(".js-folder-name").text().toLowerCase(),d={$node:r,title:l,current:a};return t.active.push(d),""===l||a||t.visible.push(d),t},{active:[],visible:[]})},_processTabs:function(){var e=this,t=this._getCheckedModel(),o=t.getCount(),n=t.getTabs(),i=this.$node;return Object.keys(n).reduce(function(t,s){var a=n[s]===o;a&&(e.disabledTabId=s);var r=i.find(".tab-"+s);r.toggleClass("b-folders__folder_current",a);var l=r.find(".js-folder-name").text().toLowerCase(),d={$node:r,title:l,current:a};return t.active.push(d),""===l||a||t.visible.push(d),t},{active:[],visible:[]})},_getCheckedModel:function(){return this.__mMessagesChecked},_filterRefresh:function(){if(this.$searchInput){var e=this.getFolderName(),t=e.toLowerCase();null===this.prevSearch&&(this.prevSearch=""),t!==this.prevSearch&&(this.prevSearch=t,this.filterFolders(t),t.length&&!this.infilteredList(t)?this.makeFakeFolder(e):this.removeFakeFolder(),this.resetKdbSelection())}},_onSearchInput:function(e){var t=Jane.Common.keyCode;switch(e.which){case t.ENTER:if(null!==this.kbdSelected&&this.kbdSelected>-1)return e.stopImmediatePropagation(),this.visibleList[this.kbdSelected]?this.visibleList[this.kbdSelected].$node.find("[data-click-action]").trigger("click"):this.createNewFolder(),!1;if(this._filterRefresh(),this.filteredList.length&&this.$fakeFolder)return!1;this.filteredList.length<=1&&(e.stopImmediatePropagation(),(this.$fakeFolder||this.filteredList[0].$node).find("[data-click-action]").trigger("click"));break;case t.DOWN:this.moveKbdCursor("down"),e.stopPropagation();break;case t.UP:this.moveKbdCursor("up"),e.stopPropagation();break;default:this._filterRefresh()}return!0}}},"kbd-dropdown-actions")},5546:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(5547);o.n(n);ns.View.define("more-services",{events:{"ns-page-before-load":"onPageBeforeLoad","ns-view-hide":"onHide","click@show":"onClick"},yateModule:"toolbar",ctor:function(){this.popup=null,this.popupClose=this.popupClose.bind(this),this.onChangeToolbarPosition=this.onChangeToolbarPosition.bind(this)},methods:{onHide:function(){this.popupClose()},onPageBeforeLoad:function(){this.popupClose()},onClick:function(){this.popupClose()||(ns.events.on("toolbar.fixed",this.onChangeToolbarPosition),this.popup=Object(n.renderReactServicesPopup)({anchor:{current:this.node.querySelector(".js-more-services-toggle")},onClose:this.popupClose}))},popupClose:function(){return!!this.popup&&(Object(n.unmountReactServicesPopup)(this.popup),ns.events.off("toolbar.fixed",this.onChangeToolbarPosition),this.popup=null,!0)},onChangeToolbarPosition:function(e,t){t&&this.popupClose()}}})},5552:function(e,t){ns.View.edefine("labels-actions",{events:{"ns-view-init":"onInit","ns-view-show":"onShow","ns-view-hide":"onHide","click@show .js-action":"_onLabelClick","click@show .js-fake-label":"_onNewLabelClick","click@show .js-label-new":"_onNewLabelClick","click@show .js-read":"_onClickRead","click@show .js-unread":"_onClickUnread","keydown@show .js-search-input":"_onSearchInput","daria:vScrollerMessages:scroll@show":"closePopup","daria:vScrollerMessage:scroll@show":"closePopup","toolbar.fixed@show":"closePopup"},models:{labels:!1,settings:!1},yateModule:"toolbar",methods:{newListSelector:".js-label-new",selectedClass:"b-mail-dropdown__item-kbd-selected",elContentSelector:".b-mail-dropdown__item__content__wrapper",elSelector:".js-kbd-lbl-nav:visible",onInit:function(){this._filterRefresh=_.debounce(this._filterRefresh,100),this.resetKdbSelection=_.debounce(this.resetKdbSelection,150),this._onPopupMouseDown=this._onPopupMouseDown.bind(this),this.nbPopup=null},onShow:function(){this.$labelsHolder=this.$node.find(".js-labels-list"),this.$searchInput=this.$node.find(".js-search-input"),this.filterByMessagesChecked()},onHide:function(){this._filterRefresh.cancel(),this.resetKdbSelection.cancel(),this.$searchInput=null,this.$labelsHolder=null},open:function(e,t,o){var n=this;this.__mMessagesChecked=t,this._isOpen=!0,this._logMetrika=o.logMetrika||_.noop;var i=this.getOpenOptions(o);return this.update(null,{execFlag:ns.U.EXEC.PARALLEL}).then(function(){var t=Jane.tt("toolbar:mail-FilterList-popup");n.nbPopup=nb.block(t),n.nbPopup.setContent(n.node),n.nbPopup.open(_.extend(i,{where:e})),n.bindEvents();var s=_.once(function(){n._isOpen=!1,n._logMetrika=null,n.unbindEvents(),n.destroy(),_.defer(function(){n.nbPopup.destroy()})});jpath(o,".isInMore")[0]&&n.nbPopup.on("nb-opened",function(){return $(t).find("input").focus()}),n.nbPopup.on("nb-closed",s)})},bindEvents:function(){this.nbPopup.$node.on("mousedown",this._onPopupMouseDown)},unbindEvents:function(){this.nbPopup.$node.off("mousedown",this._onPopupMouseDown)},_onPopupMouseDown:function(e){e.stopPropagation()},_getDataFromClickedLabel:function(e){var t=$(e.currentTarget),o=ns.action.getParams(t[0]);return{action:t.data("click-action"),lid:o.lid}},_onLabelClick:function(e){var t=this._getDataFromClickedLabel(e),o=t.lid,n=t.action;this._getCheckedModel().runAction(n,{lid:o}),this._logMetrika(o,n),this.closePopup()},_onNewLabelClick:function(e){var t=ns.action.getParams(e.currentTarget);t["message-id"]=$(e.currentTarget).attr("data-message-id"),this.createNewLabel(t),this.closePopup()},_onClickRead:function(e){e.preventDefault(),e.stopPropagation(),this._getCheckedModel().runAction("mark"),this.closePopup()},_onClickUnread:function(e){e.preventDefault(),e.stopPropagation(),this._getCheckedModel().runAction("unmark"),this.closePopup()},closePopup:function(){nb.trigger("popup-close")},_onSearchInput:function(e){var t=Jane.Common.keyCode;switch(e.which){case t.ENTER:if(null!==this.kbdSelected&&this.kbdSelected>-1)return e.stopPropagation(),this.visibleList[this.kbdSelected]?this.visibleList[this.kbdSelected].$node.find("a").trigger("click"):(this.createNewLabel(),this.nbPopup.close()),e.preventDefault(),!1;if(this._filterRefresh(),this.filteredList.length&&this.$fakeLabel)return!1;this.filteredList.length<=1&&(e.stopPropagation(),(this.$fakeLabel||this.filteredList[0].$node).find("[data-click-action]").trigger("click"));break;case t.DOWN:this.moveKbdCursor("down"),e.stopPropagation();break;case t.UP:this.moveKbdCursor("up"),e.stopPropagation();break;default:this._filterRefresh()}return!0},_filterRefresh:function(){if(!_.isEmpty(this.$searchInput)){var e=$.trim(this.$searchInput.val()),t=e.toLowerCase();null===this.prevSearch&&(this.prevSearch=""),t!==this.prevSearch&&(this.prevSearch=t,this._filterLabels(t),t.length&&!this.infilteredList(t)?this.makeFakeLabel(e):this.removeFakeLabel(),this.resetKdbSelection())}},getLabelCreatedCallback:function(){var e=this._getCheckedModel();return e.runLabelAction.bind(e)},createNewLabel:function(e){if(!_.isEmpty(this.$searchInput)){var t=Daria.capitalize(this.$searchInput.val().trim());ns.action.run("labels.add",_.extend({},e,{name:t,onLabelCreated:this.getLabelCreatedCallback()}))}},infilteredList:function(e){for(var t=this.filteredList,o=0,n=t.length;o<n;o++)if(t[o].title===e)return!0;return!1},_filterLabels:function(e){this.filteredList=_.filter(this.activeLabels,function(t){var o=!e||0===t.title.indexOf(e);return t.$node.toggleClass("g-hidden",!o),o})},resetKdbSelection:function(){var e=this;this.visibleList&&this.visibleList[this.kbdSelected]&&this.visibleList[this.kbdSelected].$node.removeClass(this.selectedClass),$(this.selectedClass).removeClass(this.selectedClass),this.visibleList=[],$(this.elSelector).each(function(t,o){var n=$(o);e.visibleList.push({$node:n,title:n.find(e.elContentSelector).text()})}),this.kbdSelected=null},makeFakeLabel:function(e){e=Daria.capitalize(e);var t=Jane.tt("toolbar:new-fake-label",{name:e,color:"31c73b"});_.isEmpty(this.$fakeLabel)?this.$labelsHolder.append(t):this.$fakeLabel.replaceWith(t),this.$fakeLabel=$(t),this.visibleList.push({title:"fake label",$node:this.$fakeLabel})},removeFakeLabel:function(){var e=this.$fakeLabel;e&&(e.remove(),this.$fakeLabel=null)},getUnreadMessagesCount:function(e){var t=0;return e.forEach(function(e){var o=ns.Model.get("message",{ids:e});o.getData()&&o.isNew()&&t++}),t},filterByMessagesChecked:function(){var e=this._getCheckedModel(),t=e.getData(),o=this.getUnreadMessagesCount(t),n=e.getCount(),i=e.getLabels();this._filterByLabelsHash(i,{showReadLabel:o>0,showUnreadLabel:o<t.length,messagesCount:n})},_filterByLabelsHash:function(e,t){t=t||{};var o=this.$node,n=o.find(".js-read"),i=o.find(".js-unread");this.activeLabels=[],t.showReadLabel?this._addLabelToActive(n.removeClass("g-hidden")):n.addClass("g-hidden"),t.showUnreadLabel?this._addLabelToActive(i.removeClass("g-hidden")):i.addClass("g-hidden");var s=t.messagesCount||0;_(e).keys().filter(function(e){return!/^FAKE/.test(e)}).each(function(t){var n=e[t],i=o.find(".label-"+t),a=o.find(".unlabel-"+t),r=n===s;r||this._addLabelToActive(i),i.toggleClass("g-hidden",r),a.toggleClass("g-hidden",0===n)},this).value();var a=_(e).filter(function(e,t){return!/^FAKE/.test(t)}).some(function(e){return e>0});o.find(".unlabel-title, .unlabel-separator").toggleClass("g-hidden",!a),this.removeFakeLabel(),this.prevSearch=null,this.$searchInput.val(""),this._filterLabels(""),this.resetKdbSelection()},_addLabelToActive:function(e){this.activeLabels.push({$node:e,title:e.find(".b-mail-dropdown__item__content__wrapper").text().toLowerCase()})},_getCheckedModel:function(){return this.__mMessagesChecked}}},"kbd-dropdown-actions")},5553:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(1117),i=o.n(n),s=o(349);o.n(s);function a(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}!function(e){ns.View.define("toolbar",{models:{"scroller-messages":!1,toolbar:!1,settings:{"ns-model-changed":!1,"ns-model-changed.liza_minified":"onChangeCompactMode","ns-model-changed.liza_minified_header":"onChangeCompactMode","ns-model-changed.show_folders_tabs":"onFoldersTabsChanged"}},params:function(){return{layout:ns.page.current.page}},events:{"ns-view-init":"_onInit","ns-view-show":"_onShow","ns-view-hide":"_onHide","daria:vScrollerMessages:scroll@show":"_recalculateFixedPosition","daria:vApp:changeLeftColumWidth":"_recalculatePositionX","daria:vApp:changeRightColumSize":"_recalculatePositionX","daria:vToolbarAside:changeCheckedCount@show":"onChangeCheckedCount","toolbar-reset-offset":"_resetOffset","daria:layout-changed":"_resetOffset","click@show .js-toolbar-button-top":"onClickScrollToTop","daria:vMessageToolbar:reply":"onReply","daria:vMessagesItemWrap:message-opened":"onOpenMessage","daria:message-will-close@show":"onMessageWillClose","toolbar.fixed":"sendMetricsForUpButton","daria:search:toggled":"_onSearchToggled","daria:Toolbar:focus":"_focus","daria:Toolbar:focusNext":"_focusNextButton","daria:Toolbar:focusPrev":"_focusPrevButton","daria:Toolbar:focusFirst":"_focusFirstButton","daria:Toolbar:focusLast":"_focusLastButton","daria:Toolbar:focusOut":"_focusOut","daria:vApp:changeAppWidth":"_recalcCurrentButton","daria:vToolbarButton:restructFinished":"_recalcCurrentButton"},yateModule:"toolbar",methods:{controlOffsetTop:null,_onInit:function(){this.getModel("toolbar").setFixedSupport(!0),this.isFixed=!1,this._recalcCurrentButton=i()(this._recalcCurrentButton,100)},_onShow:function(){this.getModel("scroller-messages").init();var e=this.getModel("toolbar"),t=e.get(".scroll");!1===e.get(".show")&&this.$node.addClass("is-hidden"),(void 0===t||t)&&(this._initScroll(!0),_.delay(this._recalculateFixedPosition.bind(this),50)),this.hideInCompactMode(),this.currentButton||this._setFirstButton(),this.node.addEventListener("focusin",this._onFocusIn),this.node.addEventListener("focusout",this._onFocusOut)},_onFocusIn:function(){$.Shortcuts.modalListOn("toolbar")},_onFocusOut:function(){$.Shortcuts.modalListOff("toolbar")},_setFirstButton:function(){var e=this.node.querySelector('.js-toolbar-item[tabindex="-1"]');this._setCurrentButton(e)},_setLastButton:function(){var e=this.node.querySelectorAll('.js-toolbar-item[tabindex="-1"]');this._setCurrentButton(e[e.length-1])},_focusNextButton:function(){for(var e=this.currentButton;e&&"-1"!==e.getAttribute("tabindex");)e=e.nextElementSibling;e?this._setCurrentButton(e):this._setFirstButton(),this._focus()},_focusPrevButton:function(){for(var e=this.currentButton;e&&"-1"!==e.getAttribute("tabindex");)e=e.previousElementSibling;e?this._setCurrentButton(e):this._setLastButton(),this._focus()},_focusFirstButton:function(){this._setFirstButton(),this._focus()},_focusLastButton:function(){this._setLastButton(),this._focus()},_setCurrentButton:function(e){this.currentButton&&this.currentButton.setAttribute("tabindex","-1"),this.currentButton=e,this.currentButton.setAttribute("tabindex","0")},_onSearchToggled:function(){this.hideInCompactMode(),this._recalculateFixedPosition()},_onHide:function(){this._toggleFixed(!1)},_initScroll:function(t){this._hasCheckScroll=t,this.$nodeLabel=this.$node.find(".b-toolbar__item__label"),this.$nodeFixedPosition=this.$node.find(".js-toolbar-content"),e.watcher.watch("toolbar.allowfixed",this._recalculateFixedPosition.bind(this))},_getControlOffsetTop:function(){return this.$nodeLabel.length&&this.$nodeLabel[0].offsetHeight?this.$nodeLabel.offset().top:this.$node.offset().top},_recalculateFixedPosition:function(){if(!Daria.is3pane()&&this._hasCheckScroll){if(this.getModel("toolbar").getFixedSupport()){this.getModel("toolbar").isFixed()&&this._recalculatePositionX(),null===this.controlOffsetTop&&(this._toggleFixed(!1),this.controlOffsetTop=this._getControlOffsetTop());var e=this.getModel("scroller-messages").getScrollTop();if(this.controlOffsetTop-e<0&&(!this._isMessageOpen()||Daria.isMessagePage()))return void this._toggleFixed(!0)}this._toggleFixed(!1)}},_isMessageOpen:function(){var e=ns.page.current.params;return!(!e.thread_id&&!e.ids)&&(ns.events.trigger("daria:vToolbar:message-opened"),!0)},_recalculatePositionX:function(){if(!this.$nodeFixedPosition)return!1;var e={left:"",right:""};if(this.isFixed){e.left=this.$node.offset().left,e.right=$(window).width()-this.$node.outerWidth()-e.left;var t=this.getModel("scroller-messages").getScroller().scrollLeft();t>0&&(e.right+=t,e.left=$(".js-compose-button-container").innerWidth())}this.$nodeFixedPosition.css(e)},_toggleFixed:function(e){this.getModel("toolbar").toggleFixed(e)&&(e&&$(document).trigger("b-mail-dropdown-closeall-onscroll"),this.isFixed=e,this._recalculatePositionX(),this.$node.toggleClass("is-fixed",e),ns.events.trigger("toolbar.fixed",e))},_resetOffset:function(){this._hasCheckScroll&&(this.controlOffsetTop=null,_.defer(this._recalculateFixedPosition.bind(this)))},onClickScrollToTop:function(){this.getModel("scroller-messages").setScrollTop(0,!0),this._sendMetricsForUpButton(["Клик"])},_sendMetricsForUpButton:function(t){e.c.apply(e,['Кнопка "Наверх"',"в тулбаре"].concat(a(t)))},sendMetricsForUpButtonMemoize:Daria.memoizeById({},function(){return this.__uniqueId},function(){this._sendMetricsForUpButton(["Показ"])}),sendMetricsForUpButton:function(e,t){t&&this.sendMetricsForUpButtonMemoize()},onFoldersTabsChanged:function(){Daria.userToolbar.invalidateCache()},onChangeCompactMode:function(){this._resetOffset(),this.hideInCompactMode(),this.$node.find(".js-toolbar-content").toggleClass("mail-Toolbar-Content_MessagesList_height_small",Daria.CompactMode.isCompactMessagesList())},hideInCompactMode:function(){if(Daria.CompactMode.isCompactHeader()){var e=Object(s.hasFeature)(s.Features.REACT_CLIENT_HEADER)||Object(s.hasFeature)(s.Features.REACT_LAYOUT)?"is-search-opened":"is-hidden",t=!Daria.React.getSearchBoxIsFolded();this.$node.find(".js-toolbar").toggleClass(e,t),ns.events.trigger("Daria:vToolbar:toggleVisibilityWithUnfoldedSearch",t)}},onChangeCheckedCount:function(e,t){this.$node.toggleClass("is-active",Boolean(t)),Daria.CompactMode.isCompactHeader()&&(t>0?Daria.React.getSearchBoxIsFolded()||(Daria.React.toggleSuggestFolded(!0),this.wasSuggestFoldBeforeToolbarOpened=!0):this.wasSuggestFoldBeforeToolbarOpened&&Daria.isSearchPage()&&(this.wasSuggestFoldBeforeToolbarOpened=!1,Daria.React.toggleSuggestFolded(!1),Daria.React.showLastSearchQuery()))},onOpenMessage:function(){this._toggleFixed(!1)},onMessageWillClose:function(){var e=this;_.delay(function(){e._recalculateFixedPosition()},150)},onMessagesCheckedChanged:function(){Daria.is3pane()},onReply:function(e,t){(Daria.isMessagePage()||Daria.isMessageOpenedInList())&&this.onReplyHotkey(e,t)},_focus:function(){this.currentButton&&(Daria.Focus.clearFocus(),this.currentButton.focus())},_recalcCurrentButton:function(){this.currentButton&&"0"===this.currentButton.getAttribute("tabindex")||this._setFirstButton()},_focusOut:function(){this.currentButton.blur(),Daria.Focus.moveItem({toForward:!0})}}},"message-actions")}(Jane)},5554:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(349),i=(o.n(n),o(347)),s=o(376),a=o.n(s);!function(e){var t=[];t.push("react-droppable-mixin"),ns.View.defineNg("toolbar-button",{events:{"ns-view-htmlinit":"_onHtmlInit","ns-view-show":"_onShow","ns-view-hide":"_onHide","click@show":"_onClick","keydown@show":"_onKeyDown",drop:"_onDrop","daria:vToolbarButton:droppableInit@show":"_onDroppableInit","daria:vToolbarButton:droppableDestroy@show":"_onDroppableDestroy"},models:{"toolbar-button":!1,"messages-checked":!1},params:function(e){var t={id:e.id};return _.extend(ns.View.infoLite("toolbar-buttons").params(e),t)},yateModule:"toolbar",mixins:t,methods:{_wasDroppableInited:!1,_onHtmlInit:function(){this.initData(),this._onDragChanged=this._onDragChanged.bind(this)},_onShow:function(){this.droppableInit()},_onHide:function(){this.droppableDestroy()},invalidate:function(){return!1},initData:function(){var e=this.getModel("toolbar-button");this.action=e.get(".action"),this.disabledAction=e.get(".disabledAction"),this.actionParams=e.get(".actionParams"),_.isFunction(this.actionParams)&&(this.actionParams=this.actionParams(this.params))},setTabIndex:function(e){this.$node.attr("tabindex",e)},_onDroppableInit:function(e,t){this.getId()===t&&this.droppableInit()},_onDroppableDestroy:function(e,t){this.getId()===t&&this.droppableDestroy()},_onDrop:function(e,t){ns.events.trigger("daria:vToolbarButton:onDrop",{id:this.getId(),event:e,dropParams:t})},droppableInit:function(){var e=this.getModel("toolbar-button");if(e.get(".droppable")){var t=e.get(".droppableParams");this.$node.droppable(t),this._wasDroppableInited=!0}var o=Object(i.getDndBridge)();o&&(this._disposer=o.onDragChange(this._onDragChanged))},droppableDestroy:function(){this._wasDroppableInited&&(this._wasDroppableInited=!1,this.$node.droppable("destroy")),this._disposer&&this._disposer()},_getActionParams:function(){return this.actionParams},_onClick:function(t,o){switch(o=o||ns.action.getParams(t.currentTarget),e.ToolbarMetric.setToolbarMetrics(t,o,this.prepareParamsForAction().buttonView.action,this.getCurrentMessageIfSingle()),this.action){case null:case"mailbox.check":break;case"deselect":this.getCheckedModel().resetChecked();break;case"select-all":this.getCheckedModel().selectList();break;default:this.defaultAction(t)}return"mailbox.check"===this.action},_onKeyDown:function(e){e.keyCode===a.a.ENTER&&this._onClick(e)},defaultAction:function(){if(!this.enabled())return!1;var e=this.prepareParamsForAction(),t=this.getCheckedModel();if(Daria.DEBUG&&console.log("daria.vToolbarButton","runOps",this.action,e),_.contains(["forward","sendon","reply","reply-all","reply-tmpl","reply-later"],this.action))return e.mMessagesChecked=t,void ns.action.run(this.action,e);var o=t.runOps(this.action,e),n=this.getModel("toolbar-button").get(".callback");n&&"function"==typeof n&&o.then(n,this)},prepareParamsForAction:function(){return _.extend({buttonView:this,toolbar:1},this._getActionParams())},isVisible:function(){return!this.$node.hasClass("is-hidden")},getWidth:function(){return this.isVisible()?(this.getId()===Daria.Constants.TOOLBAR_BUTTONS.LABELS_ACTIONS&&(this._width=Math.floor(this.$node.outerWidth(!0))),this._width||(this._width=this.$node.outerWidth(!0)),this._width):0},resetButtonWidth:function(){delete this._width},enabled:no.True,getId:function(){return this.getModel("toolbar-button").get(".id")},getFolderIdFromParams:function(){var e=this.params.current_folder||Daria.isSearchPage()&&this.params.fid;return this.params.mid&&(e=ns.Model.get("message",{ids:this.params.mid}).getFolderId()),e},hide:function(e){e||this.isVisible()||ns.events.trigger("daria:vToolbarButton:restruct",this),this.$node.addClass("is-hidden"),this.$node.removeAttr("tabindex")},show:function(e){!e&&this.isVisible()&&ns.events.trigger("daria:vToolbarButton:restruct",this),this.$node.removeClass("is-hidden"),"0"!==this.$node.attr("tabindex")&&this.$node.attr("tabindex","-1")},shouldShow:function(){if(Object(n.hasFeature)(n.Features.WEB_TOOLBAR_NO_BUTTONS)){var e=this.getCheckedModel(),t=e&&e.getCount;return t?this.toShow()&&Boolean(t.call(e)):this.toShow()}return this.toShow()},toShow:function(){return this._canBeShown()&&(this._forceShown||this.getModel("toolbar-button").toShow())},getCheckedModel:function(){return this.getModel("messages-checked")},_canBeShown:function(){var e=this.getModel("toolbar-button"),t=this.getCheckedModel(),o=this.getId(),n=Daria.messages.canShowPinControlsByParams(),i=Daria.Constants.TOOLBAR_BUTTONS;return[i.ABOOK_ADD,i.ABOOK_MORE].indexOf(o)>-1||!!t&&(!(!n&&this.isPinOrUnpin())&&e.toEnable())},isPinOrUnpin:function(){var e=this.getId();return e===Daria.Constants.TOOLBAR_BUTTONS.PIN||e===Daria.Constants.TOOLBAR_BUTTONS.UNPIN},canBeShownSelectOrDeselect:function(){var e=this.getId(),t=this.getCheckedModel(),o=t.shouldSelectAll();if("select-all"===e)return o;if("deselect"===e){var n=t.getCount();return!o||n>4}return!1},select:function(){this.$node.find(".js-toolbar-button").addClass("b-toolbar__item_selected")},deselect:function(){this.$node.find(".js-toolbar-button").removeClass("b-toolbar__item_selected")},forceShow:function(e){this._forceShown=e,this._canBeShown()?this.show():this.hide()},triggerClick:function(e,t){return this._onClick(e,t)},_runAction:function(e){ns.action.run(this.action,{},e.currentTarget,e)},isSpecial:function(){return Boolean(this.getModel("toolbar-button").get(".special"))},getCurrentMessageIfSingle:function(){var e=this.getModel("messages-checked");if(!e)return null;var t=e.getIds();return t&&0===t.tids.length&&1===t.ids.length?ns.Model.get("messages",ns.page.current.params).getMessageByMid(t.ids[0]):null},reactDroppableOnDropEnter:function(){this.node.classList.add("g-drop-place_hover")},reactDroppableOnDropLeave:function(){this.node.classList.remove("g-drop-place_hover")},_onDragChanged:function(e){e&&"message"===e.type?this.node.classList.add("g-dragging"):this.node.classList.remove("g-dragging")}}}),o(5555),o(5556),o(5557),o(5558),o(5559),o(5560),o(5561),o(5562),o(5563),o(5564),o(5565),o(5566),o(5567),o(5568),o(5569),o(5570),o(5571),o(5572),o(5573),o(5574),o(5575),o(5576),o(5577),o(5578),o(5579),o(5580),o(5581),o(5582),o(5583),o(5584),o(5585),o(5586),o(5587),o(5588),o(5589),o(5590),o(5591),o(5592),o(5593)}(Jane)},5555:function(e,t){ns.View.edefine("toolbar-button-abook",{events:{"daria:vAbookContacts:selectionChanged":"onSelectionChanged","ns-page-after-load":"_toggleSelectAllState"},models:{"toolbar-button":!1,"abook-selected":!1},params:function(e){var t={id:e.id,type:e.type};return _.extend(ns.View.infoLite("toolbar-buttons").params(e),t)},yateModule:"toolbar",methods:{_toggleSelectAllState:function(){if(this.getId()===Daria.Constants.TOOLBAR_BUTTONS.ABOOK_SELECT_ALL){var e=this.getCheckedModel().isEmptyContactsList();this.$node.toggleClass("is-disabled",e),this.$node.attr("aria-disabled",e)}},getCheckedModel:function(){return this.getModel("abook-selected")},onSelectionChanged:function(e,t){var o=this.getModel("toolbar-button").getData().id;_.has(t,o)&&(this.__toShow=Boolean(t[o]))},toShow:function(){var e=this.getId(),t=[Daria.Constants.TOOLBAR_BUTTONS.ABOOK_SELECT_ALL,Daria.Constants.TOOLBAR_BUTTONS.ABOOK_DESELECT_ALL].indexOf(e)>-1,o=1===this.params.shared,n=this.getCheckedModel().containsShared();return!((o||n)&&!t)&&([Daria.Constants.TOOLBAR_BUTTONS.ABOOK_ADD,Daria.Constants.TOOLBAR_BUTTONS.ABOOK_RESTORE,Daria.Constants.TOOLBAR_BUTTONS.ABOOK_MORE].indexOf(e)>-1||(e===Daria.Constants.TOOLBAR_BUTTONS.ABOOK_SELECT_ALL&&void 0===this.__toShow||this.__toShow))}}},"toolbar-button")},5556:function(e,t){!function(){var e=ns.View.infoLite("toolbar-button").methods;ns.View.edefine("toolbar-button-hybrid-abstract",{yateModule:"toolbar",methods:{_onHtmlInit:function(){e._onHtmlInit.call(this),this.folderAction=this.getModel("toolbar-button").get(".folderAction")},_onClick:function(e,t){t=t||ns.action.getParams(e.currentTarget),Jane.ToolbarMetric.setToolbarMetrics(e,t,this.prepareParamsForAction().buttonView.action,this.getCurrentMessageIfSingle()),this.defaultAction()},toShow:function(){return!(!this.folderAction||!this.getModel("messages-checked").isFolderOrTabSelected())||e.toShow.call(this)},refreshVisibility:function(){var e=this.toShow();this.$node.toggleClass("is-hidden",!e),e&&"0"!==this.$node.attr("tabindex")?this.$node.attr("tabindex","-1"):this.$node.removeAttr("tabindex")}}},"toolbar-button")}()},5557:function(e,t){!function(){var e=null,t=!1,o=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-disable-in",{events:{},models:o.models,params:o.params,yateModule:"toolbar",methods:{toShow:function(){if(this.params.mid&&(ns.Model.get("message-body",{ids:this.params.mid}).isLoaded()&&!this.toEnableExtended()))return!1;return o.methods.toShow.call(this)},toEnableExtended:no.true,toEnableInCollectMessage:function(){return!this.params.mid||!ns.Model.get("message-body",{ids:this.params.mid}).isCollectorMessage()},toEnableInNotificationMessage:function(){if(this.params.mid){if(!t){t=!0;var o=ns.Model.get("labels").getLabelByName("SystMetkaWJDT:NOTIFY");o&&(e=o.id)}if(e)if(ns.Model.get("message",{ids:this.params.mid}).hasLabel(e))return!1}return!0}}},"toolbar-button")}()},5558:function(e,t){ns.View.define("toolbar-button-disabled",{yateModule:"toolbar",methods:{enabled:function(){var e=this.getCheckedModel();return(e.getCount()||e.isFolderOrTabSelected())&&this.toEnableExtended()},toEnableExtended:no.true,toggleEnabled:function(e,t){var o=void 0===t?this.enabled():t;this.$node.toggleClass("is-disabled",!o),this.$node.attr("aria-disabled",!o)}}})},5559:function(e,t){function o(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}ns.View.define("toolbar-button-reply-later-mixin",{yateModule:"toolbar",methods:{toEnableExceptReplyLater:function(){if(this.params.mid)return!ns.Model.get("message",{ids:this.params.mid}).isReplyLater();var e=this.getCheckedModel().getIds();return[].concat(o(e.ids),o(e.tids)).map(function(e){return ns.Model.get("message",{ids:e})}).every(function(e){return!e.isReplyLater()})},toEnableExceptReplyLaterStarted:function(){if(this.params.mid)return!ns.Model.get("message",{ids:this.params.mid}).isReplyLaterStarted();var e=this.getCheckedModel().getIds();return[].concat(o(e.ids),o(e.tids)).map(function(e){return ns.Model.get("message",{ids:e})}).every(function(e){return!e.isReplyLaterStarted()})}}})},5560:function(e,t){ns.View.edefine("toolbar-button-main-select-all",{events:{"ns-view-show":"toggleDisablement"},models:{"toolbar-button":!1,"messages-checked":{"ns-model-touched":"onMessagesCheckedTouched","ns-model-reset-checked":"refreshVisibility"},settings:{"ns-model-changed":!1,"ns-model-changed.show_checkbox_inside_userpic":"onSettingChange"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{invalidate:ns.View.prototype.invalidate,onMessagesCheckedTouched:function(){this.toggleDisablement()},onSettingChange:function(){this.invalidate()},toggleDisablement:function(){var e=this.getCheckedModel(),t=e.isEmptyMessagesList(),o=!t&&e.isPinnedMessagesList(),n=t||o;this.isDisabled=n,this.$node.toggleClass("is-disabled",n)},shouldShow:function(){return this.toShow()},toShow:function(){return this.getCheckedModel().shouldSelectAll()},_onClick:function(){if(this.isDisabled)return!1;var e=this.getCheckedModel();e.resetChecked(),e.selectList(!0),e.trigger("ns-model-reset-checked"),setTimeout(function(){return $(".js-a11y-toolbar-checkbox").focus()},10)}}},"toolbar-button-disable-in","toolbar-button-hybrid-abstract")},5561:function(e,t){ns.View.edefine("toolbar-button-main-deselect-all",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-reset-checked":"refreshVisibility"},settings:{"ns-model-changed":!1,"ns-model-changed.show_checkbox_inside_userpic":"onSettingChange"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{invalidate:ns.View.prototype.invalidate,onSettingChange:function(){this.invalidate()},toShow:function(){return!this.getCheckedModel().shouldSelectAll()},_onClick:function(){this.getCheckedModel().resetChecked(),setTimeout(function(){return $(".js-a11y-toolbar-checkbox").focus()},10)}}},"toolbar-button-disable-in","toolbar-button-hybrid-abstract")},5562:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(407),i=o(347),s=o(551);!function(){var e=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-reply",{models:e.models,params:e.params,yateModule:"toolbar",methods:{_onClick:function(e){var t=this;e.stopPropagation(),e.preventDefault(),Object(i.getPddRestrictNotificationsModel)().showPopup(function(){return Object(s.b)(t.getCheckedModel().getCheckedMessages())})||(Daria.startScenarioForCompose(n.o),this.super_._onClick.apply(this,arguments),window.Apdex.start(["Performance_openCompose"],!0))},toEnableExtended:function(){return this.toEnableInCollectMessage()&&this.toEnableInNotificationMessage()}}},"toolbar-button-disable-in")}()},5563:function(e,t){!function(){var e=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-edit",{models:e.models,params:e.params,yateModule:"toolbar"},"toolbar-button-disable-in")}()},5564:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(407),i=o(462);o.n(i);!function(){var e=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-forward",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:e.params,yateModule:"toolbar",methods:{REACT_DROPPABLE_ACCEPTS:["message"],_onClick:function(e){e.stopPropagation(),e.preventDefault(),this.enabled()&&("message"===ns.page.current.page?Daria.startScenarioForCompose(n.j):"messages"===ns.page.current.page&&Daria.startScenarioForCompose(n.h)),this.super_._onClick.apply(this,arguments),window.Apdex.start(["Performance_openCompose"],!0)},enabled:function(){var e=this.getModel("messages-checked").getCount();return e>0&&e<=Daria.Constants.MAX_MESSAGES_TO_FORWARD},toEnableExtended:function(){return this.toEnableInCollectMessage()&&this.toEnableInNotificationMessage()},reactDroppableDragLabel:function(e){return i18n("%Drag_Переслать",e.count)},reactDroppableOnDrop:function(){this.defaultAction(),i.MetrikaService.instance().dragAndDrop.logDropMessageOnToolbarForward()}}},"toolbar-button-disabled","toolbar-button-disable-in")}()},5565:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137),i=(o.n(n),o(462));o.n(i);!function(){var e=ns.View.infoLite("toolbar-button"),t=ns.View.infoLite("toolbar-button-disable-in");ns.View.edefine("toolbar-button-spam",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:e.params,yateModule:"toolbar",methods:{REACT_DROPPABLE_ACCEPTS:["message"],toShow:function(){var e=!1,o=this.getFolderIdFromParams();if(o){var i=ns.Model.get("folders");if(i.isFolder(o,n.SpamDisabledFoldersShort))return!1;e=i.isFolder(o,[n.WellKnownFolderSymbol.SPAM])}return!e&&t.methods.toShow.apply(this,arguments)},toEnableExtended:function(){return this.toEnableInCollectMessage()&&this.toEnableInNotificationMessage()},reactDroppableDragLabel:function(e){return i18n("%Drag_Пометить_как_спам",e.count)},reactDroppableOnDrop:function(){this.reactDroppableWithDndBridge(function(e){return e.dragPreventDeselect()}),this.defaultAction(),i.MetrikaService.instance().dragAndDrop.logDropMessageOnToolbarSpam()}}},"toolbar-button-disabled","toolbar-button-disable-in")}()},5566:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137),i=(o.n(n),o(462));o.n(i);!function(){var e=ns.View.infoLite("toolbar-button-spam"),t=ns.View.infoLite("toolbar-button-disable-in");ns.View.edefine("toolbar-button-not-spam",{models:e.models,params:e.params,yateModule:"toolbar",methods:{REACT_DROPPABLE_ACCEPTS:["message"],toShow:function(){var e=!1,o=this.getFolderIdFromParams();return o&&(e=ns.Model.get("folders").isFolder(o,[n.WellKnownFolderSymbol.SPAM])),e&&t.methods.toShow.apply(this,arguments)},reactDroppableDragLabel:function(e){return i18n("%Drag_Пометить_как_неспам",e.count)},reactDroppableOnDrop:function(){this.reactDroppableWithDndBridge(function(e){return e.dragPreventDeselect()}),this.defaultAction(),i.MetrikaService.instance().dragAndDrop.logDropMessageOnToolbarNotSpam()}}},"toolbar-button-spam")}()},5567:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137);o.n(n);!function(){var e=ns.View.infoLite("toolbar-button-hybrid-abstract").methods;ns.View.edefine("toolbar-button-pin",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{toShow:function(){var t=this.getFolderIdFromParams();return(!t||!ns.Model.get("folders").isFolder(t,[n.WellKnownFolderSymbol.SPAM]))&&(!!e.toShow.call(this)&&!this.getCheckedModel().hasPinnedCheckedMessage())},toEnableExtended:function(){return this.toEnableExceptReplyLater()}}},"toolbar-button-disabled","toolbar-button-reply-later-mixin","toolbar-button-disable-in","toolbar-button-hybrid-abstract")}()},5568:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137);o.n(n);!function(){var e=ns.View.infoLite("toolbar-button-hybrid-abstract").methods;ns.View.edefine("toolbar-button-unpin",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{toShow:function(){var t=this.getFolderIdFromParams();return(!t||!ns.Model.get("folders").isFolder(t,[n.WellKnownFolderSymbol.SPAM]))&&(!!e.toShow.call(this)&&this.getCheckedModel().hasPinnedCheckedMessage())},toEnableExtended:function(){return this.toEnableExceptReplyLater()}}},"toolbar-button-disabled","toolbar-button-reply-later-mixin","toolbar-button-disable-in","toolbar-button-hybrid-abstract")}()},5569:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(462),i=(o.n(n),"toolbar-button-hybrid-abstract"),s=ns.View.infoLite(i).methods,a=ns.View.infoLite("toolbar-button-disable-in").methods;ns.View.edefine("toolbar-button-mark-as-read",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{REACT_DROPPABLE_ACCEPTS:["message"],toShow:function(){if(this._forceShown)return!0;var e=this.getCheckedModel();if(e.isTabSelected()){var t=e.getTabs(),o=ns.Model.get("tabs"),n=!1;for(var i in t)if(t[i]>0&&o.getUnreadCount(i)>0){n=!0;break}if(!n)return!1}else if(e.isFolderSelected()){var r=e.getFolders(),l=ns.Model.get("folders"),d=!1;for(var c in r)if(r[c]>0&&l.getUnreadCount(c)>0){d=!0;break}if(!d)return!1}else{if(!a.toShow.call(this))return!1;if(!s.toShow.call(this))return!1}return!ns.Model.get("folders").isCurrentFolder("template")&&(!!e.isFolderOrTabSelected()||!e.areAllCheckedRead())},toEnableExtended:function(){return this.toEnableInNotificationMessage()},reactDroppableDragLabel:function(e){return i18n("%Drag_Пометить_прочитанным",e.count)},reactDroppableOnDrop:function(){this.reactDroppableWithDndBridge(function(e){return e.dragPreventDeselect()}),this.defaultAction(),n.MetrikaService.instance().dragAndDrop.logDropMessageOnToolbarMarkRead()}}},"toolbar-button-disabled","toolbar-button-disable-in",i)},5570:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(462);o.n(n);!function(){var e="toolbar-button-hybrid-abstract",t=ns.View.infoLite(e).methods;ns.View.edefine("toolbar-button-mark-as-unread",{models:{"toolbar-button":!1,"messages-checked":!1},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{REACT_DROPPABLE_ACCEPTS:["message"],toShow:function(){if(this._forceShown)return!0;if(ns.Model.get("folders").isCurrentFolder("template"))return!1;var e=this.getCheckedModel();return!!e.getCount()&&(!!t.toShow.call(this)&&e.areAllCheckedRead())},toEnableExtended:function(){return this.toEnableInNotificationMessage()},reactDroppableDragLabel:function(e){return i18n("%Drag_Пометить_непрочитанным",e.count)},reactDroppableOnDrop:function(){this.defaultAction(),n.MetrikaService.instance().dragAndDrop.logDropMessageOnToolbarMarkUnread()}}},"toolbar-button-disable-in",e)}()},5571:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(462);o.n(n);!function(){var e=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-delete",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:e.params,yateModule:"toolbar",methods:{REACT_DROPPABLE_ACCEPTS:["message"],reactDroppableDragLabel:function(e){return i18n("%Drag_Удалить",e.count)},reactDroppableOnDrop:function(){this.reactDroppableWithDndBridge(function(e){return e.dragPreventDeselect()}),this.defaultAction(),n.MetrikaService.instance().dragAndDrop.logDropMessageOnToolbarDelete()}}},"toolbar-button-disabled","toolbar-button-hybrid-abstract")}()},5572:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(1594);o.n(n);function i(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}ns.View.edefine("toolbar-button-reply-later",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{_getMessages:function(){if(this.params.mid)return[ns.Model.get("message",{ids:this.params.mid})];var e=this.getCheckedModel().getIds();return[].concat(i(e.ids),i(e.tids)).map(function(e){return ns.Model.get("message",{ids:e})})},toEnableExtended:function(){var e=this._getMessages();return 1===e.length&&e.every(function(e){var t=e.getReplyLaterStickers();return e.isReplyLaterAllowed()&&t.length<=1})},_onClick:function(e,t){if(!this.enabled())return!1;t=t||ns.action.getParams(e.currentTarget);var o=this._getMessages()[0].getReplyLaterDate();Object(n.renderReplyLaterPopup)({anchor:{current:e.currentTarget},direction:t.isInMore?"left":"bottom",onSelectedDate:this._onSelectReplyLaterDate.bind(this),remindDate:o,onRemoveReminder:this._onRemoveReminder.bind(this),enableFocusTrap:!0}),Jane.ToolbarMetric.setToolbarMetrics(e,t,"reply-later",this.getCurrentMessageIfSingle())},_onSelectReplyLaterDate:function(e){Daria.MOPS["reply-later-create"](this.getCheckedModel(),{date:e})},_onRemoveReminder:function(){Daria.MOPS["reply-later-remove"](this.getCheckedModel())}}},"toolbar-button-disabled","toolbar-button-disable-in","toolbar-button-hybrid-abstract")},5573:function(e,t){ns.View.edefine("toolbar-button-more",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:{id:null},yateModule:"toolbar",methods:{_onHtmlInit:function(){this.initData()},_onShow:function(){this.initNb()},_onHide:function(){this.nbPopup.destroy()},initNb:function(){this.nbPopupToggler=nb.block(this.node),this.nbPopup=nb.$block(".js-main-toolbar-more-menu"),this.nbPopup.on("nb-select",this.onMenuItemClick.bind(this))},closeExtendButtons:function(){this.$extend&&(this.$extend.remove(),this.$extend=null,Daria.Dropdown.closeCurrent())},toShow:function(){return _.any(this._extendButtonViews,function(e){return e.toShow()})},setExtendButtons:function(e){var t=e.map(function(e){return e.getId()});this._extendButtons=e.map(function(e){return e.getModel("toolbar-button")}),this._extendButtonViews=e,Jane.watcher.set("toolbar.buttons.extend",t.join(","))},_onClick:function(e){return this.enabled()?(_.delay(function(){var e=this._extendButtons.map(function(e){return _.assign({},e.getData(),e.getExData())}),t=Jane.tt("toolbar:toolbar-button-more-menu-content",{popupMenu:{menu:e}});this.nbPopup.setContent(t),this.nbPopupToggler.open()}.bind(this)),!1):(e.stopPropagation(),!1)},onMenuItemClick:function(e,t){var o=t.ui.item,n=o.children("a").data("id"),i=Daria.Constants.TOOLBAR_BUTTONS;if(n){var s=_.find(this._extendButtonViews,function(e){return e.getId()===n});if(s){[i.LABELS_ACTIONS,i.FOLDERS_ACTIONS,i.REPLY_LATER].includes(n)||this.nbPopupToggler.close();var a={isInMore:!0},r=ns.action.getParams(o.children("a")[0]);r&&r.source&&(a.source=r.source),s.triggerClick(t.event,a)}}}}},"toolbar-button-disabled","toolbar-button")},5574:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(407),i=o(347),s=o(551);!function(){var e="toolbar-button-disable-in",t=ns.View.infoLite(e);ns.View.edefine("toolbar-button-reply-all",{models:t.models,params:t.params,yateModule:"toolbar",methods:{_onClick:function(e){var t=this;e.stopPropagation(),e.preventDefault(),Object(i.getPddRestrictNotificationsModel)().showPopup(function(){return Object(s.b)(t.getCheckedModel().getCheckedMessages(),!0)})||(Daria.startScenarioForCompose(n.l),this.super_._onClick.apply(this,arguments),window.Apdex.start(["Performance_openCompose"],!0))},toEnableExtended:function(){var e=ns.Model.get("message-body",{ids:this.params.mid});return e.isLoaded()&&e.allowedReplyAll()&&this.toEnableInCollectMessage()&&this.toEnableInNotificationMessage()}}},e)}()},5575:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137),i=(o.n(n),o(550));ns.View.edefine("toolbar-button-unsubscribe-one",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{__customInit:function(){Daria.IS_CORP||Object(i.d)()},_getCurrentMessage:function(){return ns.Model.get("message",{ids:this.params.mid})},toShow:function(){var e=this._getCurrentMessage();return!Daria.IS_CORP&&e&&!e.inFolderBySymbol(n.InternalFolders)},enabled:function(){var e=this._getCurrentMessage();return e&&e.isSubscriptionMessage()}}},"toolbar-button-disabled","toolbar-button-disable-in","toolbar-button-hybrid-abstract")},5576:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(550),i=o(137);o.n(i);!function(){var e=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-unsubscribe-all",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:e.params,yateModule:"toolbar",methods:{__customInit:function(){Daria.IS_CORP||Object(n.d)()},_hasSubscriptionMessages:function(){if(Daria.IS_CORP)return!1;var e=Object(n.f)(Object(n.e)(this.getCheckedModel()));return Boolean(e.length)},toShow:function(){return!Daria.IS_CORP&&!ns.Model.get("folders").isFolder(ns.page.current.params.current_folder,i.InternalFolders)},enabled:function(){return this._hasSubscriptionMessages()}}},"toolbar-button-disabled","toolbar-button-hybrid-abstract")}()},5577:function(e,t){var o=ns.View.infoLite("toolbar-button-hybrid-abstract").methods;ns.View.edefine("toolbar-button-mark-important",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{toShow:function(){return!!o.toShow.call(this)&&!this.getCheckedModel().hasImportantCheckedMessage()},_onClick:function(e,t){var o=ns.Model.get("labels").getImportantLID();this.getCheckedModel().runAction("label",{lid:o}),t=t||ns.action.getParams(e.currentTarget),Jane.ToolbarMetric.setToolbarMetrics(e,t,this.prepareParamsForAction().buttonView.action,this.getCurrentMessageIfSingle())}}},"toolbar-button-disabled","toolbar-button-disable-in","toolbar-button-hybrid-abstract")},5578:function(e,t){var o=ns.View.infoLite("toolbar-button-hybrid-abstract").methods;ns.View.edefine("toolbar-button-mark-unimportant",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{toShow:function(){return!!o.toShow.call(this)&&this.getCheckedModel().hasImportantCheckedMessage()},_onClick:function(e,t){var o=ns.Model.get("labels").getImportantLID();this.getCheckedModel().runAction("unlabel",{lid:o}),t=t||ns.action.getParams(e.currentTarget),Jane.ToolbarMetric.setToolbarMetrics(e,t,this.prepareParamsForAction().buttonView.action,this.getCurrentMessageIfSingle())}}},"toolbar-button-disabled","toolbar-button-disable-in","toolbar-button-hybrid-abstract")},5579:function(e,t){!function(){var e=ns.View.infoLite("toolbar-button").methods;ns.View.edefine("toolbar-button-customizable-abstract",{yateModule:"toolbar",methods:{runButtonAction:function(){if(this.toShowWithSettings()){var e=$.Event("click",{target:this.node});this.triggerClick(e)}},toShow:function(){var e=this.getSettingsKey();if(this._forceShown)return!0;if(this._lazyInitToolbarSettingsModel(),!this.mToolbarSettings||!this.mToolbarSettings.get(e))return!1;var t=this.getModel("messages-checked").isFolderOrTabSelected();return this.getId()!==Daria.Constants.TOOLBAR_BUTTONS.TEMPLATE||!t&&this.toShowWithSettings()},toShowWithSettings:function(){ns.assert(null,"vToolbarButtonCustomizableAbstract","%s coundn't be called directly. It's abstract")},show:function(){e.show.apply(this,arguments)},_lazyInitToolbarSettingsModel:function(){this._toolbarSettingsModelInitDone||(this._toolbarSettingsModelInitDone=!0,this.mToolbar=ns.Model.get("toolbar",{layout:ns.page.current.page}),this.mToolbar&&this.mToolbar.areSettingsEnabled()&&this.getModel("toolbar-button").isModelWithSettings()&&(this.mToolbarSettings=Daria.userToolbar))},_getActionParams:function(){return this._lazyInitToolbarSettingsModel(),_.clone(this.mToolbarSettings.get(this.getSettingsKey()).settings)},getSettingsKey:function(){return this.getId()},updateName:_.noop}},"toolbar-button")}()},5580:function(e,t){!function(){var e=ns.View.infoLite("toolbar-button-customizable-abstract").methods;ns.View.edefine("toolbar-button-with-customizable-name",{events:{"daria:vToolbarButton:updateName":"updateName"},yateModule:"toolbar",methods:{toShow:function(){return e.toShow.apply(this,arguments)},show:function(){this.updateName(),e.show.apply(this,arguments)},updateName:function(){var e=this.mToolbarSettings.getCustomizableButtonName(this.getId());e&&this.getModel("toolbar-button").setName(e)},redrawName:function(){var e=this.getModel("toolbar-button").get(".name");this.$node.find(".js-toolbar-item-title").text(e)}}},"toolbar-button-customizable-abstract")}()},5581:function(e,t){ns.View.edefine("toolbar-button-archive",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{toShowWithSettings:function(){var e=ns.Model.get("folders"),t=this.getFolderIdFromParams();return!t||!e.isArchive(t)},toEnableExtended:function(){var e=this.getFolderIdFromParams();return(!e||!ns.Model.get("folders").isArchive(e))&&this.toEnableExceptReplyLaterStarted()}}},"toolbar-button-disabled","toolbar-button-reply-later-mixin","toolbar-button-customizable-abstract")},5582:function(e,t){!function(){var e=ns.View.infoLite("toolbar-button-disable-in"),t=ns.View.infoLite("toolbar-button-with-customizable-name");ns.View.edefine("toolbar-button-sendon",{events:{"daria:vToolbarButtonSendOn:doForward@show":"runButtonAction"},models:{"toolbar-button":{"ns-model-changed":"keepValid","ns-model-changed.name":"redrawName"},"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{toShowWithSettings:function(){return this.getCheckedModel().getCount()>0},toShow:function(){if(t.methods.toShow.call(this))return e.methods.toShow.call(this)},toEnableExtended:function(){return this.toEnableInNotificationMessage()}}},"toolbar-button-disabled","toolbar-button-disable-in","toolbar-button-with-customizable-name")}()},5583:function(e,t){ns.View.edefine("toolbar-button-infolder",{models:{"toolbar-button":{"ns-model-changed":"keepValid","ns-model-changed.name":"redrawName"},"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{updateName:function(){this.getModel("toolbar-button").setName(this.mToolbarSettings.getCustomizableButtonName(this.getId()))},toShowWithSettings:function(){var e=this.getFolderIdFromParams();if(Daria.IS_CORP&&ns.Model.get("folders").isShared(e))return!1;if(e&&e===jpath(this.mToolbarSettings.get(this.getId()),".settings.folder")[0])return!1;var t=this.getCheckedModel();return t.getCount()>0&&!t.isFolderSelected()},toEnableExtended:function(){return this.toEnableExceptReplyLaterStarted()}}},"toolbar-button-disabled","toolbar-button-reply-later-mixin","toolbar-button-with-customizable-name")},5584:function(e,t){ns.View.edefine("toolbar-button-label",{models:{"toolbar-button":{"ns-model-changed":"keepValid","ns-model-changed.name":"redrawName"},"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{toShowWithSettings:function(e){e=e||this.getId();var t=this.mToolbarSettings.get(e),o=this.getCheckedModel(),n=t.settings.label,i=o.getIds("label",{lid:n});return i.ids.length+i.tids.length>0}}},"toolbar-button-disabled","toolbar-button-with-customizable-name")},5585:function(e,t){ns.events.on("pageinit",function(){ns.events.on("daria:mComposeMessage:template-saved",function(e,t){var o=Daria.Constants.TOOLBAR_BUTTONS.TEMPLATE;if(t.oldMid&&t.mid){var n=Daria.userToolbar.get(o);n&&n.settings.tmpl===t.oldMid&&(n.settings.tmpl=t.mid,Daria.userToolbar.set())}})});var o=ns.View.infoLite("toolbar-button-disable-in"),n=ns.View.infoLite("toolbar-button-customizable-abstract");ns.View.edefine("toolbar-button-template",{events:{"daria:vToolbarButtonTemplate:doSendAutoReplay@show":"runButtonAction"},models:{"toolbar-button":!1,"messages-checked":!1},params:ns.View.infoLite("toolbar-button").params,yateModule:"toolbar",methods:{toShowWithSettings:function(){if(!this.mToolbarSettings.get(this.getId()))return!1;var e=this.getCheckedModel();if("messages"===ns.page.current.page&&1!==e.getCount())return!1;var t=e.getIds("template");return!(!t.ids.length&&!t.tids.length)},toShow:function(){if(n.methods.toShow.call(this))return o.methods.toShow.call(this)},toEnableExtended:function(){return this.toEnableInNotificationMessage()}}},"toolbar-button-disable-in","toolbar-button-customizable-abstract")},5586:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137),i=(o.n(n),o(347));ns.View.edefine("toolbar-button-add-template",{models:{"toolbar-button":!1},params:{id:null},yateModule:"toolbar",methods:{toShow:function(){return ns.Model.get("folders").isFolder(ns.page.current.params.current_folder,n.DraftTemplateLikeFoldersShort)},_onClick:function(){if(!Object(i.getPddRestrictNotificationsModel)().showPopup())return ns.Model.get("compose-predefined-data").setData({save_symbol:n.WellKnownFolderSymbol.TEMPLATE}),Daria.composeGo(Daria.isReactiveCompose()?{save_symbol:n.WellKnownFolderSymbol.TEMPLATE}:void 0),!1}}},"toolbar-button")},5587:function(e,t){ns.View.edefine("toolbar-button-toolbar-settings",{models:{"toolbar-button":!1,"messages-checked":!0},params:{id:null},yateModule:"toolbar",methods:{toShow:function(){return!0},_onClick:function(e){ns.events.trigger("daria:vToolbar:customize"),ns.events.trigger("daria:vToolbar:action",{action:"customize"}),Jane.Services.run("#setup",function(){ns.events.trigger("daria:vToolbarButton:updateName");var t=ns.View.create("toolbar-settings");t.update().then(function(){var o;o=e?$(e.target).closest(".js-toolbar-item"):this.$node.closest(".js-toolbar-item")||this.$node.find(".js-toolbar-item"),t.showPopup(o)}.bind(this)),"toolbar-settings"===this.getId()&&Jane.ToolbarMetric.ub("клик на шестеренку")}.bind(this))}}},"toolbar-button-customizable-abstract")},5588:function(e,t){ns.View.edefine("toolbar-button-add-button",{models:{"toolbar-button":!1},params:{id:null},yateModule:"toolbar",methods:{toShowWithSettings:function(){return!Daria.Config.NO_SETTINGS&&!this.mToolbarSettings.isActivated()},_onClick:function(){this.super_._onClick.apply(this,arguments),Jane.ToolbarMetric.ub('клик на предложение "Добавить"')}}},"toolbar-button-toolbar-settings")},5589:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(347);!function(){var e=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-translate",{models:e.models,params:e.params,yateModule:"toolbar",methods:{isMore:no.True,_onClick:function(e,t){t=t||ns.action.getParams(e.currentTarget),Jane.ToolbarMetric.setToolbarMetrics(e,t,"translate",this.getCurrentMessageIfSingle()),Object(n.getMessageViewerBridge)().showTranslateBar(ns.page.current.params.ids)}}},"toolbar-button-disable-in")}()},5590:function(e,t){!function(){var e=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-print",{models:e.models,params:e.params,yateModule:"toolbar",methods:{_onClick:function(e,t){t=t||ns.action.getParams(e.currentTarget),Jane.ToolbarMetric.setToolbarMetrics(e,t,"print",this.getCurrentMessageIfSingle())},isMore:no.True}},"toolbar-button-disable-in")}()},5591:function(e,t){!function(){var e=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-filters-create",{models:e.models,params:e.params,yateModule:"toolbar",methods:{_onClick:function(e,t){t=t||ns.action.getParams(e.currentTarget),Jane.ToolbarMetric.setToolbarMetrics(e,t,"filters-create")},isMore:no.True,toShow:function(){return this.toEnableExceptReplyLaterStarted()}}},"toolbar-button-reply-later-mixin","toolbar-button-disable-in")}()},5592:function(e,t){!function(){var e=ns.View.infoLite("toolbar-button");ns.View.edefine("toolbar-button-message-source",{models:e.models,params:e.params,yateModule:"toolbar",methods:{_onClick:function(e,t){t=t||ns.action.getParams(e.currentTarget),Jane.ToolbarMetric.setToolbarMetrics(e,t,"message-source",this.getCurrentMessageIfSingle())},isMore:no.True}},"toolbar-button-disable-in")}()},5593:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137),i=(o.n(n),o(347));!function(e){var t,o={};t=Modernizr.mozilla?["click","keyup"]:["change"],_.each(t,function(e){o[e+"@show .js-toolbar-settings-button-options-select"]="_onButtonOptionsSelectChange"}),ns.View.define("toolbar-settings",{events:_.extend(o,{"ns-view-init":"_onInit","label.filter.toggle":"resizeDialog","scroll@show window":"_onScrollWindow","resize@show window":"_onResizeWindow","click@show .js-clickable":"_onClick",'keyup@show .js-toolbar-settings-button-options-select,input[type="text"]':"_onButtonOptionsSelectEnter","focus@show .js-toolbar-settings-button-options-email":"_onButtonOptionsEmailFocus"}),models:{settings:!1,toolbar:!1,"messages-checked":!1},params:function(){return{layout:ns.page.current.page}},yateModule:"toolbar",methods:{_onInit:function(){this.mToolbarSettings=Daria.userToolbar,this.POPUP_WIDTH=750,this._locked=!1,this._$handle=null,this._handleOffset=null,this._dialog=null,this._dialogOffset=null,this._currentButtonIdEditing=null,this._$buttonOptionsForm=null},getSettings:function(){return this.mToolbarSettings.get()},showPopup:function(e){this._$window&&this._$window.length||(this._$window=$(window)),this._$handle=e,this._handleOffset=e.offset(),this._dialog=Daria.Dialog.open({body:this.$node,width:this.POPUP_WIDTH,easyclose:!1,hideCrossClose:!0,additionalClass:"b-toolbar-settings",onTarget:{side:"top",pos:"bottom",x:this.getPopupLeftPosition(),y:this.getPopupTopPosition()-this._$window.scrollTop(),needTail:!1},onopen:this.onPopupOpen.bind(this),oncancel:this.onPopupCancel.bind(this),onclose:this.onPopupClose.bind(this)}),this._dialog.resize=function(e){var t=e?this.$body.find(".js-toolbar-settings-form"):this.$body.find(".js-toolbar-settings");this.$body.height(t.height())},this.isActivated()||this.mToolbarSettings.activate().done(function(){ns.events.trigger("daria:vToolbarButtons:settingsActivated"),ns.events.trigger("daria:vToolbarButton:restruct")})},isActivated:function(){return this.mToolbarSettings.isActivated()},onPopupOpen:function(e){this._dialog=e,e.$paranja.removeClass("g-hidden"),e.$dialog.removeClass("b-popup_contextual"),e.$dialog.find("input").filter(":visible").eq(0).focus(),this._dialogOffset=e.$dialog.offset(),this._dialogOffset.top=this._dialogOffset.top-this._$window.scrollTop();var t=e.$dialog.find(".js-clickable");t.length&&t.eq(0).focus()},onPopupCancel:function(){this.mToolbarSettings.invalidateCache(),ns.events.trigger("daria:vToolbarSettings:canceled"),e.ToolbarMetric.ub(["настройки",'клик на "Отменить"'])},onPopupClose:function(e){this._dialog.autocompleter&&(this._dialog.autocompleter.hide(),this._dialog.autocompleter.destroy()),this._$handle=null,this._handleOffset=null,this._dialog=null,this._dialogOffset=null,this._currentButtonIdEditing=null,this._$buttonOptionsForm=null,e.$paranja.addClass("g-hidden"),ns.events.trigger("daria:vToolbarSettings:popupClosed"),$(".js-toolbar-item-toolbar-settings").focus(),this.destroy()},getPopupLeftPosition:function(){var e=this._$handle.outerWidth(),t=this._handleOffset.left+e/2,o=this.POPUP_WIDTH/2,n=$(".js-mail-layout"),i=n.width(),s=n.offset().left,a=s+i,r=t;return s>t-o?r=o+s+2:t+o>a&&(r=a-o+2),r},getPopupTopPosition:function(){return this._handleOffset.top+this._$handle.outerHeight()},_onClick:function(e){var t=$(e.currentTarget),o=ns.action.getParams(t[0]);switch(t.data("clickAction")){case"toolbar.settings.button.toggle":this._onButtonToggle(t,o);break;case"toolbar.settings.button.options":this._onButtonEditOptions(o);break;case"toolbar.settings.submitButtonOptions":this._onSubmitButtonOptions(o);break;case"toolbar.settings.submit":this._onSubmit();break;case"toolbar.settings.back":this._onBack(o)}return!1},deactivateButton:function(t,o){var n=this.getModel("toolbar").getById(t);return this._markButtonDeactivated(o),n.resetName(),e.ToolbarMetric.ub(["настройки","клик на "+n.get(".action"),"снять выбор"]),this.mToolbarSettings.deactivateButton(t)},_markButtonDeactivated:function(e){e.removeClass("b-mail-button_filter-selected").find(".js-toolbar-item-title").text(e.data("title"))},activateButton:function(t,o){var n=this.getModel("toolbar").getById(t);if(e.ToolbarMetric.ub(["настройки","клик на "+n.get(".action"),"выбор"]),_.isEmpty(n.get(".settings")))return this._markButtonActivated(o),this.mToolbarSettings.activateButton(t,n.get(".settings"));this.startButtonOptionsEditing(t,n)},_markButtonActivated:function(e,t){e.addClass("b-mail-button_filter-selected").find(".js-toolbar-item-title").text(t)},_onButtonToggle:function(e,t){if(!this.isLocked()){var o=t.button,n=null;n=this.mToolbarSettings.isButtonActivated(o)?this.deactivateButton(o,e):this.activateButton(o,e),this.unlock(),_.isArray(n)&&ns.events.trigger("daria:vToolbarSettings:buttonToggled")}},startButtonOptionsEditing:function(e,t){_.isUndefined(t)&&(t=this.getModel("toolbar").getById(e)),this._currentButtonIdEditing=e,t.getSettingsDepsParams().then(function(o){var n=Vow.fulfill({}),i=t.getSettingsDeps();_.isEmpty(i)||(n=ns.request(i,o)),n.then(function(){this.showButtonOptionsForm(e,t,o)},this)},this.showButtonOptionsForm.bind(this,e,t),this)},_onButtonEditOptions:function(e){this.startButtonOptionsEditing(e.button)},showButtonOptionsForm:function(t,o,n){var s=this;if(t!==Daria.Constants.TOOLBAR_BUTTONS.SENDON&&t!==Daria.Constants.TOOLBAR_BUTTONS.TEMPLATE||!Object(i.getPddRestrictNotificationsModel)().showPopup()){(n=n||{}).isLocked=this.isLocked();var a=this._dialog.$body,r=a.outerWidth(),l=this.mToolbarSettings.get(t)||{},d=_.extend({},{params:Object.assign({isFolderSelected:this.getModel("messages-checked").isFolderSelected()},n),button:_.extend({},l,{id:t})});this._$buttonOptionsForm=$(e.tt("toolbar:js-toolbar-settings-button-options-form",d,o.getSettingsDeps(),n)),this.$node.remove(".js-toolbar-settings-form").append(this._$buttonOptionsForm.addClass("g-vhidden")),a.width(r),Promise.resolve().then(function(){s._$buttonOptionsForm.removeClass("g-vhidden")}),this.$node.find(".js-toolbar-settings").animate({marginLeft:0-r},{complete:function(){this._dialog.resize(!0),this._getButtonOptionsFormControls().filter(":visible").eq(0).focus()}.bind(this)}),e.ToolbarMetric.ub(["настройки","клик на "+o.get(".action"),"настройки","показ"])}},_getButtonOptionsFormControls:function(){return this._$buttonOptionsForm.find('input[type="text"], select, textarea')},_onButtonOptionsSelectChange:function(e){this._$buttonOptionsForm.find(".js-toolbar-settings-error").addClass("g-hidden");var t=$(e.currentTarget),o=t.attr("name"),n=t.val(),i=this._$buttonOptionsForm.find(".js-toolbar-settings-"+o+"-edit");if("new"===n&&i.hasClass("g-hidden")){switch(i.removeClass("g-hidden"),o){case"label":this._dialog.labelCreate=Daria.LabelCreateContext({parent:i,hotkey:!1}),this._dialog.labelCreate.init();break;case"folder":this._dialog.folderCreate=Daria.FolderCreateContext({parent:i,hotkey:!1}),this._dialog.folderCreate.init()}this._focusNextFormControl(t)}else"new"!==n&&i.addClass("g-hidden");this._dialog.resize(!0)},_onButtonOptionsSelectEnter:function(t){if(t.keyCode!==e.Common.keyCode.ENTER)return!0;var o=$(t.currentTarget);return this._focusNextFormControl(o).fail(function(){this._onSubmitButtonOptions({button:this._currentButtonIdEditing})}.bind(this)),!1},_focusNextFormControl:function(e){var t=new Vow.Promise,o=this._getButtonOptionsFormControls(),n=o.filter(":visible").slice(o.index(e)+1).eq(0);return n.length?(n.focus(),t.fulfill()):t.reject("error focus toolbar control"),t},_onButtonOptionsEmailFocus:function(e){var t=e.currentTarget;this._dialog.autocompleter=Daria.Autocompleter.getContactEmail(),this._dialog.autocompleter.bindField({field:t,focus:1,currentValue:$(t).val()})},_onSubmitButtonOptions:function(t){if(!this.isLocked()){this.lock();var o=t.button,n=this.getModel("toolbar").getById(o),i={};_.each(n.get(".settings"),function(e,t){i[t]=this._$buttonOptionsForm.find('[name="'+t+'"]').val()}.bind(this));var s=new Vow.Promise,a=n.validateSettings(i),r=this._$buttonOptionsForm.find(".js-toolbar-settings-loader"),l=this._$buttonOptionsForm.find(".js-toolbar-settings-error");l.addClass("g-hidden"),r.removeClass("g-hidden"),_.isEmpty(a)?s.sync(this._createContainerIfNeeded(o,i)):s.reject("toolbar button validate errors"),s.always(function(e){return r.addClass("g-hidden"),this.unlock(),e}.bind(this)).then(function(){this.mToolbarSettings.activateButton(o,i);var t=this.$node.find(".js-toolbar-settings-button-"+o),s=this.mToolbarSettings.getCustomizableButtonName(o);this._markButtonActivated(t,s),ns.events.trigger("daria:vToolbarSettings:buttonOptionsChanged"),this._onBack(),e.ToolbarMetric.ub(["настройки","клик на "+n.get(".action"),"настройки","применить"])}.bind(this),function(t){_.isString(t)&&a.push(t),l.each(function(){var e=$(this),t=e.data("errors");t&&_.intersection(a,t.split(" ")).length&&e.removeClass("g-hidden")}),this._dialog.resize(!0),e.ToolbarMetric.ub(["настройки","клик на "+n.get(".action"),"настройки","ошибка"])}.bind(this))}},_createContainerIfNeeded:function(e,t){var o=new Vow.Promise;if(e===Daria.Constants.TOOLBAR_BUTTONS.TEMPLATE)if("new"===t.tmpl){t.tmpl=null;var n=(this._$buttonOptionsForm.find('[name="body"]').val()||"").trim();n?this._createNewTemplate(n).then(function(e){t.tmpl=e,ns.page.go().always(function(){o.fulfill()})},function(){o.reject("template_body_save")}):o.reject("template_body_empty")}else o.fulfill();else e===Daria.Constants.TOOLBAR_BUTTONS.LABEL?"new"===t.label?(t.label=null,this._dialog.labelCreate.onCreate().then(function(e){t.label=e,ns.page.go().always(function(){o.fulfill()})},function(){o.reject("label_edit"),ns.events.once("label.error.hide",function(){this._dialog.resize(!0)}.bind(this))})):o.fulfill():e===Daria.Constants.TOOLBAR_BUTTONS.INFOLDER&&"new"===t.folder?(t.folder=null,this._dialog.folderCreate.onCreate().then(function(e){t.folder=e,o.fulfill()},function(){o.reject("folder_edit"),ns.events.once("folder.error.hide",function(){this._dialog.resize(!0)}.bind(this))})):o.fulfill();return o},_onSubmit:function(){if(!this.isLocked()){this.lock();var t=this.$node.find(".js-toolbar-settings-main-loader");t.removeClass("g-hidden"),this.save().then(function(){e.ToolbarMetric.ub(["настройки",'клик на "Готово"'])},this).always(function(){this.unlock(),t.addClass("g-hidden")},this).then(function(){this._dialog.close()},this)}},_onBack:function(t){if(!this.isLocked()){var o=function(){this._$buttonOptionsForm.remove(),this._dialog.resize(!1),this.$node.find("input").filter(":visible").eq(0).focus()}.bind(this);if(this.$node.find(".js-toolbar-settings").animate({marginLeft:0},{always:o}),t&&t.button){var n=this.getModel("toolbar").getById(t.button);e.ToolbarMetric.ub(["настройки","клик на "+n.get(".action"),"настройки","назад"])}this._currentButtonIdEditing=null}},resizeDialog:function(){this._dialog&&this._dialog.resize(!0)},_onResizeWindow:_.debounce(function(){this._dialog&&(this._dialog.$dialog.offset({left:this.getPopupLeftPosition()-this.POPUP_WIDTH/2}),this._animateDialogPosition(),this._dialog.autocompleter&&this._dialog.autocompleter.hide())},200,{trailing:!0}),_onScrollWindow:_.throttle(function(){this._dialog&&(this._animateDialogPosition(),this._dialog.autocompleter&&this._dialog.autocompleter.hide())},50,{trailing:!0}),_animateDialogPosition:function(){this._dialog.$dialog.animate({top:this._dialogOffset.top+this._$window.scrollTop()},{queue:!1})},lock:function(){return e.disableButton(this.$node.find(".js-toolbar-settings-control")),this._locked=!0,!0},unlock:function(){return e.enableButton(this.$node.find(".js-toolbar-settings-control")),this._locked=!1,!0},isLocked:function(){return this._locked},save:function(){return this.mToolbarSettings.set().then(function(e){ns.events.trigger("daria:vToolbarSettings:saved",_.pluck(e,"id"))})},_createNewTemplate:function(e){var t=new Vow.Promise,o=new Vow.Promise,i=ns.Model.get("folders").getFidBySymbol(n.WellKnownFolderSymbol.TEMPLATE);return i?o.fulfill():ns.Model.get("folders").createTemplateFolder().then(function(e){i=e.fid,o.fulfill()}),o.then(function(){var o=ns.Model.get("settings"),s=e.match(/^.{1,15}/)||"";s&&(s=s[0],e.length>s.length&&(s+="...")),Daria.SendMail.send({params:{to:"",bcc:"",cc:"",from_mailbox:o.getSetting("default_email"),from_name:o.getSetting("from_name"),go:1,ign_overwrite:"no",nosend:"yes",save_symbol:n.WellKnownFolderSymbol.TEMPLATE,send:e,subj:s,ttype:"plain",templates_fid:i},success:function(e){if(e.storedmid){["messages","message-nearest","message-thread-nearest","abook-contacts","abook-contact","folders"].forEach(function(e){ns.Model.invalidate(e)}),ns.Model.get("messages-pager",ns.page.current.params).invalidate(),ns.Model.get("messages-pager",{current_folder:i}).invalidate(),ns.page.go(),t.fulfill(e.storedmid)}else t.reject()},error:function(){t.reject()}})}),t}}})}(Jane)},5594:function(e,t){ns.ViewCollection.define("toolbar-buttons",{events:{"ns-view-show":"_onShow","ns-page-after-load":"_onPageAfterLoad","scroll window":"_onScrollWindow","resize window":"_onResizeWindow","daria:vToolbarButton:restruct":"_onRestructToolbarButton","daria:vToolbarSettings:settingsActivated":"_onSettingsActivated","daria:vToolbarSettings:buttonToggled":"_restruct","daria:vToolbarSettings:popupClosed":"_restruct","daria:vToolbarSettings:buttonOptionsChanged":"_restruct","daria:vApp:changeAppWidth":"_restruct","daria:vAbookContacts:selectionChanged":"onAbookSelectionChanged"},models:{settings:{"ns-model-changed":"keepValid","ns-model-changed.liza_minified":"onToggleCompactMode","ns-model-changed.liza_minified_header":"onToggleCompactMode"},toolbar:{"ns-model-changed":"keepValid","ns-model-changed.fixed":"onChangeToolbarFixed"},"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"onMessagesCheckedTouched"}},params:Daria.params.toolbarButtons,split:{byModel:"toolbar",intoViews:function(e){var t="toolbar-button-"+e.get(".id");return ns.View.isDefined(t)||(t=_.contains(t,"abook")?"toolbar-button-abook":"toolbar-button"),t}},ctor:function(){this._lazyRestructToolbar=_.debounce(function(e){this.triggerCheckedCountEvent(),this._restruct(e)},100)},yateModule:"toolbar",methods:{forceRestruct:!1,_onShow:function(){this._lazyRestructToolbar()},onMessagesCheckedTouched:function(){this._lazyRestructToolbar()},_getViews:function(){return _.values(this.views)},getViewsIds:function(e){return _.isUndefined(e)&&(e=this._getViews()),_.map(e,function(e){return e.getId()})},_getViewsToShow:function(){return this._getSpecificViewsHelper("shouldShow")},_getVisibleViews:function(){return this._getSpecificViewsHelper("isVisible")},_getSpecificViewsHelper:function(e){return _.filter(this._getViews(),function(t){var o=t.getId();if(!_.contains(["more"],o)){var n=t[e];if(n)return n.call(t)}})},onToggleCompactMode:function(){this.keepValid(),_.forEach(this._getViews(),function(e){e.resetButtonWidth()}),this._lazyRestructToolbar()},_restruct:function(e){if(this.isVisible()){var t=!!$.isPlainObject(e)&&e.force,o=this.getModel("toolbar"),n=this.getButtonView("more"),i=this.getButtonView("toolbar-settings");if(n&&(n.show(!0),n.closeExtendButtons()),!(t||this.forceRestruct||o.get(".settings")&&n))return!1;this.forceRestruct=!1;var s=n?n.getWidth():0,a=!!i&&i.shouldShow(),r=a?i.getWidth():0,l=document.querySelector(".js-toolbar-chevron").clientWidth-s-r,d=0,c=this._getVisibleViews(),u=this._getViewsToShow();_.reject(c,function(e){return _.contains(u,e)}).forEach(function(e){e.hide(!0)});var h=!1,b=_.filter(u,function(e){if(e.show(!0),a&&"toolbar-settings"===e.getId())return!0;var t=e.getWidth();return n?h||d+t>=l?(h=!0,!1):(d+=t,!0):h||d+t>l?(h=!0,!1):(d+=t,!0)}),g=_.xor(u,b);1===(g=_.uniq(g.concat(this._getSpecificViewsHelper("isMore")))).length&&d-s+g[0].getWidth()<=l&&(g.shift(),n.hide(!0)),g.forEach(function(e){e.hide(!0)}),n&&(this.getModel("messages-checked").getCount()&&(g=g.filter(function(e){return e.toShow()&&e.enabled()})),g.length?n.show(!0):n.hide(!0),n.setExtendButtons(g)),ns.events.trigger("daria:vToolbarButton:restructFinished")}},_onSettingsActivated:function(){this.getButton("toolbar-settings").show()},getButtonView:function(e){var t="toolbar-button-"+e;return ns.View.isDefined(t)||(t="toolbar-button"),this.views[ns.View.getKey(t,{id:e})]},getWidth:function(){if(this.getModel("toolbar").isFixed()){var e=this.$node.closest(".js-toolbar-wrap");return e.width()-e.find(".js-toolbar-aside").width()}return this.$node.closest(".js-toolbar-chevron").width()},getButton:function(e){return _.find(this.views,function(t){return t.getId()===e})},_onScrollWindow:_.throttle(function(){var e=this.getButtonView("more");e&&e.closeExtendButtons()},50),_onResizeWindow:function(){this._lazyRestructToolbar()},_onRestructToolbarButton:function(e,t){t&&t.force&&(this.forceRestruct=!0),this._lazyRestructToolbar(t)},onAbookSelectionChanged:function(){this._lazyRestructToolbar({force:!0})},onChangeToolbarFixed:function(){this._lazyRestructToolbar()},triggerCheckedCountEvent:function(){if(this.isVisible()){var e=this.getModel("messages-checked");ns.events.trigger("daria:vToolbarAside:changeCheckedCount",e.getCount())}},_onPageAfterLoad:function(){Daria.is3pane()&&this.getModel("messages-checked").resetMemoizeAndTouch()}}})},5595:function(e,t){!function(){var e=ns.View.infoLite("toolbar-button").methods;ns.View.edefine("toolbar-button-folders-actions",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:function(e){return ns.View.infoLite("toolbar-button").params(e)},events:{"daria:vFoldersActions:open":"onFoldersActionsOpen"},yateModule:"toolbar",methods:{onFoldersActionsOpen:function(){if(this.toShow()){var e=this.$node.parents(".js-toolbar").find(".js-toolbar-item-more"),t=this.isVisible()?this.$node:e;t.length||(t=this.$node.parent()),this.vFoldersActions=ns.View.create("folders-actions"),this.vFoldersActions.open(t,this.getModel("messages-checked"))}},_onClick:function(e,t){if(this.enabled()){if(t=t||ns.action.getParams(e.currentTarget),Jane.ToolbarMetric.setToolbarMetrics(e,t,"move",this.getCurrentMessageIfSingle()),this.vFoldersActions&&this.vFoldersActions._isOpen){if(this.vFoldersActions.isVisible())return;this.vFoldersActions.closePopup()}this.vFoldersActions=ns.View.create("folders-actions"),this.vFoldersActions.open(e.currentTarget,this.getModel("messages-checked"),t)}},toShow:function(){return!!e.toShow.call(this)&&_.contains(["message","messages"],ns.page.current.page)},toEnableExtended:function(){return this.toEnableExceptReplyLaterStarted()}}},"toolbar-button-disabled","toolbar-button-reply-later-mixin","toolbar-button")}()},5596:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(137);o.n(n);function i(e){return function(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}ns.View.edefine("toolbar-button-labels-actions",{models:{"toolbar-button":!1,"messages-checked":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model-touched":"toggleEnabled"}},params:ns.View.infoLite("toolbar-button").params,events:{"ns-view-show":"onShow","daria:vLabelsActions:open":"onLabelsActionsOpen"},yateModule:"toolbar",methods:{onShow:function(){Daria.isComposePage()&&this.enabled()&&this.toggleEnabled(null,!0)},onLabelsActionsOpen:function(){if(this.toShow()){var e=this.$node.parents(".js-toolbar").find(".js-toolbar-item-more"),t=this.isVisible()?this.$node:e;t.length||(t=this.$node.parent()),this.vLabelsActions=ns.View.create("labels-actions"),this.vLabelsActions.open(t,this.getModel("messages-checked"),{logMetrika:this._logMetrika.bind(this)})}},_onClick:function(e,t){if(this.enabled()){t=t||ns.action.getParams(e.currentTarget),Jane.ToolbarMetric.setToolbarMetrics(e,t,"label",this.getCurrentMessageIfSingle());var o="compose2"===this.params.layout;if(o&&Jane.c("Написание письма","Шапка письма",'Клик в "Метку"'),!this.vLabelsActions||!this.vLabelsActions._isOpen){var n=o?["labels-actions-compose",ns.page.current.params]:["labels-actions",this.params];this.vLabelsActions=ns.View.create.apply(null,n),this.vLabelsActions.open(e.currentTarget,this.getModel("messages-checked"),Object.assign({},t,{logMetrika:this._logMetrika.bind(this)}))}}},_logMetrika:function(e,t){var o,n=["метка",e===ns.Model.get("labels").getImportantLID()?"флажок":"пользовательская метка"];n=n.concat("label"===t?"проставление":"снятие"),(o=Jane.ToolbarMetric).messagesListToolbar.apply(o,[null].concat(i(n)))},toShow:function(){var e=_.contains(["message","messages","compose2"],ns.page.current.page);return"messages"===ns.page.current.page?e=!ns.Model.get("folders").spamOrTrash(ns.page.current.params.current_folder):"message"===ns.page.current.page&&(e=!ns.Model.get("message",{ids:ns.page.current.params.ids}).inFolderBySymbol(n.LabelDisabledFolders)),Boolean(e)},enabled:function(){var e=this.getCheckedModel();return e.getCount()||e.isFolderOrTabSelected()||Daria.isComposePage()}}},"toolbar-button-disabled","toolbar-button")},5597:function(e,t){var o=ns.Model.get("all-toolbar-buttons"),n={scroll:!0,settings:!0},i=Daria.Constants.TOOLBAR_BUTTONS,s={messages:[i.MAIN_SELECT_ALL,i.MAIN_DESELECT_ALL,i.FORWARD,i.DELETE,i.ADD_TEMPLATE,i.SPAM,i.NOT_SPAM,i.REPLY_LATER,i.MARK_AS_READ,i.UNSUBSCRIBE_ALL,i.PIN,i.UNPIN,i.MARK_AS_UNREAD,i.ARCHIVE,i.SENDON,i.INFOLDER,i.LABEL,i.TEMPLATE,i.LABELS_ACTIONS,i.FOLDERS_ACTIONS,i.MORE,i.TOOLBAR_SETTINGS],message:[i.EDIT,i.REPLY,i.REPLY_ALL,i.FORWARD,i.DELETE,i.SPAM,i.NOT_SPAM,i.REPLY_LATER,i.MARK_AS_UNREAD,i.UNSUBSCRIBE_ONE,i.PIN,i.UNPIN,i.ARCHIVE,i.SENDON,i.INFOLDER,i.LABEL,i.TEMPLATE,i.LABELS_ACTIONS,i.FOLDERS_ACTIONS,i.TRANSLATE,i.PRINT,i.FILTERS_CREATE,i.MESSAGE_SOURCE,i.MORE,i.TOOLBAR_SETTINGS],"no-message":[i.FORWARD,i.DELETE,i.SPAM,i.NOT_SPAM,i.MARK_AS_UNREAD]};_.each(s,function(e,t){var i=o.getButtonsByIds(e);ns.Model.get("toolbar",{layout:t}).setData(_.extend({},n,{buttons:i}))})}});