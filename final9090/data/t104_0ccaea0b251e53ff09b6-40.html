/*! For license information please see 0ccaea0b251e53ff09b6-40.js.LICENSE */
webpackJsonp([40],{1036:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.is3pane=function(){return"2pane"!==a.a.layout},t.is3pv=function(){return"3pane-vertical"===a.a.layout},t.is3ph=function(){return"3pane-horizontal"===a.a.layout},t.is2pane=function(){return"2pane"===a.a.layout};var a=s(2)},214:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(5029);s.n(a);Jane.module("messages.js",function(){s(5030),s(5033),s(5040),s(5050),s(5171),s(5172)})},487:function(e,t,s){"use strict";s.d(t,"c",function(){return a}),s.d(t,"a",function(){return n}),s.d(t,"d",function(){return o}),s.d(t,"b",function(){return i});var a="close-and-open-another-message",n="close-and-go-to-another-messages-list",o="close-expanded",i="close-and-go-to-another-page"},488:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,s=1,a=arguments.length;s<a;s++)for(var n in t=arguments[s])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__decorate||function(e,t,s,a){var n,o=arguments.length,i=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,s):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,a);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(i=(o<3?n(i):o>3?n(t,s,i):n(t,s))||i);return o>3&&i&&Object.defineProperty(t,s,i),i},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyTemplate=void 0;var r=i(s(135)),d=s(342),l=i(s(339)),c=s(152),g=s(350),h=s(441),u=s(5113),m=s(5114),f=s(5115),p=i(s(739)),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){var e,t=this.props,a=t.headerContent,o=t.textProps,i=t.buttonProps,d=t.imageProps,_=l.default(p.default.root,((e={})[p.default.is2pane]=g.is2Pane(),e[p.default.is3pv]=g.is3pv(),e)),b=h.ThemesStore.instance(),M={src:b.isContentDark?s(5116):s(5117),src2x:b.isContentDark?s(5118):s(5119)};return r.default.createElement("div",{className:_},a&&r.default.createElement(u.MessagesEmptyHeader,null,a),o&&r.default.createElement(m.MessagesEmptyText,n({},o)),i&&r.default.createElement(f.MessagesEmptyButton,n({},i)),r.default.createElement(c.Image,n({},d||M,{className:l.default(p.default.image,null===d||void 0===d?void 0:d.className)})))},t=o([d.observer],t)}(r.default.PureComponent);t.MessagesEmptyTemplate=_},5029:function(e,t){},5030:function(e,t,s){s(5031),s(5032)},5031:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(462),n=(s.n(a),s(347)),o=s(349);s.n(o);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],a=!0,n=!1,o=void 0;try{for(var i,r=e[Symbol.iterator]();!(a=(i=r.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(n)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(e,t,s,a,n,o,i){try{var r=e[o](i),d=r.value}catch(e){return void s(e)}r.done?t(d):Promise.resolve(d).then(a,n)}!function(){ns.action.define("shortcuts.switch-tab",function(e,t,s,a){var n={event:a,params:t};Daria.Shortcuts.switchTab(n)});var e=null,t=null,s=null;ns.action.define("mail-common.abook-person-popup",function(t,s){e?e=null:Jane.Services.run("#contacts",function(e){return function(){var t=this,s=arguments;return new Promise(function(a,n){var o=e.apply(t,s);function i(e){r(o,a,n,i,d,"next",e)}function d(e){r(o,a,n,i,d,"throw",e)}i(void 0)})}}(regeneratorRuntime.mark(function t(){var a,r,d,l,c,g,h,u,m;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ns.request("abook-contact",{email:s.email});case 2:if(a=t.sent,r=i(a,1),d=r[0],l=d.get(".cid"),!(c=d.get(".isShared"))||!Object(o.hasFeature)(o.Features.WEB_NEW_CONTACT_CARD)){t.next=11;break}return Object(n.getContactCardPopupModel)().showPopup({email:s.email,name:s.name,isShared:!0}),t.abrupt("return");case 11:if(s.shared=c,s.ref){t.next=22;break}if(g=d.get(".email"),Array.isArray(g)){t.next=16;break}return t.abrupt("return");case 16:if(!(h=g.find(function(e){return e.value===s.email}))||!h.ref){t.next=21;break}s.ref=h.ref,t.next=22;break;case 21:return t.abrupt("return");case 22:l&&!c&&(s.cid=l),e=ns.View.create("abook-person-popup"),u=Daria.is2pane()?{where:s.node,how:{my:"left top",at:"left-52 top-5"}}:{where:$(window),how:{my:"center",at:"center"}},e.on("ns-view-destroyed",function(){e=null}),e.open(u,s),m=s.shared?"общий":"личный",Daria.vAbook.Metrika.c("Карточка контакта","В Почте",m,"показ карточки (клик на контакт)");case 29:case"end":return t.stop()}},t)})))}),ns.action.define("mail-common.contact-actions",function(e,s){var n=s.node;if(t!==n){t=n;var o=ns.View.create("contact-actions",s);o.on("ns-view-destroyed",function(){n===t&&(t=null)});var i=a.MetrikaService.instance().messageViewer;i.logOpenRecipientCard(),o.open({where:n,how:{autoclose:!0,at:"center bottom",my:"center top"},itemEvents:{copy:{click:function(){return i.logRecipientCopyAddressClick()},show:function(){return i.logRecipientCopyAddressShow()}},compose:{click:function(){return i.logRecipientComposeMessageClick()},show:function(){return i.logRecipientComposeMessageShow()}},"add-contact":{click:function(){return i.logRecipientAddToContactsClick()},show:function(){return i.logRecipientAddToContactsShow()}},blacklist:{click:function(){return i.logRecipientToBlackListClick()},show:function(){return i.logRecipientToBlackListShow()}}}})}}),ns.action.define("mail-common.message-actions",function(e,t){var a=t.node,n=t.mid;if(s!==a){s=a;var o=ns.View.create("message-toolbar-popup",{ids:n});o.on("ns-view-destroyed",function(){a===s&&(s=null)}),o.open({where:a,autoclose:!0,at:"center bottom",my:"center top"})}})}()},5032:function(e,t){ns.action.define("messages.deselect",function(){$(document).trigger("b-mail-dropdown-closeall"),ns.events.trigger("daria:vMessages:deselect")})},5033:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(349),n=(s.n(a),s(137));s.n(n);!function(){var e={messages:{},"messages-notification-box@":function(e){if(e.search)return"messages-notification-search";var t=e.current_folder,s=ns.Model.get("folders"),a=s.isFolder(t,[n.WellKnownFolderSymbol.SPAM]),o=(s.getFolderById(e.current_folder)||{}).count,i=a&&o>0;return Daria.is2pane()&&!Daria.IS_CORP&&i?{"messages-spam-banner":{}}:"messages-notification"},"messages-empty-wrap":{},"opt-in-subs-box@":function(){if(ns.Model.get("folders").isCurrentFolder(n.WellKnownFolderSymbol.INBOX))return{"opt-in-subs-view":{}}}},t={"messages-list":{"messages-list-box@":{"messages-wrap":e}}};Object(a.hasFeature)(a.Features.WEB_REACT_MESSAGES_LIST)&&(t["messages-list"]={}),Daria.is3pane()&&!Object(a.hasFeature)(a.Features.REACT_LAYOUT)&&(t["messages-box@"]=function(e){var t={};return e.thread_id?Object(a.hasFeature)(a.Features.WEB_REACT_MESSAGE_THREAD)?t["message-thread-react&"]={}:t["message-thread&"]=function(){var e={"important-toggleable":{},"read-toggleable-thread":{},"message-thread-head-subject":{"message-thread-messages-count":{}},"message-thread-pager":{},"message-thread-list":{},"message-fake-list":{},"react-thread-quick-reply":{}};return Daria.showPriorityLabel()&&(e["message-thread-head-subject"]["priority-toggleable"]={}),e}:e.ids?t["message-react"]={}:t["message-empty"]={},t}),Daria.is2pane()&&(t["messages-date-pager-float-box@"]=function(e){if(e.datePager&&"messages"===ns.page.current.page)return{"messages-date-pager-float":!0}},Object(a.hasFeature)(a.Features.REACT_LAYOUT)||(t.footer={"footer-journal-link&":{},"footer-help-link":{}}),e["messages-pager-box@"]=function(){var e={"messages-pager-load-more":{},"messages-pager-date-box@":function(){return{"messages-pager-date&":{}}},"messages-pager-nav&":{},"themes-messages-list-control@":{}};return{"messages-pager":e}}),ns.layout.define("messages",{"app right-box@":function(e){if(e.search){var s=_.cloneDeep(t);return s["messages-search-session"]={},s}return t}},"common+left+toolbar"),s(5034),s(5035),s(5036),s(5037),s(5038),s(5039)}()},5034:function(e,t){ns.layout.define("layout-messages-item-thread",{"messages-item-inner-box@":{"messages-item-thread&":{},"messages-item-thread-pager&":{}}}),ns.layout.define("layout-messages-item-thread-empty",{"messages-item-inner-box@":{}})},5035:function(e,t){ns.layout.define("layout-message-thread-item",{"message-thread-item-box@":{"message-thread-item":function(){var e={"read-toggleable":{},"message-thread-item-userpic":{},"messages-item-labels":{}};return Daria.showPriorityLabel()&&(e["priority-toggleable"]={}),e["important-toggleable"]={},e}}})},5036:function(e,t){ns.layout.define("layout-message-thread-message",{"message-thread-item-box@":function(){return{"message-react":{}}}})},5037:function(e,t){ns.layout.define("layout-messages-empty",{"messages-empty-box@":{}}),ns.layout.define("layout-messages-empty-view",{"messages-empty-box@":{"messages-empty":{}}})},5038:function(e,t){ns.layout.define("layout-messages-item-checkbox",{"messages-item-checkbox-box@":{"messages-item-checkbox":{}}}),ns.layout.define("layout-messages-item-thread-checkbox",{"messages-item-checkbox-box@":{"messages-item-thread-checkbox":{}}}),ns.layout.define("layout-messages-item-checkbox-nb",{"messages-item-checkbox-box@":{"messages-item-checkbox-nb":{}}}),ns.layout.define("layout-messages-item-thread-checkbox-nb",{"messages-item-checkbox-box@":{"messages-item-thread-checkbox-nb":{}}})},5039:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(349);s.n(a);function n(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}ns.layout.define("layout-message-opened",{"messages-item-box@":function(){return{"message-react":{}}}}),ns.layout.define(Daria.messages.createMessagesItemLayout(),{"messages-item-box@":{"messages-item":{}}}),ns.layout.define(Daria.messages.createMessagesItemLayout({threadInner:!0}),{"messages-item-box@":{"messages-item":{},"messages-item-inner":{"messages-item-thread&":{},"messages-item-thread-pager&":{}}}}),ns.layout.define(Daria.messages.createMessagesItemLayout({threadFull:!0}),{"messages-item-box@":function(){return Object(a.hasFeature)(a.Features.WEB_REACT_MESSAGE_THREAD)?{"message-thread-react&":{}}:{"message-thread&":function(){var e={"read-toggleable-thread":{},"message-thread-head-subject":{"message-thread-messages-count":{}},"message-thread-prev-next":{},"message-thread-pager":{},"message-thread-more-button":{},"message-close-button":{},"message-thread-list":{},"message-fake-list":{},"react-thread-quick-reply":{}};return Daria.showPriorityLabel()&&(e["message-thread-head-subject"]["priority-toggleable"]={}),e["important-toggleable"]={},e}}}}),["attachments","events","ticket","subscriptions","widget"].forEach(function(e){var t={},s={};"attachments"===e&&(s["attachments-widget-box@"]=function(){return Daria.isAttachmentsLineDesign()?{"attachments-tab-widget&":{}}:{"attachments-widget&":{}}}),t["messages-item-"+e]=function(){var t=function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach(function(t){o(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({},s);return"ticket"===e&&Daria.isAttachmentsLineDesign()&&(t["attachments-widget-box@"]={"attachments-tab-widget&":{}}),t};var a=_.extend({},t,{"messages-item-inner":{"messages-item-thread&":{},"messages-item-thread-pager&":{}}});ns.layout.define(Daria.messages.createMessagesItemLayout({widget:e}),{"messages-item-box@":t}),ns.layout.define(Daria.messages.createMessagesItemLayout({widget:e,threadInner:!0}),{"messages-item-box@":a})})},5040:function(e,t,s){s(5041),s(5042),s(5043),s(5044),s(5045),s(5046),s(5047),s(5048),s(5049)},5041:function(e,t){ns.Model.define("save-event-by-ics",{params:{ids:null,hid:null,stid:null,decision:null}},"base-calendar-event")},5042:function(e,t){ns.Model.define("do-handle-reply",{params:{eventId:null,decision:null,ids:null,hid:null,stid:null}},"base-calendar-event")},5043:function(e,t){ns.Model.define("message-type-labels",{events:{"ns-model-init":"_onInit"},methods:{_onInit:function(){for(var e=[{type:2,label:i18n("%Messages_Title_By_Type_2")},{type:4,label:i18n("%Messages_Title_By_Type_4")},{type:5,label:i18n("%Messages_Title_By_Type_5")},{type:6,label:i18n("%Messages_Title_By_Type_6")},{type:7,label:i18n("%Messages_Title_By_Type_7")},{type:8,label:i18n("%Messages_Title_By_Type_8")},{type:12,label:i18n("%Messages_Title_By_Type_12")},{type:13,label:i18n("%Messages_Title_By_Type_13")},{type:14,label:i18n("%Messages_Title_By_Type_14")},{type:15,label:i18n("%Messages_Title_By_Type_15")},{type:16,label:i18n("%Messages_Title_By_Type_16")},{type:17,label:i18n("%Messages_Title_By_Type_17")},{type:18,label:i18n("%Messages_Title_By_Type_18")},{type:19,label:i18n("%Messages_Title_By_Type_19")},{type:20,label:i18n("%Messages_Title_By_Type_20")},{type:21,label:i18n("%Messages_Title_By_Type_21")},{type:22,label:i18n("%Messages_Title_By_Type_22")},{type:23,label:i18n("%Messages_Title_By_Type_23")},{type:25,label:i18n("%Messages_Title_By_Type_25")},{type:26,label:i18n("%Messages_Title_By_Type_26")},{type:30,label:i18n("%Messages_Title_By_Type_30")},{type:35,label:i18n("%Messages_Title_By_Type_35")}],t=[],s=0,a=e.length;s<a;s++)t.push(e[s].type);this.setData({labels:e,knownTypes:t})}}},ns.ModelStatic)},5044:function(e,t){ns.Model.define("get-link-app",{params:{app:"mail-wpv",phone_full:null,phone_id:null},methods:{}})},5045:function(e,t){ns.Model.define("message-in-reply-to",{params:{mid:null,message_id:null}})},5046:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(137);s.n(a);ns.Model.define("message-thread-toolbar",{events:{"ns-model-before-destroyed":"onBeforeDestroyed"},params:{ids:null},ctor:function(){this.recalculateButtons=this.recalculateButtons.bind(this)},methods:{onBeforeDestroyed:function(){this._unbindModelEvents()},request:function(){return ns.request(["message"],{ids:this.params.ids}).then(this._bindModelEvents,this)},_bindModelEvents:function(e){this.mMessage=_.find(e,"id","message"),this.mMessage.on("ns-model-changed",this.recalculateButtons),this.recalculateButtons()},_unbindModelEvents:function(){this.mMessage.off("ns-model-changed",this.recalculateButtons)},recalculateButtons:function(){var e=this.mMessage,t=e.inFolderBySymbol(a.WellKnownFolderSymbol.ARCHIVE),s=e.isSpam(),n=e.isPinned(),o=_.contains(e.getSOLabels(),"12"),i=e.isNew(),r=e.isValidForPin(),d=Daria.Constants.TOOLBAR_BUTTONS,l=[{id:d.MARK_AS_READ,condition:i},{id:d.MARK_AS_UNREAD,condition:!i},{id:d.DELETE,condition:!0},{id:d.SPAM,condition:!s&&!o},{id:d.NOT_SPAM,condition:s},{id:d.FORWARD,condition:!o},{id:d.ARCHIVE,condition:!t}];l=l.concat([{id:d.FOLDERS_ACTIONS,condition:!0},{id:d.LABELS_ACTIONS,condition:!0},{id:d.PIN,condition:r&&!n},{id:d.UNPIN,condition:r&&n}]);var c=ns.Model.get("all-toolbar-buttons"),g=l.filter(function(e){return e.condition}).map(function(e){return c.getButtonById(e.id)}).filter(function(e){return Boolean(e)});this.setData({buttons:g})}}})},5047:function(e,t){ns.Model.define("messages-item-state",{events:{"ns-model-init":"_onInit"},params:function(e){var t=_.extend({},ns.page.current.params,e),s=ns.Model.getKeyAndParams("messages",t).params;return s.ids=e.ids,s},methods:{STATE:{CLOSE:"close",MESSAGE:"message",THREAD_SHORT:"thread_short",THREAD_FULL:"thread_list"},_onInit:function(){this.setData({state:this.STATE.CLOSE})},destroy:function(){this.close()},setState:function(e){this.setIfChanged(".state",e)},getState:function(){return this.get(".state")},isClosed:function(){return this.get(".state")===this.STATE.CLOSE},close:function(){this.setState(this.STATE.CLOSE)}}},ns.ModelStatic)},5048:function(e,t){ns.Model.define("state-message-thread-list",{events:{"ns-model-init":"_onInit"},params:{thread_id:null},methods:{_onInit:function(){this.setData({HEIGHT_COMPACT_MESSAGE:39,countHiddenMessages:0,unloadedMessages:0,hiddenMessages:[],blockAutoMarkAsRead:!1})},getHiddenMessages:function(){return this.get(".hiddenMessages")},getCountHiddenMessages:function(){return this.get(".countHiddenMessages")},setHiddenMessages:function(e){this.set(".hiddenMessages",e),this.set(".countHiddenMessages",e.length)},resetHiddenMessages:function(){this.setHiddenMessages([])}}},ns.ModelStatic)},5049:function(e,t){ns.Model.define("unsubscribe-widget-state",{events:{"ns-model-init":"_onInit"},methods:{_onInit:function(){this.setData({loadingId:null})},startLoading:function(e){this.setData({loadingId:e})},stopLoading:function(){this.setData({loadingId:null})},isLoading:function(){return Boolean(this.getData().loadingId)}}},ns.ModelStatic)},5050:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(5051),n=(s.n(a),s(5066)),o=s.n(n),i=s(486);s.n(i);s(5071),s(5072),s(5073),s(5074),s(5075),s(5076),s(5077),s(5078),s(5079),s(5080),s(5081),s(5082),s(5083),s(5084),s(5085),s(5086),s(5087),s(5088),s(5089),s(5090),s(5091),s(5092),s(5093),s(5094),s(5095),s(5096),s(5097),s(5098),s(5099),s(5100),s(5101),s(5102),s(5103),s(5104),s(5105),s(5106),s(5107),s(5108),s(5109),s(5110),s(5140),s(5141),s(5142),s(5143),s(5144),s(5145),s(5146),s(5147),s(5148),s(5149),s(5150),s(5151),s(5152),s(5153),s(5154),s(5155),s(5156),s(5157),s(5158),s(5159),s(5160),s(5161),s(5162),s(5163),s(5164),s(5165),s(5166),s(5168),ns.View.define("opt-in-subs-view",Object(i.NsReactView)({component:a.OptInSubscriptionsWidget,yateModule:"mail"})),ns.View.define("messages-spam-banner",Object(i.NsReactView)({component:o.a,yateModule:"messages"}))},5062:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n=s(135);s.n(n);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}var i=function(e,t,s,n){a||(a="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=n;else if(i>1){for(var r=new Array(i),d=0;d<i;d++)r[d]=arguments[d+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:a,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 0a1 1 0 000 2h8a1 1 0 100-2H4zM1.5 4a1 1 0 011-1h11a1 1 0 110 2h-11a1 1 0 01-1-1zM.218 7.092C0 7.52 0 8.08 0 9.2v3.6c0 1.12 0 1.68.218 2.108a2 2 0 00.874.874C1.52 16 2.08 16 3.2 16h9.6c1.12 0 1.68 0 2.108-.218a2 2 0 00.874-.874C16 14.48 16 13.92 16 12.8V9.2c0-1.12 0-1.68-.218-2.108a2 2 0 00-.874-.874C14.48 6 13.92 6 12.8 6H3.2c-1.12 0-1.68 0-2.108.218a2 2 0 00-.874.874zM2.888 8c-.363 0-.486.486-.166.658l4.804 2.587a1 1 0 00.948 0l4.804-2.587c.32-.172.197-.658-.166-.658H2.888z",fill:"currentColor"});t.default=function(e){return n.createElement("svg",o({viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),i)}},5063:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n=s(135);s.n(n);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function i(e,t,s,n){a||(a="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=n;else if(i>1){for(var r=new Array(i),d=0;d<i;d++)r[d]=arguments[d+3];t.children=r}if(t&&o)for(var l in o)void 0===t[l]&&(t[l]=o[l]);else t||(t=o||{});return{$$typeof:a,type:e,key:void 0===s?null:""+s,ref:null,props:t,_owner:null}}var r=i("path",{d:"M3.5 0a.875.875 0 100 1.75h7a.875.875 0 000-1.75h-7zM1.313 3.5c0-.483.391-.875.875-.875h9.624a.875.875 0 010 1.75H2.188a.875.875 0 01-.876-.875z",fill:"currentColor"}),d=i("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M.19 6.205C0 6.58 0 7.07 0 8.05v3.15c0 .98 0 1.47.19 1.844.169.33.436.597.766.765.374.19.864.19 1.844.19h8.4c.98 0 1.47 0 1.845-.19a1.75 1.75 0 00.764-.765C14 12.67 14 12.18 14 11.2V8.05c0-.98 0-1.47-.19-1.845a1.75 1.75 0 00-.766-.764c-.374-.191-.864-.191-1.844-.191H2.8c-.98 0-1.47 0-1.844.19a1.75 1.75 0 00-.765.765zM2.528 7c-.318 0-.425.425-.145.576l4.203 2.263c.26.14.571.14.83 0l4.203-2.263c.28-.15.173-.576-.145-.576H2.527z",fill:"currentColor"});t.default=function(e){return n.createElement("svg",o({width:14,height:14,viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),r,d)}},5065:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withIgnoreCorp=void 0;var a=s(350);t.withIgnoreCorp=function(e){return a.isCorp()?function(){return null}:e}},5071:function(e,t){ns.View.define("messages-item-labels",{models:{message:{"ns-model-changed":"keepValid","ns-model-changed.lid":"updateSelf"},labels:{"ns-model-changed":!1,"daria:mLabels:rename":"forceUpdate"}},yateModule:"messages",methods:{updateSelf:function(){this.forceUpdate()}}})},5072:function(e,t){ns.View.define("messages-item-labels-mixin",{models:{message:ns.View.defineModelEvents({"ns-model-changed.lid":"forceUpdate"}),labels:ns.View.defineModelEvents({"daria:mLabels:rename":"forceUpdate"})}})},5073:function(e,t){ns.View.edefine("messages-item-userpic",{events:{"click .js-message-snippet-userpic":"onUserpicClick"},models:{message:!1},yateModule:"messages",methods:{onUserpicClick:function(e){e.preventDefault(),e.stopPropagation(),this.logClickMessageFromSearch("avatar");var t=e.target.href;t&&ns.page.go(t)}}},"messages-search-logger-mixin",ns.View)},5074:function(e,t){ns.View.define("messages-item-userpic-mixin",{events:{"click .js-message-snippet-userpic":"_messagesItemUserpicOnClick"},methods:{_messagesItemUserpicOnClick:function(e){e.preventDefault(),e.stopPropagation(),this.logClickMessageFromSearch("avatar");var t=e.target.href;t&&ns.page.go(t)}}})},5075:function(e,t){ns.View.define("messages-item-checkbox",{models:{message:{"ns-model-changed":!1,"ns-model-checked-toggle":"onMessageCheckedToggle"},"messages-checked":{"ns-model-changed":!1,"ns-model-reset-checked":"onCheckedReset"}},events:{"ns-view-htmlinit":"onInit",click:"onClickCheckbox"},yateModule:"messages",methods:{onInit:function(){this.checkIfInCheckedThread()},checkIfInCheckedThread:function(){var e=this.getModel("messages-checked"),t=this.getModel("message");e.isCheckedByMid(t.getThreadId())&&e.check(t,!0,{sendNotification:!1})},_getNodesToMarkChecked:function(){return this.$node.add(".js-messages-item-checkbox-visual",this.$node)},onClickCheckbox:function(){this.toggleChecked(),this.afterClickCheckbox()},afterClickCheckbox:_.noop,toggleChecked:function(){var e=this.getModel("message"),t=this.getModel("messages-checked");t.toggleCheck(e);var s=t.isChecked(e);ns.events.trigger("daria:vMessagesItem:checked",this.$node,s,e)},onMessageCheckedToggle:function(e,t,s){if(this.isVisible()){var a=this.getModel("message"),n=this.getModel("messages-checked"),o=n.isChecked(a);s===n.key&&(ns.events.trigger("daria:vMessagesItem:checked",this.$node,o,this.getModel("message")),this._setChecked({checked:o,force:!0}),this.afterMessageCheckedToggle(o,t))}else this.invalidate()},afterMessageCheckedToggle:function(e,t){(t=_.extend({sendNotification:!0},t)).sendNotification&&this.sendThreadNotification(e)},sendThreadNotification:function(e){var t=this.getModel("message");ns.Model.get("message",{ids:t.get(".tid")}).trigger("ns-model-child-check-toggle",e)},_setChecked:function(e){var t=this._getNodesToMarkChecked();e=_.extend({force:!1,checked:!1},e),t.toggleClass("is-checked",e.checked)},onCheckedReset:function(){this.isVisible()?this._setChecked({checked:this.isChecked(),force:!0}):this.invalidate()},isChecked:function(){var e=this.getModel("message");return this.getModel("messages-checked").isChecked(e)}}})},5076:function(e,t){ns.View.define("messages-item-checkbox-mixin",{models:{message:ns.View.defineModelEvents({"ns-model-checked-toggle":"_messagesItemCheckboxMessageCheckedToggle"}),"messages-checked":ns.View.defineModelEvents({"ns-model-reset-checked":"_messagesItemCheckboxCheckedReset"})},events:{"ns-view-htmlinit":"_messagesItemCheckboxHtmlInit","click .js-messages-item-checkbox":"_messagesItemCheckboxClickCheckbox"},methods:{_messagesItemCheckboxHtmlInit:function(){var e=this.getModel("message"),t=this.getModel("messages-checked");t.isCheckedByMid(e.getThreadId())&&t.check(e,!0,{sendNotification:!1})},_messagesItemCheckboxClickCheckbox:function(e){e.preventDefault(),Jane.c({"Список писем":{"чекбокс":"клик"}}),e.shiftKey||(this._messagesItemCheckboxToggleChecked(),this.afterClickMessagesItemCheckbox())},_messagesItemCheckboxCheckedReset:function(){this.isVisible()?this._messagesItemCheckboxSetChecked({checked:this.isChecked(),force:!0}):this.invalidate()},_messagesItemCheckboxMessageCheckedToggle:function(e,t,s){if(this.isVisible()){var a=this.getModel("message"),n=this.getModel("messages-checked"),o=n.isChecked(a);s===n.key&&(ns.events.trigger("daria:vMessagesItem:checked",this.$node,o,this.getModel("message")),this._messagesItemCheckboxSetChecked({checked:o,force:!0}),this.afterCheckedToggleMessagesItemCheckbox(o,t))}else this.invalidate()},_messagesItemCheckboxToggleChecked:function(){var e=this.getModel("message"),t=this.getModel("messages-checked");t.toggleCheck(e);var s=t.isChecked(e);ns.events.trigger("daria:vMessagesItem:checked",this.$node,s,e)},_messagesItemCheckboxSetCheckedNative:function(e){var t=this.$node.find(".js-messages-item-checkbox-visual");e=_.extend({force:!1,checked:!1},e),t.toggleClass("is-checked",e.checked)},_messagesItemCheckboxSetCheckedNb:function(e){var t=nb.$block(".js-messages-item-checkbox-visual",this.node);t&&(e.checked?t.check():t.uncheck())},_messagesItemCheckboxSetChecked:function(e){Daria.UISettings.shouldShowCheckboxInsideUserpic()?this._messagesItemCheckboxSetCheckedNative(e):this._messagesItemCheckboxSetCheckedNb(e)},messagesItemCheckboxAfterMessageCheckedToggle:function(e,t){if((t=_.extend({sendNotification:!0},t)).sendNotification){var s=this.getModel("message");ns.Model.get("message",{ids:s.get(".tid")}).atrigger("ns-model-child-check-toggle",e)}}}})},5077:function(e,t){ns.View.edefine("messages-item-checkbox-nb",{models:{message:{"ns-model-changed":!1,"ns-model-checked-toggle":"onMessageCheckedToggle"},"messages-checked":{"ns-model-changed":!1,"ns-model-reset-checked":"onCheckedReset"}},yateModule:"messages",methods:{_setChecked:function(e){var t=nb.$block(".nb-checkbox",this.node);t&&(e.checked?t.check():t.uncheck())}}},"messages-item-checkbox")},5078:function(e,t){ns.View.define("messages-item-thread-checkbox",{models:{message:{"ns-model-changed":!1,"ns-model-checked-toggle":"onMessageCheckedToggle","ns-model-child-check-toggle":"onChildCheckToggle"},"messages-checked":{"ns-model-changed":!1,"ns-model-reset-checked":"onCheckedReset"},"messages-item-state":!1,settings:!1},events:{click:"onClickCheckbox"},yateModule:"messages",methods:{afterClickCheckbox:function(){this.toggleManuallyCheckedState()},toggleManuallyCheckedState:function(){var e=this.getModel("messages-checked").isChecked(this.getModel("message"));this.getModel("messages-item-state").set(".manuallyChecked",e)},afterMessageCheckedToggle:function(e,t){(t=_.extend({affectChildren:!0},t)).affectChildren&&this.affectChildren(e)},affectChildren:function(e){var t=this.getModel("message").getThreadMessages();this.changeChildrenCheckedState(e,t)},getActualMessagesCount:function(e,t,s){return 0!==e?e:t<s?t:s},changeChildrenCheckedState:function(e,t){var s=this.getModel("messages-checked"),a={sendNotification:!1};t.models.forEach(function(t){s.check(t,e,a)})},onChildCheckToggle:function(){if(this.isVisible()){var e=this.getModel("message"),t=e.getThreadMessages(),s=this.getModel("messages-checked"),a=_.all(t.models,s.isChecked.bind(s));s.check(e,a,{sendNotification:!1,affectChildren:!1})}}}},"messages-item-checkbox")},5079:function(e,t){ns.View.define("messages-item-thread-checkbox-mixin",{models:{"messages-item-state":!1,message:ns.View.defineModelEvents({"ns-model-child-check-toggle":"_messagesItemThreadCheckboxChildCheckToggle"})},methods:{messagesItemThreadCheckboxAfterClick:function(){var e=this.getModel("messages-checked").isChecked(this.getModel("message"));this.getModel("messages-item-state").set(".manuallyChecked",e)},messagesItemThreadCheckboxAfterMessageCheckedToggle:function(e,t){if((t=_.extend({affectChildren:!0},t)).affectChildren){var s=this.getModel("message").getThreadMessages();this._messagesItemThreadCheckboxChangeChildrenCheckedState(e,s)}},_messagesItemThreadCheckboxChangeChildrenCheckedState:function(e,t){var s=this.getModel("messages-checked"),a={sendNotification:!1};t.models.forEach(function(t){s.check(t,e,a)})},_messagesItemThreadCheckboxChildCheckToggle:function(){if(this.isVisible()){var e=this.getModel("message");if(e.isThreadModel()){var t=e.getThreadMessages(),s=this.getModel("messages-checked"),a=_.all(t.models,s.isChecked.bind(s));s.check(e,a,{sendNotification:!1,affectChildren:!1})}}}}})},5080:function(e,t){ns.View.edefine("messages-item-thread-checkbox-nb",{models:{message:{"ns-model-changed":!1,"ns-model-checked-toggle":"onMessageCheckedToggle","ns-model-child-check-toggle":"onChildCheckToggle"},"messages-checked":{"ns-model-changed":!1,"ns-model-reset-checked":"onCheckedReset"},"messages-item-state":!1,settings:!1},yateModule:"messages",methods:{_setChecked:function(e){var t=nb.$block(".nb-checkbox",this.node);t&&(e.checked?t.check():t.uncheck())}}},"messages-item-thread-checkbox")},5081:function(e,t){ns.View.edefine("messages-item-checkbox-wrap",{models:{message:!1,"messages-checked":!1},events:{"click .js-messages-item-checkbox-visual":"onCheckboxClick"},yateModule:"messages",methods:{patchLayout:function(){var e=Daria.UISettings.shouldShowCheckboxInsideUserpic()?"":"-nb";return this.getModel("message").isThreadModel()?"layout-messages-item-thread-checkbox"+e:"layout-messages-item-checkbox"+e},isMessageChecked:function(){return this.getModel("messages-checked").isCheckedByMid(this.params.ids)},onCheckboxClick:function(e){e.preventDefault(),e.stopPropagation();var t=Daria.UISettings.shouldShowCheckboxInsideUserpic()?"cbxavatar":"checkbox";this.isMessageChecked()&&this.logClickMessageFromSearch(t)}}},"messages-search-logger-mixin",ns.View)},5082:function(e,t){ns.View.defineNg("messages-item-checkbox-wrap-mixin",{models:{message:!1,"messages-checked":!1},events:{"click .js-messages-item-checkbox-visual":"_messagesItemCheckboxWrapCheckboxClick"},mixins:["messages-item-checkbox-mixin","messages-item-thread-checkbox-mixin"],methods:{_messagesItemCheckboxWrapCheckboxClick:function(){if(this.getModel("messages-checked").isCheckedByMid(this.params.ids)){var e=Daria.UISettings.shouldShowCheckboxInsideUserpic()?"cbxavatar":"checkbox";this.logClickMessageFromSearch(e)}},isChecked:function(){var e=this.getModel("message");return this.getModel("messages-checked").isChecked(e)},afterClickMessagesItemCheckbox:function(){this.getModel("message").isThreadModel()&&this.messagesItemThreadCheckboxAfterClick()},afterCheckedToggleMessagesItemCheckbox:function(e,t){this.getModel("message").isThreadModel()?this.messagesItemThreadCheckboxAfterMessageCheckedToggle(e,t):this.messagesItemCheckboxAfterMessageCheckedToggle(e,t)}}})},5083:function(e,t){ns.View.define("messages-item-userpic-and-checkbox",{models:{message:!1,"messages-checked":!1,settings:{"ns-model-changed":!1,"ns-model-changed.show_checkbox_inside_userpic":"invalidate"}},yateModule:"messages"})},5084:function(e,t){ns.View.defineNg("messages-item-userpic-and-checkbox-mixin",{models:{settings:ns.View.defineModelEvents({"ns-model-changed.show_checkbox_inside_userpic":"forceUpdate","ns-model-changed.messages_avatars":"invalidate"})},mixins:["messages-item-userpic-mixin","messages-item-checkbox-wrap-mixin"]})},5085:function(e,t){function s(e){return function(e){if(Array.isArray(e)){for(var t=0,s=new Array(e.length);t<e.length;t++)s[t]=e[t];return s}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}ns.View.define("important-toggleable-mixin",{models:{labels:!1,message:!1},yateModule:"messages",methods:{_importantToggleableIsImportant:function(){return this.getModel("message").isImportant()},_onImportantToggleableClick:function(e){var t=this;if(e.stopPropagation(),e.preventDefault(),!this.updatePromise){var s=this._importantToggleableIsImportant()?"unlabel":"label",a=this.getModel("labels").getImportantLID(),n=this.getModel("message").getMessagesCheckedModel(!0);this.countToggleableClick(["Важное","label"===s?"проставление":"снятие",this._getFlagContext(e.currentTarget),this.isNewImportantFlag(e.currentTarget)?"Новый флажок":"Старый флажок"]),this.updatePromise=Daria.MOPS.updateHelper(s,n,a).always(function(){t.updatePromise=null})}},_getFlagContext:function(e){var t=function(t){return Boolean($(e).closest(t).length)};switch(!0){case t(".js-message-head"):return"Развёрнутое письмо";case t(".js-thread-item"):return"Свёрнутое письмо треда";case t(".js-message-snippet"):return"Письмо в списке";case t(".js-mail-Message-Toolbar-Content"):return"Шапка треда";default:return"unknown"}},countToggleableClick:function(e){var t;(t=Jane.ToolbarMetric).messageControlsToolbar.apply(t,[null].concat(s(e)))},isNewImportantFlag:function(e){return $(e).hasClass("js-flag-new")}}})},5086:function(e,t){function s(e){return function(e){if(Array.isArray(e)){for(var t=0,s=new Array(e.length);t<e.length;t++)s[t]=e[t];return s}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}ns.View.define("important-toggleable",{models:{labels:!1,message:{"ns-model-changed":!1,"ns-model-changed.lid":"_onMessageLidChange"}},params:function(e){return{ids:e.ids||e.thread_id}},events:{click:"_onImportantToggleableClick"},yateModule:"messages",methods:{_onMessageLidChange:function(){this.$node.toggleClass("is-active",this._importantToggleableIsImportant())},countToggleableClick:function(e){var t,a=this.getModel("message");(t=Jane.ToolbarMetric).messageControlsToolbar.apply(t,[a].concat(s(e)))}}},"important-toggleable-mixin")},5087:function(e,t){ns.View.define("important-toggleable-head",{models:{labels:!1,message:{"ns-model-changed":!1,"ns-model-changed.lid":"_onMessageLidChange"}},events:{click:"_onImportantToggleableClick"},yateModule:"messages"},"important-toggleable")},5088:function(e,t){ns.View.define("important-toggler",{models:{labels:!1,message:{"ns-model-changed":!1,"ns-model-changed.lid":"_onMessageLidChange"}},events:{click:"_onImportantToggleableClick"},yateModule:"messages",methods:{isNewImportantFlag:function(){return!0},_onMessageLidChange:function(){var e=this._importantToggleableIsImportant();this.$node.find(".js-message-snippet-importance").toggleClass("is-active",e),this.$node.toggleClass("mail-Important-Toggler-Container_visible",e)}}},"important-toggleable")},5089:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(346);ns.View.define("priority-toggleable-mixin",{models:{labels:"keepValid",message:ns.View.defineModelEvents({"ns-model-changed.lid":"forceUpdate"}),settings:"keepValid"},params:function(e){return{ids:e.ids||e.thread_id}},ctor:function(){this.onPriorityToggleableUnlabel=this.onPriorityToggleableUnlabel.bind(this)},events:{"click .js-priority-toggleable":"onPriorityToggleableClick"},yateModule:"messages",methods:{onPriorityToggleableUnlabel:function(e){e.stopPropagation(),e.preventDefault(),this._priorityToggleableIsPriority()&&this._onPriorityToggleableClick(e,"unlabel")},onPriorityToggleableClick:function(e){e.stopPropagation(),e.preventDefault();var t=this;this.getModel("labels").getPriorityLID()?this._onPriorityToggleableClick(e):this.createPriorityLabel("hamon_label").then(function(s){s&&t._onPriorityToggleableClick(e)}),this._priorityToggleableIsPriority()&&(window.Apdex.delete(["Performance_showInboxGPT"]),window.Apdex.start(["Performance_showInboxGPT"],!0))},_onPriorityToggleableClick:function(e,t){var s=t||(this._priorityToggleableIsPriority()?"unlabel":"label"),a=this.getModel("labels").getPriorityLID(),n=this.getModel("message"),o=n.getMessagesCheckedModel(!0);Jane.ToolbarMetric.messageControlsToolbar(n,("label"===s?"поставить":"снять")+" отметку приоритетное"),Daria.MOPS.updateHelper(s,o,a)},createPriorityLabel:function(e){var t=Object(a.getMailboxUid)();return ns.forcedRequest([{id:"do-labels-add-by-symbol",params:{symbol:e,mailboxUid:t}},{id:"labels",params:{mailboxUid:t}}]).then(function(e){var t=e[0].get(".body.updated");return t||null}).fail(function(e){return Jane.ErrorLog.send({type:"create-label-error",msg:e}),null})},_priorityToggleableIsPriority:function(){return this.getModel("message").isPriority()},getPriorityToggleableTitle:function(){return this._priorityToggleableIsPriority()?i18n("%Messages_PriorityLetter_Tooltip_Unmark"):i18n("%Messages_PriorityLetter_Tooltip_Mark")}}})},5090:function(e,t){ns.View.defineNg("priority-toggleable",{mixins:["priority-toggleable-mixin"],params:ns.View.info("priority-toggleable-mixin").params,yateModule:"messages"})},5091:function(e,t){ns.View.defineNg("priority-toggleable-head",{mixins:["priority-toggleable-mixin"],params:ns.View.info("priority-toggleable-mixin").params,yateModule:"messages"})},5092:function(e,t){ns.View.define("read-toggleable",{models:{message:{"ns-model-changed":"onMessageChange","ns-model-changed.new":"onMessageNewChange","ns-model-changed.lid":"onMessageLidChange"},"state-message-thread-item":!1,"message-read-mute-fsm":{"ns-model-changed":!1,"# toRead":"onStateToRead","# toUnread":"onStateToUnread","# toMute":"onStateToMute","# toUnmute":"onStateToUnmute"}},params:function(e){return{ids:e.ids||e.thread_id,type:"messages"}},events:{"ns-view-init":"onInit",click:"onClick"},yateModule:"messages",methods:{TO_MUTE_TIMEOUT:2e3,onInit:function(){this.mReadMuteFsm=this.getModel("message-read-mute-fsm"),this.mMessage=this.getModel("message"),this.setStartState(),this.muteLabelLid=no.jpath(".lid",ns.Model.get("labels").getMuteThreadLabel()),this.canMute=Daria.IS_CORP||Daria.Config.pddDomain||Daria.Config.workspace},setStartState:function(){this.mReadMuteFsm.setInitialState(this.computeFsmModelState())},_readToggleableGetReadMuteFsmState:function(){return this.mReadMuteFsm.getState()},computeFsmModelState:function(){return this.mMessage.isNew()?"toRead":this.mMessage.isMuted()?"toUnmute":"toUnread"},onClick:function(e){e.stopPropagation(),e.preventDefault();var t=this.mReadMuteFsm.getState(),s="toRead"===t?"mark as read":"mark as unread";Jane.ToolbarMetric.messageControlsToolbar(this.mMessage,s),"toUnread"===t||"toRead"===t?this.mMessage.toggleMark():this.mMessage.toggleMute()},toggleState:function(){var e,t=this.mReadMuteFsm.getState(),s=this.mMessage.isNew();switch(t){case"toRead":e=this.canMute&&this.mMessage.isMutable()?"toMute":"toUnread";break;case"toUnread":e=this.mMessage.isMuted()?"toUnmute":"toRead";break;case"toMute":e=s?"toRead":"toUnmute";break;case"toUnmute":e=s?"toRead":"toUnread"}this.mReadMuteFsm.setState(e)},onMessageChange:function(e,t){t||this.setStartState()},onMessageNewChange:function(){if(this.mMessage.isMuted())this.mMessage.toggleMute();else{var e=this.mMessage.isThread(),t=this.mReadMuteFsm.getState();e&&"toRead"===t&&this.mMessage.isNew()||this.toggleState()}},onMessageLidChange:function(e,t,s,a,n){this.mMessage.isThread()&&(this.mMessage.hasLabelInDiff(this.muteLabelLid,n)&&this.toggleState())},onStateToRead:function(){this.unbindMuteShowTimeout(),this.forceUpdate()},onStateToUnread:function(){this.unbindMuteShowTimeout(),this.forceUpdate()},onStateToMute:function(){this.forceUpdate(),this.bindMuteShowTimeout()},onStateToUnmute:function(){this.unbindMuteShowTimeout(),this.forceUpdate()},bindMuteShowTimeout:function(){this.from_ToMute_to_Unread_timerId=_.delay(function(){this.unbindMuteShowTimeout(),this.$node&&(this.$node.is(":hover")?this.bindMuteShowTimeout():this.mReadMuteFsm.isCurrentState("toUnread")||this.mReadMuteFsm.setState("toUnread"))}.bind(this),this.TO_MUTE_TIMEOUT)},unbindMuteShowTimeout:function(){this.from_ToMute_to_Unread_timerId&&(window.clearTimeout(this.from_ToMute_to_Unread_timerId),this.from_ToMute_to_Unread_timerId=0)},syncState:function(){this.mReadMuteFsm.getState()!==this.computeFsmModelState()&&(this.setStartState(),this.forceUpdate())}}}),ns.View.edefine("read-toggleable-thread",{models:{message:{"ns-model-changed":"onMessageChange","ns-model-changed.new":"onMessageNewChange","ns-model-changed.lid":"onMessageLidChange"},"state-message-thread-item":!1,"message-read-mute-fsm":{"ns-model-changed":!1,"# toRead":"onStateToRead","# toUnread":"onStateToUnread","# toMute":"onStateToMute","# toUnmute":"onStateToUnmute"}},params:function(e){return{ids:e.ids||e.thread_id,type:"thread"}},events:{"ns-view-show":"syncState"},yateModule:"messages"},"read-toggleable"),ns.View.edefine("read-toggleable-head",{models:{message:{"ns-model-changed":"onMessageChange","ns-model-changed.new":"onMessageNewChange","ns-model-changed.lid":"onMessageLidChange"},"state-message-thread-item":!1,"message-read-mute-fsm":{"ns-model-changed":!1,"# toRead":"onStateToRead","# toUnread":"onStateToUnread"}},params:function(e){return{ids:e.ids,type:"message"}},events:{"ns-view-show":"syncState"},yateModule:"messages"},"read-toggleable")},5093:function(e,t){ns.View.define("read-toggleable-mixin",{models:{message:ns.View.defineModelEvents({"ns-model-changed":"_readToggleableOnMessageChange","ns-model-changed.new":"_readToggleableOnMessageNewChange","ns-model-changed.lid":"_readToggleableOnMessageLidChange"}),"state-message-thread-item":!1},events:{"ns-view-init":"_readToggleableOnInit","ns-view-htmlinit":"_readToggleableOnHtmlInit","ns-view-htmldestroy":"_readToggleableOnHtmlDestroy","click .js-read-toggleable":"_readToggleableOnClick"},ctor:function(){this._readToggleableOnStateToRead=this._readToggleableOnStateToRead.bind(this),this._readToggleableOnStateToUnread=this._readToggleableOnStateToUnread.bind(this),this._readToggleableOnStateToMute=this._readToggleableOnStateToMute.bind(this),this._readToggleableOnStateToUnmute=this._readToggleableOnStateToUnmute.bind(this)},methods:{_readToggleableGetReadMuteFsm:function(){return this._mReadMuteFsm||(this._mReadMuteFsm=this._readToggleableInitReadMuteFsm()),this._mReadMuteFsm},_readToggleableInitReadMuteFsm:function(){if(this.params){var e=ns.Model.get("message-read-mute-fsm",{ids:this.params.ids,type:"messages"});return e.on("# toRead",this._readToggleableOnStateToRead).on("# toUnread",this._readToggleableOnStateToUnread).on("# toMute",this._readToggleableOnStateToMute).on("# toUnmute",this._readToggleableOnStateToUnmute),e}},_readToggleableDeinitReadMuteFsm:function(){this._mReadMuteFsm&&(this._mReadMuteFsm.off("# toRead",this._readToggleableOnStateToRead).off("# toUnread",this._readToggleableOnStateToUnread).off("# toMute",this._readToggleableOnStateToMute).off("# toUnmute",this._readToggleableOnStateToUnmute),this._mReadMuteFsm=null)},TO_MUTE_TIMEOUT:2e3,_readToggleableOnInit:function(){this.setStartState()},_readToggleableOnHtmlInit:function(){this.$readToggleableNode=this.$node.find(".js-read-toggleable"),this.muteLabelLid=no.jpath(".lid",ns.Model.get("labels").getMuteThreadLabel()),this.canMute=Daria.IS_CORP||Daria.Config.pddDomain||Daria.Config.workspace,this._readToggleableGetReadMuteFsm()},_readToggleableOnHtmlDestroy:function(){this._readToggleableDeinitReadMuteFsm()},_readToggleableGetReadMuteFsmState:function(){return this._readToggleableGetReadMuteFsm()&&this._readToggleableGetReadMuteFsm().getState()},setStartState:function(){this._readToggleableGetReadMuteFsm()&&this._readToggleableGetReadMuteFsm().setInitialState(this.computeFsmModelState())},computeFsmModelState:function(){var e=this.getModel("message");return e.isNew()?"toRead":e.isMuted()?"toUnmute":"toUnread"},_readToggleableOnClick:function(e){e.stopPropagation(),e.preventDefault();var t=this._readToggleableGetReadMuteFsm()&&this._readToggleableGetReadMuteFsm().getState(),s="toRead"===t?"mark as read":"mark as unread";Jane.ToolbarMetric.messageControlsToolbar(null,s),"toUnread"===t||"toRead"===t?this.getModel("message").toggleMark():this.getModel("message").toggleMute()},toggleState:function(){var e,t=this._readToggleableGetReadMuteFsm()&&this._readToggleableGetReadMuteFsm().getState(),s=this.getModel("message"),a=s.isNew();switch(t){case"toRead":e=this.canMute&&s.isMutable()?"toMute":"toUnread";break;case"toUnread":e=s.isMuted()?"toUnmute":"toRead";break;case"toMute":e=a?"toRead":"toUnmute";break;case"toUnmute":e=a?"toRead":"toUnread"}this._readToggleableGetReadMuteFsm()&&this._readToggleableGetReadMuteFsm().setState(e)},_readToggleableOnMessageChange:function(e,t){t||this.setStartState()},_readToggleableOnMessageNewChange:function(){var e=this.getModel("message");if(e.isMuted())e.toggleMute();else{var t=e.isThread(),s=this._readToggleableGetReadMuteFsm()&&this._readToggleableGetReadMuteFsm().getState();t&&"toRead"===s&&e.isNew()||this.toggleState()}},_readToggleableOnMessageLidChange:function(e,t,s,a,n){var o=this.getModel("message");o.isThread()&&(o.hasLabelInDiff(this.muteLabelLid,n)&&this.toggleState())},_readToggleableOnStateToRead:function(){this.unbindMuteShowTimeout(),this.invalidate(),this.forceUpdate()},_readToggleableOnStateToUnread:function(){this.unbindMuteShowTimeout(),this.invalidate(),this.forceUpdate()},_readToggleableOnStateToMute:function(){this.invalidate(),this.forceUpdate(),this.bindMuteShowTimeout()},_readToggleableOnStateToUnmute:function(){this.unbindMuteShowTimeout(),this.invalidate(),this.forceUpdate()},bindMuteShowTimeout:function(){this.from_ToMute_to_Unread_timerId=_.delay(function(){this.unbindMuteShowTimeout(),this.$readToggleableNode&&(this.$readToggleableNode.is(":hover")?this.bindMuteShowTimeout():this._readToggleableGetReadMuteFsm()&&this._readToggleableGetReadMuteFsm().setState("toUnread"))}.bind(this),this.TO_MUTE_TIMEOUT)},unbindMuteShowTimeout:function(){this.from_ToMute_to_Unread_timerId&&(window.clearTimeout(this.from_ToMute_to_Unread_timerId),this.from_ToMute_to_Unread_timerId=0)}}})},5094:function(e,t){ns.View.define("message-empty",{events:{"ns-view-show":"onshow"},models:["settings"],yateModule:"messages",methods:{onshow:function(){var e=this.getModel("settings");e.getSetting("first_show_3pane")&&e.setSettings({first_show_3pane:""})}}})},5095:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(738),n=s(551),o=s(347);ns.View.edefine("message-thread",{params:function(e){return{ids:e.thread_id||e.ids,thread_id:e.thread_id||e.ids,mid:e.thread_id||e.ids}},models:{messages:{"ns-model-changed":"keepValid","ns-model-insert":"keepValid","ns-model-remove":"checkEmptyThread","ns-model-destroyed":"invalidate"},message:{"ns-model-changed":"_onMessageModelChange"},"messages-checked":{"run-action":"_runAction","ns-model-destroyed":"keepValid","ns-model-changed":"keepValid"},"module-message":!1,settings:{"ns-model-changed":"keepValid","ns-model-changed.liza_minified":"lazyFixedRecalc","ns-model-changed.liza_minified_header":"lazyFixedRecalc"},"scroller-message":"keepValid","state-message-thread-list":{"ns-model-changed":"keepValid","ns-model-destroyed":"keepValid","ns-model:expand-list":"onMessageThreadListExpand"},"thread-info":"keepValid",themes:{"ns-model-changed":!1,"ns-model-changed.currentTheme":"addMgTheme"}},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","hotkeys.alignOpenMessage":"onAlignOpenMessage","resize@show window":"_toggleTitleTogglerLazy","daria:MOPS:action-complete":"toggleMarkSubject","click .js-open-quick-reply":"openQuickReply","daria:reactQuickReply:close":"onReactQuickReplyClose","mouseenter .js-toolbar-subject":"onHoverSubjectOn","mouseleave .js-toolbar-subject":"onHoverSubjectOff"},ctor:function(){this._toggleTitleTogglerLazy=_.throttle(this._toggleTitleToggler.bind(this),20),this.recalculateHeaderFixedState=_.throttle(this.recalculateHeaderFixedState.bind(this),20,{trailing:!0,leading:!0}),this._shouldPreserveScrollPosition=Daria.is2pane()},yateModule:"messages",methods:{LOAD_NEXT_PAGE_PADDING:100,CLASS_LONG_TITLE:"mail-Message-Toolbar_longTitle",fixedHeader:!1,onHtmlInit:function(){this._$toolbar=this.$node.find(".js-thread-toolbar"),this._$toolbarSubject=this.$node.find(".js-toolbar-subject"),this._toggleTitleToggler(),this.addMgTheme()},onShow:function(){this.checkEmptyThread()||(Daria.lom.save({current_folder:ns.page.current.params.current_folder,thread_id:this.params.thread_id}),this.fixedElementStart(),ns.Model.get("focus").get(".currentFocus")===this&&this.focusOn(),this.$node.find(".js-react-quick-reply-placeholder").show(0))},onHide:function(){this.fixedElementStop(),this.recalculateHeaderFixedState.cancel();var e=this.getModel("messages-checked"),t=this.getModel("message");e.isChecked(t)||t.uncheckThreadMessages(e),Daria.React.QuickReply&&Daria.React.QuickReply.saveDraftAndDestroy()},openQuickReply:function(){var e=this.params.thread_id,t=ns.Model.get("messages",{thread_id:e}).getLastReplyMessageQR();if(!Object(o.getPddRestrictNotificationsModel)().showPopup(function(){return Object(n.b)([t])})){var s=this.$node.find(".js-react-quick-reply")[0];Daria.openQuickReply({oper:"reply-all",quickReplyNode:s,ids:t.params.ids}),this.$node.find(".js-react-quick-reply-placeholder").hide(0),Jane.c("Quick Reply (new)","click on","reply")}},onReactQuickReplyClose:function(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).shouldSaveDraft?Daria.React.QuickReply.saveDraftAndDestroy():Daria.React.QuickReply.destroy(),this.$node.find(".js-react-quick-reply-placeholder").show(0)},shouldHideThreadControls:function(){return 1===this.getModel("message").getThreadCount()},_onMessageModelChange:function(e,t){".new"===t&&this.toggleMarkSubject(),this.$node.find(" > .mail-Message-Toolbar_thread").toggleClass("mail-MessageThread_asMessage",this.shouldHideThreadControls())},_runAction:function(e,t){var s=t.params||{},a=s.mMessagesChecked||this.getModel("messages-checked");return Daria.MOPS[t.action](a,s)},_toggleTitleToggler:function(){var e=this.initialHeight||this._$toolbarSubject[0].offsetHeight,t=this._$toolbarSubject[0].scrollHeight<=e;t||this.initialHeight||(this.initialHeight=this._$toolbarSubject[0].offsetHeight),this._$toolbarSubject.css("max-height",t?"":this._$toolbarSubject[0].scrollHeight),this._$toolbar.toggleClass(this.CLASS_LONG_TITLE,!t)},checkEmptyThread:function(){var e=ns.page.current;if(Daria.is2pane())return!1;if(this.params.thread_id!==e.params.thread_id)return!1;if(this.getModel("messages").isEmptyList()){var t=_.omit(e.params,"thread_id"),s=ns.router.generateUrl(e.page,t);return Daria.lom.deleteFid(t.current_folder),window.setTimeout(function(){ns.page.go(s)},50),!0}return!1},onAlignOpenMessage:function(e,t){var s,a=ns.Model.get("focus").getFocus();s=a&&"message-thread-item-wrap"===a.id&&a.isOpen()?a.node:this.node,t.scroller.scrollIntoView(s,t.alignOptions)},onMessageThreadListExpand:function(e,t){this.scrollAfterExpand(t.messageIndex,t.offset)},scrollAfterExpand:function(e,t){t=t||0;var s=this.getModel("scroller-message"),a=s.getScrollTop(),n=s.getNodeTop(this.node),o=a+this.getModel("state-message-thread-list").get(".HEIGHT_COMPACT_MESSAGE")*e-t;o=Math.max(o,n),s.setScrollTop(o)},toggleMarkSubject:function(){var e=this.getModel("message");this.$node.find(".js-toolbar-subject").toggleClass("is-unread",e.isNew())},onHoverSubjectOn:function(){this.$node.find(".js-mail-Message-Toolbar").addClass("with-subject-hovered")},onHoverSubjectOff:function(){this.$node.find(".js-mail-Message-Toolbar").removeClass("with-subject-hovered")},getFocusableChildren:function(){var e=[this];if(this.getModel("messages").getCount()>1){var t=Daria.nsTreeWalker.findView(this,["message-thread-pager"]);t&&t.shouldBeVisible()&&e.push(t);var s=Daria.nsTreeWalker.findView(this,["message-thread-list"]);s&&(e=e.concat(s.getFocusableChildren()))}return e},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;case"space":this.toggleCheck();break;case"enter":ns.page.go(Daria.Page.generateUrl.closeMessage());break;case"print":this.print()}},print:function(){Daria.Printer.printThread(this.params.ids)},toggleCheck:function(){var e=this.getModel("message");this.getModel("messages-checked").toggleCheck(e)},focusOn:function(){Object(a.b)(this.$node)},focusOff:function(){Object(a.a)(this.$node)}}},"fixed-element-in-message-mixin","preserve-scroll-position-mixin","mg-theme-mixin")},5096:function(e,t){ns.View.define("message-thread-head-subject",{models:{message:{"ns-model-changed":"keepValid","ns-model-changed.subject":"invalidate","ns-model-changed.subject_prefix":"invalidate"}},params:function(e){return{ids:e.ids||e.thread_id}},yateModule:"messages"})},5097:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(738);ns.View.define("message-thread-expand",{events:{"click .js-expend-control":"onControlClick"},models:{message:{"ns-model-changed":"keepValid","ns-model-changed.count":"updateCount"},"state-message-thread-list":{"ns-model-changed":"keepValid","ns-model-changed.countHiddenMessages":"updateControl","ns-model-destroyed":"keepValid"}},params:function(e){return{ids:e.thread_id||e.ids,thread_id:e.thread_id||e.ids}},yateModule:"messages",methods:{SELECTOR_FOR_COUNT_MESSAGES:".js-expend-control-count",onControlClick:function(e){e.stopPropagation(),this.toggleExpand()},toggleExpand:function(){this.getModel("state-message-thread-list").toggleExpand()},updateControl:function(){var e=this.getModel("state-message-thread-list"),t=e.getCountHiddenMessages();this.$node.toggleClass("is-disabled",!e.mayExpand()).toggleClass("is-folded",0===t)},updateCount:function(){var e=this.getModel("message").getThreadCount();this.$node.find(this.SELECTOR_FOR_COUNT_MESSAGES).text(i18n("%N_писем",e))},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;case"enter":case"space":this.toggleExpand()}},focusOn:function(){Object(a.b)(this.$node)},focusOff:function(){Object(a.a)(this.$node)}}})},5098:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(701),n=s.n(a),o=s(370),i=s(516),r=s(487);ns.View.edefine("message-thread-prev-next",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide",click:"onClick","click .js-open-prev-thread":"onOpenPrevThreadClick","click .js-open-next-thread":"onOpenNextThreadClick"},models:{message:!1},params:function(e){return{ids:e.ids||e.thread_id}},yateModule:"messages",ctor:function(){this.updateArrowBlocksBound=this.updateArrowBlocks.bind(this)},methods:{onHtmlInit:function(){this.$prevArrow=this.$node.find(".js-open-prev-thread"),this.$nextArrow=this.$node.find(".js-open-next-thread")},onShow:function(){this.updateArrowBlocks();var e=this.getMessagesModel();e.on("ns-model-insert",this.updateArrowBlocksBound),e.on("ns-model-remove",this.updateArrowBlocksBound)},onHide:function(){var e=this.getMessagesModel();e.off("ns-model-insert",this.updateArrowBlocksBound),e.off("ns-model-remove",this.updateArrowBlocksBound)},updateArrowBlocks:function(){this.$prevArrow.toggleClass("is-disabled",!this.canOpenThread(n.a.PREV)),this.$nextArrow.toggleClass("is-disabled",!this.canOpenThread(n.a.NEXT))},onClick:function(e){e.stopPropagation()},onOpenPrevThreadClick:function(){this.openThreadForPosition(n.a.PREV)},onOpenNextThreadClick:function(){this.openThreadForPosition(n.a.NEXT)},getMessagesModel:function(){return this._mMessages||(this._mMessages=ns.Model.get("messages",ns.page.current.params)),this._mMessages},canOpenThread:function(e){var t=this.getModel("message").isPinned(),s=this.getMessagesModel(),a=s.getNearestMessageByMid(this.params.ids,e),o=a&&a.isPinned()===t;return e===n.a.NEXT?o||!a&&s.canLoadMore():o},openThreadForPosition:function(e){var t=this,s=this.getMessagesModel(),a=s.getNearestMessageByMid(this.params.ids,e);a?this._openMessageFromThread(a,e):e===n.a.NEXT&&s.canLoadMore()&&s.loadMore().then(function(){if(t.canOpenThread(e)){var a=s.getNearestMessageByMid(t.params.ids,e);t._openMessageFromThread(a,e)}else t.$nextArrow.toggleClass("is-disabled",!0)})},_openMessageFromThread:function(e,t){if(e){var s=Daria.Page.generateUrl.contentMessage3pane(e.getData());ns.page.go(s),this._finishActiveMessageViewScenario(),this._startMessageViewScenario(t)}},_startMessageViewScenario:function(e){var t=e===n.a.NEXT?i.m:i.n;this.scenarioManager.startScenario(o.d,t)},_finishActiveMessageViewScenario:function(){this.scenarioManager.finishScenarioIfActive(o.d,r.c)}}},"scenario-manager-mixin")},5099:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(370),n=s(516),o=s(487);ns.View.edefine("message-thread-item",{params:function(e){return{ids:e.ids,mid:e.ids}},models:{message:{"ns-model-changed":!1,"ns-model-changed.new":"_onMessageNsModelChangedNew","ns-model-changed.lid":"_redraw"},"messages-checked":!1,"account-information":!1,folders:!1,labels:!0,settings:!1,"state-message-thread-item":{"ns-model-changed":!1,"ns-model-changed.isOpened":"invalidate","ns-model-changed.isFocused":"_onStateChangeFocus"}},events:{"ns-view-htmlinit":"_onNsViewHtmlinit","daria:vMessageThread:readUnreadToggle@show":"_onDariaToggleReadUnread","click .js-message-toggle":"_onClickMessageToggle","click .js-message-toggle .js-toggle-important":"_onClickToggleImportant"},yateModule:"messages",methods:{_onNsViewHtmlinit:function(){this.getModel("messages-checked").checkByMidInParams()},openMessage:function(){this.getModel("state-message-thread-item").setOpen(!0)},_redraw:function(){return this.invalidate(),this.update(null,{execFlag:ns.U.EXEC.PARALLEL})},_onClickMessageToggle:function(e){0!==$(e.target).closest(".js-skip-click-message-item").length||(e.stopPropagation(),this.getModel("state-message-thread-item").setOpen(!0),this.getModel("message").isNew()?Jane.c("Треды","клик по свернутому непрочитанному письму треда"):Jane.c("Треды","клик по свернутому прочитанному письму треда"),this._startMessageViewScenario())},_startMessageViewScenario:function(){this.scenarioManager.finishScenarioIfActive(a.d,o.c),this.scenarioManager.startScenario(a.d,n.k)},_onDariaToggleReadUnread:function(){this._toggleMark()},_onClickToggleImportant:function(e){e.stopPropagation(),this._toggleImportantLabel()},_toggleImportantLabel:function(){var e=this.getModel("message"),t=this.getModel("messages-checked"),s=ns.Model.get("labels").getImportantLID(),a=e.hasLabel(s)?"unlabel":"label";Daria.MOPS.updateHelper(a,t,{lid:s}).then(this._onSuccessToggleImportantLabel.bind(this,a))},_onSuccessToggleImportantLabel:function(e){this.$node.find(".js-toggle-important").toggleClass("b-ico_unimportant b-ico_important","label"!==e)},_onStateChangeFocus:function(){var e=this.getModel("state-message-thread-item").get(".isFocused");this.$node.toggleClass("b-message_focus",e)},_onMessageNsModelChangedNew:function(){var e=this.$node.find(".js-message-toggle");e.length&&(this.getModel("message").isNew()?e.addClass("b-message_unread is-unread").removeClass("b-message_read"):e.removeClass("b-message_unread is-unread").addClass("b-message_read")),ns.events.trigger("daria:vMessageThreadItem:toggleMark")},_toggleMark:function(){return this.getModel("message").toggleMark()}}},"scenario-manager-mixin")},5100:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(370),n=s(516),o=s(487),i=s(738);ns.View.edefine("message-thread-item-wrap",{events:{"ns-view-hide":"_onNsViewHide","ns-view-touch":"onTouch","click .js-close-message":"close","ns-view-show":"_onNsViewShow"},models:{message:!1,"messages-checked":"keepValid","state-message-thread-item":{"ns-model-changed":"keepValid","ns-model-changed.isOpened":"_onItemOpenToggle","ns-model-changed.isVisible":"_onStateChangeVisible","ns-model-destroyed":"keepValid"}},yateModule:"messages",methods:{SEEN_TIMEOUT:500,LOADER_TIMEOUT:200,_timerMarkRead:null,_timerBeforeLoader:null,patchLayout:function(){return this.getModel("state-message-thread-item").isOpen()?"layout-message-thread-message":"layout-message-thread-item"},onTouch:function(){this.removeStateLoading()},_onNsViewShow:function(){this._onItemOpenToggle(),this.getModel("state-message-thread-item").set(".didRendered",!0)},_onNsViewHide:function(){this._clearReadTimer(),this._clearLoaderTimer(),this.closeSilently()},removeStateLoading:function(){this.$node.removeClass("is-loading")},closeSilently:function(){this.getModel("state-message-thread-item").destroy()},lazyMarkAsRead:function(){var e=this.getModel("state-message-thread-item");e.get(".forceMark")&&this._setReadTimerCallback(),e.set(".forceMark",!1)},_onItemOpenToggle:function(){var e=this.getModel("state-message-thread-item");e.isOpen()&&(this._timerBeforeLoader=setTimeout(function(){this.$node.addClass("is-loading")}.bind(this),this.LOADER_TIMEOUT)),this.$node.toggleClass("is-opened",e.isOpen()),this.update()},_onStateChangeVisible:function(){this._clearReadTimer();var e=ns.Model.get("state-message-thread-list",{thread_id:this.getModel("message").get(".tid")}).get(".blockAutoMarkAsRead"),t=this.getModel("state-message-thread-item");Daria.is3pane()&&e?t.get(".isVisible")&&t.set(".forceMark",!0):this._setReadTimer()},_setReadTimer:function(){var e=this.getModel("state-message-thread-item"),t=e.get(".isVisible"),s=e.get(".isIgnoreMarkRead");t&&!s&&(this._timerMarkRead=window.setTimeout(this._setReadTimerCallback.bind(this),this.SEEN_TIMEOUT))},_setReadTimerCallback:function(){var e=this.getModel("state-message-thread-item").get(".isIgnoreMarkRead"),t=this.getModel("message").isNew();!e&&t&&(this.getModel("message").toggleMark(),ns.events.trigger("daria:vMessageThreadList:checkVisible"))},_clearReadTimer:function(){window.clearTimeout(this._timerMarkRead)},_clearLoaderTimer:function(){clearTimeout(this._timerBeforeLoader)},isOpen:function(){return this.getModel("state-message-thread-item").isOpen()},open:function(){this.getModel("message").isNew()?Jane.c("Треды","клик по свернутому непрочитанному письму треда"):Jane.c("Треды","клик по свернутому прочитанному письму треда"),this.getModel("state-message-thread-item").setOpen(!0),this._startMessageViewScenario()},_startMessageViewScenario:function(){this.scenarioManager.finishScenarioIfActive(a.d,o.c),this.scenarioManager.startScenario(a.d,n.l)},close:function(){this.getModel("state-message-thread-item").setOpen(!1)},toggleCheck:function(){var e=this.getModel("message");this.getModel("messages-checked").toggleCheck(e)},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;case"enter":this.open();break;case"print":this.print()}},print:function(){this.isOpen()&&Daria.Printer.printMessage(this.params.ids)},focusOn:function(){Object(i.b)(this.$node)},focusOff:function(){Object(i.a)(this.$node)}}},"message-dimensions-mixin","scenario-manager-mixin",ns.View)},5101:function(e,t){ns.View.define("message-thread-item-userpic",{models:{message:!1},yateModule:"messages"})},5102:function(e,t){ns.View.define("first-user-scroll-mixin",{methods:{_subscribeFirstUserScroll:function(){this._subscribeFirstUserScrollTimeout||(this._subscribeFirstUserScrollTimeout=_.defer(function(){ns.events.on("daria:vScrollerMessage:scroll",this._onFirstUserScroll)}.bind(this)))},_unsubscribeFirstUserScroll:function(){clearTimeout(this._subscribeFirstUserScrollTimeout),this._subscribeFirstUserScrollTimeout=null,ns.events.off("daria:vScrollerMessage:scroll",this._onFirstUserScroll)},_onFirstUserScroll:function(){this._unsubscribeFirstUserScroll(),this.getModel("state-message-thread-list").set(".blockAutoMarkAsRead",!1),this.forEachItem(function(e){e.lazyMarkAsRead()})}}})},5103:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(137);s.n(a);ns.ViewCollection.edefine("message-thread-list",{events:{"ns-view-init":"_onNsViewInit","ns-view-show":"_onNsViewShow","ns-view-hide":"_onNsViewHide","daria:vMessageThreadList:showMore@show":"_onMessagesLoad","daria:vMessageThreadList:expandUnread@show":"onExpandUnreadClick","daria:vMessageThreadList:checkVisible@show":"_checkVisibleMessages","daria:vMessageThreadList:scrollToNextUnread@show":"onScrollToNextUnread","daria:vScrollerMessage:scroll@show":"onScrollChanged","daria:layout-changed@show":"onScrollChanged"},models:{message:"keepValid",messages:{"ns-model-changed":"keepValid","ns-model-remove":"forceUpdate","ns-model-insert":"_onMessagesNsModelInsert"},"scroller-message":"keepValid","state-message-thread-list":"keepValid"},params:function(e){return{ids:e.thread_id||e.ids,thread_id:e.thread_id||e.ids}},split:{byModel:"messages",intoViews:function(){return this._openMessages(),"message-thread-item-wrap"}},ctor:function(){this._checkVisibleMessages=_.throttle(this._checkVisibleMessages.bind(this),50),this._onFirstUserScroll=this._onFirstUserScroll.bind(this)},yateModule:"messages",methods:{HEIGHT_LOADER_BLOCK:34,COUNT_MESSAGES_BEFORE_OPEN_MESSAGE:3,MESSAGE_TOP_BORDER_VISIBLE:70,_promiseMessagesLoad:null,_blockMessageAutoOpen:!1,_subscribeFirstUserScrollTimeout:null,_openMessages:function(){this._blockMessageAutoOpen||(this._getOpenedMessages().forEach(function(e){this._setMessageOpenState(e,!0)},this),this._blockMessageAutoOpen=!0)},_getOpenedMessages:function(){var e,t=this.getModel("messages");if(Daria.is3pane()){var s=t.getUnreads();if(s.length>0)return s}var n=ns.Model.get("folders"),o=ns.page.current.params.current_folder;return(e=n.isFolder(o,a.OutcomingFolders)?_.find(t.models,function(e){return e.isOutcomeMessage()}):_.find(t.models,function(e){return!e.isDraftLike()}))||(e=t.models[0]),[e]},_setMessageOpenState:function(e,t,s){var a=_.extend({},this.params,{ids:e.get(".mid")});void 0===s&&(s=!0),ns.Model.get("state-message-thread-item",a).setOpen(t,s)},_onNsViewInit:function(){this.mStateMessageThreadList=this.getModel("state-message-thread-list")},_onNsViewShow:function(){this.getModel("scroller-message").init(),this._hideFirstPartMessages(),ns.events.trigger("daria:mFocus:buildTree"),ns.events.atrigger("daria:vMessageThreadList:checkVisible"),this._unsubscribeFirstUserScroll(),this._subscribeFirstUserScroll()},_onNsViewHide:function(){this._blockMessageAutoOpen=!1,this.mStateMessageThreadList.destroy(),this._unsubscribeFirstUserScroll(),this._removeClassForHiding(),ns.events.trigger("daria:mFocus:buildTree")},_hideFirstPartMessages:function(){var e=this.getModel("messages").models,t=_.last(this._getOpenedMessages()),s=e.indexOf(t),a=[];e.length-1-s<=2?this.mStateMessageThreadList.setHiddenMessages(a):(e.forEach(function(e,t){if(!(t<=s+1)){var n=this.getItemByModel(e);n&&n.$node&&(n.$node.addClass("is-hidden"),a.push(n))}},this),this.mStateMessageThreadList.setHiddenMessages(a))},showMessages:function(){this._removeClassForHiding(),this.mStateMessageThreadList.resetHiddenMessages(),ns.events.trigger("daria:mFocus:buildTree")},_removeClassForHiding:function(){this.forEachValidItem(function(e){e.$node.removeClass("is-hidden")})},_onMessagesLoad:function(){var e=this.getModel("messages"),t=e.canLoadMore(),s=this.mStateMessageThreadList.getCountHiddenMessages();if(s){this.showMessages();var a=t?0:this.HEIGHT_LOADER_BLOCK;return this.mStateMessageThreadList.trigger("ns-model:expand-list",{messageIndex:s,offset:a}),vow.resolve()}return this._promiseMessagesLoad&&!this._promiseMessagesLoad.isResolved()?this._promiseMessagesLoad:t?(this._promiseMessagesLoad=e.loadMore(!0),this._promiseMessagesLoad.then(function(){this.mStateMessageThreadList.resetHiddenMessages()}.bind(this)),this._promiseMessagesLoad):vow.reject("can't load messages portion")},_checkVisibleMessages:function(){if(!(this.$node.find(".js-body-loading").length>0)){var e=this.getModel("scroller-message").getVDimensions();e.bottom-=this.MESSAGE_TOP_BORDER_VISIBLE,this.forEachValidItem(function(t){if(t.getModel("message").isNew()){var s=t.getModel("state-message-thread-item");if(s.get(".isOpened")){var a=t.isVisibleInScroller(e,!0);s.setVisible(a)}}})}},onScrollChanged:function(){this.isVisible()&&this.isValid()&&this._checkVisibleMessages()},onExpandUnreadClick:function(){this.expandUnreadMessages(),this.showMessages(),this._scrollToNearestUnread(!0)},expandUnreadMessages:function(){this.getModel("messages").getUnreads().forEach(function(e){this._setMessageOpenState(e,!0,!1)},this)},onScrollToNextUnread:function(){this._scrollToNearestUnread()},_scrollToNearestUnread:function(e){var t,s,a,n=this.getModel("messages"),o=n.models,i=o.length,r=this.getModel("scroller-message"),d=r.getScrollTop(),l=r.getScrollOffset();if(i<2)r.setScrollTop(0);else{for(;i--;)if((t=o[i]).isNew()){var c=this.getItemByModel(t);if(!c)continue;if(!a&&(a=c,e))break;if(c.getDimensions(!1).top-l>d){s=c;break}}if(s||(s=a||this.getItemByModel(o[0])),s){var g=s.getDimensions(!1),h=n.canLoadMore()?0:this.HEIGHT_LOADER_BLOCK;r.setScrollTop(g.top-l-h,!0)}else 0===d&&r.setScrollTop(1e5)}},_onMessagesNsModelInsert:function(e,t){if(this.isVisible()){var s=t[0],a=_.extend({},this.params,{ids:s.get(".mid")}),n=ns.Model.get("state-message-thread-item",a),o=this;s===this.getModel("messages").models[0]?(this._unsubscribeFirstUserScroll(),this.mStateMessageThreadList.set(".blockAutoMarkAsRead",!0),this._subscribeFirstUserScroll()):n.once("ns-model-changed.didRendered",function(){o.mStateMessageThreadList.trigger("ns-model:expand-list",{messageIndex:t.length})}),Daria.is3pane()&&t.forEach(function(e){e.isNew()&&this._setMessageOpenState(e,!0,!1)},this),this.forceUpdate()}},getFocusableChildren:function(){var e=this.mStateMessageThreadList.get(".hiddenMessages"),t=[];return this.forEachValidItem(function(s){_.includes(e,s)||t.push(s)}),t.reverse()}}},"first-user-scroll-mixin",ns.ViewCollection)},5104:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(738);ns.View.define("message-thread-pager",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","click .js-message-thread-pager-loadMore":"onLoadMoreClick","click .js-message-thread-pager-expandUnread":"onExpandUnreadClick"},models:{message:!1,messages:{"ns-model-changed":"onMessagesChanged","ns-model-insert":"updateCounters","ns-model-remove":"updateCounters"},"state-message-thread-list":{"ns-model-changed":!1,"ns-model-changed.countHiddenMessages":"updateCounters","ns-model-destroyed":"keepValid"}},params:function(e){return{ids:e.thread_id||e.ids,thread_id:e.thread_id||e.ids}},ctor:function(){this.updateCounters=_.throttle(this.updateCounters.bind(this),50)},yateModule:"messages",methods:{getFocusableChildren:function(){return[this]},NODE_CLASS:"mail-MessageThread-Pager",LOAD_MESSAGES_QUANTITY:30,onMessagesChanged:function(e,t){".new"===t.jpath&&this.updateCounters()},onHtmlInit:function(){this.$pagerCounts=this.$node.find(".js-message-thread-pager-counts")},onShow:function(){this.updateCounters()},onHide:function(){this.updateCounters.cancel()},updateCounters:function(){if(this.toggleVisible(),this.shouldBeVisible()){var e=!1;if(Daria.is2pane()){var t=this.getModel("messages").getUnreads().length;e=t>0;var s=this.getModel("message").getThreadCount();this.threadCount=s,this.$node.toggleClass(this.NODE_CLASS+"_withUnread",e),this.setTextInCounters(t,s)}Jane.c("Треды",'показ кнопки "показать N писем"'),e&&Jane.c("Треды",'показ кнопки "перейти к непрочитанным"')}},setTextInCounters:function(e,t){var s=i18n("%Messages_Thread_Total_count",t);e&&(s+=i18n("%Messages_Thread_Unread_count",e)),this.$pagerCounts.html(s)},onLoadMoreClick:function(){Jane.c("Треды",'клик по кнопке "показать N писем"'),ns.events.trigger("daria:vMessageThreadList:showMore")},onExpandUnreadClick:function(){Jane.c("Треды",'клик по кнопке "перейти к непрочитанным"'),ns.events.trigger("daria:vMessageThreadList:expandUnread")},shouldBeVisible:function(){var e=this.getModel("state-message-thread-list"),t=this.getModel("messages").canLoadMore(),s=e.getCountHiddenMessages();return Boolean(s||t)},toggleVisible:function(){this.$node.toggleClass("is-hidden",!this.shouldBeVisible())},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;case"enter":Daria.Focus.moveItem({toForward:!0}),this.onLoadMoreClick()}},focusOn:function(){Object(a.b)(this.$node)},focusOff:function(){Object(a.a)(this.$node)}}})},5105:function(e,t){ns.View.define("message-thread-more-button",{events:{"click .js-toolbar-item-more":"onMoreButtonClick"},models:{"message-thread-toolbar":!0},yateModule:"messages",methods:{onMoreButtonClick:function(e){if(e.stopPropagation(),this.vPopup&&this.vPopup.isValid())return this.vPopup.closePopup(),void(this.vPopup=null);this.vPopup=ns.View.create("message-thread-toolbar-popup",this.params),this.vPopup.open({where:e.currentTarget})},closePopup:function(){this.vPopup&&this.vPopup.closePopup()}}})},5106:function(e,t){ns.View.define("message-thread-messages-count",{models:{message:!0,"messages-checked":!0},params:function(e){return{ids:e.thread_id||e.ids}},yateModule:"messages",methods:{showMessagesCount:function(){return this.getModel("message").hasRealData()?this.getModel("message").getThreadCount():null}}})},5107:function(e,t){ns.View.define("message-thread-reply-all",{events:{"ns-view-show":"onRefresh"},models:{messages:{"ns-model-changed":!1,"ns-mode-insert":"onRefresh","ns-model-remove":"onRefresh"},"index-data":!1},params:function(e){return{thread_id:e.thread_id||e.ids}},yateModule:"messages",ctor:function(){this.onRefresh=_.debounce(this.onRefresh.bind(this),20)},methods:{onRefresh:function(){this.reinitLastMessage()},showView:function(){Jane.c("Message view","Reply all bottom","show"),this.$node.removeClass("is-hidden")},hideView:function(){this.$node.addClass("is-hidden")},reinitLastMessage:function(){var e,t=this.getModel("messages").getLastReplyMessage();t&&t.get(".mid")&&!$(".thread-item-"+t.get(".mid")).hasClass("is-hidden")&&(e=t.get(".mid")),this.lastMid!==e?this.lastMid=e:e||this.hideView()},getStateMessageThreadItem:function(e){return ns.Model.get("state-message-thread-item",{ids:e})}}},"message-actions")},5108:function(e,t){function s(e){return function(e){if(Array.isArray(e)){for(var t=0,s=new Array(e.length);t<e.length;t++)s[t]=e[t];return s}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}ns.View.define("message-thread-toolbar-popup",{events:{"click .js-toolbar-item-forward":"_onForwardToolbarButton","click .js-toolbar-item-delete":"_onRemoveToolbarButton","click .js-toolbar-item-spam":"_onTospamToolbarButton","click .js-toolbar-item-not-spam":"_onNotspamToolbarButton","click .js-toolbar-item-archive":"_onArchiveToolbarButton","click .js-toolbar-item-labels-actions":"_openLabelsDropdown","click .js-toolbar-item-folders-actions":"_openFoldersDropdown","click .js-toolbar-item-pin":"_onPinToolbarButton","click .js-toolbar-item-unpin":"_onUnpinToolbarButton","click .js-toolbar-item-mark-important":"_onMarkImportantToolbarButton","click .js-toolbar-item-mark-unimportant":"_onMarkUnimportantToolbarButton","click .js-toolbar-item-mark-as-read":"_onReadToolbarButton","click .js-toolbar-item-mark-as-unread":"_onUnreadToolbarButton","click .js-kbd-print":"_onPrintToolbarButton"},models:{"message-thread-toolbar":!0,message:!0,"messages-checked":!1},params:function(e){return{mid:e.ids,ids:e.ids}},yateModule:"messages",methods:{open:function(e){this.update({},{execFlag:ns.U.EXEC.PARALLEL}).then(function(){this.nbPopup=nb.block(this.node),this.nbPopup.open(e),this.nbPopup.on("nb-closed",this.destroySelf.bind(this))},this)},closePopup:function(){this.nbPopup&&this.nbPopup.close()},destroySelf:function(){var e=this;_.defer(function(){e.nbPopup&&(e.nbPopup.destroy(),e.nbPopup=null),e.destroy()})},_onForwardToolbarButton:function(){Jane.ToolbarMetric.messageThreadToolbar("forward"),this.closePopup();var e={mMessagesChecked:this.getMessagesCheckedInstance()};ns.action.run("forward",e)},_onRemoveToolbarButton:function(){return Jane.ToolbarMetric.messageThreadToolbar("remove"),this._onToolbarButton("remove")},_onTospamToolbarButton:function(){return Jane.ToolbarMetric.messageThreadToolbar("spam"),this._onToolbarButton("tospam")},_onNotspamToolbarButton:function(){return Jane.ToolbarMetric.messageThreadToolbar("not spam"),this._onToolbarButton("notspam")},_onArchiveToolbarButton:function(){return Jane.ToolbarMetric.messageThreadToolbar("archive"),this._onToolbarButton("archive")},_onPinToolbarButton:function(){return Jane.ToolbarMetric.messageThreadToolbar("pin"),this._onToolbarButton("pin")},_onUnpinToolbarButton:function(){return Jane.ToolbarMetric.messageThreadToolbar("unpin"),this._onToolbarButton("unpin")},_onMarkImportantToolbarButton:function(){Jane.ToolbarMetric.messageThreadToolbar("Important","add");var e=ns.Model.get("labels").getImportantLID();return this._onToolbarButton("label",{lid:e})},_onMarkUnimportantToolbarButton:function(){Jane.ToolbarMetric.messageThreadToolbar("Important","remove");var e=ns.Model.get("labels").getImportantLID();return this._onToolbarButton("unlabel",{lid:e})},_onReadToolbarButton:function(){return Jane.ToolbarMetric.messageThreadToolbar("read"),this._onToolbarButton("mark")},_onUnreadToolbarButton:function(){return Jane.ToolbarMetric.messageThreadToolbar("unread"),this._onToolbarButton("unmark")},_openLabelsDropdown:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"label"),this._openDropdown("labels",e)},_openFoldersDropdown:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"move"),this._openDropdown("folders",e)},_onToolbarButton:function(e,t){t=t||{},this.closePopup();var s=t.mMessagesChecked||this.getMessagesCheckedInstance();return Daria.MOPS[e](s,t)},getMessagesCheckedInstance:function(){return this._mMessagesChecked=ns.Model.get("messages-checked",{mid:this.params.ids}).checkByMidInParams(),this._mMessagesChecked},_openDropdown:function(e,t){var a=$(t.currentTarget);if(!a.hasClass("js-open-dropdown")){var n=ns.View.create(e+"-actions"),o=this.getMessagesCheckedInstance(),i=ns.Model.get("labels").getImportantLID();n.open(t.currentTarget,o,{isInDropdown:!0,isInMore:!0,logMetrika:function(e,t){var a,n=["метка",e===i?"флажок":"пользовательская метка"];n=n.concat("label"===t?"проставление":"снятие"),(a=Jane.ToolbarMetric).messageThreadToolbar.apply(a,s(n))}}).then(function(){a.addClass("js-open-dropdown"),n.nbPopup.on("nb-closed",function(){a.removeClass("js-open-dropdown")})})}},_onPrintToolbarButton:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"print")}}})},5109:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(379),n=s(373);s.n(n);ns.View.define("messages-date-pager-float",{models:{"messages-pager":!1,folders:!1,settings:!1,messages:!1,"scroller-messages":!1},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-htmldestroy":"onHtmlDestroy","ns-view-show":"onShow","ns-view-hide":"onHide","daria:vScrollerMessages:scroll":"updateVisibility","daria:layout-changed":"updateVisibility","messages-date-pager.updateVisibility@show":"updateVisibility"},yateModule:"messages",ctor:function(){this.pagerInitDebounce=_.debounce(this.pagerInit.bind(this),0)},methods:{SHOW_PADDING:150,getThemeClass:function(){return Object(a.cnTheme)(n.PS_LIGHT)},onHtmlInit:function(){this.pagerPromise=new vow.Promise(this.pagerInitDebounce)},onHtmlDestroy:function(){this.pagerInitDebounce.cancel(),this.pagerPromise&&(this.pagerPromise.done(this.pagerUnbindEvents),delete this.pagerPromise)},onShow:function(){this.pagerPromise.done(this.pagerUpdateScroll,this),this.getModel("scroller-messages").init(),this.isHidden=!0,this.$node.addClass("block-messages-date-pager-float-box_hidden"),this.updateVisibility()},onHide:function(){this.isHidden=!0,this.$node.addClass("block-messages-date-pager-float-box_hidden")},patchTree:function(){var e=this.super_.patchTree.call(this),t=this.getModel("messages-pager").getCountMonth();return e.isEmptyMessages=this.getModel("messages").isEmptyList(),e.hasSlider=t>5&&!this.params.pager_top||t>13&&this.params.pager_top,e},pagerInit:function(e,t){this.node?e(new Daria.MessagesPager(this.node)):t()},pagerUpdateScroll:function(e){e.updateScroll(this.params)},pagerUnbindEvents:function(e){e.unbindEvents()},updateVisibility:function(){var e=this.getModel("scroller-messages"),t=this.$node.rect().top<e.getHeight()+this.SHOW_PADDING;t!==this.isHidden&&(this.isHidden=t,this.$node.toggleClass("block-messages-date-pager-float-box_hidden",t))}}})},5110:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(486),n=(s.n(a),s(5111));s.n(n);ns.View.define("messages-empty",Object(a.NsReactView)({component:n.MessagesEmpty,models:["messages"],yateModule:"messages"}))},5111:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__decorate||function(e,t,s,a){var n,o=arguments.length,i=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,s):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,a);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(i=(o<3?n(i):o>3?n(t,s,i):n(t,s))||i);return o>3&&i&&Object.defineProperty(t,s,i),i},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmpty=void 0;var i=o(s(135)),r=s(342),d=s(350),l=s(441),c=s(5112),g=s(5120),h=s(5125),u=s(5126),m=s(5127),f=s(5132),p=s(5133),_=s(5134),b=s(5139),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){var e=this.props.params,t="search"===e.search,s=e.datePager,a=e.tabId,n=e.current_folder,o=e.current_label,r=e.extra_cond,M=l.ThemesStore.instance();return t||s?i.default.createElement(c.MessagesEmptySearch,null):"only_atta"===r?i.default.createElement(b.MessagesEmptyAttachments,null):"social"===a?i.default.createElement(g.MessagesEmptySocial,{isDark:M.isContentDark}):"news"===a?i.default.createElement(_.MessagesEmptyNews,{isDark:M.isContentDark}):"1"===String(n)?i.default.createElement(p.MessagesEmptyInbox,null):n?i.default.createElement(h.MessagesEmptyFolder,{currentFolder:n}):d.isPriorityTab()?i.default.createElement(u.MessagesEmptyPriority,null):o?i.default.createElement(m.MessagesEmptyLabel,{currentLabel:o}):i.default.createElement(f.MessagesEmptyDefault,null)},t=n([r.observer],t)}(i.default.PureComponent);t.MessagesEmpty=M},5112:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptySearch=void 0;var o=n(s(135)),i=n(s(344)),r=s(447),d=s(488),l=n(s(739)),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){return o.default.createElement(d.MessagesEmptyTemplate,{headerContent:o.default.createElement(i.default,{loc:"react-messages/noMessagesHeaderSearch"}),textProps:{as:"ul",className:l.default.list,children:o.default.createElement(o.default.Fragment,null,o.default.createElement(i.default,{tag:"li",loc:"react-messages/noMessagesCheckErrors"}),o.default.createElement(i.default,{tag:"li",loc:"react-messages/noMessagesCheckLength"}),o.default.createElement(i.default,{tag:"li",loc:"react-messages/noMessagesCheckSearch"},o.default.createElement("a",{"data-ref":"extended-search-link",href:r.helpUrl+"/web/letter/mail-search.html#extended-search"}),o.default.createElement("a",{"data-ref":"query-language-link",href:r.helpUrl+"/web/letter/query-language.html"})),o.default.createElement(i.default,{tag:"li",loc:"react-messages/noMessagesCheckManual"},o.default.createElement("a",{"data-ref":"link",href:"#inbox"})))}})},t}(o.default.PureComponent);t.MessagesEmptySearch=c},5113:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyHeader=void 0;var o=n(s(135)),i=s(138),r=n(s(739)),d=s(350),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){var e=this.props.children;return o.default.createElement(i.Text,{as:"h1",className:r.default.header,weight:"bold",typography:d.is3pv()?"subheader-m":"subheader-l"},e)},t}(o.default.PureComponent);t.MessagesEmptyHeader=l},5114:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,s=1,a=arguments.length;s<a;s++)for(var n in t=arguments[s])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(s[a[n]]=e[a[n]])}return s},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyText=void 0;var r=i(s(135)),d=i(s(339)),l=s(138),c=s(350),g=i(s(739)),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){var e=this.props,t=e.as,s=e.className,a=o(e,["as","className"]);return r.default.createElement(l.Text,n({as:null!==t&&void 0!==t?t:"p",className:d.default(g.default.text,s),typography:c.is3pv()?"body-long-s":"body-long-m"},a))},t}(r.default.PureComponent);t.MessagesEmptyText=h},5115:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,s=1,a=arguments.length;s<a;s++)for(var n in t=arguments[s])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(a=Object.getOwnPropertySymbols(e);n<a.length;n++)t.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(s[a[n]]=e[a[n]])}return s},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyButton=void 0;var r=i(s(135)),d=i(s(339)),l=s(140),c=i(s(739)),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){var e=this.props,t=e.className,s=e.view,a=e.url,i=o(e,["className","view","url"]);return r.default.createElement(l.Button,n({className:d.default(c.default.button,t),size:"m",view:null!==s&&void 0!==s?s:"default",type:a?"link":void 0,url:a},i))},t}(r.default.PureComponent);t.MessagesEmptyButton=g},5116:function(e,t,s){e.exports=s.p+"_/6ce7b3e69b85b5240d619518ae66828e-empty-folder-dark.png"},5117:function(e,t,s){e.exports=s.p+"_/16ff7a394f2271a8c468b87fedc2a0a7-empty-folder.png"},5118:function(e,t,s){e.exports=s.p+"_/c40ff9029ab9f7c747334c68dae8b6cd-empty-folder-dark@2x.png"},5119:function(e,t,s){e.exports=s.p+"_/98e56958c415bc20e9dd3bc48d593908-empty-folder@2x.png"},5120:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptySocial=void 0;var o=n(s(135)),i=n(s(344)),r=s(488),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){var e=this.props.isDark;return o.default.createElement(r.MessagesEmptyTemplate,{headerContent:o.default.createElement(i.default,{loc:"react-messages/noMessagesHeaderSocial"}),textProps:{children:o.default.createElement(i.default,{loc:"react-messages/noMessagesTextSocial"})},buttonProps:{url:"#inbox",children:o.default.createElement(i.default,{loc:"react-messages/noMessagesButtonGoToInbox"})},imageProps:{src:s(e?5121:5122),src2x:s(e?5123:5124)}})},t}(o.default.PureComponent);t.MessagesEmptySocial=d},5121:function(e,t,s){e.exports=s.p+"_/6b67fd10c974a19a5d3e1413310d0892-social-dark.png"},5122:function(e,t,s){e.exports=s.p+"_/8a7116f5446180d164b8fd1f2b8332f5-social.png"},5123:function(e,t,s){e.exports=s.p+"_/3e4ce93cd477242f510d5eb8e3685ada-social-dark@2x.png"},5124:function(e,t,s){e.exports=s.p+"_/dfc0b2ea944192cc570e3d42b74696fa-social@2x.png"},5125:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyFolder=void 0;var o=n(s(135)),i=n(s(344)),r=s(382),d=s(488),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){var e=r.getFoldersStore().getFolderDataByFid(this.props.currentFolder);return o.default.createElement(d.MessagesEmptyTemplate,{headerContent:o.default.createElement(i.default,{loc:"react-messages/noMessagesHeaderFolder",params:{name:(null===e||void 0===e?void 0:e.name)||""}}),buttonProps:{url:"#inbox",children:o.default.createElement(i.default,{loc:"react-messages/noMessagesButtonGoToInbox"})}})},t}(o.default.PureComponent);t.MessagesEmptyFolder=l},5126:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyPriority=void 0;var o=n(s(135)),i=n(s(344)),r=s(488),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){return o.default.createElement(r.MessagesEmptyTemplate,{headerContent:o.default.createElement(i.default,{loc:"react-messages/noMessagesHeaderPriority"}),buttonProps:{url:"#inbox",children:o.default.createElement(i.default,{loc:"react-messages/noMessagesButtonGoToInbox"})}})},t}(o.default.PureComponent);t.MessagesEmptyPriority=d},5127:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__awaiter||function(e,t,s,a){return new(s||(s=Promise))(function(n,o){function i(e){try{d(a.next(e))}catch(e){o(e)}}function r(e){try{d(a.throw(e))}catch(e){o(e)}}function d(e){e.done?n(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,r)}d((a=a.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var s,a,n,o,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(s)throw new TypeError("Generator is already executing.");for(;i;)try{if(s=1,a&&(n=2&o[0]?a.return:o[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;switch(a=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,a=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],a=0}finally{s=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyLabel=void 0;var r=i(s(135)),d=i(s(344)),l=s(382),c=s(350),g=s(23),h=s(488),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.labelsStore=l.getLabelsStore(),t}return a(t,e),t.prototype.openLabelRules=function(){return n(this,void 0,Promise,function(){return o(this,function(e){switch(e.label){case 0:return c.logMetric(["Промо меток","Писем с такой меткой нет","клик по ставить метку автоматически"]),[4,g.run("#setup")];case 1:return e.sent(),this.labelsStore.openLabelRulesModal(this.props.currentLabel),[2]}})})},t.prototype.render=function(){var e=this,t=this.labelsStore.getLabelById(this.props.currentLabel),a=["ru","kk","be"].includes(c.getLocale());return r.default.createElement(h.MessagesEmptyTemplate,{headerContent:r.default.createElement(d.default,{loc:"react-messages/noMessagesHeaderLabel",params:{name:(null===t||void 0===t?void 0:t.name)||""}}),textProps:{children:r.default.createElement(d.default,{loc:"react-messages/noMessagesTextLabel"})},buttonProps:{view:"action",onClick:function(){return e.openLabelRules()},children:r.default.createElement(d.default,{loc:"react-messages/noMessagesButtonLabel"})},imageProps:{src:s(a?5128:5129),src2x:s(a?5130:5131)}})},t}(r.default.PureComponent);t.MessagesEmptyLabel=u},5128:function(e,t,s){e.exports=s.p+"_/cccaed42859e47e1933c800dd20ebe8c-labels-ru.png"},5129:function(e,t,s){e.exports=s.p+"_/4721e4a5b7197d59120e69eb5c2e2d76-labels-en.png"},5130:function(e,t,s){e.exports=s.p+"_/faaf07d361d486a4153104004e747c3d-labels-ru@2x.png"},5131:function(e,t,s){e.exports=s.p+"_/18c125a355ffb4b14c0e00fb32da2d46-labels-en@2x.png"},5132:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyDefault=void 0;var o=n(s(135)),i=n(s(344)),r=s(488),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){return o.default.createElement(r.MessagesEmptyTemplate,{headerContent:o.default.createElement(i.default,{loc:"react-messages/noMessagesHeaderDefault"}),buttonProps:{url:"#inbox",children:o.default.createElement(i.default,{loc:"react-messages/noMessagesButtonGoToInbox"})}})},t}(o.default.PureComponent);t.MessagesEmptyDefault=d},5133:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyInbox=void 0;var o=n(s(135)),i=n(s(344)),r=s(488),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){return o.default.createElement(r.MessagesEmptyTemplate,{headerContent:o.default.createElement(i.default,{loc:"react-messages/noMessagesHeaderInbox"})})},t}(o.default.PureComponent);t.MessagesEmptyInbox=d},5134:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyNews=void 0;var o=n(s(135)),i=n(s(344)),r=s(488),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){var e=this.props.isDark;return o.default.createElement(r.MessagesEmptyTemplate,{headerContent:o.default.createElement(i.default,{loc:"react-messages/noMessagesHeaderNews"}),textProps:{children:o.default.createElement(i.default,{loc:"react-messages/noMessagesTextNews"})},buttonProps:{url:"#inbox",children:o.default.createElement(i.default,{loc:"react-messages/noMessagesButtonGoToInbox"})},imageProps:{src:s(e?5135:5136),src2x:s(e?5137:5138)}})},t}(o.default.PureComponent);t.MessagesEmptyNews=d},5135:function(e,t,s){e.exports=s.p+"_/62f6796a1a2d32ea8a4efd08f99d221e-news-dark.png"},5136:function(e,t,s){e.exports=s.p+"_/aace3bf3203ddb783f5a041028f1d64f-news.png"},5137:function(e,t,s){e.exports=s.p+"_/98612f9554018372b780e10262e2f8e9-news-dark@2x.png"},5138:function(e,t,s){e.exports=s.p+"_/c5f906d2d0f59c0b41920c0be90e713f-news@2x.png"},5139:function(e,t,s){"use strict";var a=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])})(t,s)};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesEmptyAttachments=void 0;var o=n(s(135)),i=n(s(344)),r=s(488),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){return o.default.createElement(r.MessagesEmptyTemplate,{headerContent:o.default.createElement(i.default,{loc:"react-messages/noMessagesHeaderAttachments"}),buttonProps:{url:"#inbox",children:o.default.createElement(i.default,{loc:"react-messages/noMessagesButtonGoToInbox"})}})},t}(o.default.PureComponent);t.MessagesEmptyAttachments=d},5140:function(e,t){ns.View.define("messages-empty-wrap",{events:{"ns-view-htmlinit":"onHtmlInit"},models:{messages:"onMessagesChange"},yateModule:"messages",methods:{patchLayout:function(){return this.getModel("messages").isEmptyList()?"layout-messages-empty-view":"layout-messages-empty"},onHtmlInit:function(){var e=this.getModel("messages");this._isEmptyList=e.isEmptyList()},onMessagesChange:function(){var e=this.getModel("messages").isEmptyList();e!==this._isEmptyList&&(this._isEmptyList=e,this.forceUpdate())}}})},5141:function(e,t){ns.View.define("messages-item-thread-toggle-mixin",{methods:{toggleThread:function(){var e=this.getModel("messages-item-state"),t=e.STATE;e.getState()===t.THREAD_SHORT?e.setState(t.CLOSE):e.setState(t.THREAD_SHORT)}}})},5142:function(e,t){ns.View.edefine("messages-item-thread-expand",{events:{click:"onClickThreadToggle"},models:{message:{"ns-model-changed":"keepValid","ns-model-changed.count":"forceUpdate","ns-model-changed.firstline":"forceUpdate","ns-model-remove":"keepValid"},"messages-item-state":{"ns-model-changed":"onChangeState"}},yateModule:"messages",methods:{onChangeState:function(){var e=this.getModel("messages-item-state");this.$node.toggleClass("is-folded",e.getState()===e.STATE.CLOSE)},onClickThreadToggle:function(e){e.preventDefault(),e.stopPropagation(),this.toggleThread()}}},"messages-item-thread-toggle-mixin",ns.View)},5143:function(e,t){ns.View.define("messages-item-thread-expand-mixin",{models:{message:ns.View.defineModelEvents({"ns-model-changed.count":"forceUpdate","ns-model-changed.firstline":"forceUpdate"}),"messages-item-state":ns.View.defineModelEvents({"ns-model-changed":"_messagesItemThreadExpandMixinChangeState"})},events:{"click .js-thread-toggle":"_messagesItemThreadExpandMixinOnClickThreadToggle"},yateModule:"messages",methods:{_messagesItemThreadExpandMixinOnClickThreadToggle:function(e){e.preventDefault(),e.stopPropagation(),this.toggleThread()},_messagesItemThreadExpandMixinChangeState:function(){var e=this.getModel("messages-item-state");this.$node.find(".js-thread-toggle").toggleClass("is-folded",e.getState()===e.STATE.CLOSE),ns.events.trigger("daria:vMessagesItemThreadExpandMixin:thread-expanded")}}},"messages-item-thread-toggle-mixin",ns.View)},5144:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,n=s(510),o=s.n(n),i=s(370),r=s(516),d=s(487),l=s(137),c=(s.n(l),s(462)),g=(s.n(c),s(738));function h(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var u=(h(a={},o.a.CLICK+!0,r.d),h(a,o.a.HOTKEY+!0,r.e),h(a,o.a.CLICK+!1,r.b),h(a,o.a.HOTKEY+!1,r.c),a);!function(){var e=["go-to-replied-message-mixin","messages-search-logger-mixin","messages-item-thread-toggle-mixin","messages-item-labels-mixin","messages-item-thread-expand-mixin","important-toggleable-mixin","priority-toggleable-mixin","messages-item-userpic-and-checkbox-mixin","read-toggleable-mixin","scenario-manager-mixin"];e.push("react-draggable-mixin","react-droppable-mixin");var t=ns.View.infoLite("attachments-widget").params;ns.View.defineNg("messages-item",{models:{message:ns.View.defineModelEvents({"ns-model-changed":"forceUpdate","ns-model-checked-toggle":"updateA11yLabel"}),"messages-checked":ns.View.defineModelEvents({"ns-model-changed":"keepValid","ns-model-reset-checked":"updateA11yLabel"}),"messages-item-state":ns.View.defineModelEvents({"ns-model-changed":"keepValid","ns-model-changed.state":"updateA11yLabel"}),settings:ns.View.defineModelEvents({"ns-model-changed.enable_firstline":"forceUpdate","ns-model-changed.show_priority_stuff":"forceUpdate","ns-model-changed.liza_minified":"forceUpdate"}),stickers:"forceUpdate"},params:{ids:null},events:{"ns-view-init":"onInit","ns-page-before-load@show":"onPageBeforeLoad","ns-page-after-load@show":"onPageAfterLoad","ns-page-error-load@show":"onPageErrorLoad",click:"onClick","click .js-show-attachments":"_showAttachments","click .js-message-snippet-importance":"_onImportantToggleableClick","daria:vMessagesItem:setFakeFocusIfOpened@show":"setFakeFocusIfOpened"},mixins:e,yateModule:"messages",methods:{REACT_DROPPABLE_ACCEPTS:["label"],timerID:null,delayBeforeOpen:500,onInit:function(){this._messageId=this.params.ids},onPageBeforeLoad:function(e,t,s){s!==ns.page.currentUrl&&(this.clearTimer(),this.toggleFakeFocusByParams(t[1].params),ns.Model.get("focus").setFocusAfterPageLoaded())},onPageAfterLoad:function(){ns.Model.get("focus").shouldSetFocusAfterPageLoaded()&&this.toggleFakeFocusByParams()},onPageErrorLoad:function(){ns.Model.get("focus").shouldSetFocusAfterPageLoaded()&&this.toggleFakeFocusByParams()},toggleFakeFocusByParams:function(e,t){e=e||ns.page.current.params;var s=this.isCurrentByParams(e),a=this.$node.hasClass("is-focused"),n=ns.Model.get("focus");t||s&&!a?n.hasFocus()?(n.saveViewAsLastFocused(this,n.indexColumns.MESSAGES),this.addFocus(),Daria.Focus.scrollIntoView(this.$node,n.indexColumns.MESSAGES)):n.setFocusByMid(this.params.ids,!0):!s&&a&&this.removeFocus()},setFakeFocusIfOpened:function(){var e=ns.page.current.params;this.isCurrentByParams(e)&&this.toggleFakeFocusByParams(e,!0)},_onToggleMark:function(){this.getSnippetNode().toggleClass("is-unread",this.getModel("message").isNew())},getSnippetNode:function(){return this.$node.find(".mail-MessageSnippet").eq(0)},onClick:function(e){return e.shiftKey?((new Daria.CBS).selectWithShift(this.params.ids),!1):!(!Daria.isLeftClickWithCtrl(e)&&!Daria.isMiddleButton(e))||(0!==$(e.target).closest(".js-skip-click-message-item").length||(Daria.is2pane()&&e.preventDefault(),ns.Model.get("focus").setFocusByMid(this.params.ids,!0),this.openMessage(),this.scenarioManager.finishScenarioIfActive(i.d,d.c),void(!Daria.is3pane()&&this._shouldOnlyToggleThread()||this._startMessageViewScenario(o.a.CLICK))))},_startMessageViewScenario:function(e){this.scenarioManager.finishScenarioIfActive(i.d,d.c);var t=this.getModel("message"),s=t.isThread()&&t.getThreadCount()>1,a=u[e+s];this.scenarioManager.startScenario(i.d,a),this._sendApdexMetricShowMessage()},_getOpenMessageInListSetting:function(){return ns.Model.get("settings").isSet("open-message-list")},_shouldOnlyToggleThread:function(){var e=this.getModel("message");return!this._getOpenMessageInListSetting()&&e.getThreadCount()>1},openMessage:function(){if(this.logClickMessageFromSearch("mail"),!Daria.is3pane()){var e=this.getModel("message"),t=this._getOpenMessageInListSetting(),s=Daria.Page.generateUrl.contentMessage(e.getData());if(t)this.getModel("messages-item-state").close();e.getThreadCount()>1&&Jane.c("Треды","открытие треда из списка писем"),this._shouldOnlyToggleThread()?this.toggleThread():(this._sendApdexMetricShowMessage(),ns.page.go(s)),this.logOpenMessage&&this.logOpenMessage()}},switchOpen:function(){if(Daria.is2pane())return this.openMessage(),void this._startMessageViewScenario(o.a.HOTKEY);if(ns.Model.get("focus").getPreventOpenOnFocus()&&this.focusOn(),this.getModel("message").getThreadCount()<=1)return this.openMessage(),void this._startMessageViewScenario(o.a.HOTKEY);var e=this.getModel("messages-item-state");e.isClosed()?e.setState(e.STATE.THREAD_SHORT):e.close()},_showAttachments:function(e){e.preventDefault(),e.stopPropagation();var s=t(this.params);ns.View.create("attachments-widget-popup",s).showAt(e.currentTarget)},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn(e);break;case"blur":this.focusOff();break;case"space":this.toggleCheck();break;case"enter":this.switchOpen()}},focusOn:function(e){var t=(e||{}).preventOpenOnFocus;this.addFocus(),ns.Model.get("focus").cancelSetFocusAfterPageLoaded(),t||this.startOpenMessage()},focusOff:function(){if(Daria.is3pane()){var e=ns.Model.get("focus");switch(e.getIndexCurrentColumn()){case e.indexColumns.LEFT:break;case e.indexColumns.MESSAGES:this.clearTimer(),this.removeFocus();break;case e.indexColumns.MESSAGE:this.clearTimer(),this.removeFocus(),ns.events.trigger("daria:vMessagesItem:setFakeFocusIfOpened");break;default:this.clearTimer(),this.removeFocus()}}else this.clearTimer(),this.removeFocus()},addFocus:function(){Object(g.b)(this.$node)},removeFocus:function(){Object(g.a)(this.$node)},getParentReferenceParams:function(){var e=ns.Model.get("message",{ids:this._messageId}).getThreadMessage();if(e&&ns.Model.get("messages-item-state",{ids:e.getThreadId()}).isClosed())return{params:{ids:e.getThreadId()}}},toggleCheck:function(){var e=this.getModel("message");this.getModel("messages-checked").toggleCheck(e)},isCurrentByParams:function(e){return e=e||ns.page.current.params,this.params.ids===e.thread_id||this.params.ids===e.ids},startOpenMessage:function(){var e=ns.page.current.params;Daria.is2pane()||ns.Model.get("folders").isFolder(e.current_folder,l.DraftTemplateLikeFoldersShort)||this.isCurrentByParams()||(this.clearTimer(),this.timerID=setTimeout(this.openMessage3pane.bind(this),this.delayBeforeOpen))},openMessage3pane:function(){var e=_.clone(ns.page.current.params);this.getModel("message").isThread()?(e.thread_id=this.params.ids,delete e.ids):(e.ids=this.params.ids,delete e.thread_id),this.isCurrentByParams()||(ns.page.go(ns.router.generateUrl("messages",e)),this._startMessageViewScenario(o.a.HOTKEY))},clearTimer:function(){clearTimeout(this.timerID),this.timerID=null},hasFocusedClass:function(){var e=ns.Model.get("focus");return e.isFocusedInColumn(e.indexColumns.MESSAGES,this)},reactDroppableDragLabel:function(e){var t=ns.Model.get("labels").getLabelById(e.lid).name;return i18n("%Drag_Пометить_письмо",t)},reactDroppableOnDrop:function(e){if("label"===e.type){var t=this.getModel("message"),s=ns.Model.get("messages-checked",{mid:this.params.ids});s.check(t,!0),Daria.MOPS.label(s,{lid:e.lid}),c.MetrikaService.instance().dragAndDrop.logDropLabelOnMessage()}},reactDroppableTarget:function(){return{type:"message",mid:this.params.ids}},reactCheckCurrent:function(e,t){var s=this.getModel("message"),a=this.getModel("messages-checked");e&&!a.isChecked(s)?(this._wasCheckedByDrag=!0,a.check(s,!0)):e||!this._wasCheckedByDrag||t||a.check(s,!1)},reactDraggableCanDrag:function(e){var t=$(e.target);return!t.is(".js-invalid-drag-target")&&(!!this.getModel("message").isDraggable()&&(0!==t.closest(".js-message").length&&0===t.closest(".js-cbt-item-target").length))},reactDraggableOnDragStart:function(){var e=this.getModel("messages-checked");this.reactCheckCurrent(!0);var t=e.getCount();return{dragSource:{type:"message",ids:e.getIds(),count:t},dragSourceLabel:function(){return i18n("%Drag_Куда_перенести_письма",t)}}},reactDraggableOnDragEnd:function(){this.reactCheckCurrent(!1,this.reactDraggableGetPreventDeselect())},reactDroppableOnDropEnter:function(){this.$node.addClass("g-drop-place_hover")},reactDroppableOnDropLeave:function(){this.$node.removeClass("g-drop-place_hover")},getReplyLaterDate:function(){var e=this.getModel("message").getReplyLaterDate();if(e){var t=new Date(Daria.passportNow()),s=e.getFullYear()===t.getFullYear();return Jane.Date.isSameDay(e,t)?Jane.Date.format("%Date_HM__colon",e):s?Jane.Date.format("%Date_df_in_HM",e):Jane.Date.format("%Date_dmy__dot",e)}return null},getA11yLabel:function(){var e=this.getModel("message"),t=this.getModel("messages-item-state"),s=e.getSender(),a=e.getThreadCount()>1,n=e.getFolderId(),o=this._getA11yFolderName(n,a);return[e.isCheckedInList()?i18n("%Selected"):void 0,a?t.isClosed()?i18n("%Collapsed"):i18n("%Expanded"):void 0,a?i18n("%N_писем",e.getThreadCount()):void 0,e.isNew()?i18n("%Journal_непрочитано"):void 0,e.hasAttachment()?i18n("%Messages_Title_Only_Atta").toLowerCase():void 0,e.hasUserLabel()?i18n("%a11yWithLabelsLabel"):void 0,e.isImportant()?i18n("%Labels_Toolbar_Important"):void 0,e.isPriority()&&Daria.isPriorityTabEnabled()?i18n("%Priority_Label"):void 0,s?s.name||s.email:void 0,e.get(".subject"),o,e.get(".date.view.message"),e.get(".firstline")].filter(Boolean).join(", ")},updateA11yLabel:function(){this.$node.attr("aria-label",this.getA11yLabel())},_getA11yFolderName:function(e,t){var s=ns.Model.get("folders"),a=s.getFolderById(e),n=ns.page.current.params.current_folder,o=s.isFolder(e,"template");if(!t&&!o&&n!==e&&a)return a.name},_sendApdexMetricShowMessage:function(){var e=ns.Model.isDefined("message-body")&&(ns.Model.isValid("message-body",{ids:this._messageId})||this._messageId.startsWith("t")&&ns.Model.isValid("message-body",{ids:this._messageId.substring(1)}));window.Apdex.delete(["Performance_showCachedMessage","Performance-showMessage"]),e?window.Apdex.start(["Performance_showCachedMessage"],!0):window.Apdex.start(["Performance-showMessage"],!0)}}})}()},5145:function(e,t){ns.View.define("messages-item-date",{yateModule:"messages",models:{message:{"ns-model-changed":"keepValid","ns-model-changed.date":"forceUpdate","ns-model-changed.fid":"forceUpdate","ns-model-changed.tabId":"forceUpdate","ns-model-changed.lid":"forceUpdate"},folders:{"ns-model-changed":!1,"daria:mFolders:rename":"forceUpdate"}}})},5146:function(e,t){ns.View.defineNg("messages-item-attachments",{yateModule:"messages"},"messages-item")},5147:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(349);s.n(a);function n(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,a)}return s}function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}ns.View.defineNg("messages-item-events",{models:{labels:!1,message:ns.View.defineModelEvents({"ns-model-changed":"forceUpdate"}),"messages-item-state":ns.View.defineModelEvents({"ns-model-changed":"forceUpdate"}),"message-widget-events":ns.View.defineModelEvents({"ns-model-changed":"forceUpdate"})},events:{"ns-view-show":"onWidgetEventsShow","click .js-widget-events-accept":"acceptEvent","click .js-widget-events-decline":"declineEvent","click .js-widget-events-edit":"editEvent","click .js-toggles-WidgetEventsPopup_more":"closeAllPopups","click .js-widget-events-user":"onWidgetEventsUserClick"},yateModule:"messages",ctor:function(){this.sendShowLog=_.once(this.sendLogs.bind(this,"show"))},methods:{_LOG_OPTIONS:{show:{metrik:"show"},accepted:{metrik:["click","bth-go"],actionLogButton:!0},declined:{metrik:["click","btn-reject"],actionLogButton:!0},"see-calendar-link":{metrik:["click","btn-see-calendar-link"],actionLogButton:!0},clickMore:{metrik:["click","more"],actionLogButton:!0},mail:{metrik:["click","mail"],actionLogButton:!0}},_NAME_POPUP_USER_LIST:"widget-event-dropdown-",onWidgetEventsShow:function(){this.nbPopup=nb.find(this._NAME_POPUP_USER_LIST+this.params.ids),this.sendShowLog()},changeEvent:function(e){Object(a.hasFeature)(a.Features.WEB_CALENDAR_HANDLE_REPLY_MODEL)?this._changeEventHandleReply(e):this._changeEventSaveEventByIcs(e)},_changeEventHandleReply:function(e){var t=this;nb.trigger("popup-close");var s=ns.Model.get("message-body",{ids:this.params.ids}),a={decision:e,hid:s.getCalendarICS(),stid:s.getSTID(),ids:this.params.ids},i=this.getModel("message-widget-events").getEventInfo(),r={decision:e,eventId:i&&i.eventId};ns.request(["do-handle-reply"],function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach(function(t){o(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({},a,{},r),{forced:!0}).then(function(e){return t._changeEventRequest(e)},this)},_changeEventSaveEventByIcs:function(e){nb.trigger("popup-close");var t=ns.Model.get("message-body",{ids:this.params.ids}),s={decision:e,hid:t.getCalendarICS(),stid:t.getSTID(),ids:this.params.ids};ns.request(["save-event-by-ics"],s,{forced:!0}).then(this._changeEventRequest,this)},_changeEventRequest:function(e){if("ok"===e[0].status){var t=e[0]&&e[0].getEventInfo();if(!t)return void(Object(a.hasFeature)(a.Features.WEB_CALENDAR_HANDLE_REPLY_MODEL)&&this.getModel("message-widget-events").refetchEventIcs());this.updateEventInfo(t);var s=this.getModel("message");s.isNew()&&s.toggleMark()}},updateEventInfo:function(e){this.getModel("message-widget-events").setEventInfo(e)},acceptEvent:function(e){e.preventDefault(),e.stopPropagation(),this.changeEvent("accepted"),this.sendLogs("accepted")},declineEvent:function(e){e.preventDefault(),e.stopPropagation(),this.changeEvent("declined"),this.sendLogs("declined")},editEvent:function(){this.sendLogs("see-calendar-link")},closeAllPopups:function(){this.nbPopup.isOpen()||this.sendLogs("clickMore"),nb.trigger("popup-close")},sendLogs:function(e){var t=this.getModel("message-widget-events"),s=this.getModel("message"),a=Boolean(t.get(".eventInfo")),n=Daria.Widgets.shouldShowTaksaCalendarWidget(s);"show"===e&&Daria.monitoring.stat.ics({mid:t.params.ids,show_v1:a,show_v2:n}),a&&(this.sendMetrik(e),this.sendActionLog(e))},sendMetrik:function(e){var t=this.getMetrikName(),s=this._LOG_OPTIONS[e].metrik;Jane.c(["Widgets","ICS",t].concat(s))},getMetrikName:function(){var e=this.getModel("message-widget-events");return e.get(".isOutdated")||!e.get(".isNotPast")?"ICS Outdated Inbox Widget":e.get(".eventInfo.isCancelled")?"ICS Cancel Inbox Widget":"event_update"===e.get(".eventInfo.calendarMailType")?"ICS Update Inbox Widget":"ICS Full Inbox Widget"},sendActionLog:function(e){var t=this.getModel("message-widget-events"),s="show"===e,a=s?"widget-show":"click-widget-btn",n=this._LOG_OPTIONS[e].actionLogButton,o={action:a,widget:"ics","widget-type":this.getActionType(),ids:{ids:[this.params.ids]}};s&&!t.get(".eventInfo.isCancelled")&&(o["widget-controls"]=this.getWidgetControlsList()),n&&(o.btn=e),Daria.actionLog(a,o)},getWidgetControlsList:function(){var e=this.getModel("message-widget-events"),t=e.get(".eventInfo.actions")||[],s=[];return-1!==t.indexOf("accept")&&s.push("btn-accept"),-1!==t.indexOf("decline")&&s.push("btn-decline"),e.get(".isNotOperate")||s.push("btn-see-calendar-link"),e.get(".isOutdated")||!e.get(".isNotPast")||e.get(".eventInfo.isCancelled")||s.push("btn-clickMore"),s},getActionType:function(){var e=this.getModel("message-widget-events");return e.get(".isOutdated")||!e.get(".isNotPast")?"ics-outdated":e.get(".eventInfo.isCancelled")?"ics-cancel":"event_update"===e.get(".eventInfo.calendarMailType")?"ics-update":"ics-full"},logOpenMessage:function(){this.sendLogs("mail")},onWidgetEventsUserClick:function(e){e.stopPropagation()}}},"messages-item")},5148:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(815),n=s(358),o=(s.n(n),s(359)),i=(s.n(o),s(353));function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],a=!0,n=!1,o=void 0;try{for(var i,r=e[Symbol.iterator]();!(a=(i=r.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(n)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function d(e,t,s,a,n,o,i){try{var r=e[o](i),d=r.value}catch(e){return void s(e)}r.done?t(d):Promise.resolve(d).then(a,n)}ns.View.defineNg("messages-item-subscriptions",{models:{"unsubscribe-widget-state":"forceUpdate",message:ns.View.defineModelEvents({"ns-model-changed":"forceUpdate"})},events:{"click .js-message-snippet-misc":"stopClick","click .js-widget-subscriptions-click":"unsubscribe"},yateModule:"messages",methods:{stopClick:function(e){e.preventDefault(),e.stopPropagation()},unsubscribe:function(){var e=function(e){return function(){var t=this,s=arguments;return new Promise(function(a,n){var o=e.apply(t,s);function i(e){d(o,a,n,i,r,"next",e)}function r(e){d(o,a,n,i,r,"throw",e)}i(void 0)})}}(regeneratorRuntime.mark(function e(){var t,s,d,l,c,g,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModel("message"),s=t.getSubscriptionData(),(d=this.getModel("unsubscribe-widget-state")).startLoading(this.params.ids),e.prev=4,e.next=7,ns.request("get-hidden-subscriptions/v1");case 7:return l=e.sent,c=r(l,1),g=c[0],h=g.hasSubscription(s.email,s.messageType),e.next=13,h?Object(a.a)([t]):Object(a.c)([t]);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),Object(n.showErrorMessage)(o.StatuslineName.UnsubscribeModalError,Object(i.default)("statusline/unknownError"));case 18:return e.prev=18,d.stopLoading(),e.finish(18);case 21:Jane.ToolbarMetric.messageControlsToolbar(t,"Unsubscribe one");case 22:case"end":return e.stop()}},e,this,[[4,15,18,21]])}));return function(){return e.apply(this,arguments)}}()}},"messages-item")},5149:function(e,t){ns.View.define("messages-item-inner",{params:{ids:null},yateModule:"messages",methods:{}})},5150:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(347);ns.ViewCollection.define("messages-item-thread",{params:function(e){return{thread_id:e.ids}},split:{byModel:"messages",intoViews:"messages-item-wrap"},models:{messages:{"ns-model-changed":"keepValid","ns-model-remove":"checkCountAndUpdate","ns-model-insert":"forceUpdate"},"messages-checked":{"ns-model-changed":!1,"daria:mMessagesChecked:load-more-messages":"loadMoreMessages"}},events:{"ns-view-show":"_onShow","ns-view-hide":"_onHide","daria:vMessagesItemThread:loadMoreMessages@show":"_loadMoreMessages"},yateModule:"messages",methods:{_onShow:function(){Object(a.getLizaUxFeedbackController)().onStart(function(){return ns.events.trigger("daria:messages-thread:show")}),ns.events.trigger("daria:mFocus:buildTree")},_onHide:function(){ns.events.trigger("daria:mFocus:buildTree")},loadMoreMessages:function(){var e=this.getModel("messages");e.canLoadMore()&&e.loadMore()},_loadMoreMessages:function(){if(this.__lockMessagesLoad)return!1;this.__lockMessagesLoad=!0;var e=this.getModel("messages").canLoadMore(),t=function(){this.update().always(function(){this.__lockMessagesLoad=!1},this)}.bind(this);e?this.getModel("messages").loadMore().then(t,function(){this.__lockMessagesLoad=!1},this):this.node.querySelector(".ns-view-container-desc").childNodes.length!==this.getModel("messages").models.length&&(this.invalidate(),t());return!1},isChecked:function(){return this.getModel("messages-checked").isChecked(this.getModel("message"))},checkCountAndUpdate:function(){this.isVisible()?1===this.getModel("messages").getCount()?ns.page.go(Daria.Page.generateUrl.closeMessage()):this.forceUpdate():this.forceUpdate()},getFocusableChildren:function(){var e=[];return this.forEachValidItem(function(t){e=e.concat(t.getFocusableChildren())}),e}}})},5151:function(e,t){ns.View.define("messages-item-thread-pager",{params:function(e){return{ids:e.ids,thread_id:e.ids}},models:{message:!1,messages:{"ns-model-changed":"updateIfVisible","ns-model-remove":"updateIfVisible","ns-model-insert":"updateIfVisible"}},events:{"ns-view-htmlinit":"onHtmlInit","click .js-messages-load-more":"loadMoreMessages"},yateModule:"messages",methods:{_canLoadMore:!1,onHtmlInit:function(){this._canLoadMore=this.canLoadMore()},canLoadMore:function(){return this.getModel("messages").canLoadMore()},loadMoreMessages:function(){ns.events.trigger("daria:vMessagesItemThread:loadMoreMessages")},updateIfVisible:function(){var e=this.canLoadMore();e!==this._canLoadMore&&(this._canLoadMore=e,this.forceUpdate())}}})},5152:function(e,t){ns.View.define("messages-item-widget-mixin",{methods:{updateWidget:function(){this.invalidate(),this.update(null,{execFlag:ns.U.EXEC.PARALLEL})},getWidgetMetrikaString:function(e){return e=yr.nodeset2data(e||{})||{},this._getWidgetMetrika(this.getModel("message"),e).join(":")},countWidgetMetrika:Daria.memoizeById({},function(){return this.__uniqueId},function(){this.__getWidgetMetrika.apply(this,arguments)}),__getWidgetMetrika:function(e){e=yr.nodeset2data(e||{})||{};var t=this._getWidgetMetrika(this.getModel("message"),e);e.isClick?Jane.c(t):Jane.Metrika.groupedCount(t)},_getWidgetMetrika:function(e,t){t=t||{};var s=e.getMessagesListWidget().info,a=s.type,n=["Виджеты",s.valid?a:"Протухший ".concat(a)];return s.subtype&&n.push(s.subtype),s.id&&n.push(s.id),t.label&&-1!==["pkpass","avia","hotels","calendar"].indexOf(a)&&n.push(t.label),t.isClick?n.push("клик"):n.push("показ","+"),n}}})},5153:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(137);s.n(a);ns.View.defineNg("messages-item-widget",{models:{message:ns.View.defineModelEvents({"ns-model-changed.field":"forceUpdate","ns-model-changed.firstline":"forceUpdate","ns-model-changed.flags":"forceUpdate","ns-model-changed.new":"_onToggleMark","ns-model-changed.subject":"forceUpdate"}),"messages-checked":!1,"messages-item-state":!1,settings:!1},events:{click:"onClick","click .js-print-widget-button":"onClickPrint","click .js-delete-widget-button":"onClickDelete","click .js-compose-widget-button":"onClickCompose","daria:vThemesSelector:new-schema@show":"updateWidget"},yateModule:"messages",methods:{onClickPrint:function(e){this.onClickControl(e),Daria.Printer.printMessage(this.params.ids)},onClickDelete:function(e){this.onClickControl(e),Daria.MOPS.remove(this.getModel("message").getMessagesCheckedModel())},onClickCompose:function(e){this.onClickControl(e);var t=(_.find((this.getModel("message").getMessagesListWidget()||{}).controls,{type:"compose"})||{}).attributes||{},s=t.mid,a=Boolean(t.fix_rcpt);if(s){var n={ids:s,oper:"template"};ns.request("message",{ids:s}).then(function(){this.createCustomTemplate(n,a)},this).fail(function(){Jane.ErrorLog.send({type:"widget-bounce-compose-no-message",mid:s}),this.openMessage()},this)}},createCustomTemplate:function(e,t){ns.request("compose-message",e).then(function(s){var a=s[0];this._createCustomTemplate(a,e,t)},this).fail(function(){Jane.ErrorLog.send({type:"widget-bounce-compose-no-compose-message",mid:e.ids})})},_createCustomTemplate:function(e,t,s){return ns.page.go(ns.router.generateUrl("compose2",t)).then(function(){var n,o=e.mMessage,i=e.mMessageBody,r=e.mComposeState,d=o.getSubject(),l=e.getMessageType();n="plain"===i.getSubtype()?Daria.Html2Text.html2text(i.getDraftBody(l)):i.getDraftBody(l);var c=i.getAddressField("to"),g=i.getAddressField("cc"),h=i.getAddressField("bcc"),u=i.getAddressField("phone"),m=_.clone(o.get(".lid")),f=o.getDelayedTime();if(!f){var p=ns.Model.get("labels").getDelayedMessageLabel();p&&(m=_.pull(m,p.lid))}var b=[{jpath:".overwrite",value:t.ids},{jpath:".ign_overwrite",value:"yes"},{jpath:".save_symbol",value:a.WellKnownFolderSymbol.DRAFT},{jpath:".ttype",value:l},{jpath:".lids",value:m},{jpath:".from_name",value:o.getFromName()},{jpath:".from_mailbox",value:o.getFromEmail()},{jpath:".inreplyto",value:i.getInReplyTo()},{jpath:".references",value:i.getReferences()},{jpath:".current_folder",value:o.getFolderId()},{jpath:".send_time",value:f}];d&&b.push({jpath:".subj",value:d}),s||(c&&b.push({jpath:".to",value:c},{jpath:".initial_to",value:c}),g&&(b.push({jpath:".cc",value:g},{jpath:".initial_cc",value:g}),r.setIfChanged(".isCcVisible",!0)),h&&(b.push({jpath:".bcc",value:h}),r.setIfChanged(".isBccVisible",!0))),u&&(b.push({jpath:".phone",value:u}),r.setIfChanged(".isPhoneVisible",!0)),n&&b.push({jpath:".send",value:n}),_.forEach(b,function(t){e.set(t.jpath,t.value)}),s?r.setFocusField("to"):r.setFocusField("send")})},onClickControl:function(e){e.preventDefault()},getWidgetImgLinkIcon:function(e){var t=/[A-Za-z0-9_-]*\.svg/g.exec(e);return t&&t[0]&&-1!==t[0].search(/\.svg$/)?t[0].substring(0,t[0].search(/\.svg$/)):e}}},"messages-item-widget-mixin","messages-item")},5154:function(e,t){ns.View.defineNg("messages-item-ticket",{yateModule:"messages"},"messages-item-widget")},5155:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(370),n=s(487);ns.View.edefine("messages-item-wrap",{events:{"ns-view-show":"onShow","click .js-messagesItem-toggle-opened":"onClickCloseMessage","click .js-mail-Message-Body_close_letter":"onClickCloseMessage"},models:{message:{"ns-model-changed":"keepValid","ns-model-changed.count":"onMessageCountChanged","ns-model-changed.lid":"onMessageLidChanged","ns-model-checked-toggle":"onToggleCheck"},"messages-item-state":{"ns-model-changed":"keepValid","ns-model-changed.state":"onItemStateChanged"},"messages-checked":{"ns-model-changed":!1,"ns-model-reset-checked":"onToggleCheck"}},yateModule:"messages","params+":{current_folder:null,current_label:null,search:null,scope:null,extra_cond:null,tabId:null},methods:{REG_EXP_FOR_TREE_WALKER:/^messages-item(-attachments|-events|-widget|-ticket|-subscriptions)?$/,patchLayout:function(){var e=this.getModel("message"),t=Daria.Widgets.getWidgetName(e),s={};if(Daria.is3pane())return s.threadInner=this.isThreadListOpen(),Daria.messages.createMessagesItemLayout(s);var a=ns.page.current.params;return this.params.ids===a.thread_id?(ns.events.trigger("daria:vMessagesItemWrap:message-opened"),Daria.messages.createMessagesItemLayout({threadFull:!0})):this.params.ids===a.ids?(ns.events.trigger("daria:vMessagesItemWrap:message-opened"),"layout-message-opened"):t&&!e.isThread()?Daria.messages.createMessagesItemLayout({widget:t}):Daria.Widgets.shouldShowAttachments(e,ns.page.current.params)?Daria.messages.createMessagesItemLayout({threadInner:this.isThreadListOpen(),widget:"attachments"}):Daria.Widgets.shouldShowSubscriptions(e)?Daria.messages.createMessagesItemLayout({threadInner:this.isThreadListOpen(),widget:"subscriptions"}):e.isThread()?Daria.messages.createMessagesItemLayout({threadInner:this.isThreadListOpen()}):Daria.messages.createMessagesItemLayout({})},onShow:function(){this.logWidgets()},logWidgets:Daria.memoizeById({},function(){return this.__uniqueId},function(){this._logWidgets()}),_logWidgets:function(){var e=this.getModel("message"),t=e.getMessagesListWidget();t&&this.writeLogForWidgets("exists",{mid:this.params.ids,widgetType:t.info.type,widgetSubType:t.info.subtype,origin:"list-widget"}),"widget"===Daria.Widgets.getWidgetName(e)&&t&&this.writeLogForWidgets("view",{mid:this.params.ids,widgetType:t.info.type,widgetSubType:t.info.subtype,origin:"list-widget"})},onMessageCountChanged:function(){this.getModel("messages-checked").trigger("daria:mMessagesChecked:load-more-messages"),this._forceCloseThreadOnFewMessages()},_forceCloseThreadOnFewMessages:function(){var e=this.getModel("message"),t=this.getModel("messages-item-state"),s=t.STATE.CLOSE;e.get(".count")<=1&&t.getState()!==s&&t.setState(s)},isThreadListOpen:function(){var e=this.getModel("messages-item-state"),t=e.STATE;return e.getState()===t.THREAD_SHORT},isSearchTopResult:function(){return this.getModel("messages-checked").isSearchTopResultByMid(this.getModel("message").get(".mid"))},onToggleCheck:function(){var e=this.getModel("message"),t=this.getModel("messages-checked").isChecked(e);this.$node.toggleClass("is-checked",t)},onMessageLidChanged:function(){var e=this.getModel("message"),t=e.isPinned()&&Daria.messages.checkUsePinsByParams(this.params);this.$node.toggleClass("is-pinned",t),this.$node.toggleClass("is-reply-later",e.isReplyLater())},onItemStateChanged:function(){this.lazyUpdate(),this.getModel("messages-item-state").isClosed()&&this.uncheckMessagesInThread()},onClickCloseMessage:function(e){if(!this.isSubjectSelected()){var t=$(e.target);if(!t.closest(".js-skip-click-messages-item-wrap").length&&!t.closest(".js-skip-click-message-item").length){e.preventDefault(),e.stopPropagation();var s=this.getModel("message").getThreadCount();t.closest(".js-message-close-button").length?(Jane.c("Закрытие письма кликом в шапку в 2pane","Закрытие по крестику"),s>1&&Jane.c("Треды","Закрытие треда","Закрытие по крестику")):(Jane.c("Закрытие письма кликом в шапку в 2pane","Закрытие по шапке"),s>1&&Jane.c("Треды","Закрытие треда","Закрытие по шапке")),ns.page.go(Daria.Page.generateUrl.closeMessage()),ns.events.trigger("daria:vMessagesItemWrap:message-closed"),this.uncheckMessagesInThread(),this._finishMessageViewScenario()}}},_finishMessageViewScenario:function(){this.scenarioManager.finishScenarioIfActive(a.d,n.d)},uncheckMessagesInThread:function(){var e=this.getModel("messages-checked"),t=this.getModel("message");e.isChecked(t)||t.uncheckThreadMessages(e)},isSubjectSelected:function(){var e=this.$node.find(".js-toolbar-subject")[0];if(!e)return!1;var t=window.getSelection();return!(!t||t.isCollapsed)&&("function"==typeof t.containsNode&&t.containsNode(e,!0))},getFocusableChildren:function(){var e=this.getModel("messages-item-state");switch(e.getState()){case e.STATE.THREAD_SHORT:var t=Daria.nsTreeWalker.findView(this,["messages-item-box",this.REG_EXP_FOR_TREE_WALKER]),s=Daria.nsTreeWalker.findView(this,["messages-item-box","messages-item-inner","messages-item-thread"]);return s?[t].concat(s.getFocusableChildren()):[t];default:var a=Daria.nsTreeWalker.findView(this,["messages-item-box"]),n=Daria.nsTreeWalker.findView(a,[this.REG_EXP_FOR_TREE_WALKER]);if(n)return[n];var o=Daria.nsTreeWalker.findView(a,["message-thread"]);if(o)return o.getFocusableChildren();var i=Daria.nsTreeWalker.findView(a,["message-thread-react"]);if(i)return i.getFocusableChildren();var r=Daria.nsTreeWalker.findView(a,["message-react"]);if(r)return[r]}}}},"journal-log-mixin","scenario-manager-mixin",ns.View)},5156:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(137),n=(s.n(a),s(347));ns.View.define("messages-notification",{events:{"ns-view-htmlinit":"_onHtmlInit","click .js-create-template":"onCreateTemplateClick"},models:{folders:"doForceUpdate"},"params+":_.clone(ns.Model.infoLite("messages").params),yateModule:"messages",methods:{_toUpdate:null,getPddRestrictNotificationsModel:n.getPddRestrictNotificationsModel,_onHtmlInit:function(){var e=this.$node.find(".js-infoline A");e.length&&e.attr("href",ns.router.generateUrl("messages",{search:"search",request:e.text(),force:1}))},onCreateTemplateClick:function(){this.getPddRestrictNotificationsModel().showPopup()||(ns.Model.get("compose-predefined-data").setData({save_symbol:a.WellKnownFolderSymbol.TEMPLATE}),Daria.composeGo(Daria.isReactiveCompose()?{save_symbol:a.WellKnownFolderSymbol.TEMPLATE}:void 0))},toUpdate:function(){if(null===this._toUpdate)if(this.params.current_folder){var e=ns.Model.get("folders");this._toUpdate=e.isFolder(this.params.current_folder,a.SpecialBarFolders)}else this._toUpdate=!1;return this._toUpdate},doForceUpdate:function(){this.toUpdate()&&this.forceUpdate()}}})},5157:function(e,t){function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var s=[],a=!0,n=!1,o=void 0;try{for(var i,r=e[Symbol.iterator]();!(a=(i=r.next()).done)&&(s.push(i.value),!t||s.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(n)throw o}}return s}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}!function(){var e=Daria.IS_CORP?["messages","message-type-labels"]:["collectors","messages","message-type-labels"];ns.View.define("messages-notification-search",{models:e.concat("settings"),events:{"ns-view-show":"onShow","ns-view-hide":"onHide","click .js-search-reset-folder-filter":"onResetFolderFilterClick","click .js-search-request":"onSearchRequestClick","click .js-search-feedback-close":"onFeedbackClose","click .js-feedback-link":"onFeedbackLinkClick","ns-page-before-load@show":"onSearchPageClose"},yateModule:"messages",ctor:function(){this._resetFeedbackFlags()},methods:{onShow:function(){this._cancelAdvancedSubscription=Daria.React.reactOnAdvancedChange("Daria.vMessagesNotificationSearch:searchQuerySubscription",this.invalidate.bind(this)),this.shouldShowFeedback()&&this.markFeedbackShow(),this.setViewShowCount()},onHide:function(){this._cancelAdvancedSubscription()},onSearchPageClose:function(e,t){var a=s(t,2),n=a[0],o=a[1],i=n.page,r=n.params,d=o.page,l=o.params,c=i===d,g=r.search===l.search&&r.request===l.request;c&&g||this._resetFeedbackFlags()},getViewShowCount:function(){var e=Number(ns.Model.get("settings").getSetting("feedback_search_count"))||0;return this._hasViewShown?e:e%10+1},setViewShowCount:function(){this._hasViewShown||(ns.Model.get("settings").setSettings({feedback_search_count:this.getViewShowCount()}),this._hasViewShown=!0)},canShow:function(){return this.getModel("messages").getCount()>0||"rpopinfo"===this.params.scope},shouldShowFeedback:function(){if(null===this._shouldShowFeedback){var e=ns.Model.get("settings"),t=Number(e.getSetting("feedback_search_close_count"))||0,s=this.getViewShowCount(),a=Number(e.getSetting("feedback_search_show_date"))||0,n=Daria.now()-a>=Jane.Date.DAY,o=s%10==0;this._shouldShowFeedback=this.canShow()&&Daria.hasExperiment("85773")&&"ru"===Daria.Config.locale&&t<3&&n&&o}return this._shouldShowFeedback},onResetFolderFilterClick:function(){Daria.React.setSearchTrigger(Daria.React.SEARCH_TRIGGER.NOTE_FOLDER_RESET),Daria.React.startSearch(this.params.request,{},!0)},onSearchRequestClick:function(e){var t=$(e.currentTarget).data("request"),s={request:t,force:!0};ns.events.trigger("daria:search:autocomplete-search-started",s),Daria.React.setSearchTrigger(Daria.React.SEARCH_TRIGGER.NOTE_REQUEST_CLICK),Daria.React.startSearch(t,{extraSearchParams:{force:!0}},!0)},onFeedbackClose:function(){var e=ns.Model.get("settings"),t=Number(e.getSetting("feedback_search_close_count"))||0;e.setSettings({feedback_search_close_count:t+1}),this.sendMetric("Click","Close"),this.$node.find(".js-search-feedback").remove(),this._shouldShowFeedback=!1},onFeedbackLinkClick:function(){this.sendMetric("Click","Link")},markFeedbackShow:function(){!0!==this._hasFeedbackShown&&(this.sendMetric("Show"),ns.Model.get("settings").setSettings({feedback_search_show_date:Daria.now()}),this._hasFeedbackShown=!0)},_resetFeedbackFlags:function(){this._shouldShowFeedback=null,this._hasFeedbackShown=!1,this._hasViewShown=!1},wasSearchRequestSimplified:function(){return Daria.React.wasSearchRequestSimplified()},getSearchParams:function(){return Daria.React.getSearchParams()},sendMetric:function(){for(var e,t=arguments.length,s=new Array(t),a=0;a<t;a++)s[a]=arguments[a];(e=Jane).c.apply(e,["Search","Rate the search"].concat(s))}}})}()},5158:function(e,t){ns.View.define("messages-pager",{models:{messages:!0},events:{"folder.cleared@show":"onUpdate","daria:vMessagesPager:restruct":"onUpdate"},yateModule:"messages",methods:{onUpdate:function(){this.invalidate(),this.forceUpdate()}}})},5159:function(e,t){ns.View.define("messages-pager-date",{models:{"messages-pager":!1},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-show":"onshow","ns-view-htmldestroy":"onhtmldestroy"},yateModule:"messages",ctor:function(){this.pagerInitDebounce=_.debounce(this.pagerInit.bind(this),0)},methods:{patchTree:function(){var e=this.super_.patchTree.call(this),t=this.getModel("messages-pager").getCountMonth();return e.hasSlider=Boolean(t>5&&!this.params.pager_top||t>13&&this.params.pager_top),e},onshow:function(){this.pagerPromise.done(this.pagerUpdateScroll,this)},onhtmlinit:function(){this.pagerPromise=new vow.Promise(this.pagerInitDebounce)},onhtmldestroy:function(){this.pagerInitDebounce.cancel(),this.pagerPromise&&(this.pagerPromise.done(this.pagerUnbindEvents),delete this.pagerPromise)},pagerUpdateScroll:function(e){e.updateScroll(this.params)},pagerUnbindEvents:function(e){e.unbindEvents()},pagerInit:function(e,t){this.node?e(new Daria.MessagesPager(this.node)):t()}}})},516:function(e,t,s){"use strict";s.d(t,"b",function(){return a}),s.d(t,"c",function(){return n}),s.d(t,"d",function(){return o}),s.d(t,"e",function(){return i}),s.d(t,"k",function(){return r}),s.d(t,"l",function(){return d}),s.d(t,"h",function(){return l}),s.d(t,"i",function(){return c}),s.d(t,"f",function(){return g}),s.d(t,"g",function(){return h}),s.d(t,"n",function(){return u}),s.d(t,"m",function(){return m}),s.d(t,"j",function(){return f}),s.d(t,"a",function(){return p});var a="messages-list-message-click",n="messages-list-message-hotkey",o="messages-list-thread-click",i="messages-list-thread-hotkey",r="thread-message-click",d="thread-message-hotkey",l="message-prev-click",c="message-prev-hotkey",g="message-next-click",h="message-next-hotkey",u="thread-prev-click",m="thread-next-click",f="message-right-column-message-click",p="direct-url"},5160:function(e,t){ns.View.define("messages-pager-load-more",{events:{"ns-view-htmlinit":"onHtmlinit","ns-view-show":"onShow","click .js-message-load-more":"_onClickMessageLoadMore","daria:vMessages:messages-load-start@show":"_onMessagesLoadStart","daria:vMessages:messages-load-stop@show":"_onMessagesLoadStop"},models:{messages:{"ns-model-changed":"onMessagesChanged","ns-model-insert":"onMessagesChanged","ns-model-remove":"onMessagesChanged"}},yateModule:"messages",methods:{_canLoadMore:!1,onHtmlinit:function(){this._canLoadMore=this.canLoadMore()},onShow:function(){var e=this.getModel("messages");e.canLoadMore()&&0===e.getCount()&&(Daria.invalidateMailHandlers(!1,"loadMore method if mops operation async"),this.getModel("messages").loadMore())},canLoadMore:function(){return this.getModel("messages").canLoadMore()},_onMessagesLoadStart:function(){this.$node.addClass("is-loading")},_onMessagesLoadStop:function(){this.$node.removeClass("is-loading")},_onClickMessageLoadMore:function(){return this.loadMore(),Daria.is2pane()&&Jane.c("Футер в 2-пейн","Еще","клик"),!1},onMessagesChanged:function(){this.canLoadMore()!==this._canLoadMore&&this.forceUpdate()},loadMore:function(){ns.events.trigger("daria:vMessagesPager:messages-load")}}})},5161:function(e,t){ns.View.define("messages-pager-nav",{events:{"ns-view-htmlinit":"onHtmlinit"},models:{messages:{"ns-model-changed":"onMessagesChanged","ns-model-insert":"onMessagesChanged","ns-model-remove":"onMessagesChanged"},"messages-pager":!0},yateModule:"messages",methods:{_toShow:!1,patchTree:function(){var e=this.super_.patchTree.call(this);if(e.isShowPagerNav=this.toShow(),e.isShowPagerNav){var t,s,a,n=this.params.datePager.match(/^((\d{2})\.)?(\d{4})$/),o=n[3],i=n[2];if(i){var r=Daria.MessagesPager.decDate(o,i),d=Daria.MessagesPager.incDate(o,i);t=r[1]+r[0],s=d[1]+d[0],a=i+o}else t=parseInt(o,10)-1,s=parseInt(o,10)+1,a=o;e.navigator={currentDateId:a,prevDateId:t,nextDateId:s}}return e},onHtmlinit:function(){this._toShow=this.toShow()},onMessagesChanged:function(){this.toShow()!==this._toShow&&this.forceUpdate()},toShow:function(){var e=this.getModel("messages"),t=e.isEmptyList(),s=e.canLoadMore();return Boolean(!s&&!t&&this.params.datePager)}}})},5162:function(e,t){ns.View.define("messages-search-session",{events:{"ns-view-show":"onShow","ns-view-hide":"onHide"},yateModule:"messages",methods:{onShow:function(){Daria.React.getSearchSessionId()},onHide:function(){Daria.React.dropSearchSession()}}})},5163:function(e,t){ns.View.define("messages-list",{yateModule:"messages"})},5164:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(137);s.n(a);!function(){var e=$.extend({},ns.Model.infoLite("messages").params);ns.View.define("messages-wrap",{"params+":e,paramsRewrite:function(e){var t=ns.page.current.params;return!Daria.Page.isParamsForSingleThread(t)&&"thread_id"in e&&delete e.thread_id,e},events:{"ns-view-show":"onShow","ns-view-touch":"repaintWaitforreply","daria:vScrollerMessages:scroll":"_messagesLoad"},models:{"scroller-messages":!1},yateModule:"messages",methods:{LOAD_NEXT_PAGE_PADDING:300,onShow:function(){this.getModel("scroller-messages").init()},_messagesLoad:function(){Daria.is2pane()&&!Daria.isFullThreadPage()||!this._canLoadMessagesOnScroll()||ns.events.trigger("daria:vMessagesWrap:messages-scroll-load")},_canLoadMessagesOnScroll:function(){var e=this.getModel("scroller-messages");return Daria.is2pane()?this.$node.rect().bottom<=e.getHeight()+this.LOAD_NEXT_PAGE_PADDING:e.getScrollBottom()<this.LOAD_NEXT_PAGE_PADDING},repaintWaitforreply:function(){var e=this.params,t=ns.Model.get("labels").getWaitingForReplyLabel(),s=jpath(t,".count")[0],n=jpath(t,".lid")[0],o=ns.Model.get("folders").isFolder(e.current_folder,[a.WellKnownFolderSymbol.SENT]);if(s&&o&&this.waitForReplyCountLast!==s){var i=Jane.tt("mail:js-letters-without-answer",{count:s,lid:n}),r=$(".js-intruder-without-answer",this.node);r.length?r.replaceWith(i):$(".js-toolbar-hr",this.node).after(i),this.waitForReplyCountLast=s}else s||($(".js-intruder-without-answer",this.node).remove(),this.waitForReplyCountLast=0)}}})}()},5165:function(e,t){ns.View.define("messages-headers-mixin",{methods:{__sortViewItems:function(){this._destroyHeaders(),this.super_.__sortViewItems.apply(this,arguments),this._initHeaders()},_onHtmlDestroy:function(){this._destroyHeaders()},_redrawHeaderTopResults:function(){this.$headerTopResults&&this.$headerTopResults.off().html(Jane.tt("messages:vMessages-header-top-results"))},_getHeaderOtherResultsRenderData:function(){var e=this.getModel("messages"),t=e.get(".details.total-found")||0,s=e.get(".details.top-relevant")||0,a=t-s;return a>0?e.isSearchNotFilter()?{headerText:s>0?i18n("%Search_OtherResults"):i18n("%Search_AllResults"),messagesCount:a}:{messagesCount:a}:null},_redrawHeaderOtherResults:function(){if(this.$headerOtherResults){var e=this._getHeaderOtherResultsRenderData(),t=e?Jane.tt("messages:vMessages-header-other-results",e):"";this.$headerOtherResults.off().html(t)}},_redrawA11yTitleInSearchResult:function(){if(this.$headerHiddenTitle){var e=this._getHeaderOtherResultsRenderData(),t=e?Jane.tt("messages:vMessages-a11y-title-search-result",e):"";this.$headerHiddenTitle.off().html(t)}},_initHeaders:function(){this.isSearchResults()&&(this.$headerTopResults=this.$headerTopResults||$("<div/>"),this.$headerOtherResults=this.$headerOtherResults||$("<div/>"),this.$headerHiddenTitle=this.$headerHiddenTitle||$("<div/>"),this._updateHeaders())},_destroyHeaders:function(){this.$headerTopResults&&(this.$headerTopResults.off().remove(),this.$headerTopResults=null),this.$headerOtherResults&&(this.$headerOtherResults.off().remove(),this.$headerOtherResults=null),this.$headerHiddenTitle&&(this.$headerHiddenTitle.off().remove(),this.$headerHiddenTitle=null)},_updateHeaders:function(){this._positionHeaderBefore(this.$headerTopResults,".js-is-search-top-result:first"),this._positionHeaderBefore(this.$headerOtherResults,".js-messages-item:first"),this._positionHeaderBefore(this.$headerHiddenTitle),this._redrawHeaderTopResults(),this._redrawHeaderOtherResults(),this._redrawA11yTitleInSearchResult()},_positionHeaderBefore:function(e,t){if(e){var s=t?this.$node.find(".js-messages-list").find(t):this.$node.find(".js-messages-list");s.length?e.next()[0]!==s[0]&&e.insertBefore(s):e.off().remove()}}}})},5166:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(88),n=s.n(a),o=s(370),i=s(5167),r=s(1076),d=s(1075),l=s(137),c=(s.n(l),s(815)),g=s(817),h=(s.n(g),s(347)),u=s(349);s.n(u);function m(e){return function(e){if(Array.isArray(e)){for(var t=0,s=new Array(e.length);t<e.length;t++)s[t]=e[t];return s}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}ns.ViewCollection.edefine("messages",{models:{settings:{"ns-model-changed":"keepValid","ns-model-changed.liza_minified":"onToggleCompactMode","ns-model-changed.show_checkbox_inside_userpic":"invalidate"},messages:{"ns-model-changed":"keepValid","ns-model-insert":"onInsertMessages","ns-model-remove":"onRemoveMessages"},"messages-checked":{"run-action":"_runAction","ns-model-destroyed":!1,"ns-model-changed":!1},"scroller-messages":!1},split:{byModel:"messages",intoViews:function(){return"messages-item-wrap"}},paramsRewrite:function(e){return Daria.is3pane()&&delete e.thread_id,e},events:{"ns-view-init":"oninit","ns-view-htmlinit":"_onHtmlInit","ns-view-hide":"_onHide","ns-view-show":"_onShow","ns-view-touch":"_onTouch","ns-view-htmldestroy":"_onHtmlDestroy","ns-page-after-load@init":"invalidateUnreadMessages","ns-page-after-load@show":"scrollToMessageDebounce","daria:vMessages:invalidate@init":"invalidate","daria:vMessages:recalculate@show":"_recalculateMessages","daria:vMessages:deselect@show":"deselect","daria:vMessages:closeWithShortcut@show":"onCloseWithShortcut","daria:vMessages:selectAll@show":"selectAll","daria:vToolbarButton:label@show":"_onLabelToolbarButton","daria:vToolbarButton:unlabel@show":"_onUnlabelToolbarButton","daria:vToolbarButton:move@show":"_onMoveToolbarButton","daria:vToolbarButton:archive@show":"_onArchiveToolbarButton","daria:vToolbarButton:infolder@show":"_onInfolderToolbarButton","daria:vToolbarButton:tospam@show":"_onTospamToolbarButton","daria:vToolbarButton:notspam@show":"_onNotspamToolbarButton","daria:vToolbarButton:sendon@show":"_onSendonToolbarButton","daria:vToolbarButton:reply-tmpl@show":"_onReplyTmplToolbarButton","daria:vToolbarButton:deselect@show":"deselect","daria:vToolbarButton:select-all@show":"selectAll","daria:vMessagesWrap:messages-scroll-load@show":"_onMessagesScrollLoad","daria:vMessagesPager:messages-load@show":"_onMessagesLoad","dragndrop.drop@show":"_onDrop","resize@show window":"_onResizeWindow","layout-ratio-changed":"fillMessagesList","daria:folder-remove-done@show":"_onFolderRemove","daria:label-remove-done@show":"_onLabelRemove","daria:MOPS:action-complete@show":"_onActionComplete"},ctor:function(){this._onMessagesScrollLoad=_.debounce(this._onMessagesLoad.bind(this),50),this.scrollToMessageDebounce=_.debounce(this.scrollToMessage.bind(this),10)},yateModule:"messages",methods:{HEIGHT_MESSAGE_SNIPPET:39,_openMessageState:null,_itemsListChanged:!1,OPEN_MESSAGE_OFFSET_TOP:8,_recalculateMessages:function(){this.isUnreadList()&&ns.forcedRequest([this.getModel("messages")])},onInsertMessages:function(e,t){var s=this.getMessagesCheckedInstance();(s.isFolderOrTabSelected()||s.isListSelected())&&t.forEach(function(e){s.check(e,!0)}),this.forceUpdate(),this._itemsListWillUpdate()},onRemoveMessages:function(){this.forceUpdate(),this._itemsListWillUpdate()},_onActionComplete:function(e,t){this.loadMoreMessagesIfNeed(),this._processRedirect(t)},_processRedirect:function(e){var t=this;if(!this._isActionEligibleForRedirect(e.action))return!1;if(!this._isMessagesListAffectedByAction(e))return!1;var s=_.get(e,".whereToGo.where");s||(s=Daria.messages.whereToGoAfterMove(e.action,this.getMessagesCheckedInstance(),e).where);var a=_.get(e,".whereToGo.expandMessage");return _.delay(function(){ns.page.go(s).then(function(){a&&t._expandMessage(a)})},60),!0},_isActionEligibleForRedirect:function(e){return!!_.contains([].concat(m(Daria.MOPS.MOVE_ACTIONS),["delete"]),e)},_isMessagesListAffectedByAction:function(e){var t=ns.page.current.params.ids||ns.page.current.params.thread_id;return this._findAffectedIds(e.ids).some(function(e){return t===e})},_findAffectedIds:function(e){if(!e)return[];var t=e.ids&&e.ids.length?e.ids:[],s=_.map(t,function(e){var t=ns.Model.get("message",{ids:e});return t&&t.getThreadId()||e}),a=e.tids&&e.tids.length?e.tids:[];return _.uniq([].concat(m(t),m(s),m(a)))},_expandMessage:function(e){var t=ns.Model.get("state-message-thread-item",{ids:e}),s=ns.Model.get("state-message-thread-list",{thread_id:ns.page.current.params.thread_id}).getHiddenMessages();-1!==_.findIndex(s,function(e){return e.getModel("state-message-thread-item")===t})&&ns.events.trigger("daria:vMessageThreadList:showMore"),t.setOpen(!0)},loadMoreMessagesIfNeed:function(){var e=this.getModel("messages"),t=e.models.length,s=this.getModel("settings").getSetting("messages_per_page");e.canLoadMore()&&t<Math.round(s/2)&&this.getModel("messages").loadMore()},onCloseWithShortcut:function(){var e=this.getOpenMessageState();if(e){var t=ns.Model.get("message",{ids:e});t&&t.getThreadCount()>1&&Jane.c("Треды","Закрытие треда","Закрытие по хоткею"),ns.page.go(Daria.Page.generateUrl.closeMessage())}},oninit:function(){var e=this;this.isSearchResults()&&this._startSearchScenarioIfNotActive();var t=ns.page.current.params,s=t.threaded,a=t.ids;"yes"===s&&a&&ns.Model.get("settings").isSet("open-message-list")&&ns.request("message",{ids:a}).then(function(t){var s=ns.Model.get("messages-item-state",{ids:t[0].data.tid}),n=s.STATE;s.setState(n.THREAD_SHORT),ns.Model.get("message-body",{ids:a}).once("ns-model-changed",function(){e.resetOpenMessageState(),e.scrollToMessageDebounce()})}),Daria.IS_CORP||Object(c.b)()},_onHtmlInit:function(){this._htmlInited=!0;var e=this.params;$(".b-search-not-found").length?Jane.c(["Пейджер по датам","Ничего не нашлось"]):e.datePager&&Jane.c(["Пейджер по датам","Страница с результатами поиска"])},_onShow:function(e,t,s){this._shown=!0,this.logTimings(s,n.a.messages),window.Apdex.send(["Performance-initMessageList"]),this._cbt=new Daria.CBT(this.$node,{targetSelector:".js-cbt-item-target"});var a={$node:this.$node,selector:".js-message",mMessagesChecked:this.getModel("messages-checked")};this._cmBaseBindMenuableElements(a),this.isSearchResults()&&(Daria.React.saveShowSearchResultsTimestamp(),this._startSearchScenarioIfNotActive(),this._searchScenarioSuccessStep(),window.Apdex.send(["Performance_searchResult"])),this.loadMoreMessagesIfNeed(),Daria.MessagesLogger.log(this.getModel("messages").models),Object(h.getLizaUxFeedbackController)().onStart(function(){return ns.events.trigger("daria:messages:show")})},_startSearchScenarioIfNotActive:function(){this.scenarioManager.hasActiveScenario(o.e)?this._initialScenario=this.scenarioManager.getActiveScenario(o.e):this._initialScenario=this.scenarioManager.startScenario(o.e,r.b)},_searchScenarioSuccessStep:function(){if(this.scenarioManager.hasActiveScenario(o.e)){var e=this.scenarioManager.getActiveScenario(o.e),t=e.getTimeFromStart();e.logStep(i.a,{duration:t})}},finishSearchScenarioOnLeave:function(){var e=this.scenarioManager.hasActiveScenario(o.e)&&this.scenarioManager.getActiveScenario(o.e),t=this._initialScenario!==e;if(this._initialScenario=null,e&&!t){var s=d.g;Daria.isSearchPage()?s=d.a:Daria.isComposePage()?s=d.h:Daria.isMessageOpenedInList()||Daria.isMessagePage()?s=d.i:Daria.isMessagesListPage()&&(s=d.f),this.scenarioManager.finishScenarioIfActive(o.e,s)}},__countShowLabelPromoMetrics:Daria.memoizeById({},function(){return this.__uniqueId},function(){Jane.c(["Промо меток","Писем с такой меткой нет","показ блока"])}),_onTouch:function(){var e=this.getModel("messages").isEmptyList();Daria.is2pane()&&this.params.current_label&&e?this.__countShowLabelPromoMetrics():Daria.is2pane()&&!Daria.isFullThreadPage()||(e||this.fillMessagesList(),ns.events.trigger("mail:splitter:toggleOnePaneMode",e)),this._moveDynamicNodes()},_moveDynamicNodes:function(){this._triggerItemsListUpdated()},_onHide:function(){this.scrollToMessageDebounce.cancel(),this._shown=!1,this._cbt&&this._cbt.destroy(),this.resetOpenMessageState(),this._cmBaseUnbindMenuableElements(),this.finishSearchScenarioOnLeave()},deselect:function(){this.getMessagesCheckedInstance().resetChecked()},selectAll:function(){this.getMessagesCheckedInstance().selectList()},_onMessagesLoad:function(){!this.__lockMessagesLoad&&this.getModel("messages").canLoadMore()&&(this.__lockMessagesLoad=!0,ns.events.trigger("daria:vMessages:messages-load-start"),this.getModel("messages").loadMore().then(function(e){ns.Model.get("messages-pager",ns.page.current.params).invalidate(),this.__lockMessagesLoad=!1,ns.events.trigger("daria:vMessages:messages-load-stop"),Daria.MessagesLogger.log(e)},this))},getMessagesCheckedInstance:function(){return this.getModel("messages-checked")},_onToolbarButton:function(e,t,s){var a=this;if(t=t||{},s=s||{},"move"===e&&ns.Model.get("folders").isArchive(t.fid)&&(e="archive"),!t._viewKey||t._viewKey===this.key){var n;s.refreshImmediately&&(n=this);var o=t.mMessagesChecked||this.getMessagesCheckedInstance(!0),i=o.getIds(e,t),r=Daria.MOPS.updateHelper(e,o,t,n);if(r){var d=ns.Model.get("mops-confirmation").getMops().action,l=["archive","tospam","notspam"].includes(e)||d||g.HooksManager.instance().hasHandler(e);return r.then(function(){if(l&&a.deselect(),!s.refreshImmediately&&!s.preventUpdate&&"label"!==e&&"unlabel"!==e)if(Daria.is3pane()){var n=Daria.messages.whereToGoAfterMove(e,o,_.extend({ids:i},t));ns.page.go(n.where)}else ns.page.go();ns.events.trigger("daria:vToolbarButton:loader:end"),$(document).trigger("b-mail-dropdown-closeall")}),l?r:(o.isFolderSelected()||["remove","move","infolder"].indexOf(e)>-1||["mark","unmark"].indexOf(e)>-1&&!Daria.is3pane()?a.deselect():o.touch(),r)}}},_scrollUpOnActionComplete:function(){ns.events.once("daria:MOPS:action-complete",function(){$(window).scrollTop(0)})},_onReplyTmplToolbarButton:function(e,t){this._replyHelper("reply-tmpl",t),this._scrollUpOnActionComplete()},_onSendonToolbarButton:function(e,t){this._replyHelper("sendon",t),this._scrollUpOnActionComplete()},_onDeselect:function(){$(document).trigger("b-mail-dropdown-closeall"),ns.events.trigger("daria:vMessages:deselect")},_onLabelToolbarButton:function(e,t){this._onToolbarButton("label",t,{preventUpdate:!0,_viewKey:t._viewKey})},_onUnlabelToolbarButton:function(e,t){this._onToolbarButton("unlabel",t,{preventUpdate:!0,_viewKey:t._viewKey})},_onTospamToolbarButton:function(e,t){this._onToolbarButton("tospam",t)},_onNotspamToolbarButton:function(e,t){this._onToolbarButton("notspam",t)},_onArchiveToolbarButton:function(e,t){this._onToolbarButton("archive",t)},_onInfolderToolbarButton:function(e,t){this._onToolbarButton("infolder",t)},_onMoveToolbarButton:function(e,t){this._onToolbarButton("move",t,{refreshImmediately:!0})},_onRemoveToolbarButton:function(e,t){this._onToolbarButton("remove",t)},_onMarkToolbarButton:function(e,t){this._onToolbarButton("mark",t,{preventUpdate:!0})},_onUnmarkToolbarButton:function(e,t){this._onToolbarButton("unmark",t,{preventUpdate:!0})},fillMessagesList:function(){this.isVisible()&&this._canFillMessagesList()&&this._onMessagesLoad()},_canFillMessagesList:function(){var e=this.getModel("scroller-messages");return Daria.is2pane()?this.$node.rect().bottom<=e.getHeight():e.getScrollHeight(!0)<=e.getOffsetHeight(!0)},_onResizeWindow:function(){Daria.is3pane()&&(this._lazyOnResize||(this._lazyOnResize=_.debounce(function(){this.fillMessagesList(),Daria.is3pv()&&ns.events.trigger("mail:splitter:update")},100)),this._lazyOnResize())},_runAction:function(e,t){this._onToolbarButton(t.action,t.params)},_onFolderRemove:function(e,t){this.params.current_folder===t&&ns.page.go(ns.router.generateUrl("messages",{current_folder:ns.Model.get("folders").getFidBySymbol(l.WellKnownFolderSymbol.INBOX)}))},_onLabelRemove:function(e,t){this.params.current_label===t&&ns.page.go("#inbox")},isUnreadList:function(){return"only_new"===this.params.extra_cond},isSearchResults:function(){return this.getModel("messages").isSearch()},invalidateUnreadMessages:function(){this.isUnreadList()&&!this.isVisible()&&this.getModel("messages").invalidate()},getOpenMessageState:function(){var e=ns.page.current.params;return Daria.Page.isParamsForSingleThread(e)?e.ids||"":e.ids||e.thread_id||""},resetOpenMessageState:function(){this._openMessageState=null},scrollToMessage:function(){if(Daria.is2pane()){var e,t=this.getOpenMessageState();t!==this._openMessageState&&(t?(e=this.$node.find(".js-message-wrap-"+t),this.scrollMessageIntoViewport(e,!0)):!t&&this._openMessageState&&(e=this.$node.find(".js-message-wrap-"+this._openMessageState),this.scrollMessageIntoViewport(e,!1),this.highlightClosedMessage(e)),ns.events.trigger("daria:vMessages:scroll"),this._openMessageState=t)}},scrollMessageIntoViewport:function(e,t){var s=e.offset();if(s){var a=ns.Model.get("scroller-messages"),n=a.getScrollTop(),o=a.getHeight(),i=n+o,r=Object(u.hasFeature)(u.Features.REACT_LAYOUT)?s.top+n-a.getScroller().offset().top:s.top,d=!1;if(t){var l=r-n;d=!(l>2*this.HEIGHT_MESSAGE_SNIPPET&&l<o/3)}else d=!(n<r&&r<i);if(d){var c=2*this.HEIGHT_MESSAGE_SNIPPET;Object(u.hasFeature)(u.Features.REACT_LAYOUT)&&(c+=$("#js-mail-layout-content-header").height());var g=r-c;if(a.setScrollTop(g,!0),t){var h=ns.Model.get("message",{ids:this.getOpenMessageState()}),m=ns.Model.get("message-body",{ids:h.get(".last_mid")});m.isValid()||m.once("ns-model-changed",function(){g>a.getScrollTop()&&a.setScrollTop(g,!0)})}}}else Daria.Focus.moveItem({toForward:!0})},highlightClosedMessage:function(e){e.addClass("is-highlight"),$.Transitions.animFrame(function(){$.Transitions.animFrame(function(){e.removeClass("is-highlight")})})},onToggleCompactMode:function(){Daria.is2pane()&&this.$node.find(".js-messages-list").toggleClass("mail-MessagesList_height_small",Daria.CompactMode.isCompactMessagesList())},getFocusableChildren:function(){var e=[];return this.forEachValidItem(function(t){e=e.concat(t.getFocusableChildren())}),e},_itemsListWillUpdate:function(){this._itemsListChanged=!0,ns.events.trigger("vMessages:items-list-will-update")},_triggerItemsListUpdated:function(){this._itemsListChanged&&(ns.events.trigger("vMessages:items-list-updated"),this._itemsListChanged=!1,Daria.MessagesLogger.log(this.getModel("messages").models))}}},"messages-headers-mixin","message-actions","context-menu-mixin-messages","scenario-manager-mixin",ns.ViewCollection)},5167:function(e,t,s){"use strict";s.d(t,"a",function(){return a});var a="successful-render"},5168:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(486),n=(s.n(a),s(347)),o=s(5169);s.n(o);ns.View.edefine("message-thread-react",Object(a.NsReactView)({component:o.MessageThreadReact,params:function(e){return{ids:e.thread_id||e.ids,thread_id:e.thread_id||e.ids,mid:e.thread_id||e.ids}},models:["messages"],yateModule:"messages",methods:{onHtmlInit:function(){this.addMgTheme()},onShow:function(){this._shouldPreserveScrollPosition=Daria.is2pane(),ns.Model.get("focus").get(".currentFocus")===this&&setTimeout(function(){var e=Object(n.getFocusBridge)();e.focusGroup(e.FocusGroup.RIGHT_COLUMN)},200)},getFocusableChildren:function(){return[this]},onFocusEvent:function(e){var t=Object(n.getFocusBridge)();switch(e.type){case"focus":t.focusGroup(t.FocusGroup.RIGHT_COLUMN);break;case"blur":t.dropFocus()}}}}),"preserve-scroll-position-mixin","mg-theme-mixin")},5169:function(e,t,s){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,s=1,a=arguments.length;s<a;s++)for(var n in t=arguments[s])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},n=this&&this.__createBinding||(Object.create?function(e,t,s,a){void 0===a&&(a=s),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,a){void 0===a&&(a=s),e[a]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&n(t,e,s);return o(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageThreadReact=void 0;var d=i(s(135)),l=s(543),c=s(347),g=s(145),h=r(s(5170));t.MessageThreadReact=function(e){var t=c.getMessageThreadLoader(),s=d.useCallback(function(){return t().then(function(t){var s=t.MessageThread;return d.default.createElement(s,a({},e.params))})},[t,e]),n=d.useCallback(function(){return d.default.createElement("div",{className:h.default.placeholder},d.default.createElement(g.Spin,{view:"default",size:"s",progress:!0}))},[]);return t?d.default.createElement(l.ModuleLoader,{component:s,placeholder:n}):null}},5170:function(e,t){e.exports={placeholder:"message-thread-react__placeholder--1BXn8"}},5171:function(e,t){yr.externals["date-pager-url"]=function(e){var t;return t=e?no.extend({},ns.page.current.params,e):ns.page.current.params,ns.router.generateUrl("messages",t)},yr.externals.json=function(e){return JSON.stringify(e[0].data)},yr.externals["messages-item-format-date"]=function(e){var t=yr.nodeset2data(e),s=new Date,a=new Date(t.ts);return Jane.Date.isSameDay(s,a)?Jane.Date.format("%R",t.ts):s.getFullYear()!==a.getFullYear()?t.short:Jane.Date.format("%Date_df",t.ts)},yr.externals["widget-entity"]=function(e){var t={man:"Widgets-Person",plane:"Widgets-PlaneOneWay",planes:"Widgets-PlaneBothWays"};return e.replace(/&([a-z]+);/g,function(e,s){var a=t[s];return a?'<svg xmlns="http://www.w3.org/2000/svg" class="svgicon svgicon-mail--'+a+'"><use xlink:href="#svgicon-mail--'+a+'"></use><rect height="100%" width="100%" style="fill: transparent;"></rect></svg>':"&"+s+";"})},yr.externals["is-corp-email"]=function(e){return Daria.email.isCorp(e)},yr.externals["show-taksa-widgets"]=function(e){return Daria.Widgets.shouldShowTaksaWidgets(ns.Model.get("message",{ids:e}))},yr.externals["show-widgets-decor"]=function(){return ns.Model.get("settings").getSign("show_widgets_decor")},yr.externals["show-widgets-buttons"]=function(){return ns.Model.get("settings").getSign("show_widgets_buttons")}},5172:function(e,t,s){s(5173),s(5174),ns.events.on("daria:vSetupOther:inboxattachs-changed",function(){ns.Model.invalidate("messages")})},5173:function(e,t){Daria.CBS=function(){this._mMessagesChecked=ns.Model.get("messages-checked",ns.page.current.params),this._mFocus=ns.Model.get("focus")},Daria.CBS.prototype.start=function(e){this._start=e,this._action=!this._mMessagesChecked.isCheckedByMid(this._start),this._previous=[]},Daria.CBS.prototype.getStart=function(){return this._start},Daria.CBS.prototype.select=function(e){var t=this._mFocus.getRange(this._start,e),s=this._action;if(this._checkByRange(t,s),this._previous.length){var a=_.difference(this._previous,t);this._checkByRange(a,!s)}this._previous=t},Daria.CBS.prototype.selectWithShift=function(e){var t=this._mMessagesChecked,s=t.getLastChecked(),a=t.getCheckedMessages(),n=0===a.length?e:s.params.ids,o=this._mFocus.getRange(n,e);if(this._checkByRange(o,!0,!0),0===a.length){var i=ns.Model.get("message",{ids:n});t.setLastChecked(i)}var r=o.map(function(e){return e.getModel("message")});a.forEach(function(e){-1===r.indexOf(e)&&t.check(e,!1)})},Daria.CBS.prototype._checkByRange=function(e,t){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this._mMessagesChecked;if(e.forEach(function(e){a.check(e.getModel("message"),t)}),e.length>0&&!s){var n=_.last(e);a.setLastChecked(n.getModel("message"))}}},5174:function(e,t){!function(){var e={itemSelector:".js-cbt-item",checkboxSelector:".js-cbt-item-checkbox",targetSelector:"",level2Selector:".js-cbt-group",onPotentialDragNDrop:no.nop},t="mousedown.cbt",s="mouseup.cbt",a="mousemove.cbt",n="daria:cbt:mousedown";Daria.CBT=function(t,s){this.options=_.extend({},e,s),this._$node=$(t),this._init()},Daria.CBT.prototype.destroy=function(){this._$node.off(".cbt"),this.$document.off(".cbt")},Daria.CBT.prototype.$document=$(document),Daria.CBT.prototype._init=function(){this._$node.on(t,this.options.targetSelector,this._onItemMouseDown.bind(this))},Daria.CBT.prototype.startSelection=function(e){var t=this._getCBTItem(e);return!!t&&(this._cbs=new Daria.CBS,this._cbs.start(t.dataset.id),!0)},Daria.CBT.prototype.selectByRange=function(e){var t=e.dataset.id;this._cbs.getStart()!==t&&this._cbs.select(t)},Daria.CBT.prototype._onItemMouseDown=function(e){if(1!==e.which||2===e.buttons)return!1;ns.events.trigger(n);var t=e.target.className;if("string"==typeof t&&t.indexOf("b-label")>-1)return!0;this._onMouseDown(e)},Daria.CBT.prototype._onMouseDown=function(e){this.startSelection(e.target)&&(e.preventDefault(),this.$document.on(a,this._doMouseSelection.bind(this)).on(s,this._stopMouseSelection.bind(this)))},Daria.CBT.prototype._doMouseSelection=function(e){e.stopPropagation(),e.preventDefault();var t=this._getCBTItem(e.target);t&&this.selectByRange(t)},Daria.CBT.prototype._stopMouseSelection=function(e){e.stopPropagation(),e.preventDefault(),this._cbs=null,this.$document.off(".cbt")},Daria.CBT.prototype._getCBTItem=function(e){var t=$(e).closest(this.options.itemSelector)[0];return t||null}}()},738:function(e,t,s){"use strict";t.b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"is-focused";e.addClass(t),e.focus()},t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"is-focused";e.removeClass(t),e.blur()}},739:function(e,t){e.exports={root:"messages-empty__root--1xz_s",is2pane:"messages-empty__is2pane--3GgCR",is3pv:"messages-empty__is3pv--7bk2k",header:"messages-empty__header--2ws56",text:"messages-empty__text--KZt7V",list:"messages-empty__list--rMIxK",button:"messages-empty__button--2wWgi",image:"messages-empty__image--2hoq9",label:"messages-empty__label--1eE0g"}}});