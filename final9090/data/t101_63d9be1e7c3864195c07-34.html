/*! For license information please see 63d9be1e7c3864195c07-34.js.LICENSE */
webpackJsonp([34],Array(149).concat([function(e,t,n){"use strict";var r=n(12);t.a=new Promise(function(e){if("complete"!==document.readyState){var t=Object(r.c)(function(){document.removeEventListener("DOMContentLoaded",t,!1),window.removeEventListener("load",t,!1),e()});document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)}else e()})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2553),o=n(3065),i=n(71);Jane.module("compose-manager.js",function(){var e=new r.a,t=new o.a;Daria.React.Compose={create:function(t,n,r){t.mailboxUid=t.mailboxUid||Object(i.a)(),Daria.React.Compose.shouldRenderStack=!0,e.createCompose(t,n,r),e.render(document.querySelector(".js-ComposeManagerContainer"))},restore:function(t){e.render(t)},showPromo:function(t){e.showPromo(t)},destroy:function(){return e.unmount()},isVisible:function(){return Boolean(e.manager.currentCompose)}},Daria.React.QuickReply={open:t.render,saveDraft:t.saveDraft,saveDraftAndDestroy:t.saveDraftAndUnmount,destroy:t.unmount}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r,o,i=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return a(t,e),t},c=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0}),t.COMPOSE_METRIKA_WYSIWIG_FONT=t.COMPOSE_METRIKA_WYSIWIG_STRIKETHROUGH=t.COMPOSE_METRIKA_WYSIWIG_UNDERLINE=t.COMPOSE_METRIKA_WYSIWIG_ITALIC=t.COMPOSE_METRIKA_WYSIWIG_BOLD=t.COMPOSE_METRIKA_WYSIWIG_REDO=t.COMPOSE_METRIKA_WYSIWIG_UNDO=t.COMPOSE_METRIKA_WYSIWIG=t.COMPOSE_SIGNATURES_POPUP_GO_TO_SETTINGS=t.COMPOSE_SIGNATURES_POPUP_WITHOUT_SIGNATURE=t.COMPOSE_SIGNATURES_POPUP_CHANGE_SIGNATURE=t.COMPOSE_SIGNATURES_POPUP_OPEN=t.COMPOSE_SIGNATURES_POPUP=t.COMPOSE_METRIKA_RECIPIENTS_DIFF_PROMO_CLOSED=t.COMPOSE_METRIKA_RECIPIENTS_DIFF_PROMO_SHOWN=t.COMPOSE_METRIKA_RECIPIENTS_DIFF_EXPANDED=t.COMPOSE_METRIKA_RECIPIENTS_DIFF_COLLAPSED=t.COMPOSE_METRIKA_RECIPIENTS_DIFF_SHOWN=t.COMPOSE_METRIKA_RECIPIENTS_DIFF=t.COMPOSE_HEADER_FIELDS_METRIKA=t.COMPOSE_METRIKA_HEADER_LABELS_REMOVE=t.COMPOSE_METRIKA_HEADER_LABELS=t.COMPOSE_METRIKA_HEADER_PROMO_SUGGEST_BEAUTIFUL_EMAIL_ACTION=t.COMPOSE_METRIKA_HEADER_PROMO_SUGGEST_BEAUTIFUL_EMAIL_CLOSE=t.COMPOSE_METRIKA_HEADER_PROMO_SUGGEST_BEAUTIFUL_EMAIL_SHOW=t.COMPOSE_METRIKA_HEADER_PROMO_BEAUTIFUL_EMAIL_CLOSE=t.COMPOSE_METRIKA_HEADER_PROMO_BEAUTIFUL_EMAIL_SHOW=t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_WRITE_ONLY=t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_EDIT=t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_COPY=t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_EMAIL=t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP=t.COMPOSE_METRIKA_HEADER_SUGGEST_OTHER=t.COMPOSE_METRIKA_HEADER_SUGGEST_SELF=t.COMPOSE_METRIKA_HEADER_SUGGEST=t.COMPOSE_METRIKA_HEADER_STACK_DRAFTS_LINK=t.COMPOSE_METRIKA_HEADER_TOGGLE_STACK=t.COMPOSE_METRIKA_HEADER_THUMB_CLICK=t.COMPOSE_METRIKA_HEADER_EXPAND=t.COMPOSE_METRIKA_HEADER_CLOSE=t.COMPOSE_METRIKA_HEADER_COLLAPSE=t.COMPOSE_METRIKA_HEADER_TOGGLE_ADDRESSES=t.COMPOSE_METRIKA_HEADER_SUBJECT=t.COMPOSE_METRIKA_HEADER_FROM_SHOW=t.COMPOSE_METRIKA_HEADER_FROM_CLICK=t.COMPOSE_METRIKA_HEADER_BCC=t.COMPOSE_METRIKA_HEADER_CC=t.COMPOSE_METRIKA_HEADER_TO=t.COMPOSE_METRIKA_HEADER=t.COMPOSE_METRIKA=void 0,t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CANCEL_CUSTOM_DATETIME=t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_SELECT_CUSTOM_DATETIME=t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_SEND=t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CLEAR=t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CUSTOM_DATETIME=t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CLICK=t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING=t.COMPOSE_METRIKA_FOOTER_ATTACHMENTS_CLICK=t.COMPOSE_METRIKA_FOOTER_ATTACHMENTS=t.COMPOSE_METRIKA_FOOTER_PROMO_AUTOCOMPLETE_CLOSE=t.COMPOSE_METRIKA_FOOTER_PROMO_AUTOCOMPLETE_SHOW=t.COMPOSE_METRIKA_FOOTER_MORE_SIGNATURES_CLICK=t.COMPOSE_METRIKA_FOOTER_MORE_LABELS_CLICK=t.COMPOSE_METRIKA_FOOTER_MORE_SMARTSUBJECT_OFF=t.COMPOSE_METRIKA_FOOTER_MORE_SMARTSUBJECT_ON=t.COMPOSE_METRIKA_FOOTER_MORE_AUTOCOMPLETE_OFF=t.COMPOSE_METRIKA_FOOTER_MORE_AUTOCOMPLETE_ON=t.COMPOSE_METRIKA_FOOTER_MORE=t.COMPOSE_METRIKA_FOOTER_BETA=t.COMPOSE_METRIKA_FOOTER_ATTACH_MAIL=t.COMPOSE_METRIKA_FOOTER_ATTACH_DISK=t.COMPOSE_METRIKA_FOOTER_ATTACH_LOCAL=t.COMPOSE_METRIKA_FOOTER_SEND=t.COMPOSE_METRIKA_FOOTER=t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_FROM_LOCAL=t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_FROM_URL=t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_INSERT_FILE=t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_CLICK_OPTION=t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_CLICK_TOOLBAR=t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES=t.COMPOSE_METRIKA_WYSIWYG_AUTOCOMPLETE_USE_WITH_KEYBOARD=t.COMPOSE_METRIKA_WYSIWYG_AUTOCOMPLETE_USE_WITH_MOUSE=t.COMPOSE_METRIKA_WYSIWIG_AUTOCOMPLETE_USE=t.COMPOSE_METRIKA_WYSIWIG_AUTOCOMPLETE_SHOW=t.COMPOSE_METRIKA_WYSIWIG_AUTOCOMPLETE=t.COMPOSE_METRIKA_WYSIWIG_BODY=t.COMPOSE_METRIKA_WYSIWIG_CLEAR_FORMAT=t.COMPOSE_METRIKA_WYSIWIG_BULLETED_LIST=t.COMPOSE_METRIKA_WYSIWIG_NUMBERED_LIST=t.COMPOSE_METRIKA_WYSIWIG_ALIGN_RIGHT=t.COMPOSE_METRIKA_WYSIWIG_ALIGN_CENTER=t.COMPOSE_METRIKA_WYSIWIG_ALIGN_LEFT=t.COMPOSE_METRIKA_WYSIWIG_ALIGN=t.COMPOSE_METRIKA_WYSIWIG_QUOTE=t.COMPOSE_METRIKA_WYSIWIG_REMOVE_LINK=t.COMPOSE_METRIKA_WYSIWIG_ADD_LINK=t.COMPOSE_METRIKA_WYSIWIG_EMOJI=t.COMPOSE_METRIKA_WYSIWIG_BACKGROUND_COLOR=t.COMPOSE_METRIKA_WYSIWIG_TEXT_COLOR=t.COMPOSE_METRIKA_WYSIWIG_FONT_SIZE=void 0,t.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS=t.COMPOSE_METRIKA_POPUPS_SEND_FAILED_CLOSE=t.COMPOSE_METRIKA_POPUPS_SEND_FAILED_CANCEL=t.COMPOSE_METRIKA_POPUPS_SEND_FAILED_RETRY=t.COMPOSE_METRIKA_POPUPS_SEND_FAILED_SHOW=t.COMPOSE_METRIKA_POPUPS_SEND_FAILED=t.COMPOSE_METRIKA_POPUPS=t.COMPOSE_METRIKA_ATTACHMENTS_PLACE=t.COMPOSE_METRIKA_ATTACHMENTS_CANCEL_UPLOAD=t.COMPOSE_METRIKA_ATTACHMENTS_TOGGLE=t.COMPOSE_METRIKA_ATTACHMENTS_REMOVE_ALL=t.COMPOSE_METRIKA_ATTACHMENTS_REMOVE=t.COMPOSE_METRIKA_ATTACHMENTS_DOWNLOAD=t.COMPOSE_METRIKA_ATTACHMENTS_PREVIEW=t.COMPOSE_METRIKA_ATTACHMENTS=t.TIME_PRESETS_METRIKA=t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_NEXT_WEEK=t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_WEEKEND=t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_TOMORROW=t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_TODAY=t.COMPOSE_METRIKA_FOOTER_OVERFLOW_CLICK=t.COMPOSE_METRIKA_FOOTER_OVERFLOW=t.COMPOSE_METRIKA_FOOTER_LABELS_ADD_USER=t.COMPOSE_METRIKA_FOOTER_LABELS_ADD_IMPORTANT=t.COMPOSE_METRIKA_FOOTER_LABELS_MANAGE=t.COMPOSE_METRIKA_FOOTER_LABELS_CLICK=t.COMPOSE_METRIKA_FOOTER_LABELS=t.COMPOSE_METRIKA_FOOTER_TEMPLATES_MANAGE=t.COMPOSE_METRIKA_FOOTER_TEMPLATES_UPDATE=t.COMPOSE_METRIKA_FOOTER_TEMPLATES_SAVE_AS_NEW=t.COMPOSE_METRIKA_FOOTER_TEMPLATES_SAVE=t.COMPOSE_METRIKA_FOOTER_TEMPLATES_SELECT=t.COMPOSE_METRIKA_FOOTER_TEMPLATES_CLICK=t.COMPOSE_METRIKA_FOOTER_TEMPLATES=t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_COLLAPSE=t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_EXPAND=t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_OFF=t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_ON=t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_DELIVERY_OFF=t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_DELIVERY_ON=t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_CLICK=t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS=t.COMPOSE_METRIKA_TRANSLATION_EDIT_BUTTON=t.COMPOSE_METRIKA_TRANSLATION_SEND_BUTTON=t.COMPOSE_METRIKA_TRANSLATION_TRANSLATE_BUTTON=t.COMPOSE_METRIKA_TRANSLATION_CHOOSE_LANGUAGE=t.COMPOSE_METRIKA_TRANSLATION_OPEN_LANGUAGE_SELECTOR=t.COMPOSE_METRIKA_TRANSLATION_TO=t.COMPOSE_METRIKA_TRANSLATION_FROM=t.COMPOSE_METRIKA_TRANSLATION_PANE=void 0,t.ABOOK_POPUP_SHOW_SUGGEST=t.ABOOK_POPUP_SHOW_FIELD_TITLE=t.ABOOK_POPUP_SHOW=t.ABOOK_POPUP=t.EDITOR_TOOLBAR_COMMANDS_METRIKA=t.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS_BACK_TO_EDIT=t.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS_REMOVE_AND_SEND=t.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS_SHOW=t.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS=t.COMPOSE_METRIKA_POPUPS_SMART_SUBJECT_SELECT_FROM_SUGGEST=t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_CLICK_DO_NOT_SHOW=t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_CLOSE=t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_CANCEL=t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_SEND=t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_SEND_EMPTY=t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_SHOW=t.COMPOSE_METRIKA_POPUPS_SMART_SUBJECT=t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT=t.COMPOSE_METRIKA_POPUPS_CAPTCHA_CANCEL=t.COMPOSE_METRIKA_POPUPS_CAPTCHA_SEND=t.COMPOSE_METRIKA_POPUPS_CAPTCHA_REFRESH=t.COMPOSE_METRIKA_POPUPS_CAPTCHA_SHOW=t.COMPOSE_METRIKA_POPUPS_CAPTCHA=t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_CLOSE=t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_ACTION=t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_DISK_TECHNICAL_WORK=t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_DISK_TRAFFIC_LIMIT=t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_SHOW=t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS=t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_CLOSE=t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_CANCEL=t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_ACTION=t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_SHOW=t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT=t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_CLOSE=t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_CANCEL=t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_ACTION=t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_SHOW=t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE=t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE_CLOSE=t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE_CANCEL=t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE_ACTION=t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE_SHOW=t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE=t.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS_CLOSE=t.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS_ACTION=t.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS_SHOW=t.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS=t.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS_CLOSE=t.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS_SHOW=void 0,t.QUICK_REPLY_CLICK_ON_RECIPIENTS=t.QUICK_REPLY_CLICK_ON_COMPOSE=t.QUICK_REPLY_CLICK_ON_CLOSE=t.QUICK_REPLY=void 0;var l=n(471),p=s(n(470));t.COMPOSE_METRIKA="Letter writing (new)",t.COMPOSE_METRIKA_HEADER="in header",t.COMPOSE_METRIKA_HEADER_TO='focus on "To"',t.COMPOSE_METRIKA_HEADER_CC='focus on "Cc"',t.COMPOSE_METRIKA_HEADER_BCC='focus on "Bcc"',t.COMPOSE_METRIKA_HEADER_FROM_CLICK='click on another address in "From"',t.COMPOSE_METRIKA_HEADER_FROM_SHOW='show addresses in "From"',t.COMPOSE_METRIKA_HEADER_SUBJECT='focus on "Theme"',t.COMPOSE_METRIKA_HEADER_TOGGLE_ADDRESSES='click on "Expand/Collapse addresses"',t.COMPOSE_METRIKA_HEADER_COLLAPSE='click on "Collapse compose"',t.COMPOSE_METRIKA_HEADER_CLOSE='click on "Close compose"',t.COMPOSE_METRIKA_HEADER_EXPAND='click on "Expand compose"',t.COMPOSE_METRIKA_HEADER_THUMB_CLICK="click on collapsed compose header",t.COMPOSE_METRIKA_HEADER_TOGGLE_STACK='click on "Expand/Collapse stack"',t.COMPOSE_METRIKA_HEADER_STACK_DRAFTS_LINK='click on "Show all drafts"',t.COMPOSE_METRIKA_HEADER_SUGGEST="in suggest",t.COMPOSE_METRIKA_HEADER_SUGGEST_SELF='click on "self" contact',t.COMPOSE_METRIKA_HEADER_SUGGEST_OTHER="click on other contact",t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP="in yabble popup",t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_EMAIL="click on email",t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_COPY='click on "Copy"',t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_EDIT='click on "Edit"',t.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_WRITE_ONLY='click on "Write to this contact only"',t.COMPOSE_METRIKA_HEADER_PROMO_BEAUTIFUL_EMAIL_SHOW="showing beautiful email promo",t.COMPOSE_METRIKA_HEADER_PROMO_BEAUTIFUL_EMAIL_CLOSE="closing beautiful email promo",t.COMPOSE_METRIKA_HEADER_PROMO_SUGGEST_BEAUTIFUL_EMAIL_SHOW="showing suggest beautiful email promo",t.COMPOSE_METRIKA_HEADER_PROMO_SUGGEST_BEAUTIFUL_EMAIL_CLOSE="closing suggest beautiful email promo",t.COMPOSE_METRIKA_HEADER_PROMO_SUGGEST_BEAUTIFUL_EMAIL_ACTION="action from suggest beautiful email promo",t.COMPOSE_METRIKA_HEADER_LABELS="Labels",t.COMPOSE_METRIKA_HEADER_LABELS_REMOVE="click on remove",t.COMPOSE_HEADER_FIELDS_METRIKA={to:t.COMPOSE_METRIKA_HEADER_TO,cc:t.COMPOSE_METRIKA_HEADER_CC,bcc:t.COMPOSE_METRIKA_HEADER_BCC},t.COMPOSE_METRIKA_RECIPIENTS_DIFF="in recipients diff",t.COMPOSE_METRIKA_RECIPIENTS_DIFF_SHOWN="show",t.COMPOSE_METRIKA_RECIPIENTS_DIFF_COLLAPSED="collapsed",t.COMPOSE_METRIKA_RECIPIENTS_DIFF_EXPANDED="expanded",t.COMPOSE_METRIKA_RECIPIENTS_DIFF_PROMO_SHOWN="promo shown",t.COMPOSE_METRIKA_RECIPIENTS_DIFF_PROMO_CLOSED="promo closed",t.COMPOSE_SIGNATURES_POPUP="in signatures popup",t.COMPOSE_SIGNATURES_POPUP_OPEN="open",t.COMPOSE_SIGNATURES_POPUP_CHANGE_SIGNATURE="change",t.COMPOSE_SIGNATURES_POPUP_WITHOUT_SIGNATURE='choose "Empty"',t.COMPOSE_SIGNATURES_POPUP_GO_TO_SETTINGS='click on "Manage Settings"',t.COMPOSE_METRIKA_WYSIWIG="in wysiwig",t.COMPOSE_METRIKA_WYSIWIG_UNDO='click on "Undo"',t.COMPOSE_METRIKA_WYSIWIG_REDO='click on "Redo"',t.COMPOSE_METRIKA_WYSIWIG_BOLD='click on "Bold"',t.COMPOSE_METRIKA_WYSIWIG_ITALIC='click on "Italic"',t.COMPOSE_METRIKA_WYSIWIG_UNDERLINE='click on "Underline"',t.COMPOSE_METRIKA_WYSIWIG_STRIKETHROUGH='click on "Strikethrough"',t.COMPOSE_METRIKA_WYSIWIG_FONT='click on "Font"',t.COMPOSE_METRIKA_WYSIWIG_FONT_SIZE='click on "Font size"',t.COMPOSE_METRIKA_WYSIWIG_TEXT_COLOR='click on "Text color"',t.COMPOSE_METRIKA_WYSIWIG_BACKGROUND_COLOR='click on "Background color"',t.COMPOSE_METRIKA_WYSIWIG_EMOJI='click on "Emoji"',t.COMPOSE_METRIKA_WYSIWIG_ADD_LINK='click on "Add/Edit link"',t.COMPOSE_METRIKA_WYSIWIG_REMOVE_LINK='click on "Remove link"',t.COMPOSE_METRIKA_WYSIWIG_QUOTE='click on "Blockquote"',t.COMPOSE_METRIKA_WYSIWIG_ALIGN='click on "Alignment"',t.COMPOSE_METRIKA_WYSIWIG_ALIGN_LEFT='click on "Align left"',t.COMPOSE_METRIKA_WYSIWIG_ALIGN_CENTER='click on "Align center"',t.COMPOSE_METRIKA_WYSIWIG_ALIGN_RIGHT='click on "Align right"',t.COMPOSE_METRIKA_WYSIWIG_NUMBERED_LIST='click on "Numbered list"',t.COMPOSE_METRIKA_WYSIWIG_BULLETED_LIST='click on "Bulleted list"',t.COMPOSE_METRIKA_WYSIWIG_CLEAR_FORMAT='click on "Clear format"',t.COMPOSE_METRIKA_WYSIWIG_BODY='focus on "Body"',t.COMPOSE_METRIKA_WYSIWIG_AUTOCOMPLETE="Autocomplete",t.COMPOSE_METRIKA_WYSIWIG_AUTOCOMPLETE_SHOW="show",t.COMPOSE_METRIKA_WYSIWIG_AUTOCOMPLETE_USE="use",t.COMPOSE_METRIKA_WYSIWYG_AUTOCOMPLETE_USE_WITH_MOUSE="with mouse",t.COMPOSE_METRIKA_WYSIWYG_AUTOCOMPLETE_USE_WITH_KEYBOARD="with keyboard",t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES="Inline images",t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_CLICK_TOOLBAR="click on toolbar button",t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_CLICK_OPTION="click on option",t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_INSERT_FILE="insert file",t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_FROM_URL="from url",t.COMPOSE_METRIKA_WYSIWIG_INLINE_IMAGES_FROM_LOCAL="from computer",t.COMPOSE_METRIKA_FOOTER="in footer",t.COMPOSE_METRIKA_FOOTER_SEND='click on "Send"',t.COMPOSE_METRIKA_FOOTER_ATTACH_LOCAL='click on "Files from computer"',t.COMPOSE_METRIKA_FOOTER_ATTACH_DISK='click on "Files from Disk"',t.COMPOSE_METRIKA_FOOTER_ATTACH_MAIL='click on "Files from mail"',t.COMPOSE_METRIKA_FOOTER_BETA='click on "Beta"',t.COMPOSE_METRIKA_FOOTER_MORE='click on "More" button',t.COMPOSE_METRIKA_FOOTER_MORE_AUTOCOMPLETE_ON='click on "enable autocomplete"',t.COMPOSE_METRIKA_FOOTER_MORE_AUTOCOMPLETE_OFF='click on "disable autocomplete"',t.COMPOSE_METRIKA_FOOTER_MORE_SMARTSUBJECT_ON='click on "enable smartsubject"',t.COMPOSE_METRIKA_FOOTER_MORE_SMARTSUBJECT_OFF='click on "disable samrtsubject"',t.COMPOSE_METRIKA_FOOTER_MORE_LABELS_CLICK="click on labels in more menu",t.COMPOSE_METRIKA_FOOTER_MORE_SIGNATURES_CLICK="click on signatures in more menu",t.COMPOSE_METRIKA_FOOTER_PROMO_AUTOCOMPLETE_SHOW="showing autocomplete promo",t.COMPOSE_METRIKA_FOOTER_PROMO_AUTOCOMPLETE_CLOSE="closing autocomplete promo",t.COMPOSE_METRIKA_FOOTER_ATTACHMENTS="Attachments",t.COMPOSE_METRIKA_FOOTER_ATTACHMENTS_CLICK='click on "Attachments" button',t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING="Delayed sending",t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CLICK='click on "Delayed sending" button',t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CUSTOM_DATETIME='click on "Select date&time"',t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CLEAR='click on "Reset delayed sending"',t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_SEND='click on "Send" with delayed options',t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_SELECT_CUSTOM_DATETIME="select datetime in calendar",t.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CANCEL_CUSTOM_DATETIME="cancel datetime in calendar",t.COMPOSE_METRIKA_TRANSLATION_PANE="in translation pane",t.COMPOSE_METRIKA_TRANSLATION_FROM="language from",t.COMPOSE_METRIKA_TRANSLATION_TO="language to",t.COMPOSE_METRIKA_TRANSLATION_OPEN_LANGUAGE_SELECTOR='click on "Choose language"',t.COMPOSE_METRIKA_TRANSLATION_CHOOSE_LANGUAGE="select language",t.COMPOSE_METRIKA_TRANSLATION_TRANSLATE_BUTTON='click on "Translator"',t.COMPOSE_METRIKA_TRANSLATION_SEND_BUTTON='click on "Send translation"',t.COMPOSE_METRIKA_TRANSLATION_EDIT_BUTTON='click on "Edit translation"',t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS="Notifications",t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_CLICK='click on "Notifications" button',t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_DELIVERY_ON='enable "Delivery" notification',t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_DELIVERY_OFF='disable "Delivery" notification',t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_ON='enable "Reply" notification',t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_OFF='disable "Reply" notification',t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_EXPAND='expanded "Reply" notification options',t.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_COLLAPSE='collapsed "Reply" notification options',t.COMPOSE_METRIKA_FOOTER_TEMPLATES="Templates",t.COMPOSE_METRIKA_FOOTER_TEMPLATES_CLICK='click on "Templates" button',t.COMPOSE_METRIKA_FOOTER_TEMPLATES_SELECT="select template from list",t.COMPOSE_METRIKA_FOOTER_TEMPLATES_SAVE='click on "Save as template"',t.COMPOSE_METRIKA_FOOTER_TEMPLATES_SAVE_AS_NEW='click on "Save as new template"',t.COMPOSE_METRIKA_FOOTER_TEMPLATES_UPDATE='click on "Update current template"',t.COMPOSE_METRIKA_FOOTER_TEMPLATES_MANAGE='click on "Manage templates"',t.COMPOSE_METRIKA_FOOTER_LABELS="Labels",t.COMPOSE_METRIKA_FOOTER_LABELS_CLICK='click on "Labels" button',t.COMPOSE_METRIKA_FOOTER_LABELS_MANAGE='click on "Manage labels"',t.COMPOSE_METRIKA_FOOTER_LABELS_ADD_IMPORTANT="add important label to letter",t.COMPOSE_METRIKA_FOOTER_LABELS_ADD_USER="add user label to letter",t.COMPOSE_METRIKA_FOOTER_OVERFLOW="Overflow",t.COMPOSE_METRIKA_FOOTER_OVERFLOW_CLICK='click on "Overflow" button',t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_TODAY='click on "Today" preset',t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_TOMORROW='click on "Tomorrow" preset',t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_WEEKEND='click on "Weekend" preset',t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_NEXT_WEEK='click on "Next week" preset',t.TIME_PRESETS_METRIKA=((r={})[p.TODAY]=t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_TODAY,r[p.TOMORROW]=t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_TOMORROW,r[p.WEEKEND]=t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_WEEKEND,r[p.NEXT_WEEK]=t.COMPOSE_METRIKA_FOOTER_TIME_PRESET_NEXT_WEEK,r),t.COMPOSE_METRIKA_ATTACHMENTS="Attachments",t.COMPOSE_METRIKA_ATTACHMENTS_PREVIEW='click "show"/preview',t.COMPOSE_METRIKA_ATTACHMENTS_DOWNLOAD='click "download one"',t.COMPOSE_METRIKA_ATTACHMENTS_REMOVE='click on "Close"',t.COMPOSE_METRIKA_ATTACHMENTS_REMOVE_ALL='click on "Remove all"',t.COMPOSE_METRIKA_ATTACHMENTS_TOGGLE='click "Fold"',t.COMPOSE_METRIKA_ATTACHMENTS_CANCEL_UPLOAD='click on "Cancel upload"',t.COMPOSE_METRIKA_ATTACHMENTS_PLACE="in compose react",t.COMPOSE_METRIKA_POPUPS="Popups",t.COMPOSE_METRIKA_POPUPS_SEND_FAILED="in send failed popup",t.COMPOSE_METRIKA_POPUPS_SEND_FAILED_SHOW="show",t.COMPOSE_METRIKA_POPUPS_SEND_FAILED_RETRY='click on "Retry"',t.COMPOSE_METRIKA_POPUPS_SEND_FAILED_CANCEL='click on "Cancel"',t.COMPOSE_METRIKA_POPUPS_SEND_FAILED_CLOSE='click on "Close"',t.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS="in limited recipients popup",t.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS_SHOW="show",t.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS_CLOSE='click on "Close"',t.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS="in validation errors popup",t.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS_SHOW="show",t.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS_ACTION='click on "Action"',t.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS_CLOSE='click on "Close"',t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE="in confirm save popup",t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE_SHOW="show",t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE_ACTION='click on "Save"',t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE_CANCEL='click on "Do not save"',t.COMPOSE_METRIKA_POPUPS_CONFIRM_SAVE_CLOSE='click on "Close"',t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE="in confirm remove popup",t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_SHOW="show",t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_ACTION='click on "Remove draft"',t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_CANCEL='click on "Keep draft"',t.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_CLOSE='click on "Close"',t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT="in remove draft popup",t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_SHOW="show",t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_ACTION='click on "Remove draft"',t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_CANCEL='click on "Cancel"',t.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_CLOSE='click on "Close"',t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS="in attachments errors popup",t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_SHOW="show",t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_DISK_TRAFFIC_LIMIT="traffic limit",t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_DISK_TECHNICAL_WORK="technical work",t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_ACTION='click on "OK"',t.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_CLOSE='click on "Close"',t.COMPOSE_METRIKA_POPUPS_CAPTCHA="in captcha popup",t.COMPOSE_METRIKA_POPUPS_CAPTCHA_SHOW="show",t.COMPOSE_METRIKA_POPUPS_CAPTCHA_REFRESH="refresh",t.COMPOSE_METRIKA_POPUPS_CAPTCHA_SEND="send",t.COMPOSE_METRIKA_POPUPS_CAPTCHA_CANCEL="cancel",t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT="in empty subject popup",t.COMPOSE_METRIKA_POPUPS_SMART_SUBJECT="in smart subject popup",t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_SHOW="show",t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_SEND_EMPTY="send_empty",t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_SEND="send",t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_CANCEL="cancel",t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_CLOSE="close",t.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_CLICK_DO_NOT_SHOW="click do not show",t.COMPOSE_METRIKA_POPUPS_SMART_SUBJECT_SELECT_FROM_SUGGEST="click on suggest item",t.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS="in too many subscribers popup",t.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS_SHOW="show",t.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS_REMOVE_AND_SEND="remove and send",t.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS_BACK_TO_EDIT="back to edit",t.EDITOR_TOOLBAR_COMMANDS_METRIKA=((o={})[l.ToolbarCommands.UNDO]=t.COMPOSE_METRIKA_WYSIWIG_UNDO,o[l.ToolbarCommands.REDO]=t.COMPOSE_METRIKA_WYSIWIG_REDO,o[l.ToolbarCommands.BOLD]=t.COMPOSE_METRIKA_WYSIWIG_BOLD,o[l.ToolbarCommands.ITALIC]=t.COMPOSE_METRIKA_WYSIWIG_ITALIC,o[l.ToolbarCommands.UNDERLINE]=t.COMPOSE_METRIKA_WYSIWIG_UNDERLINE,o[l.ToolbarCommands.STRIKETHROUGH]=t.COMPOSE_METRIKA_WYSIWIG_STRIKETHROUGH,o[l.ToolbarCommands.FONT]=t.COMPOSE_METRIKA_WYSIWIG_FONT,o[l.ToolbarCommands.FONT_SIZE]=t.COMPOSE_METRIKA_WYSIWIG_FONT_SIZE,o[l.ToolbarCommands.TEXT_COLOR]=t.COMPOSE_METRIKA_WYSIWIG_TEXT_COLOR,o[l.ToolbarCommands.BACKGROUND_COLOR]=t.COMPOSE_METRIKA_WYSIWIG_BACKGROUND_COLOR,o[l.ToolbarCommands.EMOJI]=t.COMPOSE_METRIKA_WYSIWIG_EMOJI,o[l.ToolbarCommands.ADD_LINK]=t.COMPOSE_METRIKA_WYSIWIG_ADD_LINK,o[l.ToolbarCommands.REMOVE_LINK]=t.COMPOSE_METRIKA_WYSIWIG_REMOVE_LINK,o[l.ToolbarCommands.QUOTE]=t.COMPOSE_METRIKA_WYSIWIG_QUOTE,o[l.ToolbarCommands.ALIGN]=t.COMPOSE_METRIKA_WYSIWIG_ALIGN,o[l.ToolbarCommands.ALIGN_LEFT]=t.COMPOSE_METRIKA_WYSIWIG_ALIGN_LEFT,o[l.ToolbarCommands.ALIGN_CENTER]=t.COMPOSE_METRIKA_WYSIWIG_ALIGN_CENTER,o[l.ToolbarCommands.ALIGN_RIGHT]=t.COMPOSE_METRIKA_WYSIWIG_ALIGN_RIGHT,o[l.ToolbarCommands.NUMBERED_LIST]=t.COMPOSE_METRIKA_WYSIWIG_NUMBERED_LIST,o[l.ToolbarCommands.BULLETED_LIST]=t.COMPOSE_METRIKA_WYSIWIG_BULLETED_LIST,o[l.ToolbarCommands.CLEAR_FORMAT]=t.COMPOSE_METRIKA_WYSIWIG_CLEAR_FORMAT,o),t.ABOOK_POPUP="Abook popup",t.ABOOK_POPUP_SHOW="show popup",t.ABOOK_POPUP_SHOW_FIELD_TITLE="on click on field title",t.ABOOK_POPUP_SHOW_SUGGEST='on click on "All contacts" in suggest',t.QUICK_REPLY="Quick Reply (new)";var f=[t.QUICK_REPLY,"click on"];t.QUICK_REPLY_CLICK_ON_CLOSE=u(f,["close"]),t.QUICK_REPLY_CLICK_ON_COMPOSE=u(f,["compose"]),t.QUICK_REPLY_CLICK_ON_RECIPIENTS=u(f,["recipients"])},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.BanReason=t.WorkModes=t.TimePresets=t.SuggestTypes=t.SmartSubjectType=t.Settings=t.SendError=t.ResolutionTypes=t.PromoTypes=t.Popups=t.Limits=t.LeaveTypes=t.InputTypes=t.FixedModes=void 0;var a=i(n(523));t.FixedModes=a;var s=i(n(524));t.InputTypes=s;var c=i(n(496));t.LeaveTypes=c;var u=i(n(497));t.Limits=u;var l=i(n(450));t.Popups=l;var p=i(n(525));t.PromoTypes=p;var f=i(n(526));t.ResolutionTypes=f;var d=i(n(498));t.SendError=d;var y=i(n(527));t.Settings=y;var b=i(n(528));t.SmartSubjectType=b;var m=i(n(529));t.SuggestTypes=m;var h=i(n(470));t.TimePresets=h;var v=i(n(530));t.WorkModes=v;var g=n(531);Object.defineProperty(t,"BanReason",{enumerable:!0,get:function(){return g.BanReason}})},function(e,t,n){"use strict";var r=n(338),o=(n.n(r),n(784)),i=n(1449),a=n(1456),s=n(1455),c=n(1457);t.a=r.PropTypes.shape({avatars:r.PropTypes.instanceOf(o.a),contactsFormatter:r.PropTypes.instanceOf(i.a),suggest:r.PropTypes.instanceOf(a.a),settings:r.PropTypes.instanceOf(s.a),limits:r.PropTypes.instanceOf(c.a)})},function(e,t,n){"use strict";var r=n(703),o=n(586),i=n(704),a=n(1062),s=n(1063);n.d(t,"a",function(){return s}),n.d(t,"c",function(){return r}),n.d(t,"d",function(){return i}),n.d(t,"b",function(){return a}),n.d(t,"e",function(){return o})},,,,function(e,t,n){"use strict";var r=n(338),o=(n.n(r),n(1079));t.a=r.PropTypes.shape({avatars:r.PropTypes.instanceOf(o.c),compose:r.PropTypes.instanceOf(o.e),contactsSuggest:r.PropTypes.instanceOf(o.u),settings:r.PropTypes.instanceOf(o.r),selfRecipient:r.PropTypes.instanceOf(o.p),messageBody:r.PropTypes.instanceOf(o.j),attachments:r.PropTypes.instanceOf(o.a)})},,function(e,t,n){"use strict";var r=n(2670);n.d(t,"a",function(){return r.a})},,,function(e,t,n){"use strict";var r=n(136),o=(n.n(r),n(338)),i=n.n(o),a=n(2677),s=n(2679),c=n(355),u=(n.n(c),n(1472));t.a=i.a.shape({isLocked:i.a.bool.isRequired,additionalAddressesAreExpanded:i.a.bool,contactsSuggest:a.a,currentPopup:i.a.oneOf([""].concat(function(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(Object(r.values)(c.Popups)))),diskResourcesPath:i.a.string,isDiskAvailable:i.a.bool,subjectsSuggest:u.b,translate:s.a,workMode:i.a.oneOf(Object(r.values)(c.WorkModes))})},function(e,t,n){"use strict";var r=n(394),o=n.n(r);n.d(t,"a",function(){return o.a})},,,,,,,,,,,,,function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderButtons=t.ComposeSizes=t.ComposeMode=void 0;var a=i(n(2623));t.ComposeMode=a;var s=i(n(2624));t.ComposeSizes=s;var c=i(n(2625));t.HeaderButtons=c},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(394)),i=function(){function e(e){var t=e.services,n=e.controllers,r=e.stores,i=e.environmentAdapter,a=e.visualState,s=e.data,c=e.validation,u=e.mailboxUid;this.services=t,this.controllers=n,this.stores=r,this.environmentAdapter=i,this.visualState=a,this.data=s,this.validation=c,this.mailboxUid=u,this._disposer=new o.default}return e.prototype.destroy=function(){this._disposer.disposeAll()},e}();t.default=i},,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useStores=void 0;var o=r(n(135)),i=n(342);t.useStores=function(){return o.default.useContext(i.MobXProviderContext)}},,,,,,,function(e,t,n){"use strict";n.d(t,"h",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"f",function(){return i}),n.d(t,"g",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"b",function(){return c}),n.d(t,"d",function(){return u}),n.d(t,"e",function(){return l});var r="blockquote",o="data-cke-role",i="placeholder",a="js-compose-Quote-Container",s="js-expand-quote",c="js-expand-all-quotes",u=10,l=1e4},,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"COUNTER_PREFIX",function(){return c}),n.d(t,"default",function(){return l});var r=n(136),o=(n.n(r),n(2568));function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var s=0,c="contact";function u(e){return e&&e.email}var l=function(){function e(t){var n=t.avatar,r=t.count,o=t.email,i=t.emailList,a=t.group,s=t.id,c=t.monogram,u=t.name,l=t.refer,p=t.isExternal;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.avatar=n,this.count=r,this.email=o,this.emailList=i,this.group=a,this.id=s,this.monogram=c,this.name=u,this.refer=l,this.isExternalFlag=Boolean(p)}return a(e,null,[{key:"of",value:function(t){var n=e.generateId(t),r=t.emailList||null,i=t.refer||t.ref||"",a=t.avatar||{},s=1,c=[],u=t.email||"",l=t.name||u,p=Boolean(t.contacts&&t.contacts.length);p&&(c=(t.contacts||[]).map(e.of),s=t.count||c.length,l=t.title,u=t.title);var f,d=t.monogram||Object(o.a)(l||u,p)||null;return a.valid?f=a:a.color?f={color:a.color,valid:!0,monogram:d}:p&&(f={color:"#f39718",valid:!0,monogram:d}),new e({avatar:f,count:s,email:u,emailList:r,group:c,id:n,monogram:d,name:l,refer:i,isExternal:Boolean(t.isExternal)})}},{key:"generateId",value:function(e){return e.id&&"string"==typeof e.id?e.id:e.cid?"cid"+e.cid:e.id&&e.id>0?"id"+e.id:e.tid?"tid"+e.tid:e.mcid?"mcid"+e.mcid:"".concat(c).concat(++s)}},{key:"isGroupContact",value:function(e){return Boolean(e&&e.isGroup&&e.isGroup())}},{key:"flattenContacts",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;return Object(r.flatten)(t.map(function(t){return e.isGroupContact(t)?e.flattenContacts(t.group,n):n(t)}))}}]),a(e,[{key:"setIsExternalFlag",value:function(e){this.isExternalFlag=e}},{key:"normalizeContact",value:function(){return this.isGroup()?this.group:[this]}},{key:"getId",value:function(){return this.id}},{key:"getSendInfo",value:function(){return this.normalizeContact().map(function(e){return e.name?'"'.concat(e.getSendName(),'" <').concat(e.email,">"):e.email}).join(", ")}},{key:"getSendName",value:function(){return this.name.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}},{key:"isGroup",value:function(){return(this.group||[]).length>0}},{key:"isLocal",value:function(){return/contact/.test(this.getId())}},{key:"isExternal",value:function(){return Jane.FormValidation.checkExternalEmail(this.email)}},{key:"isExternalContact",value:function(){return Daria.IS_CORP?Jane.FormValidation.checkExternalEmail(this.email):this.isExternalFlag}},{key:"isValid",value:function(){return this.isGroup()||Jane.FormValidation.checkEmail(this.email||"")}},{key:"toJSON",value:function(){return{avatar:this.avatar,count:this.count,email:this.email,emailList:this.emailList,group:this.group,id:this.id,monogram:this.monogram,name:this.name,refer:this.refer}}}]),e}()},function(e,t,n){"use strict";t.a=function(e,t){var n,r,a,l=function(n){var r=n.services,i=n.forwardedRef,a=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(n,["services","forwardedRef"]),s=r.settings.isMobile?t:e;return o.a.createElement(s,u({ref:i},a))},l=Object(i.inject)("services")(n=Object(i.observer)((a=r=l,r.propTypes={forwardedRef:s.a.object,services:c.a.isRequired},n=a))||n)||n;return o.a.forwardRef(function(e,t){return o.a.createElement(l,u({},e,{forwardedRef:t}))})};var r=n(135),o=n.n(r),i=n(342),a=n(338),s=n.n(a),c=n(356);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}},,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(420),o=n(2763),i=n(2765),a=(n.n(i),Object(r.a)(i.ControlPanelButton,o.a))},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TOO_MANY_SUBSCRIBERS=t.VALIDATION_ERROR=t.SEND_RETRYABLE_FAILED=t.SEND_FAILED=t.REMOVE_DRAFT=t.LIMITED_RECIPIENTS=t.EMPTY_SUBJECT=t.DISK_RESOURCES=t.CONTACTS_SUGGEST=t.CONFIRM_REMOVE=t.CHECKBOX_CAPTCHA=t.CAPTCHA=t.ATTACHMENTS_ERROR=void 0,t.ATTACHMENTS_ERROR="AttachmentsError",t.CAPTCHA="Captcha",t.CHECKBOX_CAPTCHA="CheckboxCaptcha",t.CONFIRM_REMOVE="ConfirmRemove",t.CONTACTS_SUGGEST="ContactsSuggest",t.DISK_RESOURCES="DiskResources",t.EMPTY_SUBJECT="EmptySubject",t.LIMITED_RECIPIENTS="LimitedRecipients",t.REMOVE_DRAFT="RemoveDraft",t.SEND_FAILED="SendFailed",t.SEND_RETRYABLE_FAILED="SendRetryableFailed",t.VALIDATION_ERROR="ValidationError",t.TOO_MANY_SUBSCRIBERS="TooManySubscribers"},,,,function(e,t,n){"use strict";t.a=function(e){return(e.innerText||"").replace(/[\n\r]/g,"")}},,,function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"d",function(){return o}),n.d(t,"b",function(){return i}),n.d(t,"e",function(){return a}),n.d(t,"a",function(){return s});var r=40,o="dir",i=60,a=200,s=200},function(e,t,n){"use strict";var r=n(2659);n.d(t,"a",function(){return r})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROMO_COMPOSE_SUGGEST_BEAUTIFUL_EMAIL=t.PROMO_COMPOSE_BEAUTIFUL_EMAIL=t.PROMO_REPLY_LATER=t.PROMO_ONBOARDING_BEAUTIFUL_EMAIL=t.PROMO_MAIL360_DISCOUNT=t.PROMO_OPT_IN_SUBS_POPUP=t.PROMO_GREETINGS_ONBOARDING=t.PROMO_BEAUTIFUL_EMAIL_CONNECTED=t.PROMO_AUTO_TOOLTIP=t.PROMO_AUTO_ONBOARDING=void 0,t.PROMO_AUTO_ONBOARDING="promo-auto-onboarding",t.PROMO_AUTO_TOOLTIP="promo-auto-tooltip",t.PROMO_BEAUTIFUL_EMAIL_CONNECTED="promo-domain-connected",t.PROMO_GREETINGS_ONBOARDING="promo-onboard-greet",t.PROMO_OPT_IN_SUBS_POPUP="promo-opt-in-popup",t.PROMO_MAIL360_DISCOUNT="promo-mail-360-discount",t.PROMO_ONBOARDING_BEAUTIFUL_EMAIL="promo-onboard-email",t.PROMO_REPLY_LATER="promo-reply-later",t.PROMO_COMPOSE_BEAUTIFUL_EMAIL="promo-compose-beautiful-email",t.PROMO_COMPOSE_SUGGEST_BEAUTIFUL_EMAIL="promo-compose-suggest-beautiful-email"},function(e,t,n){"use strict";var r=n(366);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a={cls:o.a.string,innerRef:o.a.object,isMobile:o.a.bool,isPopupVisible:o.a.bool,onMouseEnter:o.a.func,onMouseLeave:o.a.func,onClick:o.a.func,upload:o.a.func}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd",d:"M1.793 1.793a1 1 0 000 1.414L6.586 8l-4.793 4.793a1 1 0 101.414 1.414L8 9.414l4.793 4.793a1 1 0 001.414-1.414L9.414 8l4.793-4.793a1 1 0 00-1.414-1.414L8 6.586 3.207 1.793a1 1 0 00-1.414 0z"});t.default=function(e){return o.createElement("svg",i({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NEXT_WEEK=t.WEEKEND=t.TOMORROW=t.TODAY=void 0,t.TODAY="today",t.TOMORROW="tomorrow",t.WEEKEND="weekend",t.NEXT_WEEK="next week"},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Popups=t.ToolbarCommandsList=t.ToolbarCommands=t.ImageSources=t.HIGHEST_EVENT_PRIORITY=void 0;var s=a(n(674)),c=i(n(1012));t.ImageSources=c;var u=i(n(757));t.ToolbarCommands=u;var l=i(n(1013));t.Popups=l;var p=s.default(u);t.ToolbarCommandsList=p,t.HIGHEST_EVENT_PRIORITY=-100},,,,,,,,function(e,t,n){"use strict";t.a=function(e){if("number"!=typeof e.size&&e.file){var t=e.file;e.size="number"==typeof t.size?t.size:t.fileSize}return Number(e.size)}},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a={arrayOf:o.a.arrayOf}},,function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HumanFileSize=t.getLocString=t.UNIT_LOC_KEYS=void 0;var i=o(n(135)),a=n(800),s=o(n(353));t.UNIT_LOC_KEYS={bytes:"compose-react/FileSize_bytes",kilobytes:"compose-react/FileSize_kilobytes",megabytes:"compose-react/FileSize_megabytes",gigabytes:"compose-react/FileSize_gigabytes"};t.getLocString=function(e){var n=e.unit,r=e.value;return r&&n?s.default(t.UNIT_LOC_KEYS[n],{value:r}):null};var c=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return r(n,e),n.prototype.render=function(){var e=a.getSizeAndUnit(this.props.bytes);return t.getLocString(e)},n}(i.default.PureComponent);t.HumanFileSize=c},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o});var r="/disk/",o="/mail/"},function(e,t,n){"use strict";t.a=function(e,t){var n,r,i,s,C,w,T,k=e.PopupContent,A=e.cls,R=e.metrikaArgs,j=void 0===R?[]:R,M=e.directions,I=void 0===M?["top"]:M,D=e.title,L=e.options,N=void 0===L?{}:L,x=Object(l.inject)("services","visual")(n=Object(l.observer)((T=w=function(e){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;return _(e)}(this,O(n).call(this,e))).popupContentRef=o.a.createRef(),t.popupBoundaryRef=o.a.createRef(),t.contentKey=Date.now(),E(_(t),"isPopupVisible",i,_(t)),E(_(t),"closePopup",s,_(t)),E(_(t),"onClick",C,_(t)),t.onOutsideClick=function(e){!t.isPopupVisible||t.isMobile&&t.nodeRef.current.contains(e.target)||t.closePopup()},t._onAction=function(){t.props.onAction&&t.props.onAction(),t.closePopup()},t.nodeRef=e.innerRef||o.a.createRef(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(n,e),function(e,t,n){t&&g(e.prototype,t);n&&g(e,n)}(n,[{key:"componentDidMount",value:function(){this.popupBoundaryRef.current=!Object(b.hasFeature)(m.Features.REACT_LAYOUT)&&document.querySelector(".js-mail-App")?document.querySelector(".js-mail-App"):document.documentElement}},{key:"notifyPopupVisibilityChanged",value:function(){var e,t=this.props.onPopupVisibilityChanged;(t&&t(this.isPopupVisible),this.isPopupVisible)&&(e=this.metrikaService).sendFooterMetrika.apply(e,function(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(j))}},{key:"render",value:function(){var e=this.props,n=e.forwardedRef,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,["forwardedRef"]);return o.a.createElement(o.a.Fragment,null,o.a.createElement(t,h({ref:n},r,{innerRef:this.nodeRef,onClick:this.onClick,isPopupVisible:this.isPopupVisible})),this.renderPopup())}},{key:"renderPopup",value:function(){return o.a.createElement(d.a,h({className:c()(A,this.isMobile?"".concat(A,"_mobile"):"".concat(A,"_desktop")),anchor:this.nodeRef,onClose:this.onOutsideClick,scope:this.isMobile?this.containerRef:"inplace",visible:this.isPopupVisible,direction:I,title:D&&Object(y.default)(D),boundary:this.popupBoundaryRef,hasTail:!0},N,this.props.popupProps),this.renderPopupContent())}},{key:"renderPopupContent",value:function(){var e=this.props.contentOptions;return o.a.createElement(k,h({},e,{key:this.contentKey,ref:this.popupContentRef,onChange:this.updatePopupPosition,onAction:this._onAction,anchor:this.nodeRef,scope:this.nodeRef}))}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"containerRef",get:function(){return this.props.visual.refs.composeContainer}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}}]),n}(o.a.Component),w.propTypes={contentOptions:a.a.object,forwardedRef:a.a.object,innerRef:a.a.object,onClick:a.a.func,onPopupVisibilityChanged:a.a.func,popupProps:a.a.object,services:p.a.isRequired,visual:f.a.isRequired,onAction:a.a.func},r=T,i=P(r.prototype,"isPopupVisible",[u.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),P(r.prototype,"metrikaService",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"metrikaService"),r.prototype),P(r.prototype,"containerRef",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"containerRef"),r.prototype),P(r.prototype,"isMobile",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"isMobile"),r.prototype),s=P(r.prototype,"closePopup",[u.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isPopupVisible=!1,e.notifyPopupVisibilityChanged(),e.isMobile||e.containerRef.focus()}}}),C=P(r.prototype,"onClick",[u.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.isPopupVisible||(e.contentKey=Date.now()),e.isPopupVisible=!e.isPopupVisible,e.notifyPopupVisibilityChanged(),e.props.onClick&&e.props.onClick(t)}}}),n=r))||n)||n;function B(e,t){return o.a.createElement(x,h({},e,{forwardedRef:t}))}var F=t.displayName||t.name;return B.displayName=F?"withPopup(".concat(F,")"):"withPopup",o.a.forwardRef(B)};var r=n(135),o=n.n(r),i=n(338),a=n.n(i),s=n(339),c=n.n(s),u=n(341),l=n(342),p=n(356),f=n(366),d=n(544),y=n(353),b=n(16),m=n(400);n.n(m);function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function v(e){"@babel/helpers - typeof";return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function P(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}},,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SENT=t.DELETE=t.CLOSE=t.COLLAPSE=void 0,t.COLLAPSE="collapse",t.CLOSE="close",t.DELETE="delete",t.SENT="sent"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_SUGGEST_ITEMS_FOR_POPUP=void 0,t.MAX_SUGGEST_ITEMS_FOR_POPUP=3},,function(e,t,n){"use strict";var r=n(673);n.d(t,"a",function(){return r})},,,,,,,,,,,,function(e,t,n){"use strict";var r,o=n(458);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=(i(r={},o.a.DELAYED_SENDING,function(e){var t=e.data;return Boolean(t.sendTime)}),i(r,o.a.NOTIFICATIONS,function(e){return e.data.hasNotifications}),i(r,o.a.TEMPLATES,function(e){var t=e.data,n=e.visual;return t.isTemplate&&n.hasChanges}),r)},,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0;var r=n(340),o=n(141),i=n(403),a=n(440);t.Modal=r.compose(a.withPsTheme({source:i.DarkSource.Content}))(o.Modal)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NONE=t.SMALL=t.NORMAL=void 0,t.NORMAL="normal",t.SMALL="small",t.NONE="none"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INSERT_REPLACEMENT_TEXT=t.INSERT_MULTIPLE=t.INSERT_TEXT=t.INSERT_LINE_BREAK=t.INSERT_FROM_PASTE=t.DELETE_CONTENT_BACKWARD=t.DELETE_BY_CUT=void 0,t.DELETE_BY_CUT="deleteByCut",t.DELETE_CONTENT_BACKWARD="deleteContentBackward",t.INSERT_FROM_PASTE="insertFromPaste",t.INSERT_LINE_BREAK="insertLineBreak",t.INSERT_TEXT="insertText",t.INSERT_MULTIPLE="insertMultiple",t.INSERT_REPLACEMENT_TEXT="insertReplacementText"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NONE=t.NS_COMPOSE=t.AUTOCOMPLETE=void 0,t.AUTOCOMPLETE="Autocomplete",t.NS_COMPOSE="NsCompose",t.NONE="None"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DRAFT_NOT_SAVED=t.DRAFT_REMOVED=t.DRAFT_SAVED=t.NO_CHANGES=void 0,t.NO_CHANGES="no changes",t.DRAFT_SAVED="draft saved",t.DRAFT_REMOVED="draft removed",t.DRAFT_NOT_SAVED="draft not saved"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LOCK_DEFAULT_EMAIL=t.CAN_WRITE_LETTERS=t.TWO_SIZES_HEADER_PROMO=t.TIMELINE_EXPANDED=t.STORED_COMPOSE_STATES=t.SIZE_LAYOUT_LEFT=t.SIZE_LAYOUT=t.SIGNATURE_TOP=t.RECIPIENTS_DIFF_PROMO_CLOSED=t.NS_COMPOSE_PROMO_CLOSED=t.NUMBER_OF_AUTOSAVE_PROMO_SHOW=t.LAST_USED_COMPOSE_SIZE=t.FROM_NAME=t.DEFAULT_EMAIL=t.ENABLE_HOTKEYS=t.ENABLE_AUTOSAVE=t.EMPTY_SUBJECT_POPUP_DISABLED=t.DISABLE_AUTOCOMPLETE_REACT=t.SUGGEST_BEAUTIFUL_EMAIL_PROMO_CLOSED=t.BEAUTIFUL_EMAIL_PROMO_CLOSED=t.MUTE_AUTOSAVE_PROMO_UNTIL=void 0,t.MUTE_AUTOSAVE_PROMO_UNTIL="mute_autosave_promo_until",t.BEAUTIFUL_EMAIL_PROMO_CLOSED="beautiful_email_compose_promo",t.SUGGEST_BEAUTIFUL_EMAIL_PROMO_CLOSED="beautiful_email_compose_promo",t.DISABLE_AUTOCOMPLETE_REACT="disable_autocomplete_react",t.EMPTY_SUBJECT_POPUP_DISABLED="empty_subject_popup_disabled",t.ENABLE_AUTOSAVE="enable_autosave",t.ENABLE_HOTKEYS="enable_hotkeys",t.DEFAULT_EMAIL="default_email",t.FROM_NAME="from_name",t.LAST_USED_COMPOSE_SIZE="last_used_compose_size",t.NUMBER_OF_AUTOSAVE_PROMO_SHOW="number_of_autosave_promo_show",t.NS_COMPOSE_PROMO_CLOSED="ns_compose_promo_closed",t.RECIPIENTS_DIFF_PROMO_CLOSED="kukutz-promo-closed",t.SIGNATURE_TOP="signature_top",t.SIZE_LAYOUT="size-view-app",t.SIZE_LAYOUT_LEFT="size-layout-left",t.STORED_COMPOSE_STATES="storedComposeStates",t.TIMELINE_EXPANDED="timeline-is-open",t.TWO_SIZES_HEADER_PROMO="two_sizes_header_promo",t.CAN_WRITE_LETTERS="can_write_letters",t.LOCK_DEFAULT_EMAIL="lock_employees_default_mail_domain"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.POPUP=t.INPUT=void 0,t.INPUT="line",t.POPUP="popup"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QUERY=t.POPULAR=void 0,t.POPULAR="popular",t.QUERY="query"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BACKGROUND=t.FOREGROUND=void 0,t.FOREGROUND="foreground",t.BACKGROUND="background"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BanReason=void 0,function(e){e.RfcFail="RfcFail",e.UrlRbl="UrlRbl",e.BadKarma="BadKarma",e.MailLimits="MailLimits",e.PddAdminKarma="PddAdminKarma",e.Bounces="Bounces",e.SpamCompl="SpamCompl"}(t.BanReason||(t.BanReason={}))},function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return i}),n.d(t,"c",function(){return s});var r=n(499),o=function(){return!Daria.isReactiveCompose()},i=function(){var e=a();return!ns.Model.get("settings").isSet(e)?Daria.isReactiveCompose()?r.a.REACT:r.a.NOSCRIPT:r.a.NONE},a=function(){return Daria.isReactiveCompose()?"disable_autocomplete_react":"disable_compose_autocomplete"},s=function(){var e=i();return Daria.isReactiveCompose()?e===r.a.REACT:Daria.isReactiveCompose()?null:e===r.a.NOSCRIPT}},,,,,function(e,t,n){"use strict";t.a=function(e,t){e&&e.parentNode&&t&&e.parentNode.replaceChild(t,e)}},,,,,,,function(e,t,n){"use strict";var r=n(420),o=n(1477),i=(n.n(o),n(2777));t.a=Object(r.a)(o.Popup,i.a)},function(e,t,n){"use strict";t.a=function(e,t){var n,r,o,a,E,P,C,w,T=Object(u.observer)((w=C=function(e){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){if(t&&("object"===b(t)||"function"==typeof t))return t;return v(e)}(this,h(n).call(this,e))).popupBoundaryRef=i.a.createRef(),_(v(t),"isHovered",o,v(t)),_(v(t),"isPopupVisible",a,v(t)),_(v(t),"setIsHovered",E,v(t)),_(v(t),"onPopupVisibilityChanged",P,v(t)),t.nodeRef=e.innerRef||i.a.createRef(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(n,e),function(e,t,n){t&&m(e.prototype,t);n&&m(e,n)}(n,[{key:"componentDidMount",value:function(){this.popupBoundaryRef.current=!Object(f.hasFeature)(d.Features.REACT_LAYOUT)&&document.querySelector(".js-mail-App")?document.querySelector(".js-mail-App"):document.documentElement}},{key:"render",value:function(){var e=this,n=this.props,r=n.forwardedRef,o=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(n,["forwardedRef"]);return i.a.createElement(i.a.Fragment,null,i.a.createElement(t,y({ref:r,innerRef:this.nodeRef,onMouseEnter:function(){return e.setIsHovered(!0)},onMouseLeave:function(){return e.setIsHovered(!1)},onPopupVisibilityChanged:this.onPopupVisibilityChanged},o)),this.renderTooltip())}},{key:"renderTooltip",value:function(){return O(l.Tooltip,{direction:"top",view:"default",size:"s",state:"warning",anchor:this.nodeRef,visible:this.isTooltipVisible,boundary:this.popupBoundaryRef},void 0,O(p.default,{loc:this.props.tooltipKey}))}},{key:"isTooltipVisible",get:function(){return this.isHovered&&!this.isPopupVisible}}]),n}(i.a.Component),C.propTypes={forwardedRef:s.a.object,innerRef:s.a.oneOfType([s.a.object,s.a.func]),tooltipKey:s.a.string},C.defaultProps={tooltipKey:e},r=w,o=S(r.prototype,"isHovered",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=S(r.prototype,"isPopupVisible",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),S(r.prototype,"isTooltipVisible",[c.computed],Object.getOwnPropertyDescriptor(r.prototype,"isTooltipVisible"),r.prototype),E=S(r.prototype,"setIsHovered",[c.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.isHovered=t}}}),P=S(r.prototype,"onPopupVisibilityChanged",[c.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.isPopupVisible=t}}}),n=r))||n;function k(e,t){return i.a.createElement(T,y({},e,{forwardedRef:t}))}var A=t.displayName||t.name;return k.displayName=A?"withTooltip(".concat(A,")"):"withTooltip",i.a.forwardRef(k)};var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(341),u=n(342),l=n(767),p=(n.n(l),n(344)),f=n(16),d=n(400);n.n(d);function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function b(e){"@babel/helpers - typeof";return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function _(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function S(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}},function(e,t,n){"use strict";n.d(t,"a",function(){return L});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(356),h=n(366),v=n(719),g=n.n(v),O=n(393),_=n(360),S=n(376),E=n.n(S),P=n(3011);n.n(P);function C(e){"@babel/helpers - typeof";return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var j=p.a.oneOfType([p.a.element,p.a.string]),M="ComposeConfirmPopup",I={Block:M,Block_mobile:"".concat(M,"_mobile"),Block_tablet:"".concat(M,"_tablet"),Block_desktop:"".concat(M,"_desktop"),Content:"".concat(M,"-Content"),Title:"".concat(M,"-Title"),Description:"".concat(M,"-Description"),Toolbar:"".concat(M,"-Toolbar"),Button:"".concat(M,"-Button"),Button_action:"".concat(M,"-Button_action"),Button_cancel:"".concat(M,"-Button_cancel"),Close:"".concat(M,"-Close"),CheckmarkSection:"".concat(M,"-CheckmarkSection")},D=R(_.default,{id:"mail--Compose-ClosePopup"}),L=Object(b.inject)("services","visual")(r=Object(b.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=T(this,(e=k(t)).call.apply(e,[this].concat(o))))._onKeyDown=function(e){if(n.props.visible){var t=!1;switch(e.keyCode){case E.a.ENTER:n.props.onAction&&(n.props.onAction(),t=!0)}t&&e.stopPropagation&&e.stopPropagation()}},n.onClose=function(e,t){"esc"===t&&n.props.onClose&&n.props.onClose(e)},n._onCheckmarkChange=function(e){n.props.onCheckmarkChange(e.target.checked)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,u.a.Component),function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this._onKeyDown,!0),window.oneOf=p.a.oneOf}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this._onKeyDown,!0)}},{key:"render",value:function(){var e=this.props,t=e.services,n=e.visible,r=e.Title,o=e.Description,i=e.cls;if(!this.shouldRender&&!n)return!1;this.shouldRender=!0;var a=d()(I.Block,t.settings.isMobile?I.Block_mobile:I.Block_desktop,i,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},I.Block_tablet,t.settings.isTablet));return R(g.a,{cls:a,visible:n,onClose:this.onClose},void 0,R("div",{className:I.Content},void 0,this.maybeRenderCloseButton(),R("div",{className:I.Title},void 0,r),R("div",{className:I.Description},void 0,o),R("div",{className:I.Toolbar},void 0,this.maybeRenderConfirmButton(),this.maybeRenderCancelButton()),this.maybeRenderCheckmark()))}},{key:"maybeRenderCloseButton",value:function(){var e=this.props.onClose;return e?R(O.a,{cls:I.Close,theme:"clear",view:"default",tone:"default",size:"xs",onClick:e},void 0,D):null}},{key:"maybeRenderConfirmButton",value:function(){var e=this.props,t=e.onAction,n=e.ActionText;return t?R(O.a,{cls:d()(I.Button,I.Button_action),theme:"action",size:"m",onClick:t},void 0,n):null}},{key:"maybeRenderCancelButton",value:function(){var e=this.props,t=e.onCancel,n=e.CancelText;return t?R(O.a,{cls:d()(I.Button,I.Button_cancel),theme:"normal",tone:"default",view:"default",size:"m",onClick:t},void 0,n):null}},{key:"maybeRenderCheckmark",value:function(){var e=this.props,t=e.onCheckmarkChange,n=e.CheckmarkText,r=e.checkmarkValue;return t?R("div",{className:I.CheckmarkSection},void 0,R("label",{},void 0,R("input",{type:"checkbox",checked:r,onChange:this._onCheckmarkChange}),R("span",{},void 0,n))):null}},{key:"composeContainerRef",get:function(){return this.props.visual.refs.composeContainer}}]),t}(),i.propTypes={cls:p.a.string,ActionText:j.isRequired,CancelText:j,Description:j.isRequired,Title:j,onAction:p.a.func.isRequired,onCancel:p.a.func,onClose:p.a.func,visible:p.a.bool,onCheckmarkChange:p.a.func,CheckmarkText:j,checkmarkValue:p.a.bool,services:m.a.isRequired,visual:h.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"composeContainerRef",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeContainerRef"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";var r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useRemoveAddressesAndSend=t.useRecipients=t.getRecipientsCountLocalString=t.getAddressesCountLocalString=t.formatNumber=t.ERRORS_TO_SHOW=void 0;var i=n(135),a=n(341),s=n(350),c=n(397),u=n(3033),l=o(n(353)),p=n(355),f=n(354);t.ERRORS_TO_SHOW=[p.SendError.TOO_MANY_SUBSCRIBERS,p.SendError.MAX_EMAIL_ADDRESS_REACHED,p.SendError.MAILING_LIST_NOT_ALLOWED];t.formatNumber=function(e){return e.toLocaleString(s.getLocale())};t.getAddressesCountLocalString=function(e){return l.default("compose-react/TooManySubscribers_AddressesCount",{count:e,formatted:t.formatNumber(e)})};t.getRecipientsCountLocalString=function(e){return l.default("compose-react/TooManySubscribers_RecipientsCount",{count:e,formatted:t.formatNumber(e)})};t.useRecipients=function(){var e=c.useStores().validation.sendError,n=r(i.useState([]),2),o=n[0],a=n[1];i.useEffect(function(){(null===e||void 0===e?void 0:e.error)&&t.ERRORS_TO_SHOW.includes(e.error)&&a((null===e||void 0===e?void 0:e.recipients)||[])},[e]);var s=i.useMemo(function(){return o.filter(function(e){return e.type===u.RecipientType.MailingList})},[o]);return{all:o,mailingLists:s}};t.useRemoveAddressesAndSend=function(){var e=c.useStores(),t=e.controllers,n=t.saveSend,r=t.visual,o=e.services.metrika,s=e.data;return i.useCallback(function(e){e.length&&(a.runInAction(function(){s.addresses.to=s.addresses.to.filter(function(t){var n=t.email;return!e.includes(n)}),s.addresses.cc=s.addresses.cc.filter(function(t){var n=t.email;return!e.includes(n)}),s.addresses.bcc=s.addresses.bcc.filter(function(t){var n=t.email;return!e.includes(n)})}),r.closeCurrentPopup(),n.sendMessage(),o.sendPopupsMetrika(f.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS,f.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS_REMOVE_AND_SEND))},[s.addresses,o,n,r])}},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";t.b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=function(e,t){for(var n=!1,r=0;r<e.childNodes.length;r++){var o=e.childNodes[r],i=l(o);if(i&&(n=!n),!n&&!i){var a=c(o,t),s=a.isMatch,u=a.targetMatch;if(s)return{idx:r,targetMatch:u}}}return{idx:-1,targetMatch:null}}(e,t),r=n.idx,o=n.targetMatch;if(r<0)return null;for(var i={current:r,prev:r},a=!1,s=!1,f=r+1;f<e.childNodes.length;f++){var d=e.childNodes[f];if(u(d)){a=!0;break}if(l(d))break;if("#text"===d.nodeName)break;if((d.outerText||"").trim().startsWith("----------------"))break;(s=p(d))||(i.prev=i.current,i.current=f)}s&&i.prev++;o&&o.leadingLineBreaks>0&&function(e,t){for(;t--;)if(!(e=e.previousElementSibling)||!p(e))return!1;return!0}(e.childNodes[r],o.leadingLineBreaks)&&(r-=o.leadingLineBreaks);return{node:e,start:r,finish:a?i.prev:i.current,targetMatch:o}},t.c=function(e){for(;e.childNodes.length;){var t=e.childNodes[e.childNodes.length-1];if(!p(t))break;e.removeChild(t)}},t.a=function(e){for(var t=-1,n=-1,r=0;r<e.childNodes.length;r++){var o=e.childNodes[r];if(l(o)){if(-1===t){t=r;continue}n=r;break}}if(-1===t||-1===n)return null;return{node:e,start:t,finish:n}};var r=n(454),o=n(404),i="IMG",a=/^--------[^\-]+.*--------$/,s=/^--\s?$|^--\s/;function c(e,t){if(u(e))return{isMatch:!1,targetMatch:null};var n=Daria.Html2Text.html2text(e.innerHTML);n&&(n=n.replace(/^[\n\r]+/g,""));var r=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done);r=!0){var l=a.value;if(l.match&&new RegExp("^"+l.match).test(n))return{isMatch:!0,targetMatch:l}}}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return s.test(n)?{isMatch:!0,targetMatch:null}:{isMatch:!1,targetMatch:null}}function u(e){return(e.tagName||"").toUpperCase()===o.h.toUpperCase()}function l(e){var t=Object(r.a)(e);return a.test(t)}function p(e){return!(Object(r.a)(e).trim()||(e.tagName||"").toUpperCase()===i||e.getElementsByTagName&&0!==e.getElementsByTagName(i).length)}},function(e,t,n){"use strict";t.a=function(e){if(!e)return 0;var t=Array.prototype.slice.call(e.getElementsByTagName(r.h)).map(function(e){return e.parentNode}),n=Object(o.uniq)(t).length;return e.tagName.toLowerCase()===r.h.toLowerCase()?n+1:n};var r=n(404),o=n(136);n.n(o)},,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(137);n.n(r);function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,[{key:"getPageAfterSent",value:function(){return Daria.isReactiveCompose()&&Daria.IS_CORP||Daria.is3pane()?"prev":ns.Model.get("settings").getSetting("page_after_send")}},{key:"whereToGoAfterSend",value:function(){var e,t=ns.Model.get("folders");switch(this.getPageAfterSent()){case"sent_list":e=ns.router.generateUrl("messages",{current_folder:t.getFidBySymbol(r.WellKnownFolderSymbol.SENT)});break;case"current_list":e=ns.page.history.getPreviousPageUrl({match:"messages"});break;case"prev":e=ns.page.history.getPreviousPageUrl({mismatch:"compose2"})}e||(e=ns.router.generateUrl("messages",{current_folder:t.getFidBySymbol(r.WellKnownFolderSymbol.INBOX)}));return e}},{key:"showMessageSentNotification",value:function(e){var t=e.sentMid,n=e.wasSendCancelled,r=e.withUndo,o=e.isDelayed,i=e.sendTime;if(n)return!1;var a={};if(r){var s=Daria.SendMail.getUndoSendLogger(t);a.onClose=function(){s.logClose()},a.onCancel=function(){s.logCancel()}}return o?Daria.SendMail.showMessageSentDelayed(t,i,a):Daria.SendMail.showMessageSent(t,a),!0}},{key:"sendMetrika",value:function(){Jane.Metrika.counter&&Jane.Metrika.counter.reachGoal("SEND")}},{key:"leaveCompose",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.clearPageBlock,r=t.neverReturn;n&&ns.page.block.clear();var o=this.pageGoUrl||ns.page.history.getPreviousPageUrl({mismatch:"compose2"})||ns.page.HOME_HASH,i=ns.router(o);i.page===ns.R.REDIRECT&&(i=ns.router(i.redirect)),i.params=_.omit(i.params,"_cuid");var a=_.delay(function(){Jane.ErrorLog.send({event:"after_send_wait_10_sec"})},1e4),s=_.delay(function(){Jane.ErrorLog.send({event:"after_send_wait_20_sec"}),ns.page.go(ns.page.HOME_HASH)},2e4),c=ns.router.generateUrl(i.page,i.params);return ns.page.go(c,r?"replace":null).fail(function(t){return e.handleLeaveComposeFail(c,t)}).always(function(e){return window.clearTimeout(a),window.clearTimeout(s),e})}},{key:"handleLeaveComposeFail",value:function(e,t){var n=this,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t,{event:"compose_leave_failed",loadingHash:e});return Jane.ErrorLog.send(r),this.handleTransitionFail(t,function(e,t){return ns.page.go(t).fail(n.handleTransitionFail)},[ns.page.HOME_HASH])}},{key:"handleTransitionFail",value:function(e,t,n){if(t=t||Vow.reject,n=Array.isArray(n)?n:[],"expired"!==(e&&e.error)){var r=t.apply(null,[e].concat(o(n)));return r instanceof Vow.Promise?r:Vow.reject(r)}return Vow.resolve(e)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"UNKNOWN",function(){return r}),n.d(t,"FILE_LIMIT",function(){return o}),n.d(t,"TOTAL_LIMIT",function(){return i}),n.d(t,"YADISK_ERROR",function(){return a}),n.d(t,"VIRUS",function(){return s}),n.d(t,"DISK_FULL",function(){return c}),n.d(t,"STATUS_DISK_FULL",function(){return u}),n.d(t,"DISK_TRAFFIC_LIMIT",function(){return l}),n.d(t,"DISK_TECHNICAL_WORK",function(){return p});var r=0,o=1,i=2,a=6,s=106,c=85,u=507,l=311,p=312},function(e,t,n){"use strict";var r=n(136);n.n(r);t.a=function(e){return e.id||e.hid&&e.hid.replace(/\./g,"-")||Object(r.uniqueId)("attach-")}},,function(e,t,n){"use strict";n.d(t,"d",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"i",function(){return i}),n.d(t,"h",function(){return a}),n.d(t,"f",function(){return s}),n.d(t,"g",function(){return c}),n.d(t,"e",function(){return u}),n.d(t,"b",function(){return l}),n.d(t,"c",function(){return p});var r="compose-have-opened",o="captcha-have-shown",i="SSItemsShow",a="SSItemClick",s="sending-has-been-triggered",c="sending-have-failed",u="delayed-sending-have-failed",l="changed-size-to-small",p="changed-size-to-large"},function(e,t,n){"use strict";var r=n(136),o=(n.n(r),n(338)),i=n.n(o),a=n(2674),s=n(357);t.a=i.a.shape({info:a.a.isRequired,status:i.a.oneOf(Object(r.values)(s.c)).isRequired,errorCode:i.a.oneOf(Object(r.values)(s.e)),previewSupported:i.a.bool.isRequired,progress:i.a.number,visual:i.a.object,source:i.a.oneOf(Object(r.values)(s.b))})},,,,function(e,t,n){"use strict";var r=n(2862);n.d(t,"a",function(){return r.a});var o=n(2896);n.d(t,"b",function(){return o.a});n(1508);var i=n(2898);n.d(t,"c",function(){return i.a});n(427);var a=n(710),s=n.n(a);n.d(t,"d",function(){return s.a});var c=n(2899);n.d(t,"e",function(){return c.a});var u=n(1473);n.d(t,"f",function(){return u.a});n(1509),n(711)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"NOSCRIPT",function(){return r}),n.d(t,"NONE",function(){return o}),n.d(t,"REACT",function(){return i});var r="noscript",o="none",i="react"},,,,,,,,function(e,t,n){"use strict";t.a=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},function(e,t,n){"use strict";t.a=function(e,t){if(!e)return null;var n=Array.prototype.slice.call(e.getElementsByTagName(r.h)).filter(function(t){var n=function(e){var t=e&&e.parentNode;for(;t;){if(t.tagName.toUpperCase()===r.h.toUpperCase())return t;t=t.parentNode}return null}(t);return!n||n===e}).map(function(e){return{quote:e,weight:function(e){var t=e.getAttribute(s);if(!t){var n=Object(a.a)(e),r=Object(o.a)(e).length;t=1e4*n+r,e.setAttribute(s,t)}return t}(e)}}).sort(function(e,t){return e.weight-t.weight}),c=null;n.length&&(c=n[n.length-1].quote,Object(i.a)(c,t));return c};var r=n(404),o=n(454),i=n(537),a=n(571),s="data-weight"},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(1060);n.d(t,"a",function(){return r.a});n(585);var o=n(779);n.d(t,"b",function(){return o.a});var i=n(780);n.d(t,"c",function(){return i.a})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"NEW",function(){return r}),n.d(t,"UPLOADING",function(){return o}),n.d(t,"COMPLETED",function(){return i}),n.d(t,"FAILED",function(){return a}),n.d(t,"VIRUS",function(){return s}),n.d(t,"ABORTED",function(){return c}),n.d(t,"RESTRICTED",function(){return u});var r=0,o=1,i=2,a=3,s=4,c=5,u=6},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"FILE",function(){return r}),n.d(t,"YADISK",function(){return o}),n.d(t,"FORWARDED_MAIL",function(){return i});var r="simple",o="narod",i="forwarded"},function(e,t,n){"use strict";t.a=function(e,t){var n=t.handlerName,r=t.isOk,o=t.errorCode;Daria.monitoring.workflow.attachToDisk({params:{size:e&&e.size,checkLimit:!0},handler:n,status:r?"success":"error",errorCode:o})}},function(e,t,n){"use strict";t.a=function(e,t){e.upload&&e.upload.addEventListener("progress",function(e,n){e&&e.lengthComputable&&(n=e.loaded/e.total*100),n=parseInt(n,10),n=isNaN(n)?-1:n,t(n)},!1)}},function(e,t,n){"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=function(e){!function(e){if(!e.mid)return;var t=function(e){if(!e.mid||!e.from_template)return e;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{mid:e.template_mid,hid:e.template_hid})}(e);e.previewHref=Daria.url.attachment(t,e.mid,{no_disposition:!0}),e.previewSrc=Daria.url.attachment(t,e.mid,{no_disposition:!0,thumb:!0})}(e),function(e){if(!e.narodPreview)return;e.previewSrc=e.narodPreview,e.previewHref=e.narodUrl||e.narodPreview}(e)}},,,function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(339)),i=r(n(135)),a=r(n(344)),s=n(138);n(2680);t.default=function(e){var t=e.cls,n=e.fieldId,r=e.title,c=e.onTitleClick,u=e.onClickCapture,l=e.contentClass,p=e.contentRef,f=e.children,d=e.getRef,y=o.default("compose-LabelRow-Content",l);return i.default.createElement("div",{className:o.default(t,"compose-LabelRow"),onClickCapture:u,ref:d},i.default.createElement(s.Text,{className:"compose-LabelRow-Label",typography:"body-long-m",color:"secondary",onMouseDown:c,htmlFor:n,as:"label"},i.default.createElement(a.default,{loc:r})),i.default.createElement("div",{className:y,ref:p},f))}},function(e,t,n){"use strict";n.d(t,"a",function(){return S});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(138),p=(n.n(l),n(353)),f=n(2682);n.n(f);function d(e){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var O="ComposeYabble",_={Block:O,Block_invalid:"".concat(O,"_invalid"),Block_editable:"".concat(O,"_editable"),Block_uneditable:"".concat(O,"_uneditable"),Block_external:"".concat(O,"_external"),Avatar:"".concat(O,"-Avatar"),Text:"".concat(O,"-Text"),RemoveIconWrapper:"".concat(O,"-RemoveIconWrapper")},S=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=m(this,(e=h(t)).call.apply(e,[this].concat(o)))).onMouseDown=function(e){n.props.onMouseDown&&n.props.onMouseDown(e)},n.onClick=function(e){n.props.onClick&&n.props.onClick(e)},n.onRemove=function(e){e.preventDefault(),e.stopPropagation(),n.props.onRemove&&n.props.onRemove(e)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,i.a.Component),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"maybeRenderAvatar",value:function(e){if(!e)return null;var t=this.props.AvatarComponent;return t&&e.isValid()?g("div",{className:_.Avatar},void 0,g(t,{contact:e})):null}},{key:"maybeRenderRemoveIcon",value:function(){return this.props.isEditable?g("div",{className:_.RemoveIconWrapper,onClick:this.onRemove,role:"button","aria-label":Object(p.default)("compose-react/deleteLabel")},void 0,this.props.removeIcon):null}},{key:"render",value:function(){var e,t=this.props,n=t.nodeRef,r=t.isEditable,o=t.getContact,a=t.children,s=t.ContentComponent,c=t.className,p=o(),f=p?p.isValid():this.props.isValid,d=p&&p.isExternal(),b=u()(c,_.Block,(y(e={},_.Block_invalid,!f),y(e,_.Block_editable,r),y(e,_.Block_uneditable,!r),y(e,_.Block_external,d),e));return i.a.createElement("div",{ref:n,className:b,onMouseDown:this.onMouseDown,onClick:this.onClick,contentEditable:"false",suppressContentEditableWarning:!0},this.maybeRenderAvatar(p),g(l.Text,{as:"div",typography:"body-short-m",className:_.Text,spellCheck:"false",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"},void 0,g(s,{contact:p})),this.maybeRenderRemoveIcon(),a)}}]),t}();S.propTypes={className:s.a.string,nodeRef:s.a.object,isEditable:s.a.bool,isValid:s.a.bool,onRemove:s.a.func,onClick:s.a.func,onMouseDown:s.a.func,AvatarComponent:s.a.elementType,ContentComponent:s.a.elementType.isRequired,removeIcon:s.a.element,getContact:s.a.func},S.defaultProps={getContact:function(){return null}}},,,,,function(e,t,n){"use strict";var r=n(338),o=n.n(r),i=n(361),a=n(363),s=n(356),c=n(366);t.a={cls:o.a.string,controllers:i.a.isRequired,data:a.a.isRequired,services:s.a.isRequired,visual:c.a.isRequired}},,function(e,t,n){"use strict";var r=n(338),o=(n.n(r),n(480)),i=n(2822);t.a=r.PropTypes.shape({errors:o.a.arrayOf(i.a)})},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0;var a=i(n(135)),s=i(n(339)),c=n(342),u=n(522),l=n(141),p=n(397);n(1120);var f={Block:"ComposeModal",Block_mobile:"ComposeModal_mobile",Block_tablet:"ComposeModal_tablet",Block_desktop:"ComposeModal_desktop",Block_fullscreen:"ComposeModal_fullscreen"};t.Modal=c.observer(function(e){var t,n=e.fullscreen,i=e.cls,c=e.className,d=o(e,["fullscreen","cls","className"]),y=p.useStores().services,b=s.default(i,c,f.Block,y.settings.isMobile?f.Block_mobile:f.Block_desktop,((t={})[f.Block_fullscreen]=n,t[f.Block_tablet]=null===y||void 0===y?void 0:y.settings.isTablet,t)),m=y.settings.isMobile?l.Modal:u.Modal;return a.default.createElement(m,r({className:b,theme:"normal"},d))}),t.default=t.Modal},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(3020),t)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INLINE_IMAGE_URL=t.INLINE_IMAGE_LOCAL=t.INLINE_IMAGE=t.CLEAR_FORMAT=t.BULLETED_LIST=t.NUMBERED_LIST=t.ALIGN_RIGHT=t.ALIGN_CENTER=t.ALIGN_LEFT=t.ALIGN=t.QUOTE=t.REMOVE_LINK=t.ADD_LINK=t.EMOJI=t.BACKGROUND_COLOR=t.TEXT_COLOR=t.FONT_SIZE=t.FONT=t.STRIKETHROUGH=t.UNDERLINE=t.ITALIC=t.BOLD=t.REDO=t.UNDO=void 0,t.UNDO="undo",t.REDO="redo",t.BOLD="bold",t.ITALIC="italic",t.UNDERLINE="underline",t.STRIKETHROUGH="strike",t.FONT="mailfont",t.FONT_SIZE="mailfontsize",t.TEXT_COLOR="mailtextcolor",t.BACKGROUND_COLOR="mailbgcolor",t.EMOJI="emoticons",t.ADD_LINK="link",t.REMOVE_LINK="unlink",t.QUOTE="blockquote",t.ALIGN="menualignment",t.ALIGN_LEFT="justifyleft",t.ALIGN_CENTER="justifycenter",t.ALIGN_RIGHT="justifyright",t.NUMBERED_LIST="numberedlist",t.BULLETED_LIST="bulletedlist",t.CLEAR_FORMAT="removeFormat",t.INLINE_IMAGE="inlineImage",t.INLINE_IMAGE_LOCAL="inlineImageLocal",t.INLINE_IMAGE_URL="inlineImageUrl"},,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tooltip=void 0;var r=n(150),o=n(373),i=n(148),a=n(349);t.Tooltip=a.hasFeature(a.Features.WEB_DARK_COMPOSE)?r.Tooltip:i.withStaticTheme(o.PS_LIGHT)(r.Tooltip)},,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(137);n.n(r);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(e,[{key:"updateDraftAfterAction",value:function(e,t){if(t){var n=ns.Model.get("message",{ids:t});if(!e){ns.Model.traverse("messages",function(e){return e.remove(n)});var o=n.getThreadMessage();o&&o.hasRealData()&&o.updateThreadCount(-1)}var i=function(e){return e.isValid()&&e.params.ids===t};ns.Model.invalidate("message",i),ns.Model.invalidate("message-body",i),this.updateFolders(r.DraftLikeFoldersShort)}}},{key:"updateFolders",value:function(e){var t=Array.isArray(e)?e:[e],n=ns.Model.get("folders");return t.forEach(function(e){var t=n.getFidBySymbol(e);Daria.messages.clearCacheByFID(t)}),ns.forcedRequest(["folders","labels"]).then(function(){ns.router.buildFoldersUrls()})}},{key:"updateTemplateAfterAction",value:function(e){if(this.updateFolders(r.DraftTemplateLikeFoldersShort),e){var t=ns.Model.get("folders").getFidBySymbol(r.WellKnownFolderSymbol.TEMPLATE);ns.Model.get("message",{ids:e}).setIfChanged(".fid",t);var n=function(t){return t.isValid()&&t.params.ids===e};ns.Model.invalidate("message",n),ns.Model.invalidate("message-body",n)}}},{key:"updateMessageFlagsAfterSend",value:function(e,t){var n=t.isForward,r=t.isReply,o=t.replyMessageId;if(e&&e.length){var i=function(t){return e.forEach(function(e){return t(ns.Model.get("message",{ids:e}))})};n&&i(function(e){return e.markForwarded()}),r&&i(function(e){return e.markAnswered()}),ns.Model.invalidate("message-in-reply-to-ng",function(e){return e.params.message_id===o})}}},{key:"resetCheckedMessages",value:function(){"message"!==ns.page.current.page&&(ns.Model.get("messages-checked").resetChecked(),ns.events.trigger("daria:vToolbarButton:restruct",{force:!0}))}},{key:"updateOutboxAfterAction",value:function(){this.updateFolders([r.WellKnownFolderSymbol.OUTBOX])}}]),e}()},function(e,t,n){"use strict";t.a=function(e){return Boolean(e.inreplyto)?{initial_to:e.to,initial_cc:e.cc}:{}}},function(e,t,n){"use strict";t.a=function(e){return function(t){return e*(Math.sqrt(t)/(1+Math.sqrt(t)))}}},function(e,t,n){"use strict";var r=n(1446),o=n.n(r),i=n(703),a=n(586),s=n(704),c=n(136);n.n(c);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){p(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.status,r=t.previewSupported,u=e.id,p=e.name,f=e.folder,d=e.size,y=e.stid,b=e.message,m=e.type;if(m===s.FORWARDED_MAIL)return{id:u,name:p,icon:"eml",class:"mail"};var h=Daria.splitName(p),v={id:u,name:p,"name-uri-encoded":e["name-uri-encoded"],filename:h[0],fileext:h[1]?"."+h[1]:"",class:e.class,folder:f,"browser-supports":e["browser-supports"],length:d,status:n,errorCode:n===i.VIRUS?a.VIRUS:void 0,stid:y||void 0,icon:e.extension&&e.extension.icon||void 0,external_transformer:e.external_transformer,external_transformer_filetype:e.external_transformer?e.external_transformer_filetype:void 0,message:Boolean(b)||void 0,narod:m===s.YADISK||void 0},g=l({},Object(c.omit)(v,function(e){return void 0===e}),{},function(e){return function(e){var t=e.narodUrl,n=e.url;return t||n?{url:t||n}:null}(e)||function(e){var t=e.mid,n=e.hid,r=e.bid;return t&&n?{mid:t,hid:n,bid:r}:null}(e)||function(e){return e.from_template?{mid:e.template_mid,hid:e.template_hid}:null}(e)||{uploading:!0}}(e),{},function(e,t){return t?{"preview-supported":!0,"preview-src":e.previewSrc||!1,"preview-href":e.previewHref||!1}:{}}(e,r));return l({},g,{},function(e,t){if(function(e){return!!(e.external_transformer&&e.mid&&e.fileext)&&(o()(null,e.fileext.slice(1).toLowerCase())||o()(null,e.fileext.slice(1).toLowerCase(),!0))}(e))return{url:Daria.url.docviewer(e,e.mid)};if(e.narodUrl||e.url)return{url:e.narodUrl||e.url};if(t===i.COMPLETED)return{url:Daria.url.attachment(e,e.mid)};return{}}(g,n))}},function(e,t,n){"use strict";var r=n(136),o=(n.n(r),n(587)),i=n(357),a=n(707),s=n(1073);t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"mail"===e.class&&"eml"!==Daria.getExtension(Object(r.unescape)(e.name))&&(e.name+=".eml"),e.id=Object(o.a)(e),e.name=Object(r.unescape)(e.name||function(e){return Object(r.escape)(e?e.name||e.fileName:i18n("%Без_темы"))}(e.file)),e["name-uri-encoded"]=encodeURIComponent(e.name),e.extension=Daria.getExtensionInfo(e.name),e.class=e.class||e.extension.class;var t=Object(s.a)(e);return t&&Object(a.a)(e),{info:e,previewSupported:t,status:e.type?i.c.COMPLETED:i.c.NEW,progress:null}}},,,function(e,t){var n=/^(.*)<[^<>]*>$/,r={",":!0,";":!0," ":!0};function o(e,t,n){for(var r=!1,o=0;o<e.length;++o){var i=e[o];if(l(e,o)&&(r=!r),!r&&n[i]){var a=e.substring(0,o).trim();a&&t.push(a),e=s(e,0,o+1),o=-1}}return e&&(t.push(e.trim()),e=""),e}function i(e,t,r){for(var o=0,i=0;i<e.length;++i){var c=e.charAt(i);if("<"===c&&(o=i),">"===c){if(Daria.hasFeature("web-change-parse-contact"))if(!p(e.substring(o+1,i).trim()))continue;var u=e.substring(0,i+1).trim();if(u&&n.test(u)){var l=[];u=a(u,t,r),l.length&&t.push.apply(t,l),t.push(u),e=s(e,0,i+1),i=-1}}}return e.trim()}function a(e,t,n){for(var r=!1,o=0;o<e.length;++o){var i=e[o];if(l(e,o)&&(r=!r),!r&&n[i]){var a=e.substring(0,o).trim();a&&!c(a,i)||(a&&t.push(a),e=s(e,0,o+1),o=-1)}if(Daria.hasFeature("web-change-parse-contact")&&n[i]){var p=e.substring(0,o).trim();u(p,i,o,e)&&(p&&t.push(p),e=s(e,0,o+1),o=-1)}}return e.trim()}function s(e,t,n){return e.substr(0,t)+(n>0?e.substr(n):"")}function c(e,t){return(" "!==t||!function(e){return'"'===e[0]&&'"'===e[e.length-1]}(e))&&p(e)}function u(e,t,n,r){return">"!==r.charAt(n-1)&&" "!==t&&l(r,n+1)&&!l(r,0)&&!p(e)}function l(e,t){return'"'===e[t]&&(0===t||"\\"!==e[t-1])}function p(e){return Daria.hasFeature("web-change-parse-contact")?!!e&&Jane.FormValidation.checkEmail(e,!0):Jane.FormValidation.checkEmail(e)}e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;return function(t){return function(e,t){var n=999,r=1,a=[];for(;e&&n;)r>0?(e=i(e,a,t),r=-1):(e=o(e,a,t),r=1),n--;return a}(t,e)}},e.exports.SEPARATORS=r},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(1074),o=n.n(r);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._emitter=o()()}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"on",value:function(e){var t=this;return this._emitter.on("event",e),function(){return t.off(e)}}},{key:"off",value:function(e){this._emitter.off("event",e)}},{key:"once",value:function(e){var t=this;return this._emitter.once("event",e),function(){return t.off(e)}}},{key:"_emit",value:function(e){this._emitter.emit("event",e)}}]),e}()},,,,function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return p}),n.d(t,"c",function(){return f});var r=n(682),o=n(681),i=n(570),a=function(e){var t=e.messageBody,n=e.signatureMatches,r=void 0===n?[]:n,o=document.createElement("div");return o.innerHTML=t,{signature:s(o,r),forward:u(o),quotes:l(o)}},s=function(e,t){var n=Object(i.b)(e,t);return n?c(e,n):""},c=function(e,t){for(var n=t.start,r=t.finish,o=document.createElement("div"),i=r-n+1,a=0;a<i;a++)o.appendChild(e.childNodes[n]);return o.innerHTML},u=function(e){var t=Object(i.a)(e);return t?c(e,t):""},l=function(e){var t=document.createElement("div"),n=Object(r.a)(e,t);if(n){var o=document.createElement("div"),i=t.previousSibling;return i&&o.appendChild(i),o.appendChild(n),o.innerHTML}return""},p=function(e){var t=document.createElement("div");t.innerHTML=e;var n=document.createElement("div");if(Object(r.a)(t,n)){var i=n.previousSibling;Object(o.a)(i),Object(o.a)(n)}return Daria.Html2Text.html2text(t.innerHTML).trim().length},f=function(e){var t=e.messageBody,n=e.signatureMatches,r=void 0===n?[]:n,o=function(e){try{var t=new DOMParser,n=t.parseFromString(e,"text/html");return n.body}catch(t){var r=document.createElement("div");return r.innerHTML=e,r}}(t),a=Object(i.b)(o,r);return a?{beforeSignature:d(o,0,a.start-1),signature:d(o,a.start,a.finish),afterSignature:d(o,a.finish+1)}:{beforeSignature:o.innerHTML.trim(),signature:"",afterSignature:""}};function d(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.children.length-1,r="",o=t;o<=n;)r+=e.children[o++].outerHTML;return r}},,function(e,t,n){"use strict";var r=n(338);n.n(r);t.a=r.PropTypes.shape({email:r.PropTypes.string,name:r.PropTypes.string})},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContactAvatarWithTooltip=void 0;var c=a(n(135)),u=n(1087),l=s(n(1089));t.ContactAvatarWithTooltip=function(e){var t=c.useMemo(function(){return c.default.createElement(l.default,r({},e))},[e]);return c.default.createElement(u.AvatarTooltip,{contact:e.contact,avatar:t})}},,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSizeAndUnit=void 0;t.getSizeAndUnit=function(e){var t=parseInt(String(e),10),n=null,r=null;return isNaN(t)?{value:n,unit:r}:(t<128?(n=t,r="bytes"):t<1048576?(n=t/1024,r="kilobytes"):t<1073741824?(n=t/1048576,r="megabytes"):(n=t/1073741824,r="gigabytes"),{value:n=(n=n<10?Math.round(10*n)/10:Math.round(n)).toString().replace(".",","),unit:r})}},function(e,t,n){"use strict";var r="ComposeControlPanel";t.a={Block:r,Part:"".concat(r,"-Part"),Button:"".concat(r,"-Button"),ButtonNew:"".concat(r,"-Button_new"),FileInput:"".concat(r,"-FileInput"),AttachFileButton:"".concat(r,"-AttachFileButton"),CloseButton:"".concat(r,"-CloseButton"),DelayedSendingButton:"".concat(r,"-DelayedSendingButton"),LabelButton:"".concat(r,"-LabelButton"),MoreButton:"".concat(r,"-MoreButton"),NotificationsButton:"".concat(r,"-NotificationsButton"),SendButton:"".concat(r,"-SendButton"),TemplatesButton:"".concat(r,"-TemplatesButton"),TranslatorButton:"".concat(r,"-TranslatorButton")}},function(e,t,n){"use strict";var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(461),p=n(415),f=n(344),d=n(2776);n.n(d);function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var h="ControlButtonMenuItem",v={Block:h,withNotification:"".concat(h,"_notification"),Icon:"".concat(h,"-Icon"),Text:"".concat(h,"-Text")},g=function(e){var t=u()(e.cls,v.Block,b({},v.withNotification,e.hasNotification));return i.a.createElement("div",{ref:e.innerRef,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,className:t},m("span",{className:v.Icon},void 0,m(p.a,{id:e.icon})),m(f.default,{className:v.Text,loc:e.loc}))};t.a=g,g.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(t){b(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},l.a,{icon:s.a.string,loc:s.a.string,hasNotification:s.a.bool})},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(341),p=n(342),f=n(594),d=n(366);function y(e){"@babel/helpers - typeof";return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(f.e,{}),O=Object(p.inject)("visual")(r=Object(p.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,h(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,u.a.Component),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"render",value:function(){return this.isLocked&&g}},{key:"isLocked",get:function(){return this.props.visual.isLocked}}]),t}(),i.propTypes={visual:d.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"isLocked",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"isLocked"),o.prototype),r=o))||r)||r},,,function(e,t,n){"use strict";t.a=function(e){return a(e.name||"").toLowerCase()||"general"},t.b=function(e){if(e&&e.icon&&"none"!==e.icon)return e.icon;return e&&e.meta&&e.meta.mediatype||"none"},t.e=function(e){return e.type===i.d},t.f=function(e,t){if(t||!e.meta||!e.meta.sizes)return;var n=Object(r.find)(e.meta.sizes,function(e){return"S"===e.name});return n&&n.url},t.c=function(e,t){return Object(o.a)(e,t)},t.d=function(e,t,n){return!e&&!Object(o.c)(t,n)};var r=n(136),o=(n.n(r),n(804)),i=n(457),a=function(e){return e.split(".").pop()||""}},function(e,t,n){"use strict";var r=n(2902);n.d(t,"a",function(){return r.a})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LINK=t.LOCAL=void 0,t.LOCAL="local",t.LINK="link"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.INLINE_IMAGE=t.SIGNATURES=t.ADD_LINK=void 0,t.ADD_LINK="addLink",t.SIGNATURES="signatures",t.INLINE_IMAGE="inline-image"},,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(1435),o=n.n(r);function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,c(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,o.a),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(t,[{key:"getConfig",value:function(){}},{key:"getContainer",value:function(){}},{key:"getData",value:function(){}},{key:"setData",value:function(){}},{key:"getContents",value:function(){}},{key:"beforeUpdateElement",value:function(){}},{key:"getCurrentRange",value:function(){return window.getSelection().getRangeAt(0)}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var r=n(136),o=(n.n(r),n(1028)),i=n(570),a=n(394),s=n.n(a),c=n(1029),u=(n.n(c),n(1030)),l=(n.n(u),n(376)),p=n.n(l);function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=-101,y=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editor=null,this._signatureMatches=[],this.disposer=new s.a,this.replacer=document.createElement("div"),this.bootstrap=function(){var e=n.editor.getContainer(),t=n.editor.getConfig().isMobile;t||(e.addEventListener("mouseover",n._onMouseOver),e.addEventListener("click",n._onClick),e.addEventListener("keydown",n._onHoverOff,{capture:!0})),n._initMenuAnchor(e,t)},this._initMenuAnchor=function(e,t){n._menuAnchor=n._createMenuAnchor(),e.appendChild(n._menuAnchor),n._updateMenuAnchorPosition(),n._setMenuAnchorVisibility(t),n._setSignaturesPopupVisibility(!1)},this._onBackspace=function(){var e=n._getContainer(),t=n._getContent();if(e&&!t&&n._cursorIsInContainer())e.remove();else if(n._cursorIsInStartPosition()){var r=n.editor.getCurrentRange(),o=r.startContainer,i=r.startOffset,a=r.endContainer,s=r.endOffset;e.parentNode.insertBefore(e.firstChild,e),n.restoreCursorPosition({startContainer:o,startOffset:i,endContainer:a,endOffset:s})}},this._onResize=function(){n._updateMenuAnchorPosition()},this._onScroll=function(){n._setSignaturesPopupVisibility(!1)},this._onChange=function(){n._menuAnchor&&n._updateMenuAnchorPosition()},this._onDestroy=function(){n.disposer.dispose(n)},this._onGetData=function(e){var t=e.data,r=t.dataValue;void 0!==r&&(t.dataValue=n._insertSignatureBackIntoMessage(r))},this._onSetData=function(e){var t=e.data;t.dataValue&&(t.dataValue=n._wrapSignature(t.dataValue))},this._onClick=function(e){n._isSignatureEvent(e)||(n._setMenuAnchorVisibility(!1),n._isSignaturesPopupShown=!1)},this._onHoverOff=function(e){e.keyCode===p.a.ESC&&(n._setMenuAnchorVisibility(!1),n._isSignaturesPopupShown=!1)},this._onMouseOver=function(e){n._updateMenuAnchorPosition();var t=n._isSignaturesPopupShown||n._isSignatureEvent(e);n._isHovered!==t&&n._setMenuAnchorVisibility(t)},this.applySignature=function(e){var t=n._getContainer();t||(t=document.createElement("div"),n.editor.getContents().appendChild(t)),e.html?(t.innerHTML=e.html,Object(i.c)(t)):t.remove();var r=e.match,o=e.leadingLineBreaks;n._signatureMatches=[{match:r,leadingLineBreaks:o}],n.editor.setData(n.editor.getData());var a=n.editor.getConfig().isMobile;n._setMenuAnchorVisibility(a)},this.editor=t,t.signatureManager=this;var a=t.getConfig();this._consts=Object(o.e)(a.isMobile),a.signatures.popup&&t.beforeUpdateElement(this.bootstrap),this._signatureMatches=a.signatures.matches||[],this._addSubscription("getData",this._onGetData,void 0,void 0,d),this._addSubscription("setData",this._onSetData,void 0,void 0,d),a.isMobile&&this._addSubscription("change",this._onChange),this._addSubscription("destroy",this._onDestroy),this._addSubscription("backspace",this._onBackspace),this._addSubscription("resize",function(){return n._onResize()}),this.disposer.addEventListener(this,{element:window,eventName:"resize",listener:this._onResize});var c=a.composeContainer?a.composeContainer.getScrollableRef():null;if(c){var u=Object(r.throttle)(this._onScroll,50,{leading:!0});this.disposer.addEventListener(this,{element:c,eventName:"scroll",listener:u})}}return function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(e,[{key:"_addSubscription",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];this.disposer.add(this,[(t=this.editor).on.apply(t,[e].concat(r))])}},{key:"restoreCursorPosition",value:function(e){var t=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,i=window.getSelection();i.removeAllRanges();var a=document.createRange();a.setStart(t,n),a.setEnd(r,o),i.addRange(a)}},{key:"_getContent",value:function(){var e=this._getContainer();return e?e.innerText.trim():""}},{key:"_cursorIsInStartPosition",value:function(){var e=this._getContainer(),t=this.editor.getCurrentRange(),n=e&&t&&e.contains(t.startContainer);if(!e||!t.collapsed||!n)return!1;var r=t.cloneRange();return r.selectNodeContents(e),r.setEnd(t.endContainer,t.endOffset),0===r.toString().length}},{key:"_cursorIsInContainer",value:function(){var e=this.editor.getCurrentRange(),t=this._getContainer();return t.contains(e.startContainer)||t.contains(e.endContainer)}},{key:"_initReplacerAndFindWrapper",value:function(e){return this.replacer.innerHTML=e,this.replacer.querySelector(this._consts.CONTAINER_SELECTOR)}},{key:"_insertSignatureBackIntoMessage",value:function(e){var t=this._initReplacerAndFindWrapper(e);if(!t)return e;var n=t.querySelector(".".concat(this._consts.MENU_ANCHOR_CLASS));for(n&&t.removeChild(n);t.parentNode!==this.replacer;){var r=t.parentNode;r.parentNode.insertBefore(t,r.nextSibling)}for(;t.childNodes.length;)this.replacer.insertBefore(t.childNodes[0],t);return this.replacer.removeChild(t),this.replacer.innerHTML}},{key:"_createSignatureWrapper",value:function(){var e=document.createElement("div");return e.classList.add(this._consts.CONTAINER_CLASS,o.a),e.setAttribute(o.b,o.c),e}},{key:"_wrapSignature",value:function(e){if(this.replacer.innerHTML=e,this.replacer.querySelector(this._consts.CONTAINER_SELECTOR))return e;var t=Object(i.b)(this.replacer,this._signatureMatches);if(!t)return e;var n=this._createSignatureWrapper(),r=t.start,o=t.finish,a=t.targetMatch,s=o-r+1;a&&(this._signatureMatches=[a]);for(var c=0;c<s;c++)n.appendChild(this.replacer.childNodes[r]);return r<this.replacer.childNodes.length?this.replacer.insertBefore(n,this.replacer.childNodes[r]):this.replacer.appendChild(n),Object(i.c)(n),this.replacer.innerHTML}},{key:"_isSignatureEvent",value:function(e){for(var t=e.target;t;){if(t.classList&&(t.classList.contains(this._consts.CONTAINER_CLASS)||t.classList.contains(this._consts.MENU_ANCHOR_CLASS)))return!0;t=t.parentNode}return!1}},{key:"_createMenuAnchor",value:function(){var e=this,t=document.createElement("div");return t.setAttribute("contenteditable",!1),t.tabIndex=-1,t.classList.add(this._consts.MENU_ANCHOR_CLASS,o.d),t.classList.add(this._consts.MENU_ANCHOR_HIDDEN_CLASS),t.addEventListener("click",function(){return e._setSignaturesPopupVisibility(!e._isSignaturesPopupShown)}),t}},{key:"_getContainer",value:function(){return this.editor.getContainer().querySelector(this._consts.CONTAINER_SELECTOR)}},{key:"_updateMenuAnchorPosition",value:function(){var e=this,t=this._getContainer();if(t){var n=this.editor.getConfig().isMobile;requestAnimationFrame(function(){n?(e._menuAnchor.style.setProperty("top","".concat(t.offsetTop,"px")),e._menuAnchor.style.setProperty("left","".concat(t.offsetLeft+t.offsetWidth,"px"))):(e._menuAnchor.style.setProperty("top","".concat(t.offsetTop-16,"px")),e._menuAnchor.style.setProperty("left","".concat(t.offsetLeft+t.offsetWidth+8,"px")))})}else this._setMenuAnchorVisibility(!1)}},{key:"_setMenuAnchorVisibility",value:function(e){var t=this._getContainer();this._isHovered=e,e?(this._menuAnchor.classList.remove(this._consts.MENU_ANCHOR_HIDDEN_CLASS),t&&t.classList.add(this._consts.CONTAINER_HOVERED_CLASS)):(this._menuAnchor.classList.add(this._consts.MENU_ANCHOR_HIDDEN_CLASS),t&&t.classList.remove(this._consts.CONTAINER_HOVERED_CLASS))}},{key:"_setSignaturesPopupVisibility",value:function(e){this._isSignaturesPopupShown!==e&&(this._isSignaturesPopupShown=e,this.editor.getConfig().signatures.popup.stateChange({isOpen:e,anchor:this._menuAnchor,applySignature:this.applySignature}))}}]),e}()},function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return a}),n.d(t,"e",function(){return s});var r="data-cke-filter",o="off",i="qa-Compose-SignatureContainer",a="qa-Compose-SignatureMenuAnchor",s=function(e){var t=e?"ComposeReact-SignatureContainer":"ComposeReact-SignatureContainer_desktop",n=".".concat(t),r="".concat(t,"_hovered"),o=e?"ComposeReact-SignatureMenuAnchor":"ComposeReact-SignatureMenuAnchorNew";return{CONTAINER_CLASS:t,CONTAINER_SELECTOR:n,CONTAINER_HOVERED_CLASS:r,MENU_ANCHOR_CLASS:o,MENU_ANCHOR_HIDDEN_CLASS:"".concat(o,"_hidden")}}},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(149);function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}window.swfobject=function(){var e,t,n,i,a,s,c="undefined",u="object",l="application/x-shockwave-flash",p="SWFObjectExprInst",f=window,d=document,y=navigator,b=!1,m=[function(){b?function(){var e,t=navigator.plugins["Shockwave Flash"]||window.ActiveXObject;try{e=t.description||new t("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(t){e="Unavailable"}(e=e.split(" ")[2])?(e=e.split(/\.|,/g),E.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)]):E.pv=[0,0,0];C()}():C()}],h=[],v=[],g=[],O=!1,_=!1,S=!0,E=function(){var e=o(d.getElementById)!=c&&o(d.getElementsByTagName)!=c&&o(d.createElement)!=c,t=y.userAgent.toLowerCase(),n=y.platform.toLowerCase(),r=/win/.test(n||t),i=/mac/.test(n||t),a=!!/webkit/.test(t)&&parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),s=!1,p=[0,0,0],m=null;if(o(y.plugins)!=c&&o(y.plugins["Shockwave Flash"])==u)!(m=y.plugins["Shockwave Flash"].description)||o(y.mimeTypes)!=c&&y.mimeTypes[l]&&!y.mimeTypes[l].enabledPlugin||(b=!0,s=!1,m=m.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),p[0]=parseInt(m.replace(/^(.*)\..*$/,"$1"),10),p[1]=parseInt(m.replace(/^.*\.(.*)\s.*$/,"$1"),10),p[2]=/[a-zA-Z]/.test(m)?parseInt(m.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(o(f.ActiveXObject)!=c)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");h&&(m=h.GetVariable("$version"))&&(s=!0,m=m.split(" ")[1].split(","),p=[parseInt(m[0],10),parseInt(m[1],10),parseInt(m[2],10)])}catch(e){}return{w3:e,pv:p,wk:a,ie:s,win:r,mac:i}}();function P(e){O?e():m[m.length]=e}function C(){var e=h.length;if(e>0)for(var t=0;t<e;t++){var n=h[t].id,r=h[t].callbackFn,i={success:!1,id:n};if(E.pv[0]>0){var a=D(n);if(a)if(!N(h[t].swfVersion)||E.wk&&E.wk<312)if(h[t].expressInstall&&T()){var s={};s.data=h[t].expressInstall,s.width=a.getAttribute("width")||"0",s.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(s.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(s.align=a.getAttribute("align"));for(var u={},l=a.getElementsByTagName("param"),p=l.length,f=0;f<p;f++)"movie"!=l[f].getAttribute("name").toLowerCase()&&(u[l[f].getAttribute("name")]=l[f].getAttribute("value"));k(s,u,n,r)}else A(a),r&&r(i);else B(n,!0),r&&(i.success=!0,i.ref=w(n),r(i))}else if(B(n,!0),r){var d=w(n);d&&o(d.SetVariable)!=c&&(i.success=!0,i.ref=d),r(i)}}}function w(e){var t=null,n=D(e);if(n&&"OBJECT"==n.nodeName)if(o(n.SetVariable)!=c)t=n;else{var r=n.getElementsByTagName(u)[0];r&&(t=r)}return t}function T(){return!_&&N("6.0.65")&&(E.win||E.mac)&&!(E.wk&&E.wk<312)}function k(r,a,s,u){_=!0,n=u||null,i={success:!1,id:s};var l=D(s);if(l){"OBJECT"==l.nodeName?(e=R(l),t=null):(e=l,t=s),r.id=p,(o(r.width)==c||!/%$/.test(r.width)&&parseInt(r.width,10)<310)&&(r.width="310"),(o(r.height)==c||!/%$/.test(r.height)&&parseInt(r.height,10)<137)&&(r.height="137"),d.title=d.title.slice(0,47)+" - Flash Player Installation";var y=E.ie&&E.win?"ActiveX":"PlugIn",b="MMredirectURL="+f.location.toString().replace(/&/g,"%26")+"&MMplayerType="+y+"&MMdoctitle="+d.title;if(o(a.flashvars)!=c?a.flashvars+="&"+b:a.flashvars=b,E.ie&&E.win&&4!=l.readyState){var m=L("div");s+="SWFObjectNew",m.setAttribute("id",s),l.parentNode.insertBefore(m,l),l.style.display="none",function(){4==l.readyState?l.parentNode.removeChild(l):setTimeout(arguments.callee,10)}()}j(r,a,s)}}function A(e){if(E.ie&&E.win&&4!=e.readyState){var t=L("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(R(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(R(e),e)}function R(e){var t=L("div");if(E.win&&E.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(u)[0];if(n){var r=n.childNodes;if(r)for(var o=r.length,i=0;i<o;i++)1==r[i].nodeType&&"PARAM"==r[i].nodeName||8==r[i].nodeType||t.appendChild(r[i].cloneNode(!0))}}return t}function j(e,t,n){var r,i=D(n);if(E.wk&&E.wk<312)return r;if(i)if(o(e.id)==c&&(e.id=n),E.ie&&E.win){var a="";for(var s in e)e[s]!=Object.prototype[s]&&("data"==s.toLowerCase()?t.movie=e[s]:"styleclass"==s.toLowerCase()?a+=' class="'+e[s]+'"':"classid"!=s.toLowerCase()&&(a+=" "+s+'="'+e[s]+'"'));var p="";for(var f in t)t[f]!=Object.prototype[f]&&(p+='<param name="'+f+'" value="'+t[f]+'" />');i.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+p+"</object>",v[v.length]=e.id,r=D(e.id)}else{var d=L(u);for(var y in d.setAttribute("type",l),e)e[y]!=Object.prototype[y]&&("styleclass"==y.toLowerCase()?d.setAttribute("class",e[y]):"classid"!=y.toLowerCase()&&d.setAttribute(y,e[y]));for(var b in t)t[b]!=Object.prototype[b]&&"movie"!=b.toLowerCase()&&M(d,b,t[b]);i.parentNode.replaceChild(d,i),r=d}return r}function M(e,t,n){var r=L("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function I(e){var t=D(e);t&&"OBJECT"==t.nodeName&&(E.ie&&E.win?(t.style.display="none",function(){4==t.readyState?function(e){var t=D(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function D(e){var t=null;try{t=d.getElementById(e)}catch(e){}return t}function L(e){return d.createElement(e)}function N(e){var t=E.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]}function x(e,t,n,r){if(!E.ie||!E.mac){var i=d.getElementsByTagName("head")[0];if(i){var l=n&&"string"==typeof n?n:"screen";if(r&&(a=null,s=null),!a||s!=l){var p=L("style");p.setAttribute("type","text/css"),p.setAttribute("media",l),a=i.appendChild(p),E.ie&&E.win&&o(d.styleSheets)!=c&&d.styleSheets.length>0&&(a=d.styleSheets[d.styleSheets.length-1]),s=l}E.ie&&E.win?a&&o(a.addRule)==u&&a.addRule(e,t):a&&o(d.createTextNode)!=c&&a.appendChild(d.createTextNode(e+" {"+t+"}"))}}}function B(e,t){if(S){var n=t?"visible":"hidden",r=D(e);O&&r&&r.style?r.style.visibility=n:x("#"+e,"visibility:"+n)}}function F(e){return null!=/[\\\"<>\.;]/.exec(e)&&("undefined"==typeof encodeURIComponent?"undefined":o(encodeURIComponent))!=c?encodeURIComponent(e):e}r.a.then(function(){if(O)return;for(var e=m.length,t=0;t<e;t++)m[t]();O=!0});E.ie&&E.win&&window.attachEvent("onunload",function(){for(var e=g.length,t=0;t<e;t++)g[t][0].detachEvent(g[t][1],g[t][2]);for(var n=v.length,r=0;r<n;r++)I(v[r]);for(var o in E)E[o]=null;for(var i in E=null,swfobject)swfobject[i]=null;swfobject=null});return{registerObject:function(e,t,n,r){if(E.w3&&e&&t){var o={};o.id=e,o.swfVersion=t,o.expressInstall=n,o.callbackFn=r,h[h.length]=o,B(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(E.w3)return w(e)},embedSWF:function(e,t,n,r,i,a,s,l,p,f){var d={success:!1,id:t};E.w3&&!(E.wk&&E.wk<312)&&e&&t&&n&&r&&i?(B(t,!1),P(function(){n+="",r+="";var y={};if(p&&o(p)===u)for(var b in p)y[b]=p[b];y.data=e,y.width=n,y.height=r;var m={};if(l&&o(l)===u)for(var h in l)m[h]=l[h];if(s&&o(s)===u)for(var v in s)o(m.flashvars)!=c?m.flashvars+="&"+v+"="+s[v]:m.flashvars=v+"="+s[v];if(N(i)){var g=j(y,m,t);y.id==t&&B(t,!0),d.success=!0,d.ref=g}else{if(a&&T())return y.data=a,void k(y,m,t,f);B(t,!0)}f&&f(d)})):f&&f(d)},switchOffAutoHideShow:function(){S=!1},ua:E,getFlashPlayerVersion:function(){return{major:E.pv[0],minor:E.pv[1],release:E.pv[2]}},hasFlashPlayerVersion:N,createSWF:function(e,t,n){return E.w3?j(e,t,n):void 0},showExpressInstall:function(e,t,n,r){E.w3&&T()&&k(e,t,n,r)},removeSWF:function(e){E.w3&&I(e)},createCSS:function(e,t,n,r){E.w3&&x(e,t,n,r)},addDomLoadEvent:P,getQueryParamValue:function(e){var t=d.location.search||d.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return F(t);for(var n=t.split("&"),r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return F(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(_){var r=D(p);r&&e&&(r.parentNode.replaceChild(e,r),t&&(B(t,!0),E.ie&&E.win&&(e.style.display="block")),n&&n(i)),_=!1}}}}()},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){e.exports={MAX_MESSAGES_TO_FORWARD:30,MAX_MESSAGES_TO_PIN:15,MAX_MESSAGES_TO_REMOVE_OR_SPAM:20,MAX_MESSAGES_TO_SEND:Daria.IS_CORP?150:50}},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(341),o=n(136),i=(n.n(o),n(137)),a=(n.n(i),n(355)),s=(n.n(a),n(346));function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.newMessageId=void 0,t.tids&&!t.tids.length&&delete t.tids;var r=t.mailboxUid||null;this.params=t,this.data=n,this.mSettings=r?ns.Model.get("mailbox-settings",{mailboxUid:r}):ns.Model.get("settings")}return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(e,[{key:"getParams",value:function(){return this.params}},{key:"getMessageType",value:function(){return Daria.UA.isMobile&&Daria.UA.isTouch?"html":Daria.UA.isMobile?"plain":this.mSettings.isSet("enable_richedit")||Daria.isReactiveCompose()?"html":this.mMessageBody?this.mMessageBody.getSubtype():"plain"}},{key:"getFromName",value:function(){return this.mSettings.getSetting(a.Settings.FROM_NAME)}},{key:"getFromEmail",value:function(){return this.mSettings.getSetting(a.Settings.LOCK_DEFAULT_EMAIL)?this.mSettings.getSetting(a.Settings.DEFAULT_EMAIL):this.mMessage&&this.mMessage.getToEmail()||this.mSettings.getSetting(a.Settings.DEFAULT_EMAIL)}},{key:"getAvailableFromEmails",value:function(){var e=this.mAccountInformation.getFromEmails();return this.mSettings.getSetting(a.Settings.LOCK_DEFAULT_EMAIL)?[this.mSettings.getSetting(a.Settings.DEFAULT_EMAIL)]:e}},{key:"_getForwardMarkIds",value:function(){return this.mMessage?this.mMessage.isThread()&&1===this.mMessage.get(".count")?[this.mMessage.get(".last_mid")]:this.mMessage.isThread()?[]:[this.mMessage.get(".mid")]:[]}},{key:"isForward",value:function(){return Boolean("forward"===this.params.oper)}},{key:"isTemplate",value:function(){return!(!this.mMessage||!this.mMessage.isTemplate())||!(!this.data||this.data.save_symbol!==i.WellKnownFolderSymbol.TEMPLATE)}},{key:"isDraft",value:function(){return!this.isTemplate()&&(!(!this.data||"no"!==this.data.ign_overwrite||!this.data.overwrite)||!!(this.mMessage&&this.mMessageBody&&this.mMessage.isDraftLike()))}},{key:"isReplyAll",value:function(){return Boolean(this.mMessageBody&&"reply-all"===this.params.oper)}},{key:"isReply",value:function(){return Boolean(this.mMessageBody&&"reply"===this.params.oper)}},{key:"isReplyAny",value:function(){return this.isReply()||this.isReplyAll()}},{key:"getForwardData",value:function(){var e=this.getMessageType(),t=this.getFromEmail(),n=this.mMessage?this.mMessage.getFolderId():null,r=this.mMessageBody?this.mMessageBody.getForwardBody(e,t):Daria.signs.appendToBody("",e,!0,t,null,this.mailboxUid),o=this.mMessageBody?this.mMessageBody.getMessageId():null;return{ttype:e,from_mailbox:t,from_name:this.getFromName(),cc:"",bcc:"",subj:"Fwd: "+this.messageSubject,send:r,inreplyto:o,current_folder:n,overwrite:this.params.ids,ign_overwrite:"yes",references:"",mark_ids:this._getForwardMarkIds(),mark_as:"forwarded",message_id:this.newMessageId}}},{key:"getDraftData",value:function(){var e=this.getMessageType(),t=this.mMessage.isTemplate()?i.WellKnownFolderSymbol.TEMPLATE:i.WellKnownFolderSymbol.DRAFT,n=_.clone(this.mMessage.get(".lid")),r=this.mMessage.getDelayedTime(),o=this.isTemplate()?this.newMessageId:this.mMessage.get(".message_id"),a=this.params.mailboxUid;if(!r){var s=ns.Model.get("labels",{mailboxUid:a}).getDelayedMessageLabel();s&&(n=_.pull(n,s.lid))}return{overwrite:this.params.ids,ign_overwrite:"no",save_symbol:t,to:this.mMessageBody.getAddressField("to"),cc:this.mMessageBody.getAddressField("cc"),bcc:this.mMessageBody.getAddressField("bcc"),phone:this.mMessageBody.getAddressField("phone"),lids:n,from_name:this.mMessage.getFromName(),from_mailbox:this.mMessage.getFromEmail(),subj:this.messageSubjectWithPrefix,send:this.mMessageBody.getDraftBody(e),ttype:e,inreplyto:this.mMessageBody.getInReplyTo(),references:this.mMessageBody.getReferences(),current_folder:this.mMessage.getFolderId(),send_time:r,message_id:o}}},{key:"getTemplateData",value:function(){if(this.mMessage&&this.mMessageBody)return this.draftMessageData;var e=this.defaultMessageData;return e.save_symbol=i.WellKnownFolderSymbol.TEMPLATE,e}},{key:"getReplyData",value:function(){var e=this.getMessageType(),t=this.mMessageBody.getRecipients(this.isReplyAll()),n=this.mMessageBody.getMessageId(),r=this.mMessageBody.getReferences(),o=this.mMessageBody.getInReplyTo(),i=this.mMessageBody.getInfo("delivered-to")[0],a=this.fromEmail,s=this.params.isQuickReply?"":this.sendMessageData;return{from:{receiver:i},from_mailbox:a,from_name:this.getFromName(),overwrite:this.params.ids,ign_overwrite:"yes",mark_as:"replied",mark_ids:[this.params.ids],to:t.to,cc:t.cc,bcc:"",subj:"Re: "+this.messageSubject,send:s,ttype:e,inreplyto:n,references:_.trim((r||o||"")+" "+n),message_id:this.newMessageId}}},{key:"getSendMessage",value:function(){return(this.data&&this.data.qrText||"")+this.getReplyBody()}},{key:"getReplyBody",value:function(){var e=this.getMessageType(),t=this.fromEmail;return this.mMessageBody.getReplyBody(e,t)}},{key:"getDefaultData",value:function(){var e=this.getFromEmail()||this.mAccountInformation.getFromDefaultEmail(),t=this.getFromName(),n=this.getMessageType(),r=this.data&&this.data.send||"";return Object(o.isEmpty)(r)||"html"!==this.getMessageType()||(r="<div>".concat(r,"</div>")),{from_mailbox:e,from_name:t,ttype:n,send:Daria.signs.appendToBody(r,n,!0,e,void 0,this.mailboxUid),message_id:this.newMessageId}}},{key:"getComposeMessageData",value:function(){return this.isDraft()?this.draftMessageData:this.isTemplate()?this.templateMessageData:this.isReplyAny()?this.replyMessageData:this.isForward()?this.forwardMessageData:this.defaultMessageData}},{key:"isPredefinedDataEmpty",value:function(){var e=Object(r.toJS)(this.data);return!e||0===Object.keys(e).length}},{key:"getRelatedThreadId",value:function(){return this.mMessage?this.mMessage.getThreadId():""}},{key:"isNewMessage",value:function(){return!this.isDraft()&&!this.isReplyAny()&&!this.isForward()}},{key:"isNewTemplate",value:function(){var e=this.data&&this.data.overwrite||this.mMessage&&this.mMessage.isDraftLike();return this.isTemplate()&&!e}},{key:"mailboxUid",get:function(){return this.params.mailboxUid}},{key:"hasMessage",get:function(){return this.params.ids&&!this.params.tids}},{key:"mMessage",get:function(){return this.hasMessage?ns.Model.getValid("message",{ids:this.params.ids,mailboxUid:this.mailboxUid}):null}},{key:"mThread",get:function(){return this.hasMessage?null:ns.Model.getValid("message",{ids:this.params.tids,mailboxUid:this.mailboxUid})}},{key:"mMessageBody",get:function(){if(!this.hasMessage)return null;var e=ns.Model.infoLite("message-body").calculateParamsForMessageBody(this.params);return ns.Model.getValid("message-body",e)}},{key:"mAccountInformation",get:function(){return Object(s.isSharedMailboxes)()&&this.mailboxUid?ns.Model.get("address-information"):ns.Model.get("account-information")}},{key:"fromName",get:function(){return this.getFromName()}},{key:"fromEmail",get:function(){return this.getFromEmail()}},{key:"fromEmails",get:function(){return this.getAvailableFromEmails()}},{key:"forwardMessageData",get:function(){return this.getForwardData()}},{key:"messageSubject",get:function(){var e=this.mMessage||this.mThread;return e?e.getSubject(!0):""}},{key:"messageSubjectWithPrefix",get:function(){var e=this.mMessage||this.mThread;return e?e.getSubject():""}},{key:"draftMessageData",get:function(){return this.getDraftData()}},{key:"templateMessageData",get:function(){return this.getTemplateData()}},{key:"replyMessageData",get:function(){return this.getReplyData()}},{key:"sendMessageData",get:function(){return this.getSendMessage()}},{key:"defaultMessageData",get:function(){return this.getDefaultData()}},{key:"messageData",get:function(){return this.getComposeMessageData()}},{key:"relatedThreadId",get:function(){return this.getRelatedThreadId()}}]),e}()},function(e,t,n){"use strict";var r=n(357),o=n(705),i=n(3),a=(n.n(i),"do-attach-file-store");t.a=function(e,t){var n=t.onError,s=t.onSuccess,c={file:e.name,size:e.file&&e.file.size,checkLimit:!0};return ns.forcedRequest(a,c).then(function(t){return function(e,t,n){var i=n.onError,s=n.onSuccess,c=t&&t.upload_url,u=t&&t.oid;if(!c||!u)return i({info:{errorType:"upload.disk.no_url_or_oid"},additionalInfo:t&&JSON.stringify(t),status:r.c.FAILED}),void Object(o.a)(e.file,{handlerName:a,isOk:!1});e.narod={oid:u,url:c},Object(o.a)(e.file,{handlerName:a,isOk:!0}),e.file&&s()}(e,t[0].getData(),{onError:n,onSuccess:s})},function(t){var s=t&&t.invalid&&t.invalid[0]||{},c=s.error&&s.error.code,u=function(e){switch(e){case r.e.STATUS_DISK_FULL:return r.e.DISK_FULL;case r.e.DISK_TECHNICAL_WORK:return r.e.DISK_TECHNICAL_WORK;case r.e.DISK_TRAFFIC_LIMIT:return r.e.DISK_TRAFFIC_LIMIT;default:return r.e.UNKNOWN}}(c);Object(o.a)(e.file,{handlerName:a,isOk:!1,errorCode:c}),n({info:{type:i.ErrorType.Transport,source:i.ErrorSource.Network,block:i.ErrorBlock.Compose,sourceMethod:i.ErrorSourceMethod.ComposeAttach,message:"attach_disk_upload_failed",invalidModel:ns.Model.collectErrorData(s.invalid),rawErrorCode:c},status:r.c.FAILED,errorCode:u,additionalInfo:function(e,t){if(e===r.e.DISK_TRAFFIC_LIMIT&&t&&t.error&&t.error.limit)return{limit:t.error.limit}}(c,s)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"LOCAL",function(){return r}),n.d(t,"DISK",function(){return o});var r="local",o="disk"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"MB_SIZE",function(){return r}),n.d(t,"GB_SIZE",function(){return o}),n.d(t,"HAS_DISK",function(){return i}),n.d(t,"MAX_TOTAL_ATTACHMENTS_SIZE",function(){return a}),n.d(t,"MAX_SIZE_FOR_SINGLE_FILE",function(){return s}),n.d(t,"IS_CORP",function(){return c});var r=1048576,o=1024*r,i=!Daria.IS_CORP&&-1!==Daria.SIDS.indexOf("59"),a=Daria.IS_CORP?40*r:24*r,s=i?2*o:a,c=Daria.IS_CORP},function(e,t,n){"use strict";var r=n(357),o=n(705),i=n(706),a=n(3);n.n(a);t.a=function(e,t){var n=e.file,s=e.narod,c=t.onError,u=t.onUploadProgress,l=t.onUploadComplete,p=t.onCancelUpload,f=new FormData;f.append("file",n);var d=new XMLHttpRequest;return d.open("POST",s.url,!0),Object(i.a)(d,u),d.onreadystatechange=function(){4===this.readyState&&(0===this.status?p&&p(this):this.status>=200&&this.status<300?l(this):(c({info:{message:"attach_disk_upload_error",type:a.ErrorType.Transport,source:a.ErrorSource.Network,block:a.ErrorBlock.Compose,sourceMethod:a.ErrorSourceMethod.ComposeAttach,status:this.status,responseText:this.responseText},status:r.c.FAILED,errorCode:this.status===r.e.STATUS_DISK_FULL?r.e.DISK_FULL:r.e.UNKNOWN}),Object(o.a)(n,{handlerName:"diskUploadXhr",isOk:!1,errorCode:this.status})))},d.send(f),d}},function(e,t,n){"use strict";var r=n(357),o=n(3);n.n(o);t.a=function(e,t){var n=t.onError,i=t.onUploadProgress,a=t.onUploadComplete;if(e&&e.narod)return ns.forcedRequest("do-attach-file-status",{oid:e.narod.oid}).then(function(t){return function(e,t,n){var i=n.onError,a=n.onUploadProgress,s=n.onUploadComplete,c=t[0].getData(),u=c.operation;if(!u)return void i({info:{errorType:"upload.disk.no_operation"},status:r.c.FAILED,errorCode:r.e.YADISK_ERROR});var l=u.status;switch(l){case"EXECUTING":case"WAITING":a(function(e){var t=(e&&e.stages&&e.stages.stage||[]).filter(function(e){return e&&"kladun_upload"===e.name})[0],n=t&&t.progress;return void 0===n||100===Number(n)?100:n}(u));break;case"FAILED":i(function(e){var t=Number(e&&e.error&&e.error.code);return t===r.e.VIRUS?{info:{errorType:"upload.disk.virus"},status:r.c.VIRUS,errorCode:r.e.VIRUS}:t===r.e.DISK_FULL?{info:{errorType:"upload.disk.quota_limit"},status:r.c.FAILED,errorCode:r.e.DISK_FULL}:{info:{type:o.ErrorType.Transport,source:o.ErrorSource.Request,block:o.ErrorBlock.Compose,sourceMethod:o.ErrorSourceMethod.ComposeAttach,message:"attach_disk_response_unknown"},status:r.c.FAILED,errorCode:r.e.YADISK_ERROR}}(u));break;case"DONE":return function(e,t,n){var i=n.onError,a=n.onUploadComplete,s=t.file;if(s)return function(e,t,n){var i=n.onError,a=n.onUploadComplete;return e.narodUrl=t.meta&&t.meta.short_url,e.size=t.size,e.hash=t.meta&&t.meta.public_hash,function(e){var t=e&&e.meta||{},n=t.preview,r=t.public_hash;return n&&r?ns.Model.get("disk-resources").getPreview(r).always(function(e){return e}):Promise.resolve(n)}(t).then(function(t){e.narodPreview=t,function(e,t){var n=t.onError,i=t.onUploadComplete;delete e.narod,e.narodUrl&&e.size?i():n({info:{type:o.ErrorType.Transport,source:o.ErrorSource.Request,block:o.ErrorBlock.Compose,sourceMethod:o.ErrorSourceMethod.ComposeAttach,message:"attach_disk_no_size_or_no_url",disk_url:e.narodUrl,disk_size:e.size},status:r.c.FAILED,errorCode:r.e.YADISK_ERROR})}(e,{onError:i,onUploadComplete:a})})}(e,s,{onError:i,onUploadComplete:a});i({info:{type:o.ErrorType.Transport,source:o.ErrorSource.Request,block:o.ErrorBlock.Compose,sourceMethod:o.ErrorSourceMethod.ComposeAttach,message:"attach_disk_no_fileinfo"},status:r.c.FAILED,errorCode:r.e.YADISK_ERROR})}(e,u,{onError:i,onUploadComplete:s});default:i({info:{errorType:"unknown_disk_status",status:l},additionalInfo:JSON.stringify(c)})}}(e,t,{onError:n,onUploadProgress:i,onUploadComplete:a})},function(){return n({info:{type:o.ErrorType.Transport,source:o.ErrorSource.Network,block:o.ErrorBlock.Compose,sourceMethod:o.ErrorSourceMethod.ComposeAttach,message:"attach_disk_file_status_failed"},status:r.c.FAILED})})}},function(e,t,n){"use strict";function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};clearInterval(e.getProgressTimer)}t.a=function(e,t){r(e),e.getProgressTimer=setInterval(t,1500)},t.b=r},function(e,t,n){"use strict";var r=n(706);t.a=function(e,t){var n=e.name,o=e.file,i=t.uploadUrl,a=t.onUploadProgress,s=t.onUploadComplete,c=new FormData;c.append("Filename",n);var u=new XMLHttpRequest;return u.open("POST",i,!0),Object(r.a)(u,a),u.onreadystatechange=function(){4===this.readyState&&s(this)},c.append("attachment",o,n),a(0),u.send(c),u}},function(e,t,n){"use strict";var r=n(357),o=n(3);n.n(o);t.a=function(e,t){var n=e.info,i=e.previewSupported,a=e.xhr,s=t.onError,c=t.onSuccess,u=t.onAuthFail,l=a.responseText,p={};if(l)try{p=JSON.parse(l)}catch(e){return void s({info:{xhr_status:a.status,xhr_readystate:a.readyState,xhr_length:l?l.length:0,message:"attach_json_parse_error",type:o.ErrorType.Transport,source:o.ErrorSource.Logic,block:o.ErrorBlock.Compose,sourceMethod:o.ErrorSourceMethod.ComposeAttach,responseText:l},status:r.c.FAILED,errorCode:r.e.UNKNOWN})}var f=p.write_attachment;f||!p.error||"AUTH_NO_AUTH"!==p.error.code&&"AUTH_WRONG_GUARD"!==p.error.code||u();var d=f&&f.id,y=f&&f.downloadUrl;if(d&&y){n.att_id=d,n.url=y.replace("http://","//");var b=f&&f.previewUrl;i&&b&&(n.previewHref=n.url+"&no_disposition=y",n.previewSrc=b.replace("http://","//")+"&no_disposition=y"),c()}else s({info:{type:o.ErrorType.Transport,source:o.ErrorSource.Network,block:o.ErrorBlock.Compose,sourceMethod:o.ErrorSourceMethod.ComposeAttach,message:"attach_id_or_url_undefined",xhr_status:a.status,xhr_readystate:a.readyState,xhr_length:l?l.length:0,responseText:l,attId:!!d,downloadUrl:!!y},status:r.c.FAILED,errorCode:r.e.UNKNOWN})}},function(e,t,n){"use strict";var r=n(357);t.a=function(e,t){switch(e.type){case r.d.FILE:return{att_id:e.att_id,hid:e.hid,from_template:e.from_template,template_hid:e.template_hid,template_mid:e.template_mid};case r.d.YADISK:return{disk:t===r.c.COMPLETED?function(e){return Daria.utils.getDiskParams(e)}(e):""}}}},function(e,t,n){"use strict";var r=n(781);t.a=function(e,t){var n=t.onFail,o=t.onSuccess,i=function(e){var t=Object(r.a)(100),n=0;return setInterval(function(){return e(t(n++))},100)}(t.onUploadProgress);return ns.Model.get("disk-resources").attach(e.diskSrcPath,e.name).then(function(t){return function(e,t){return e.narodUrl=t.url,e.hash=t.hash,e.narodPreview?ns.Model.get("disk-resources").getPreview(t.hash).always(function(t){return e.narodPreview=t}):Promise.resolve()}(e,t)}).then(function(){return o()}).fail(function(){return n()}).always(function(){return function(e){clearInterval(e)}(i)})}},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return a});var r=n(353),o=function(e){return e||"(".concat(Object(r.default)("compose-react/Без_темы"),")")},i=function(e){return e?o(e.getSubject(!0)):""},a=function(e){return e?[e.get(".subject_prefix"),o(e.getSubject(!0))].filter(Boolean).join(" "):""}},function(e,t,n){"use strict";var r=n(136),o=(n.n(r),n(357));t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n={stid:t.getSTID(),mid:t.params.ids,bid:e.bid,hid:e.hid,name:Object(r.unescape)(e.name),"browser-supports":e["browser-supports"],from_template:e.from_template,template_hid:e.template_hid,template_mid:e.template_mid};return e.narod?(n.narodUrl=e.unsafeUrl,n.size=e.size,n.type=o.d.YADISK,n.folder=Boolean(e.folder),n.narodPreview=e.preview):(n.size=e.length,n.type=o.d.FILE,n.class=e.class,n.message=Boolean(e.message),n.external_transformer=e.external_transformer,n.external_transformer_filetype=e.external_transformer_filetype),n}},function(e,t,n){"use strict";var r=n(357);t.a=function(e){return e.type===r.d.YADISK?Boolean(e.narodPreview):Boolean(e.extension.preview)||"audio"===e.class&&"mp3"===e.extension.icon}},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return T});var r,o,i,a,s,c,u,l,p,f=n(136),d=n.n(f),y=n(341),b=n(1078),m=n(3045),h=n(702),v=n(3046),g=n(355),O=(n.n(g),n(380)),_=(n.n(O),n(3));n.n(_);function S(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function E(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){S(i,r,o,a,s,"next",e)}function s(e){S(i,r,o,a,s,"throw",e)}a(void 0)})}}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function w(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var T=(r=y.observable.ref,i=w((o=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.params,o=n.predefinedData,d=n.miniData,y=n.services,S=n.controllers,P=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).size,w=void 0===P?O.ComposeSizes.LARGE:P;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),C(this,"mode",i,this),C(this,"size",a,this),C(this,"currentPromo",s,this),this._loadingPromise=null,C(this,"waitToClose",c,this),C(this,"waitToCollapse",u,this),C(this,"_params",l,this),C(this,"_predefinedData",p,this),this.onSendSuccess=function(){var e=E(regeneratorRuntime.mark(function e(n){var r,o,i,a,s,c,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.responseData,o=n.composeParamsData,i=n.miniData,a=n.withUndo,s=n.sendTime,c=n.preventLeave,t.leaveComposeController.sendMetrika(),t.miniData.update(i).catch(function(){}),u=Boolean(s),t.leaveComposeController.showMessageSentNotification({sentMid:r.storedmid,wasSendCancelled:!1,withUndo:a,isDelayed:u,sendTime:s}),(l=t.composeParamsService).data=o.data,l.params=o.params,l.isDraft()?t.syncRelatedModelsService.updateDraftAfterAction(!1,l.data.overwrite):(u||a)&&t.syncRelatedModelsService.updateOutboxAfterAction(),t.syncRelatedModelsService.updateMessageFlagsAfterSend(l.data.mark_ids,{isForward:l.isForward(),isReply:l.isReplyAny(),replyMessageId:l.data.inreplyto}),t.sendTime=s,c||(t.pageAfterSend=t.leaveComposeController.getPageAfterSent(),t.setWaitToClose(!0),l.isForward()&&t.syncRelatedModelsService.resetCheckedMessages());case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.onSaveSuccess=function(){var e=E(regeneratorRuntime.mark(function e(n){var r,o,i,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.dataUpdate,o=n.miniData,i=n.composeParamsData,a=n.responseData,t.updateAfterSave(r),(s=t.composeParamsService).data=i.data,s.params=i.params,t.miniData.update(o),t.isDraft?t.syncRelatedModelsService.updateDraftAfterAction(!0,a.storedmid):t.composeParamsService.isTemplate()&&t.syncRelatedModelsService.updateTemplateAfterAction(a.storedmid);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.onClose=function(){var e=E(regeneratorRuntime.mark(function e(n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.leaveType,e.t0=r,e.next=e.t0===g.LeaveTypes.COLLAPSE?4:e.t0===g.LeaveTypes.CLOSE?6:e.t0===g.LeaveTypes.SENT?8:e.t0===g.LeaveTypes.DELETE?11:14;break;case 4:return t.setWaitToCollapse(!0),e.abrupt("break",14);case 6:return t.setWaitToClose(!0),e.abrupt("break",14);case 8:return t.pageAfterSend=t.leaveComposeController.getPageAfterSent(),t.setWaitToClose(!0),e.abrupt("break",14);case 11:return t.ignoreChanges=!0,t.setWaitToClose(!0),e.abrupt("break",14);case 14:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.changeWorkMode=function(e){var n=e.mode;t.composeAdapter.sender.changeWorkMode({mode:n}).then(function(){},function(e){"dispose"!==e&&Jane.ErrorLog.log({type:_.ErrorType.Component,block:_.ErrorBlock.Compose,source:_.ErrorSource.Logic,sourceMethod:_.ErrorSourceMethod.Compose,method:"changeWorkMode"},e)})},this.id=Object(f.uniqueId)("compose_state_"),this._params=r||{},this._predefinedData=o,this.size=w,this.services=y,this.controllers=S,this.composeAdapter=new b.b(this),this.composeParamsService=new h.a(r,o),this.undoSendController=new v.a(r),this.miniData=new m.a(d,r.mailboxUid)}return function(e,t,n){t&&P(e.prototype,t),n&&P(e,n)}(e,[{key:"maximize",value:function(){this.mode="maximized",this.undoSendController.composeLoaded=!0}},{key:"minimize",value:function(){this.mode="minimized",this._loadingPromise=null,this.undoSendController.composeLoaded=!1,this.onClosePromo()}},{key:"setMaximized",value:function(){this.mode="maximized"}},{key:"waitLoad",value:function(){var e=E(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.maximize(),this._loadingPromise||(this._loadingPromise=E(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.composeAdapter.waitLoad();case 2:return e.next=4,t.loadCompose();case 4:case"end":return e.stop()}},e)}))()),e.abrupt("return",this._loadingPromise);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setWaitToClose",value:function(e){this.waitToClose=e}},{key:"setWaitToCollapse",value:function(e){this.waitToCollapse=e}},{key:"isEqual",value:function(e){return d.a.isEqual(e.params,this.params)}},{key:"setCurrentScenario",value:function(e){return this.composeAdapter.setCurrentScenario(e)}},{key:"disconnect",value:function(){return"maximized"===this.mode&&this.setWaitToClose(!0),this.composeAdapter.disconnect()}},{key:"loadCompose",value:function(){var e=E(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={params:this._params,predefinedData:this._predefinedData},e.next=3,this.composeAdapter.sender.loadWithParams({initParams:t});case 3:return n=e.sent,r=n.miniData,e.abrupt("return",this.miniData.update(r));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveData",value:function(){var e=E(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.composeAdapter.sender.saveData();case 2:return t=e.sent,n=t.saveDataResult,r=t.miniData,e.next=7,this.miniData.update(r);case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateAfterSave",value:function(e){e.mailboxUid=e.mailboxUid||this._params.mailboxUid||null,e.ids=e.overwriteIds||this._params.ids,delete e.overwriteIds,this._params=e}},{key:"changeSize",value:function(e,t){this.size=e,this.composeAdapter.sender.changeSize(this.size).then(Object(y.action)(function(){}),Object(y.action)(function(e){"dispose"!==e&&"not ready"!==e&&Jane.ErrorLog.log({type:_.ErrorType.Component,block:_.ErrorBlock.Compose,source:_.ErrorSource.Logic,sourceMethod:_.ErrorSourceMethod.Compose,method:"changeSize"},e)})),t&&(this.controllers.settings.lastUsedComposeSize=e),e===O.ComposeSizes.LARGE&&this.syncRelatedModelsService.resetCheckedMessages()}},{key:"setCurrentPromo",value:function(e,t,n){this.currentPromo=e,this.currentPromoActions=t,this.composeAdapter.sender.setCurrentPromo(e,n)}},{key:"clearPromo",value:function(){this.setCurrentPromo(null,null,null)}},{key:"onClosePromo",value:function(){this.currentPromoActions&&this.currentPromoActions.onClose(),this.currentPromo=null,this.currentPromoActions=null}},{key:"onShowPromo",value:function(){this.currentPromoActions&&this.currentPromoActions.onShow(this)}},{key:"collapseAllComposes",value:function(){this.currentPromoActions&&this.currentPromoActions.collapseAllComposes()}},{key:"showAbookPopup",value:function(e){this.abookPopupController.showAbookPopup(e)}},{key:"leaveComposeController",get:function(){return this.controllers.leaveCompose}},{key:"syncRelatedModelsService",get:function(){return this.services.syncRelatedModels}},{key:"abookPopupController",get:function(){return this.controllers.abookPopup}},{key:"minimized",get:function(){return"minimized"===this.mode}},{key:"maximized",get:function(){return"maximized"===this.mode}},{key:"params",get:function(){return{ids:this._params.ids,tids:this._params.tids,oper:this._params.oper,qrAttaches:this._params.qrAttaches||[],mailboxUid:this._params.mailboxUid}}},{key:"mailboxUid",get:function(){return this._params.mailboxUid}},{key:"predefinedData",get:function(){return this._predefinedData}},{key:"hasEmptyParams",get:function(){return!(this.params.ids||this.params.tids||this.params.oper)}},{key:"hasEmptyPredefinedData",get:function(){return!this._predefinedData||d.a.isEqual(this._predefinedData,{})}},{key:"isDraft",get:function(){return this.composeParamsService.isDraft()}},{key:"isTemplate",get:function(){return this.composeParamsService.isTemplate()}},{key:"isNewTemplate",get:function(){return this.composeParamsService.isNewTemplate()}},{key:"isEmpty",get:function(){return this.hasEmptyParams&&this.hasEmptyPredefinedData}}]),e}()).prototype,"mode",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"minimized"}}),a=w(o.prototype,"size",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return O.ComposeSizes.LARGE}}),s=w(o.prototype,"currentPromo",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w(o.prototype,"leaveComposeController",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"leaveComposeController"),o.prototype),w(o.prototype,"syncRelatedModelsService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"syncRelatedModelsService"),o.prototype),w(o.prototype,"abookPopupController",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"abookPopupController"),o.prototype),w(o.prototype,"minimized",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"minimized"),o.prototype),w(o.prototype,"maximized",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"maximized"),o.prototype),w(o.prototype,"maximize",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"maximize"),o.prototype),w(o.prototype,"minimize",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"minimize"),o.prototype),w(o.prototype,"setMaximized",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"setMaximized"),o.prototype),c=w(o.prototype,"waitToClose",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),w(o.prototype,"setWaitToClose",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"setWaitToClose"),o.prototype),u=w(o.prototype,"waitToCollapse",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),w(o.prototype,"setWaitToCollapse",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"setWaitToCollapse"),o.prototype),l=w(o.prototype,"_params",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w(o.prototype,"params",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"params"),o.prototype),w(o.prototype,"mailboxUid",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"mailboxUid"),o.prototype),p=w(o.prototype,"_predefinedData",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w(o.prototype,"predefinedData",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"predefinedData"),o.prototype),w(o.prototype,"hasEmptyParams",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasEmptyParams"),o.prototype),w(o.prototype,"hasEmptyPredefinedData",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasEmptyPredefinedData"),o.prototype),w(o.prototype,"isEmpty",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"isEmpty"),o.prototype),w(o.prototype,"updateAfterSave",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"updateAfterSave"),o.prototype),w(o.prototype,"changeSize",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"changeSize"),o.prototype),w(o.prototype,"setCurrentPromo",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"setCurrentPromo"),o.prototype),w(o.prototype,"clearPromo",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"clearPromo"),o.prototype),w(o.prototype,"onClosePromo",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"onClosePromo"),o.prototype),o)},function(e,t,n){"use strict";var r=n(2626);n.d(t,"a",function(){return r.a}),n.d(t,"b",function(){return r.b});var o=n(3044);n.d(t,"c",function(){return o.a})},function(e,t,n){"use strict";var r=n(2634);n.d(t,"a",function(){return r.a});var o=n(2635);n.d(t,"b",function(){return o.a});var i=n(2636);n.d(t,"c",function(){return i.a});var a=n(2637);n.d(t,"d",function(){return a.a});var s=n(2638);n.d(t,"e",function(){return s.a});var c=n(2639);n.d(t,"f",function(){return c.a});var u=n(2640);n.d(t,"g",function(){return u.a});var l=n(2641);n.d(t,"h",function(){return l.a});var p=n(2642);n.d(t,"i",function(){return p.a});var f=n(2643);n.d(t,"l",function(){return f.a});var d=n(2644);n.d(t,"m",function(){return d.a});var y=n(2645);n.d(t,"n",function(){return y.a});var b=n(2646);n.d(t,"o",function(){return b.a});var m=n(2649);n.d(t,"p",function(){return m.a});var h=n(2650);n.d(t,"q",function(){return h.a});var v=n(2651);n.d(t,"r",function(){return v.a});var g=n(2652),O=n.n(g);n.d(t,"s",function(){return O.a});var _=n(2653);n.d(t,"t",function(){return _.a});var S=n(2654);n.d(t,"u",function(){return S.a});var E=n(2655);n.d(t,"v",function(){return E.a});var P=n(2656);n.d(t,"w",function(){return P.a});var C=n(2657);n.d(t,"x",function(){return C.a});var w=n(2658);n.d(t,"y",function(){return w.a});var T=n(2660);n.n(T);n.o(T,"MessageBodyController")&&n.d(t,"j",function(){return T.MessageBodyController});var k=n(2661),A=n.n(k);n.d(t,"k",function(){return A.a})},function(e,t,n){"use strict";var r=n(357),o=n(457);t.a=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.meta,i=n&&n.mediatype||"unknown";"image"===i&&(e=n&&n.preview);var a,s=t.type===o.d;return a=s?n&&n.group&&n.group.size:n&&n.size,{name:t.name,type:r.d.YADISK,size:a,narodPreview:e,folder:s,mediaType:i,diskSrcPath:t.id}}},function(e,t,n){"use strict";var r=n(357),o=n(479),i=function(e){return e.map(function(e){return Object(o.a)(e.info)||0}).reduce(function(e,t){return e+t},0)};t.a=function(e){var t=e.filter(function(e){return e.info.type===r.d.FILE}),n=e.filter(function(e){return e.info.type===r.d.YADISK}),o=e.filter(function(e){return e.info.type===r.d.FORWARDED_MAIL}).map(function(e){return e.info.mid});return{hasAttachments:e.length>0,fileAttachmentsCount:t.length,fileAttachmentsSize:i(t),diskAttachmentsCount:n.length,diskAttachmentsSize:i(n),forwardedMailsAttachmentsCount:o.length,relatedMailIds:o}}},function(e,t,n){"use strict";var r=n(357),o=n(587);t.a=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0;return e.type!==r.d.YADISK&&(e.att_id?t=n.filter(function(t){return t.att_id===e.att_id})[0]:e.hid&&(t=n.filter(function(t){return t.old_hid===e.hid})[0]),!!t&&(e.from_template=void 0,e.template_hid=void 0,e.template_mid=void 0,e.att_id=void 0,e.url=void 0,e.hid=t.hid,e.mid=i,e.id=Object(o.a)(e),n.splice(n.indexOf(t),1),!0))}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isOn=!1,this.wasPageHidden=!1,this.prevTime=null,this.fpsLevels=[],this.counters={},this._onPageVisibilityChanged=function(e,t){r.wasPageHidden=r.wasPageHidden||!t.value},this.area=t,this.fpsLevels=Object.keys(n).map(function(e){return{key:e,value:n[e]}}).sort(function(e,t){return e.value-t.value}),this._resetCounters()}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"_hasPerformance",value:function(){return Boolean(window.performance&&window.performance.now)}},{key:"_resetCounters",value:function(){var e=this;this.counters={total:0},this.fpsLevels.forEach(function(t){return e.counters[t.key]=0})}},{key:"processFrame",value:function(){var e=performance.now();if(this.prevTime&&!this.wasPageHidden){var t=e-this.prevTime,n=Math.round(1e3/t),r="";if(this.fpsLevels.some(function(e){return r=e.key,e.value>=n})&&this.counters.hasOwnProperty(r)){var o=Math.floor(t/(1e3/30));this.counters[r]+=o}this.counters.total++}this.prevTime=e,this.wasPageHidden=!1}},{key:"start",value:function(){var e=this;this.stop(),this._resetCounters(),this.isOn=this._hasPerformance(),this.prevTime=null;!function t(){e.isOn&&(e.processFrame(),requestAnimationFrame(t))}(),ns.events.on("pageVisible.change",this._onPageVisibilityChanged)}},{key:"stop",value:function(){this.isOn=!1,ns.events.off("pageVisible.change",this._onPageVisibilityChanged)}},{key:"logCounters",value:function(){this._hasPerformance()&&Daria.monitoring.performance.fps(this.area,this.counters)}},{key:"finish",value:function(){this.stop(),this.logCounters()}}]),e}();o.defaultConfig={slow:30,freeze:5}},,,function(e,t,n){"use strict";var r=n(338),o=n.n(r),i=n(2678);t.a=o.a.shape({avatar:i.a,name:o.a.string.isRequired,isGroup:o.a.func.isRequired,count:o.a.number.isRequired,email:o.a.string.isRequired})},,,function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},u=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},l=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var f=a(n(135)),d=n(397),y=p(n(795));t.default=function(e){var t=e.contact,n=u(e,["contact"]),o=d.useStores().controllers.avatars,i=l(f.useState(),2),a=i[0],p=i[1];return f.useEffect(function(){s(void 0,void 0,Promise,function(){var e;return c(this,function(n){switch(n.label){case 0:return[4,o.getAvatarForContact(t)];case 1:return e=n.sent(),p(e),[2]}})})},[o,t]),f.default.createElement(y.default,r({},n,a))}},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scrollIntoView=t.scrollTo=void 0;var r="scrollBehavior"in document.documentElement.style;t.scrollTo=function(e,t){var n=t.top,o=t.isSmooth,i=void 0===o||o;e&&(r?e.scrollTo({top:n,behavior:i?"smooth":"auto"}):e.scrollTop=n)},t.scrollIntoView=function(e,t){if(r)e.scrollIntoView(t);else if("boolean"==typeof t||void 0===t)e.scrollIntoView(t);else{var n="end"!==t.block;e.scrollIntoView(n)}}},,function(e,t,n){"use strict";var r=n(2760),o=n(2860);n.d(t,"a",function(){return o.a}),t.b=r.a},function(e,t,n){"use strict";n.d(t,"a",function(){return f}),n.d(t,"b",function(){return d});var r=n(338),o=n.n(r),i=n(361),a=n(356),s=n(366);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){l(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p={cls:o.a.string},f=u({},p,{services:a.a.isRequired,visual:s.a.isRequired}),d=u({},p,{controllers:i.a.isRequired})},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var r=n(2762),o=n(2769),i=n(2775),a=n(484),s=n(545),c=n(2784),u=n(2786),l=n(420),p=n(354),f=(n.n(p),Object(c.a)(r.b,{label:"compose-react/Attachments_LocalFiles"})),d={PopupContent:o.a,cls:r.a.Popup,metrikaArgs:[p.COMPOSE_METRIKA_FOOTER_ATTACHMENTS,p.COMPOSE_METRIKA_FOOTER_ATTACHMENTS_CLICK],directions:["top"],title:"compose-react/AttachmentsPopup_Title"};t.b=Object(l.a)(Object(s.a)("compose-react/Attachments_LocalFiles",Object(u.a)(f,{shouldCheckUploadDisabled:!1})),Object(s.a)("compose-react/ControlPanel_AttachFile_Tooltip",Object(a.a)(d,Object(u.a)(f,{shouldCheckUploadDisabled:!0}))));var y=Object(a.a)(d,i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(338),o=n.n(r),i=n(136),a=(n.n(i),{LOCAL:"local",DISK:"disk",MAIL:"mail"});t.b=o.a.shape({type:o.a.oneOf(Object(i.values)(a)),icon:o.a.string,loc:o.a.string})},function(e,t,n){"use strict";n.d(t,"b",function(){return d}),n.d(t,"a",function(){return y});var r,o=n(343),i=n.n(o),a=n(136),s=(n.n(a),n(353)),c=n(355),u=(n.n(c),n(2794));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=(p(r={},c.TimePresets.TODAY,19),p(r,c.TimePresets.TOMORROW,12),p(r,c.TimePresets.WEEKEND,12),p(r,c.TimePresets.NEXT_WEEK,12),r),d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){p(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},f,{},t);var n=i()(e()),r=Object(a.values)(u.a).map(function(e){return e(n,t)}).filter(function(e){return e});return r=Object(a.uniq)(r,function(e){return e.value.getTime()})},y=function(e){var t=(e=i()(e)).format(Object(s.default)("compose-react/TimeOptions_TimeFormat"));e=e.startOf("day");var n=i()().startOf("day");return 0===n.diff(e)?{date:Object(s.default)("compose-react/Send_Delayed_Today"),time:t}:0===i()().startOf("day").add(1,"day").diff(e)?{date:Object(s.default)("compose-react/Send_Delayed_Tomorrow"),time:t}:n.year()===e.year()?{date:e.format(Object(s.default)("compose-react/TimeOptions_DateFormat_Short")),time:t}:{date:e.format(Object(s.default)("compose-react/TimeOptions_DateFormat")),time:t}}},function(e,t,n){"use strict";n.d(t,"a",function(){return U});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(361),h=n(363),v=n(356),g=n(718),O=n(366),_=n(461),S=n(427),E=n(344),P=n(1112),C=n(354),w=(n.n(C),n(2823));n.n(w);function T(e){"@babel/helpers - typeof";return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function L(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function N(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var x="ComposeSendButton",B={Block:x,Text:"".concat(x,"-Text"),Delayed:"".concat(x,"_delayed"),MainText:"".concat(x,"-MainText"),SecondaryText:"".concat(x,"-SecondaryText")},F=["SPACE"],z=["ENTER"],U=Object(b.inject)("controllers","data","services","validation","visual")(r=Object(b.observer)((c=s=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return L(M(n=function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?M(e):t}(this,(e=j(t)).call.apply(e,[this].concat(o)))),"onSendTranslation",i,M(n)),L(M(n),"onSend",a,M(n)),n.onClickHandler=function(){return n.isTranslated?n.onSendTranslation():n.onSend()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,p.a.PureComponent),function(e,t,n){t&&R(e.prototype,t),n&&R(e,n)}(t,[{key:"_getDelayedSendText",value:function(){var e=Object(P.a)(this.sendTime),t=this.isTranslated?"compose-react/Send_Translated":"compose-react/Send",n=this.isMobile?"compose-react/SendTime_Mobile":"compose-react/Notifications_ReplyTime";return p.a.createElement(p.a.Fragment,null,D(E.default,{loc:t,className:B.MainText}),D(E.default,{loc:n,className:B.SecondaryText,params:e}))}},{key:"_getSendText",value:function(){var e=this.isTranslated?"compose-react/Send_Translated":"compose-react/Send";return D(E.default,{loc:e})}},{key:"render",value:function(){var e=d()(this.props.cls,B.Block,this.isMobile?"".concat(B.Block,"_mobile"):"".concat(B.Block,"_desktop"),A({},B.Delayed,Boolean(this.sendTime))),t=this.sendTime?this._getDelayedSendText():this._getSendText();return D(S.a,{innerRef:this.props.innerRef,className:e,disabled:this.isLocked,view:this.isMobile?void 0:"action",onClick:this.onClickHandler,pressKeys:z,prvntKeys:F,isAction:!0},void 0,D("div",{className:B.Text},void 0,t))}},{key:"isLocked",get:function(){return this.props.visual.isLocked}},{key:"sendTime",get:function(){return this.props.data.sendTime}},{key:"isTranslated",get:function(){return this.props.visual.translate.isEnabled}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}}]),t}(),s.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach(function(t){A(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},_.a,{controllers:m.a.isRequired,data:h.a.isRequired,services:v.a.isRequired,validation:g.a.isRequired,visual:O.a.isRequired}),N((o=c).prototype,"isLocked",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"isLocked"),o.prototype),N(o.prototype,"sendTime",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"sendTime"),o.prototype),N(o.prototype,"isTranslated",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"isTranslated"),o.prototype),N(o.prototype,"metrikaService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),N(o.prototype,"isMobile",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),i=N(o.prototype,"onSendTranslation",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.controllers.saveSend.sendTranslation(Object(y.action)(function(){var t,n=e.sendTime?[C.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING,C.COMPOSE_METRIKA_TRANSLATION_SEND_BUTTON]:[C.COMPOSE_METRIKA_TRANSLATION_SEND_BUTTON];(t=e.metrikaService).sendFooterMetrika.apply(t,n)}))}}}),a=N(o.prototype,"onSend",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t;e.props.controllers.saveSend.sendMessage();var n=e.sendTime?[C.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING,C.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_SEND]:[C.COMPOSE_METRIKA_FOOTER_SEND];(t=e.metrikaService).sendFooterMetrika.apply(t,n)}}}),r=o))||r)||r},,function(e,t,n){"use strict";var r=n(338),o=(n.n(r),n(1462));t.a=r.PropTypes.shape({addressesFrom:r.PropTypes.instanceOf(o.b),contacts:r.PropTypes.instanceOf(o.a)})},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var r=n(338),o=n.n(r),i=n(363),a=n(366),s=n(356),c=n(361);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p={cls:o.a.string,field:o.a.string.isRequired,innerRef:o.a.object,onFocus:o.a.func,onDragStart:o.a.func,title:o.a.string.isRequired,mailboxUid:o.a.string,data:i.a.isRequired,visual:a.a.isRequired,services:s.a.isRequired},f=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){l(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},p,{controllers:c.a.isRequired,onYabblesChanged:o.a.func,onSelectSuggestContact:o.a.func});t.b=p},,function(e,t,n){"use strict";n.d(t,"a",function(){return N});var r,o,i,a,s,c,u=n(135),l=n.n(u),p=n(341),f=n(342),d=n(338),y=n.n(d),b=n(1514),m=n.n(b),h=n(594),v=n(363),g=n(366),O=n(356),_=n(361),S=n(354),E=(n.n(S),n(355)),P=(n.n(E),n(394)),C=n.n(P),w=n(2944);n.n(w);function T(e){"@babel/helpers - typeof";return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n,r){c||(c="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:c,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function I(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var D="ComposeSubject",L={Block:D,Content:"".concat(D,"-Content"),TextField:"".concat(D,"-TextField"),IFrame:"".concat(D,"-IFrame"),SubmitButton:"".concat(D,"-SubmitButton")},N=Object(f.inject)("data","visual","services","controllers")(r=Object(f.observer)((s=a=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?R(e):t}(this,(e=A(t)).call.apply(e,[this].concat(o)))).disposer=new C.a,n.submitRef=l.a.createRef(),n.fieldId=m()("compose-field-subject-"),function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(R(n),"updateSubject",i,R(n)),n.focusTextField=function(e){e.preventDefault(),e.stopPropagation(),n.props.inputRef.current.focus()},n.onFocus=function(e){var t=n.props.onFocus;t&&t(e),n.metrikaService.sendHeaderMetrika(S.COMPOSE_METRIKA_HEADER_SUBJECT)},n.onKeyDown=function(){n.selectionLength=document.getSelection().toString().length},n.onSending=function(e){e&&n.subject.length&&n.submitRef.current&&n.submitRef.current.click()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,l.a.Component),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this.disposer.add(this,[Object(p.reaction)(function(){return e.props.visual.isSending},this.onSending),Object(p.reaction)(function(){return e.subject},function(t){e.props.inputRef.current.value!==t&&(e.props.inputRef.current.value=t)})])}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"render",value:function(){return M("div",{className:L.Block},void 0,this._renderContent())}},{key:"_renderContent",value:function(){var e=this;return M(h.d,{getRef:this.props.innerRef,title:this.props.title,onTitleClick:this.focusTextField,contentClass:L.Content,fieldId:this.fieldId},void 0,M(h.f,{fieldId:this.fieldId,cls:L.TextField,getRef:function(t){return e.props.inputRef.current=t},value:this.subject,onChange:this.updateSubject,onFocus:this.onFocus,onClick:this.onClick,onKeyDown:this.onKeyDown,name:"subject",autoComplete:this.autocompleteOff?"off":"on"}))}},{key:"subject",get:function(){return this.props.data.subject||""}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"complexityLogger",get:function(){return this.props.controllers.compose.complexityLogger}},{key:"autocompleteOff",get:function(){return this.props.services.settings.hasEmptySubjectPopup}}]),t}(),a.propTypes={innerRef:y.a.object,inputRef:y.a.object,onClick:y.a.func,onFocus:y.a.func,title:y.a.string.isRequired,data:v.a.isRequired,visual:g.a.isRequired,services:O.a.isRequired,controllers:_.a.isRequired},a.defaultProps={innerRef:l.a.createRef(),inputRef:l.a.createRef()},I((o=s).prototype,"subject",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"subject"),o.prototype),I(o.prototype,"metrikaService",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),I(o.prototype,"complexityLogger",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"complexityLogger"),o.prototype),I(o.prototype,"autocompleteOff",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"autocompleteOff"),o.prototype),i=I(o.prototype,"updateSubject",[p.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){e.props.data.subject=t,e.selectionLength>0||(n===E.InputTypes.INSERT_TEXT?e.complexityLogger.increaseSubjectInsertCount():n===E.InputTypes.DELETE_CONTENT_BACKWARD&&e.complexityLogger.increaseSubjectDeleteCount())}}}),r=o))||r)||r},function(e,t,n){"use strict";t.a=function(e){return function(t){function n(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(t=function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,(e=s(n)).call.apply(e,[this].concat(o)))).handleError=function(e){if(e.target&&"IMG"===e.target.tagName&&"js-browse-disk-thumbnail"===e.target.dataset.role){e.stopPropagation(),e.preventDefault();var t=e.target.dataset.fallbackSrc;e.target.src.substr(-t.length)!==t&&(e.target.src=e.target.dataset.fallbackSrc,e.target.dataset.clearClass&&e.target.classList.remove(e.target.dataset.clearClass))}},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,t),function(e,t,n){t&&a(e.prototype,t);n&&a(e,n)}(n,[{key:"componentDidMount",value:function(){window.addEventListener("error",this.handleError,!0)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("error",this.handleError,!0)}},{key:"render",value:function(){return o.a.createElement(e,this.props)}}]),n}(o.a.PureComponent)};var r=n(135),o=n.n(r);function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}},function(e,t){},function(e,t,n){"use strict";var r=n(1122);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return I});var r,o,i,a,s=n(135),c=n.n(s),u=n(338),l=n.n(u),p=n(339),f=n.n(p),d=n(341),y=n(342),b=n(719),m=n.n(b),h=n(1123),v=n(760),g=n(503),O=n(1124),_=n(367),S=n(1125);n.n(S);function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function P(e){"@babel/helpers - typeof";return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t,n,r){a||(a="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var s=new Array(i),c=0;c<i;c++)s[c]=arguments[c+3];t.children=s}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:a,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var j=function(){return Jane.Services.runModules(["disk-resources.js","disk-resources.css"]).then(function(){return Daria.React.DiskResourcesContainer})},M=R("div",{className:"diskResources-Placeholder"},void 0,R(g.a,{size:"m"})),I=Object(y.inject)("services")(r=Object(y.observer)((i=o=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=T(this,(e=k(t)).call.apply(e,[this].concat(o))))._disposer=new _.a,n._shortcutsConnected=!1,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,c.a.Component),function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(t,[{key:"_renderPlaceholder",value:function(){return M}},{key:"componentDidMount",value:function(){var e=this;this._togglePageInteraction(this.props.isVisible),this._disposer.add(this,Object(d.reaction)(function(){return e.props.isVisible},function(t){return e._togglePageInteraction(t)}))}},{key:"componentWillUnmount",value:function(){this.props.isVisible&&this._togglePageInteraction(!1),this._disposer.dispose(this)}},{key:"_togglePageInteraction",value:function(e){Object(O.a)(e),this.toggleSelectionOutside(!e),this.toggleShortcuts(e)}},{key:"toggleSelectionOutside",value:function(e){document.body.onselectstart=function(){return e}}},{key:"toggleShortcuts",value:function(e){e?$.Shortcuts.modalListPush("disk-resources")&&(this._shortcutsConnected=!0):this._shortcutsConnected&&($.Shortcuts.modalListPop("disk-resources"),this._shortcutsConnected=!1)}},{key:"render",value:function(){var e=this.props,t=e.isVisible,n=e.onClose,r=C(e,["isVisible","onClose"]),o=this.props.services.settings.isMobile;r.isMobile=o;var i=f()("diskResources",o?"diskResources_mobile":"diskResources_desktop");return R(m.a,{cls:i,visible:t,fullscreen:!0,onClose:n},void 0,R("div",{className:"diskResources-Content"},void 0,c.a.createElement(v.a,E({},r,{loader:j,renderPlaceholder:this._renderPlaceholder}))))}}]),t}(),o.displayName="DiskResources",o.propTypes={isVisible:l.a.bool,services:h.a.isRequired,scope:l.a.instanceOf(Element),onClose:l.a.func},r=i))||r)||r},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a=o.a.shape({settings:o.a.shape({isMobile:o.a.bool})})},function(e,t,n){"use strict";t.a=function(e){Daria.toggleVerticalScrollBar(e),Daria.toggleHorizontalScrollBar(e)}},function(e,t){},,,,function(e,t){e.exports={body:"Content__body--bJhJT",mobile:"Content__mobile--2d8n0",tablet:"Content__tablet--2a1w-",text:"Content__text--ASVn4",buttons:"Content__buttons--NKwPi",button:"Content__button--10pVf"}},function(e,t){e.exports={root:"MailingLists__root--3nnhl",mobile:"MailingLists__mobile--ATnwh",tablet:"MailingLists__tablet--1aVc8",header:"MailingLists__header--2t2ug",hideCheckboxes:"MailingLists__hideCheckboxes--2IZxv",label:"MailingLists__label--cE5BO",list:"MailingLists__list--2zYYt",row:"MailingLists__row--1IHNu",checkbox:"MailingLists__checkbox--2OE4w",email:"MailingLists__email--1G2mj",count:"MailingLists__count--1-pLt",exceeded:"MailingLists__exceeded--Wp4Kb"}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneStatus=void 0,function(e){e.ON="1",e.OFF="0"}(t.PhoneStatus||(t.PhoneStatus={}))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(702);n.d(t,"x",function(){return r.b});var o=n(2554);n.d(t,"a",function(){return o.a});var i=n(784);n.d(t,"b",function(){return i.a});var a=n(2558);n.d(t,"c",function(){return a.a});var s=n(2559);n.d(t,"d",function(){return s.a});var c=n(2560);n.d(t,"e",function(){return c.a});var u=n(2561);n.d(t,"f",function(){return u.a});var l=n(1449);n.d(t,"g",function(){return l.a});var p=n(2567);n.d(t,"h",function(){return p.a});var f=n(2569);n.d(t,"i",function(){return f.a});var d=n(2570);n.d(t,"j",function(){return d.a});var y=n(2571);n.d(t,"k",function(){return y.a});var b=n(2593);n.d(t,"l",function(){return b.a});var m=n(2594);n.d(t,"m",function(){return m.a});var h=n(2596);n.d(t,"o",function(){return h.a});var v=n(2597);n.d(t,"p",function(){return v.a});var g=n(2602);n.d(t,"q",function(){return g.a});var O=n(2603);n.d(t,"r",function(){return O.a});var _=n(2604);n.d(t,"s",function(){return _.a});var S=n(1455);n.d(t,"t",function(){return S.a});var E=n(2605);n.d(t,"u",function(){return E.a});var P=n(2606);n.d(t,"v",function(){return P.a});var C=n(1456);n.d(t,"w",function(){return C.a});var w=n(2607);n.d(t,"y",function(){return w.a});var T=n(2608);n.d(t,"z",function(){return T.a});var k=n(1457);n.d(t,"n",function(){return k.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return a});var r=n(781),o=function(e,t){var n=Object(r.a)(t),o=0;return setInterval(function(){return e(n(o++))},100)},i=function(e){clearInterval(e)},a=function(e,t){var n=e.to-e.from,r=(t.to-t.from)/n;return function(e){return t.from+e*r}}},,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(1072),o=n(783),i=n(782);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(e,t){var n=Object(r.a)(t,e),c=Object(o.a)(n);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},c,{visual:Object(i.a)(c.info,{status:c.status,previewSupported:c.previewSupported})})}},,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(2566);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contactsParser=Object(r.a)()}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(e,[{key:"parseContacts",value:function(e){return this.contactsParser(e).map(function(e){return Jane.FormValidation.contact2obj(e)})}},{key:"contactToString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.email,n=e.name;return Jane.FormValidation.obj2contact({email:t,name:n})}}]),e}()},function(e,t,n){"use strict";n(787);var r=n(2590);n.d(t,"a",function(){return r.a});var o=n(2591);n.d(t,"b",function(){return o.a});var i=n(2592);n.d(t,"c",function(){return i.a})},,,function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(136),o=(n.n(r),function(e,t){var n=Object(r.debounce)(t,0);return e.on("ns-model-changed",n),function(){e.off("ns-model-changed",n)}})},,function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(136),o=(n.n(r),n(349)),i=(n.n(o),n(532)),a=n(499),s=n(355),c=(n.n(s),n(382));function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(e,[{key:"toggleAutocomplete",value:function(){this.data.toggleSetting(s.Settings.DISABLE_AUTOCOMPLETE_REACT)}},{key:"registerChangeSettingsHandler",value:function(e,t){var n=this,r=t?"ns-model-changed.".concat(t):"ns-model-changed";return this.data.on(r,function(t,n,r,o,i){e({eventName:t,jpath:n,fullJpath:r,data:o,previousValue:i})}),function(){n.data.off(r,e)}}},{key:"data",get:function(){return ns.Model.get("settings")}},{key:"areHotkeysEnabled",get:function(){return this.data.getSetting(s.Settings.ENABLE_HOTKEYS)}},{key:"storedComposeStates",get:function(){var e=decodeURIComponent(this.data.getSetting(s.Settings.STORED_COMPOSE_STATES));return e&&"undefined"!==e?JSON.parse(e):[]},set:function(e){"string"!=typeof e&&(e=JSON.stringify(e)),this.data.setSettings({storedComposeStates:encodeURIComponent(e)})}},{key:"sizeLayout",get:function(){return Number(this.data.getSetting(s.Settings.SIZE_LAYOUT))}},{key:"sizeLayoutLeft",get:function(){return Number(this.data.getSetting(s.Settings.SIZE_LAYOUT_LEFT))}},{key:"timelineEnabled",get:function(){return this.data.checkTimelineEnable()}},{key:"timelineExpanded",get:function(){return""!==this.data.getSetting(s.Settings.TIMELINE_EXPANDED)}},{key:"isComposeAutocompleteEnabled",get:function(){return Object(i.a)()===a.a.REACT}},{key:"isNsComposePromoClosed",get:function(){return this.data.getSetting(s.Settings.NS_COMPOSE_PROMO_CLOSED)},set:function(e){this.data.setSettings(u({},s.Settings.NS_COMPOSE_PROMO_CLOSED,e))}},{key:"isRecipientsDiffPromoClosed",get:function(){return this.data.getSetting(s.Settings.RECIPIENTS_DIFF_PROMO_CLOSED)},set:function(e){this.data.setSettings(u({},s.Settings.RECIPIENTS_DIFF_PROMO_CLOSED,e))}},{key:"disableAutocompleteReact",get:function(){return this.data.getSetting(s.Settings.DISABLE_AUTOCOMPLETE_REACT)}},{key:"isBeautifulEmailPromoClosed",get:function(){return this.data.getSetting(s.Settings.BEAUTIFUL_EMAIL_PROMO_CLOSED)},set:function(e){this.data.setSettings(u({},s.Settings.BEAUTIFUL_EMAIL_PROMO_CLOSED,e))}},{key:"hasEmptySubjectPopup",get:function(){return!this.isMobile&&this.isSmartSubjectEnabled}},{key:"isSmartSubjectEnabled",get:function(){return Object(c.getSettingsStore)().isSmartSubjectEnabled},set:function(e){this.data.setSettings(u({},s.Settings.EMPTY_SUBJECT_POPUP_DISABLED,e))}},{key:"topLevelDomain",get:function(){return Daria.Config.TLD}},{key:"autocompleteDelay",get:function(){return 30}},{key:"isMobile",get:function(){return Object(o.hasFeature)(o.Features.WEB_MOBILE_COMPOSE)}},{key:"isTablet",get:function(){return this.isMobile&&Daria.UA.isTablet}},{key:"lang",get:function(){return Daria.locale||"ru"}},{key:"isTopSignature",get:function(){return this.data.getSetting(s.Settings.SIGNATURE_TOP)}},{key:"lastUsedComposeSize",get:function(){return this.data.getSetting(s.Settings.LAST_USED_COMPOSE_SIZE)},set:function(e){this.data.setSettings(u({},s.Settings.LAST_USED_COMPOSE_SIZE,e))}},{key:"numberOfAutosavePromoShow",get:function(){return Number(this.data.getSetting(s.Settings.NUMBER_OF_AUTOSAVE_PROMO_SHOW)||0)},set:function(e){this.data.setSettings(u({},s.Settings.NUMBER_OF_AUTOSAVE_PROMO_SHOW,e))}},{key:"muteAutosavePromoUntil",get:function(){return Number(this.data.getSetting(s.Settings.MUTE_AUTOSAVE_PROMO_UNTIL)||0)},set:function(e){this.data.setSettings(u({},s.Settings.MUTE_AUTOSAVE_PROMO_UNTIL,e))}},{key:"canWriteLetters",get:function(){var e=this.data.getSetting(s.Settings.CAN_WRITE_LETTERS);return void 0===e||e}},{key:"isEditContactAllowed",get:function(){return!Object(o.hasFeature)(o.Features.WEB_SMART_DISPLAY_NAME)}},{key:"isDefaultEmailLocked",get:function(){return Boolean(this.data.getSetting(s.Settings.LOCK_DEFAULT_EMAIL))}}]),e}();p.instance=Object(r.memoize)(function(){return new p})},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(419),o=n(349);n.n(o);function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){var n=this,o=t.contactsStore;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parseResponse=function(e,t){var o=e[0].getData();if(o){var i=o.contacts||[],a=o.groups||[],s=[].concat(u(i),u(a)).map(function(e){return n.contactsStore.readContact(e.cid)||r.default.of(e)});s.forEach(function(e){return n.contactsStore.writeContact(e)}),t(s)}else t(n.fallback())},this.contactsStore=o}return function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(e,[{key:"getPopularContactsSuggest",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r){ns.request(["abook-suggest"],s({popular:!0,to:t,climit:5,glimit:5},n)).then(function(t){return e.parseResponse(t,r)}).fail(function(){return r(e.fallback())})})}},{key:"getQuerySuggest",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{useAbook:!0},a=r.useAbook,c=i(r,["useAbook"]);return new Promise(function(r){ns.request(["abook-suggest"],s({q:e,to:n,climit:5,glimit:5,useAbook:a?"on":null,alternateOrder:Object(o.hasFeature)(o.Features.WEB_SMART_DISPLAY_NAME)?"1":""},c)).then(function(e){return t.parseResponse(e,r)}).fail(function(){return r(t.fallback())})})}},{key:"fallback",value:function(){return[]}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1458);n.n(r);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(e,[{key:"getMaxSizeForSingleFile",value:function(e){return e?this.maxSizeForDiskUploadSingleFile:this.maxSizeForDirectUploadSingleFile}},{key:"_model",get:function(){return ns.Model.get("system-status")}},{key:"maxDestinations",get:function(){return this._model.get(".limits.config.maxDestinations")}},{key:"maxDestinationsWithMailingLists",get:function(){return this._model.get(".limits.config.maxDestinationsWithMailingLists")}},{key:"maxUsers",get:function(){return this._model.get(".limits.config.maxUsers")}},{key:"maxTotalAttachmentsSize",get:function(){return this._model.get(".limits.config.attachmentsMaxSize")}},{key:"maxSizeForDirectUploadSingleFile",get:function(){return this._model.get(".limits.config.singleAttachmentMaxSize")}},{key:"maxSizeForDiskUploadSingleFile",get:function(){return 2*r.GB_SIZE}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GB_SIZE=t.MB_SIZE=void 0,t.MB_SIZE=1048576,t.GB_SIZE=1024*t.MB_SIZE},function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"f",function(){return o}),n.d(t,"b",function(){return i}),n.d(t,"d",function(){return a}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return c});var r=31,o=190,i=256,a=4,s=256+a,c=252},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var r,o,i,a,s=n(341),c=n(1077),u=n(367),l=n(3047),p=n(405),f=n(370),d=n(589),y=n(407),b=n(3048),m=n(355),h=(n.n(m),n(380)),v=(n.n(h),n(137));n.n(v);function g(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function O(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){g(i,r,o,a,s,"next",e)}function s(e){g(i,r,o,a,s,"throw",e)}a(void 0)})}}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function E(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var P=(o=E((r=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),S(this,"stack",o,this),S(this,"currentCompose",i,this),S(this,"suggestedBeautifulEmail",a,this),this.openCompose=function(){var e=O(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n._runSafe(function(){return n._doOpenCompose(t)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.expandCompose=function(e){return n._runSafe(function(){return n._doExpandCompose(e)})},this._doOpenCompose=function(){var e=O(regeneratorRuntime.mark(function e(t){var r,o,i,a,s,u,l,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||new c.a({services:n.services,controllers:n.controllers}),n.currentPromo&&(r=n.currentPromo,o=r.name,i=r.actions,a=r.data,t.setCurrentPromo(o,i,a)),e.next=4,n._doExpandCompose(t);case 4:if(e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return n.stack.add(t),n.currentPromo&&(s=n.currentPromo,u=s.name,l=s.actions,p=s.data,t.setCurrentPromo(u,l,p)),e.abrupt("return",!0);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.closeCompose=function(){var e=O(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.collapseCompose(t);case 2:if(e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return n.stack.remove(t),e.abrupt("return",!0);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this._doExpandCompose=function(){var e=O(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!0);case 2:if(n.currentCompose!==t){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,n.collapseCompose(n.currentCompose);case 6:if(e.sent){e.next=9;break}return e.abrupt("return",!1);case 9:return t.size===h.ComposeSizes.LARGE&&t.syncRelatedModelsService&&t.syncRelatedModelsService.resetCheckedMessages(),n._setCurrentCompose(t),e.next=13,t.waitLoad();case 13:return t.changeWorkMode({mode:m.WorkModes.FOREGROUND}),n._logExpand(t),n._disposeOnClose.add(t,Object(s.reaction)(function(){return t.waitToClose},function(e){return e&&n._handleClose(t)})),n._disposeOnCollapse.add(t,Object(s.reaction)(function(){return t.waitToCollapse},function(e){return e&&n._handleCollapse(t)})),n._expandHelper.reportExpand(t.id),e.abrupt("return",!0);case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.collapseCompose=function(){var e=O(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!0);case 2:if(t.maximized){e.next=4;break}return e.abrupt("return",!0);case 4:if(t.ignoreChanges){e.next=11;break}return e.next=7,t.saveData();case 7:if(r=e.sent,r.canContinue){e.next=11;break}return e.abrupt("return",!1);case 11:return t.minimize(),n.currentCompose===t&&n._setCurrentCompose(null),n._disposeOnClose.dispose(t),n._disposeOnCollapse.dispose(t),n._expandHelper.reportCollapse(t.id),t.changeWorkMode({mode:m.WorkModes.BACKGROUND}),e.abrupt("return",!0);case 18:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),this.collapseAllComposes=O(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(n.stack.composeMetaStates.map(n.collapseCompose)));case 1:case"end":return e.stop()}},e)})),this.showPromo=function(e){var t=e.name,r=e.off,o=e.data,i=void 0===o?{}:o,a={onClose:n.onClosePromo,onShow:n.onShowPromo,collapseAllComposes:n.collapseAllComposes};n.currentPromo={name:t,off:r,actions:a,data:i},n.stack.composeMetaStates.forEach(function(e){return e.setCurrentPromo(t,a,i)})},this.onClosePromo=function(){n.stack.composeMetaStates.forEach(function(e){return e.clearPromo()}),n.currentPromo=null},this.onShowPromo=function(e){n.currentPromo.off(),n.stack.composeMetaStates.filter(function(t){return t!==e}).forEach(function(e){return e.clearPromo()})};var r=t.services,p=t.controllers;this.services=r,this.controllers=p,this.stack=new b.a(t),this._disposeOnClose=new u.a,this._disposeOnCollapse=new u.a,this._expandHelper=new l.a,this._running=Promise.resolve()}return function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(e,[{key:"connect",value:function(){this.stack.connect()}},{key:"_runSafe",value:function(e){return this._running=this._running.then(e)}},{key:"_handleClose",value:function(){var e=O(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.closeCompose(t);case 2:e.sent&&"sent_list"===t.pageAfterSend&&(n=ns.Model.get("folders").getFidBySymbol(v.WellKnownFolderSymbol.SENT),r=ns.router.generateUrl("messages",{current_folder:n}),ns.page.go(r));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_handleCollapse",value:function(e){return e.waitToCollapse=!1,this.collapseCompose(e)}},{key:"_setCurrentCompose",value:function(e){this.currentCompose=e}},{key:"_logExpand",value:function(e){var t=e.size===h.ComposeSizes.SMALL;if(p.a.hasActiveScenario(f.b)){var n=p.a.getActiveScenario(f.b),r=n.getTimeFromStart();n.logStep(d.d,{duration:r,usedSmall:t})}else p.a.startScenario(f.b,y.d,{usedSmall:t});e.setCurrentScenario(p.a.getActiveScenario(f.b))}},{key:"setSuggestedBeautifulEmail",value:function(e){this.suggestedBeautifulEmail=e}}]),e}()).prototype,"stack",[s.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i=E(r.prototype,"currentCompose",[s.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a=E(r.prototype,"suggestedBeautifulEmail",[s.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E(r.prototype,"_handleCollapse",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"_handleCollapse"),r.prototype),E(r.prototype,"_setCurrentCompose",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"_setCurrentCompose"),r.prototype),E(r.prototype,"setSuggestedBeautifulEmail",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"setSuggestedBeautifulEmail"),r.prototype),r)},function(e,t,n){"use strict";var r=n(2628);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";var r=n(2633);n.d(t,"b",function(){return r.a});var o=n(1188);n.d(t,"a",function(){return o.a})},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return a});var r=n(1444);var o=new r.g,i={avatars:new r.b,captcha:new r.c,composeRequest:new r.f,contactsFormatter:o,date:new r.i,errors:new r.j,logContactValidation:new r.o,logSuggest:new r.p,metrika:new r.q,pageReload:new r.r,removeDraft:new r.s,settings:r.t.instance(),signatures:new r.u,syncRelatedModels:new r.x,templates:new r.y({contactsFormatter:o}),labels:new r.m},a=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.abookPopup=i.abookPopup,this.avatars=i.avatars,this.captcha=i.captcha,this.composeRequest=i.composeRequest,this.contactsFormatter=i.contactsFormatter,this.date=i.date,this.dateFormat=i.dateFormat,this.errors=i.errors,this.loadData=i.loadData,this.logContactValidation=i.logContactValidation,this.logSuggest=i.logSuggest,this.pageReload=i.pageReload,this.removeDraft=i.removeDraft,this.settings=i.settings,this.signatures=i.signatures,this.syncRelatedModels=i.syncRelatedModels,this.templates=i.templates,this.labels=i.labels,this.htmlProcessor=new r.l,this.composeParams=new r.e(n.params,n.predefinedData,o.mailboxUid),this.metrika=new r.q(n.params),this.checkEmptyDraft=new r.d(this.composeParams.defaultMessageData.send,this),this.contacts=new r.h(t.contacts,i.errors),this.smartSubject=new r.v,this.suggest=new r.w({contactsStore:t.contacts}),this.hotkeys=new r.k,this.attachments=new r.a(this.composeParams,o.mailboxUid),this.translate=new r.z(this),this.limits=new r.n}},function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"a",function(){return a});var r=n(1079),o=n(1463);var i={avatars:new r.c(o.b.avatars),settings:new r.r(o.b.settings)},a=function e(t){var n=t.services,o=t.stores,a=t.environmentAdapter,s=t.visualState,c=t.data,u=t.validation,l=t.mailboxUid;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var p={services:n,stores:o,controllers:this,environmentAdapter:a,visualState:s,data:c,mailboxUid:l,validation:u};this.avatars=i.avatars,this.settings=i.settings,this.messageBody=new r.j(p),this.contacts=new r.f(p),this.contactsSuggest=new r.u(p),this.hotkeys=new r.h(p),this.recipientsDiff=new r.m(p),this.attachments=new r.a(p),this.autoSave=new r.b(p),this.validation=new r.x(p),this.compose=new r.e(p),this.quickReply=new r.l(p),this.checkUnsavedChanges=new r.d(p),this.saveOnClose=new r.n(p),this.selfRecipient=new r.p(p),this.smartSubject=new r.t(p),this.signatures=new r.s(p),this.translate=new r.w(p),this.templates=new r.v(p),this.labels=new r.i(p),this.deleteDraft=new r.g(p),this.serialization=new r.q(p),this.saveSend=new r.o(p),this.visual=new r.y(p),this.notification=new r.k(p)}},function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"c",function(){return u}),n.d(t,"a",function(){return l});var r,o,i,a=n(357);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=(s(r={},a.e.UNKNOWN,{key:"compose-react/ErrorCode_Attachments_Unknown"}),s(r,a.e.FILE_LIMIT,{key:"compose-react/ErrorCode_Attachments_FileLimit"}),s(r,a.e.TOTAL_LIMIT,{key:"compose-react/ErrorCode_Attachments_TotalLimit"}),s(r,a.e.VIRUS,{key:"compose-react/ErrorCode_Attachments_Virus"}),s(r,a.e.DISK_FULL,{key:"compose-react/ErrorCode_Attachments_DiskFull"}),s(r,a.e.DISK_TECHNICAL_WORK,{key:"compose-react/ErrorCode_Attachments_DiskTrafficLimitError_Title"}),s(r,a.e.DISK_TRAFFIC_LIMIT,{key:"compose-react/ErrorCode_Attachments_DiskTrafficLimitError_Title"}),r),u=(s(o={},a.e.UNKNOWN,"unknown"),s(o,a.e.FILE_LIMIT,"file limit"),s(o,a.e.TOTAL_LIMIT,"total limit"),s(o,a.e.VIRUS,"virus"),s(o,a.e.DISK_FULL,"disk full"),o),l=(s(i={},a.e.UNKNOWN,{key:"compose-react/ErrorCode_Attachments_Unknown_Description"}),s(i,a.e.FILE_LIMIT,{key:"compose-react/ErrorCode_Attachments_FileLimit_Description",extraKeyCorp:"compose-react/ErrorCode_Attachments_FileLimit_Description_NoDisk",extraKeyProd:"compose-react/ErrorCode_Attachments_FileLimit_Description_NoDisk_Prod"}),s(i,a.e.TOTAL_LIMIT,{key:"compose-react/ErrorCode_Attachments_TotalLimit_Description",extraKeyCorp:"compose-react/ErrorCode_Attachments_TotalLimit_Description_Corp",extraKeyProd:"compose-react/ErrorCode_Attachments_TotalLimit_Description_NoDisk_Prod"}),s(i,a.e.VIRUS,{key:"compose-react/ErrorCode_Attachments_Virus_Description"}),s(i,a.e.DISK_FULL,{key:"compose-react/ErrorCode_Attachments_DiskFull_Description"}),s(i,a.e.DISK_TECHNICAL_WORK,{key:"compose-react/ErrorCode_Attachments_DiskTrafficLimitTechnicalError_Description"}),s(i,a.e.DISK_TRAFFIC_LIMIT,{key:"compose-react/ErrorCode_Attachments_DiskTrafficLimitError_Description"}),i)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(532);function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.smartComposeShows=0,this.smartComposeUses=0,this.smartComposeLettersTotal=0,this.subjectInsertCount=0,this.subjectDeleteCount=0,this.bodyInsertCount=0,this.bodyDeleteCount=0,this.smartSubjectMode="line|popup",this.smartSubjectsUses=0,this.smartSubjectLastUsedText="",this.smartSubjectLastUsedItems=[],this.signatureWasChanged=!1}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"addSmartComposeMeasure",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).length;e&&(this.smartComposeUses+=1,this.smartComposeLettersTotal+=e)}},{key:"getSummary",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).subject,t=void 0===e?"":e,n=t.length;return{autocomplete:Object(r.c)(),smartComposeShows:this.smartComposeShows,smartComposeUses:this.smartComposeUses,smartComposeLettersTotal:this.smartComposeLettersTotal,subjectInsertCount:this.subjectInsertCount,subjectDeleteCount:this.subjectDeleteCount,bodyInsertCount:this.bodyInsertCount,bodyDeleteCount:this.bodyDeleteCount,wasSSUsed:Boolean(this.smartSubjectsUses),smartSubjectMode:this.smartSubjectMode,subjectLength:n,sSSuccessRate:this._calculateSharedPrefix(t,this.smartSubjectLastUsedText),sSAbstractSuccessRate:this._calculateItemsSharedPrefix(t,this.smartSubjectLastUsedItems),signatureWasChanged:this.signatureWasChanged}}},{key:"_calculateItemsSharedPrefix",value:function(e,t){var n=this;return e.length?Math.max.apply(Math,o(t.map(function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{text:""}).text;return n._calculateSharedPrefix(e,t)}))):0}},{key:"_calculateSharedPrefix",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Math.min(e.length,t.length),r=0;r<n;r++)if(e[r]!==t[r])return r/e.length;return n/e.length}},{key:"increaseSubjectInsertCount",value:function(){this.subjectInsertCount+=1}},{key:"increaseSubjectDeleteCount",value:function(){this.subjectDeleteCount+=1}},{key:"increaseBodyInsertCount",value:function(){this.bodyInsertCount+=1}},{key:"increaseBodyDeleteCount",value:function(){this.bodyDeleteCount+=1}},{key:"increaseSmartComposeShows",value:function(){this.smartComposeShows+=1}},{key:"addSmartSubjectUsage",value:function(e){var t=e.text,n=void 0===t?"":t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.smartSubjectsUses++,this.smartSubjectLastUsedText=n,this.smartSubjectLastUsedItems=r}},{key:"setSignatureWasChanged",value:function(e){this.signatureWasChanged=e}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1468);function o(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(e,[{key:"onNeedRemoveDraft",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onSaveSuccess",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onSaveFailed",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onSending",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onSendSuccess",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onSendFailed",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onFieldChanged",value:function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.fieldName;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"onShowNotification",value:function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"onClose",value:function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.leaveType;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"openTemplate",value:function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.params;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"openTemplatesManager",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"openSignaturesSettings",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"manageLabels",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"changeSize",value:function(){var e=i(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onShowPromo",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onClosePromo",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"showAbookPopup",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"showPddRestrictPopup",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"loadExternalEmails",value:function(){var e=i(regeneratorRuntime.mark(function e(){var t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.length>0&&void 0!==t[0]?t[0]:[];case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"getExternalEmails",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"apdexStart",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"apdexSendDelta",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"apdexSend",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}();Object(r.a)(s)},function(e,t,n){"use strict";t.a=function(e){var t=Object.getOwnPropertyNames(e.prototype).filter(function(t){return"function"==typeof e.prototype[t]&&"constructor"!==t});return Object.freeze(t)}},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(2667);function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)})}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=c(this,u(t).call(this)))._options={},n.composeState=e,n._options=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r["a"]),function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(t,[{key:"loadWithParams",value:function(){var e=a(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.initParams,e.next=3,this.composeState.setInitParams(n);case 3:return e.next=5,this.composeState.fill();case 5:return this._options.onDataLoaded&&this._options.onDataLoaded(),r=this.composeState.getMiniData(),e.abrupt("return",{miniData:r});case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveData",value:function(){var e=a(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.composeState.saveData();case 2:return t=e.sent,n=this.composeState.getMiniData(),e.abrupt("return",{saveDataResult:t,miniData:n});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"changeWorkMode",value:function(){var e=a(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.mode,this.composeState.changeWorkMode({mode:n});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"changeSize",value:function(){var e=a(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.composeState.changeSize(t);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setCurrentPromo",value:function(){var e=a(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.composeState.setCurrentPromo(t,n);case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()}]),t}()},function(e,t,n){"use strict";n(2669),n(1471);var r=n(2720);n.d(t,"a",function(){return r.a});var o=n(2994);n.d(t,"c",function(){return o.a});var i=n(1089),a=(n.n(i),n(803),n(807),n(1524));n.d(t,"b",function(){return a.a});n(1528),n(1118)},function(e,t,n){"use strict";n.d(t,"a",function(){return se});var r,o,i,a,s,c,u,l,p,f,d,y,b,m,h,v,g=n(135),O=n.n(g),_=n(338),S=n.n(_),E=n(339),P=n.n(E),C=n(341),w=n(342),T=n(376),k=n.n(T),A=n(394),R=n.n(A),j=n(553),M=(n.n(j),n(363)),I=n(361),D=n(356),L=n(366),N=n(710),x=n.n(N),B=n(1473),F=n(711),z=n(794),U=(n.n(z),n(2689)),K=n(419),H=n(1474),W=n(1476),Y=n(380),G=(n.n(Y),n(2715)),q=n(2717),V=n(459),$=(n.n(V),n(354)),Q=(n.n($),n(2719));n.n(Q);function X(e){"@babel/helpers - typeof";return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function J(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ne(e,t,n,r){v||(v="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:v,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function re(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function oe(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var ie="ComposeAddressFrom",ae={Block:ie,Popup:"".concat(ie,"-Popup"),Popup_small:"".concat(ie,"-Popup_small"),Field:"".concat(ie,"-Field"),Content:"".concat(ie,"-Content")},se=Object(w.inject)("data","controllers","services","visual")(r=Object(w.observer)((h=m=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),m=0;m<r;m++)o[m]=arguments[m];return(n=function(e,t){return!t||"object"!==X(t)&&"function"!=typeof t?ee(e):t}(this,(e=Z(t)).call.apply(e,[this].concat(o)))).disposer=new R.a,re(ee(n),"isEditing",i,ee(n)),re(ee(n),"isShowingPopup",a,ee(n)),re(ee(n),"textFieldRef",s,ee(n)),n.yabbleRef=O.a.createRef(),n.labelRef=O.a.createRef(),n.fieldRef=O.a.createRef(),n.contentRef=O.a.createRef(),n.beautifulEmailPromoRef=O.a.createRef(),n.suggestBeautifulEmailPromoRef=O.a.createRef(),n.onShowPromo=function(){n.props.controllers.visual.onShowPromo()},n.onClosePromo=function(){n.props.controllers.visual.onClosePromo()},n.onGoToBeautifulAddressSettings=function(){n.props.controllers.visual.collapseAllComposes()},re(ee(n),"onTopContentInFixedModeChanged",c,ee(n)),n.focusTextField=function(){n.isEditing&&n.textFieldRef&&(n.textFieldRef.focus(),n.textFieldRef.setSelectionRange(0,n.address.name?n.address.name.length:0))},n.onNameChanged=function(e){n.updateAddressFrom({email:n.address.email,name:e})},n.onSelectAddress=function(e){n.updateAddressFrom({email:e,name:n.address.name}),n.closePopup()},re(ee(n),"onStartEditing",u,ee(n)),n.onTitleClick=function(){n.isShowingPopup?n.closePopup():n.showPopup()},n.onOutsideClick=function(e){var t=n.props.innerRef&&n.props.innerRef.current;t&&t.contains(e.target)||n.closePopup()},re(ee(n),"setTextFieldRef",l,ee(n)),re(ee(n),"onWriteOnly",p,ee(n)),re(ee(n),"showPopup",f,ee(n)),re(ee(n),"closePopup",d,ee(n)),n.onEditingKeyDown=function(e){e.keyCode===k.a.ENTER&&n.onStopEditing()},re(ee(n),"onStopEditing",y,ee(n)),re(ee(n),"updateAddressFrom",b,ee(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(t,O.a.Component),function(e,t,n){t&&J(e.prototype,t),n&&J(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this.disposer.add(this,[Object(C.reaction)(function(){return{isEditing:e.isEditing,textFieldRef:e.textFieldRef}},this.focusTextField,{equals:C.comparer.structural}),Object(C.reaction)(function(){return e.props.visual.topContentInFixedMode},this.onTopContentInFixedModeChanged),Object(C.reaction)(function(){return e.props.visual.contactsSuggest.field||["to","cc","bcc"].indexOf(e.props.visual.yabbleMenuPopup.field)>-1},this.onClosePromo),Object(C.reaction)(function(){return e.isShowingPopup},function(t){e.props.visual.yabbleMenuPopup.field=t?"from":""})])}},{key:"componentDidUpdate",value:function(){this.beautifulEmailPromoRef.current&&this.beautifulEmailPromoRef.current.forceUpdate(),this.suggestBeautifulEmailPromoRef.current&&this.suggestBeautifulEmailPromoRef.current.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"maybeRenderAliasPromo",value:function(){return this.contentRef.current&&this.isBeautifulEmailPromoOn&&Object(j.areEmailsEqual)(this.address.email,this.props.visual.promoData)?ne(G.a,{promoRef:this.beautifulEmailPromoRef,scopeRef:this.labelRef,anchorRef:this.contentRef,canBeShowed:!0,onShow:this.onShowPromo,onClose:this.onClosePromo}):null}},{key:"maybeRenderBeautifulAddressPromo",value:function(){return this.contentRef.current&&this.isSuggestBeautifulEmailPromoOn&&!Object(j.areEmailsEqual)(this.address.email,this.props.visual.promoData)?ne(q.a,{promoRef:this.suggestBeautifulEmailPromoRef,scopeRef:this.props.visual.composeContainerRef,anchorRef:this.contentRef,onShow:this.onShowPromo,onClose:this.onClosePromo,onAction:this.onGoToBeautifulAddressSettings,suggestedEmail:this.props.visual.promoData,toBottom:this.isSmall}):null}},{key:"render",value:function(){return O.a.createElement("div",{ref:this.props.innerRef,className:ae.Block},ne(x.a,{title:this.props.title,onClickCapture:this.onTitleClick,getRef:this.labelRef},void 0,O.a.createElement("div",{ref:this.fieldRef,className:ae.Field,tabIndex:"0"},ne("div",{className:ae.Content,tabIndex:"-1"},void 0,O.a.createElement("span",{ref:this.contentRef},this.renderContent())))),this.renderPopup(),this.maybeRenderAliasPromo(),this.maybeRenderBeautifulAddressPromo())}},{key:"renderContent",value:function(){return this.isEditing?ne(B.a,{getRef:this.setTextFieldRef,value:this.address.name,onChange:this.onNameChanged,onKeyDown:this.onEditingKeyDown,onBlur:this.onStopEditing}):this.renderYabble()}},{key:"renderYabble",value:function(){var e=this;return ne("span",{className:"js-yabble yabble-compose"},void 0,ne(F.a,{nodeRef:this.yabbleRef,AvatarComponent:z.ContactAvatarWithTooltip,ContentComponent:U.a,isEditable:!1,getContact:function(){return K.default.of(e.address)}}))}},{key:"renderPopup",value:function(){if(!this.isShowingPopup||this.props.mailboxUid)return null;var e=this.props.services.settings.isMobile?this.props.innerRef:this.yabbleRef;return ne(W.a,{anchor:e,cls:P()(ae.Popup,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},ae.Popup_small,this.isSmall)),scope:this.props.visual.refs.topContent,onOutsideClick:this.onOutsideClick,onClose:this.closePopup,bounds:this.fieldRef},void 0,ne(H.a,{contact:this.address,onSelectAddress:this.onSelectAddress,availableAddresses:this.availableAddresses,onCopy:this.closePopup,onEdit:this.onStartEditing,onWriteOnly:this.onWriteOnly}))}},{key:"address",get:function(){return this.props.data.addresses.from}},{key:"availableAddresses",get:function(){return this.props.controllers.selfRecipient.availableAddresses}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"composeContainerRef",get:function(){return this.props.visual&&this.props.visual.refs.composeContainer}},{key:"isSmall",get:function(){return this.props.visual.size===Y.ComposeSizes.SMALL}},{key:"isBeautifulEmailPromoOn",get:function(){return this.props.visual.currentPromo===V.PROMO_COMPOSE_BEAUTIFUL_EMAIL}},{key:"isSuggestBeautifulEmailPromoOn",get:function(){return this.props.visual.currentPromo===V.PROMO_COMPOSE_SUGGEST_BEAUTIFUL_EMAIL}}]),t}(),m.propTypes={innerRef:S.a.object,onShow:S.a.func,title:S.a.string.isRequired,mailboxUid:S.a.string,data:M.a.isRequired,controllers:I.a.isRequired,services:D.a.isRequired,visual:L.a.isRequired},m.defaultProps={innerRef:O.a.createRef()},i=oe((o=h).prototype,"isEditing",[C.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=oe(o.prototype,"isShowingPopup",[C.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s=oe(o.prototype,"textFieldRef",[C.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oe(o.prototype,"address",[C.computed],Object.getOwnPropertyDescriptor(o.prototype,"address"),o.prototype),oe(o.prototype,"availableAddresses",[C.computed],Object.getOwnPropertyDescriptor(o.prototype,"availableAddresses"),o.prototype),oe(o.prototype,"metrikaService",[C.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),oe(o.prototype,"composeContainerRef",[C.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeContainerRef"),o.prototype),oe(o.prototype,"isSmall",[C.computed],Object.getOwnPropertyDescriptor(o.prototype,"isSmall"),o.prototype),oe(o.prototype,"isBeautifulEmailPromoOn",[C.computed],Object.getOwnPropertyDescriptor(o.prototype,"isBeautifulEmailPromoOn"),o.prototype),oe(o.prototype,"isSuggestBeautifulEmailPromoOn",[C.computed],Object.getOwnPropertyDescriptor(o.prototype,"isSuggestBeautifulEmailPromoOn"),o.prototype),c=oe(o.prototype,"onTopContentInFixedModeChanged",[C.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t&&(e.isShowingPopup=!1)}}}),u=oe(o.prototype,"onStartEditing",[C.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isEditing=!0,e.closePopup()}}}),l=oe(o.prototype,"setTextFieldRef",[C.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.textFieldRef=t}}}),p=oe(o.prototype,"onWriteOnly",[C.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.controllers.contacts.setSingleRecipient(e.address),e.closePopup()}}}),f=oe(o.prototype,"showPopup",[C.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=e.props.onShow;e.isShowingPopup=!0,t&&t(),e.metrikaService.sendHeaderMetrika($.COMPOSE_METRIKA_HEADER_FROM_SHOW)}}}),d=oe(o.prototype,"closePopup",[C.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isShowingPopup=!1,e.composeContainerRef.contains(document.activeElement)||e.composeContainerRef.focus()}}}),y=oe(o.prototype,"onStopEditing",[C.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isEditing=!1}}}),b=oe(o.prototype,"updateAddressFrom",[C.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.controllers.selfRecipient.setFrom(t),e.metrikaService.sendHeaderMetrika($.COMPOSE_METRIKA_HEADER_FROM_CLICK)}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(338),o=n.n(r),i=n(136),a=(n.n(i),n(480)),s=n(355);n.n(s);var c=o.a.shape({text:o.a.string.isRequired});t.b=o.a.shape({requestId:o.a.string,suggestItems:a.a.arrayOf(c),suggestType:o.a.oneOf([""].concat(function(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}(Object(i.values)(s.SmartSubjectType))))})},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r=n(135),o=n.n(r),i=n(338),a=n.n(i),s=n(339),c=n.n(s),u=n(355),l=(n.n(u),n(376)),p=n.n(l),f=n(2681);n.n(f);function d(e){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=b(this,(e=m(t)).call.apply(e,[this].concat(o)))).inputRef=null,n.onChange=function(e){var t=e.target.value,r=n.guessInputType(t);n.clearInputTypeHints(),n.props.onChange(t,r)},n.onFocus=function(e){var t=e.target;setTimeout(function(){return t.selectionStart=t.selectionEnd});var r=n.props.onFocus;r&&r()},n.onBlur=function(e){n.props.onBlur&&n.props.onBlur(e)},n.onCut=function(){n.isCut=!0},n.onPaste=function(){n.isPaste=!0},n.onKeyDown=function(e){n.lastKey=e.keyCode;var t=n.props.onKeyDown;t&&t(e)},n.setInputRef=function(e){n.inputRef=e,n.inputRef&&(n.inputRef.value=n.props.value),n.props.getRef&&n.props.getRef(e)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,o.a.PureComponent),function(e,t,n){t&&y(e.prototype,t),n&&y(e,n)}(t,[{key:"guessInputType",value:function(e){return this.isPaste?u.InputTypes.INSERT_FROM_PASTE:this.isCut?u.InputTypes.DELETE_BY_CUT:Math.abs(e.length-this.props.value.length)>1?u.InputTypes.INSERT_MULTIPLE:this.lastKey===p.a.BACKSPACE?u.InputTypes.DELETE_CONTENT_BACKWARD:u.InputTypes.INSERT_TEXT}},{key:"clearInputTypeHints",value:function(){this.isPaste=!1,this.isCut=!1,this.lastKey=null}},{key:"render",value:function(){var e=this.props,t=e.cls,n=e.name,r=e.fieldId,i=c()("composeTextField",t);return o.a.createElement("input",{id:r,name:n,className:i,ref:this.setInputRef,onChange:this.onChange,onClick:this.props.onClick,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onCut:this.onCut,onPaste:this.onPaste,autoComplete:this.props.autoComplete})}}]),t}();v.propTypes={cls:a.a.string,fieldId:a.a.string,value:a.a.string.isRequired,getRef:a.a.func,name:a.a.string,onChange:a.a.func.isRequired,onClick:a.a.func,onFocus:a.a.func,onBlur:a.a.func,onKeyDown:a.a.func,autoComplete:a.a.string}},function(e,t,n){"use strict";var r=n(2690);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ContactItem=void 0;var u=a(n(135)),l=c(n(339)),p=n(138),f=c(n(353)),d=n(350),y=c(n(2692));t.ContactItem=function(e){var t,n=e.renderAvatar,o=e.name,i=e.description,a=e.isActive,c=e.isExternal,b=e.isMobile,m=s(e,["renderAvatar","name","description","isActive","isExternal","isMobile"]),h=u.useMemo(function(){return!(!c||b)||!(!c||!b||d.isCorp())},[c,b]);return u.default.createElement("div",r({},m,{className:l.default(y.default.root,m.className,(t={},t[y.default.active]=a,t)),role:"option",id:m.id}),n(y.default.avatar),u.default.createElement("div",{className:y.default.content},u.default.createElement(p.Text,{as:"div",typography:"body-short-m",className:y.default.name},o),i&&u.default.createElement("div",{className:y.default.containerDescAndBadge},u.default.createElement(p.Text,{as:"div",typography:"body-short-m",color:"secondary",className:y.default.description},u.default.createElement("span",null,i)),h&&u.default.createElement("div",null,u.default.createElement("span",{className:y.default.externalEmailDivider},"•"),u.default.createElement("div",{className:y.default.externalEmailBadge},f.default("contact-card/externalContactShort")))),!i&&h&&u.default.createElement("div",{className:y.default.externalEmailBadge},f.default("contact-card/externalContactShort"))))}},function(e,t,n){"use strict";var r=n(420),o=n(2708),i=n.n(o),a=n(2712);t.a=Object(r.a)(i.a,a.a)},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Popup=void 0;var a=i(n(135)),s=i(n(339)),c=n(2709),u=n(143),l=n(379),p=n(373),f=n(349),d=i(n(2710));t.Popup=function(e){var t=e.position,n=o(e,["position"]),i=c.useVirtualElementRef({rect:t});return t&&(n.anchor=i),a.default.createElement(u.Popup,r({role:"dialog",view:"default",target:"anchor",enableFocusTrap:!0},n,{className:s.default(d.default.root,n.className,f.hasFeature(f.Features.WEB_DARK_COMPOSE)?"":l.cnTheme(p.PS_LIGHT))}))}},function(e,t,n){"use strict";t.a=function(e){var t=function(t){function n(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(t=function(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,(e=d(n)).call.apply(e,[this].concat(i)))).targetRef=o.a.createRef(),t.onMouseDown=function(e){var n=t.targetRef.current;if(n){var r=n.containerRef.current,o=e.clientX,i=e.clientY,a=!1;if(r){var s=r.getBoundingClientRect();a=o>=s.left&&o<=s.right&&i>=s.top&&i<=s.bottom}var c=document.querySelector(".js-context-menu");!t.props.onOutsideClick||a||!r||r.contains(e.target)||e.metaKey||e.ctrlKey||e.altKey||e.shiftKey||e.button||c&&c.contains(e.target)||t.props.onOutsideClick(e)}},t.onKeyDown=function(e){t.props.onOutsideKeyDown&&t.props.onOutsideKeyDown(e)},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(n,t),function(e,t,n){t&&f(e.prototype,t);n&&f(e,n)}(n,[{key:"componentDidMount",value:function(){this.subscribeToEvents()}},{key:"componentWillUnmount",value:function(){this.unsubscribeFromEvents()}},{key:"render",value:function(){var t=this.props,n=(t.onOutsideClick,t.onOutsideKeyDown,function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,["onOutsideClick","onOutsideKeyDown"]));return o.a.createElement(e,c({ref:this.targetRef,onClose:s.noop},n))}},{key:"subscribeToEvents",value:function(){document.addEventListener("mousedown",this.onMouseDown,!0),document.addEventListener("keydown",this.onKeyDown,!0)}},{key:"unsubscribeFromEvents",value:function(){document.removeEventListener("mousedown",this.onMouseDown,!0),document.removeEventListener("keydown",this.onKeyDown,!0)}}]),n}(o.a.PureComponent);return t.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){p(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e.propTypes,{onOutsideClick:a.a.func,onOutsideKeyDown:a.a.func}),t};var r=n(135),o=n.n(r),i=n(338),a=n.n(i),s=n(136);n.n(s);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}},function(e,t,n){"use strict";var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.408 2.632a.684.684 0 011.184 0l5.312 9.201a.684.684 0 01-.592 1.026H2.687a.684.684 0 01-.592-1.026l5.313-9.201zm2.916-1c-1.033-1.79-3.616-1.79-4.648 0L.363 10.833c-1.033 1.79.258 4.026 2.324 4.026h10.625c2.066 0 3.357-2.237 2.324-4.026l-5.312-9.201zM8.36 5.004h-.72A.643.643 0 007 5.71l.32 3.192c.022.22.206.386.426.386h.51a.43.43 0 00.427-.386L9 5.711a.643.643 0 00-.64-.707zM7.023 11.03c0-.576.422-.977.977-.977.556 0 .977.401.977.977s-.421.977-.977.977c-.555 0-.977-.4-.977-.977z",fill:"#6A2D00"});t.a=function(e){return o.createElement("svg",i({width:16,height:16,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},,function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Progress=void 0;var c=a(n(135)),u=s(n(339)),l=s(n(2732)),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){return c.default.createElement("div",{className:u.default(l.default.progress,this.props.className)},c.default.createElement("div",{className:l.default.progress_inner,style:{width:(this.props.progress||0)+"%"}}))},t}(c.PureComponent);t.Progress=p},,function(e,t,n){"use strict";var r,o=n(458),i=n(801),a=n(1110),s=n(1486),c=n(2805),u=n(1492);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=(l(r={},o.a.ATTACHMENTS,{buttonCls:i.a.AttachFileButton,Button:a.b,MenuItem:a.a}),l(r,o.a.DELAYED_SENDING,{buttonCls:i.a.DelayedSendingButton,Button:s.b,MenuItem:s.a}),l(r,o.a.LABELS,{buttonCls:i.a.LabelButton,Button:c.b,MenuItem:c.a}),l(r,o.a.NOTIFICATIONS,{buttonCls:i.a.NotificationsButton,Button:u.b,MenuItem:u.a}),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return U});var r,o,i,a,s,c,u,l,p=n(135),f=n.n(p),d=n(339),y=n.n(d),b=n(338),m=n.n(b),h=n(342),v=n(341),g=n(344),O=n(360),_=n(1111),S=n(361),E=n(363),P=n(356),C=n(366),w=n(483),T=n(355),k=(n.n(T),n(354)),A=(n.n(k),n(2771));n.n(A);function R(e){"@babel/helpers - typeof";return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t,n,r){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function x(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function B(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var F="ComposeAttachmentSourcesMenu",z={Block:F,Item:"".concat(F,"-Item"),Icon:"".concat(F,"-Icon"),Text:"".concat(F,"-Text"),FileInput:"".concat(F,"-FileInput")},U=Object(h.inject)("controllers","data","services","visual")(r=Object(h.observer)((u=c=function(e){function t(){var e,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];return x(D(r=function(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?D(e):t}(this,(e=I(t)).call.apply(e,[this].concat(c)))),"onChangeFile",i,D(r)),x(D(r),"onAttachMail",a,D(r)),x(D(r),"onAttachDisk",s,D(r)),r.onAttachLocal=function(){r.props.onSelectSource&&r.props.onSelectSource(_.a.LOCAL),r.metrikaService.sendFooterMetrika(k.COMPOSE_METRIKA_FOOTER_ATTACH_LOCAL)},r.sourceHandlers=(j(n={},_.a.LOCAL,r.onAttachLocal),j(n,_.a.DISK,r.onAttachDisk),j(n,_.a.MAIL,r.onAttachMail),n),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,f.a.PureComponent),function(e,t,n){t&&M(e.prototype,t),n&&M(e,n)}(t,[{key:"render",value:function(){var e=this,t=this.props.sources,n=t.find(function(e){return e.type===_.a.LOCAL}),r=t.filter(function(e){return e!==n});return N("div",{className:y()(this.props.cls,z.Block)},void 0,this.renderAttachLocal(n),r.map(function(t){return e.renderItem(t)}))}},{key:"renderAttachLocal",value:function(e){var t=e.type,n=e.icon,r=e.loc;return N("label",{className:z.Item,onClick:this.sourceHandlers[t]},t,N("div",{className:z.Icon},void 0,N(O.default,{id:n})),N("div",{className:z.Text},void 0,N(g.default,{loc:r})),N("input",{className:z.FileInput,type:"file",multiple:!0,onChange:this.onChangeFile}))}},{key:"renderItem",value:function(e){var t=e.type,n=e.icon,r=e.loc;return N("div",{className:z.Item,onClick:this.sourceHandlers[t]},t,N("div",{className:z.Icon},void 0,N(O.default,{id:n})),N("div",{className:z.Text},void 0,N(g.default,{loc:r})))}},{key:"attachmentsController",get:function(){return this.props.controllers.attachments}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),t}(),c.propTypes={cls:m.a.string,controllers:S.a.isRequired,data:E.a.isRequired,onSelectSource:m.a.func,services:P.a.isRequired,sources:m.a.arrayOf(_.b),visual:C.a.isRequired},B((o=u).prototype,"attachmentsController",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"attachmentsController"),o.prototype),B(o.prototype,"metrikaService",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),i=B(o.prototype,"onChangeFile",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t.stopPropagation(),t.preventDefault();var n=Array.from(t.target.files);e.props.controllers.attachments.attachFilesFromLocal(n),t.target.value=null}}}),a=B(o.prototype,"onAttachMail",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.onSelectSource&&e.props.onSelectSource(_.a.MAIL),e.props.visual.diskResourcesPath=w.b,e.props.visual.currentPopup=T.Popups.DISK_RESOURCES,e.metrikaService.sendFooterMetrika(k.COMPOSE_METRIKA_FOOTER_ATTACH_MAIL)}}}),s=B(o.prototype,"onAttachDisk",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.onSelectSource&&e.props.onSelectSource(_.a.DISK),e.props.visual.diskResourcesPath=w.a,e.props.visual.currentPopup=T.Popups.DISK_RESOURCES,e.metrikaService.sendFooterMetrika(k.COMPOSE_METRIKA_FOOTER_ATTACH_DISK)}}}),r=o))||r)||r},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a={onChange:o.a.func,onAction:o.a.func}},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(545),o=n(484),i=n(2787),a=n(2789),s=n(2804),c=n(354),u=(n.n(c),{PopupContent:a.a,cls:i.a.Popup,metrikaArgs:[c.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING,c.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CLICK],directions:["top"],title:"compose-react/DelayedSending_Title"}),l=Object(o.a)(u,i.b);t.b=Object(r.a)("compose-react/ControlPanel_DelayedSending_Tooltip",l);var p=Object(o.a)(u,s.a)},function(e,t,n){"use strict";var r=n(2791);n.d(t,"a",function(){return r.a})},,function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a={anchor:o.a.object,visible:o.a.bool,onSelectDate:o.a.func.isRequired,onCancelSelectDate:o.a.func,getInitialDate:o.a.func.isRequired,getMaxDate:o.a.func.isRequired,getMinDate:o.a.func.isRequired}},function(e,t,n){"use strict";n.d(t,"a",function(){return D});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(342),b=n(341),m=n(361),h=n(363),v=n(356),g=n(1491),O=n(344),_=n(138),S=(n.n(_),n(354)),E=(n.n(S),n(2810)),P=n.n(E);function C(e){"@babel/helpers - typeof";return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function j(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var M="ComposeLabelOptions",I={Block:M,Wrapper:"".concat(M,"-Wrapper"),List:"".concat(M,"-List"),Actions:"".concat(M,"-Actions"),Item:"".concat(M,"-Item"),Label:"".concat(M,"-Label"),Separator:"".concat(M,"-Separator")},D=Object(y.inject)("controllers","data","services")(r=Object(y.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=T(this,(e=k(t)).call.apply(e,[this].concat(o)))).onManageAction=function(){n.props.onAction&&n.props.onAction(),n.labelsController.manageLabels(),n.metrikaService.sendFooterMetrika(S.COMPOSE_METRIKA_FOOTER_LABELS,S.COMPOSE_METRIKA_FOOTER_LABELS_MANAGE)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,u.a.Component),function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(t,[{key:"addLabel",value:function(e){this.labelsController.addLabel(e),this.props.onAction&&this.props.onAction();var t=this.labelsService.isImportantLabel(e);this.metrikaService.sendFooterMetrika(S.COMPOSE_METRIKA_FOOTER_LABELS,t?S.COMPOSE_METRIKA_FOOTER_LABELS_ADD_IMPORTANT:S.COMPOSE_METRIKA_FOOTER_LABELS_ADD_USER)}},{key:"componentDidUpdate",value:function(){this.props.onChange&&this.props.onChange()}},{key:"render",value:function(){var e=this.isMobile?"".concat(I.Block,"_mobile ").concat(P.a.mobile):"".concat(I.Block,"_desktop ").concat(P.a.desktop);return R("div",{className:I.Wrapper},void 0,R("div",{className:d()(I.Block,e,P.a.root)},void 0,this.renderList(),R("div",{className:d()(I.Actions,P.a.actions)},void 0,this.renderAction())))}},{key:"renderList",value:function(){var e=this;return this.unusedLabels.length?u.a.createElement(u.a.Fragment,null,R("div",{className:d()(I.List,P.a.list)},void 0,this.unusedLabels.map(function(t){return e.renderLabel(t)})),R("div",{className:d()(I.Separator,P.a.separator)})):null}},{key:"renderLabel",value:function(e){var t=this;return R("div",{className:d()(I.Item,P.a.item),onClick:function(){return t.addLabel(e)}},e.lid,R(g.a,{label:e,cls:I.Label}))}},{key:"renderAction",value:function(){var e=this.hasCreatedByUserLabels?"compose-react/Labels_Edit":"compose-react/Labels_Create";return R(_.Text,{typography:"body-long-m",className:d()(I.Item,P.a.item),onClick:this.onManageAction},void 0,R(O.default,{loc:e}))}},{key:"labelsController",get:function(){return this.props.controllers.labels}},{key:"labelsService",get:function(){return this.props.services.labels}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"unusedLabels",get:function(){return this.labelsController.getUnusedLabels()}},{key:"hasCreatedByUserLabels",get:function(){return this.labelsService.getCreatedByUserLabels().length>0}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}}]),t}(),i.propTypes={onChange:p.a.func,onAction:p.a.func,controllers:m.a.isRequired,data:h.a.isRequired,services:v.a.isRequired},j((o=a).prototype,"labelsController",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"labelsController"),o.prototype),j(o.prototype,"labelsService",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"labelsService"),o.prototype),j(o.prototype,"composeController",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),j(o.prototype,"metrikaService",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),j(o.prototype,"unusedLabels",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"unusedLabels"),o.prototype),j(o.prototype,"hasCreatedByUserLabels",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasCreatedByUserLabels"),o.prototype),j(o.prototype,"isMobile",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return E});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(341),d=n(342),y=n(2806),b=n(356),m=n(2807),h=n.n(m);function v(e){"@babel/helpers - typeof";return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=Object(d.inject)("services")(r=Object(d.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),O(this,_(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,u.a.Component),function(e,t,n){t&&g(e.prototype,t),n&&g(e,n)}(t,[{key:"render",value:function(){var e=this.labelsService.labelColors(this.props.label),t=e.background,n=e.color,r=this.labelsService.isImportantLabel(this.props.label);return function(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(h.a,{background:t,className:this.props.cls,color:n,id:"mail--ComposeReact-ImportantLabel",isImportant:r,name:this.props.label.name,onRemove:this.props.onRemove})}},{key:"labelsService",get:function(){return this.props.services.labels}}]),t}(),i.propTypes={cls:p.a.string,label:y.a.isRequired,onRemove:p.a.func,services:b.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"labelsService",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"labelsService"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(545),o=n(484),i=n(2814),a=n(2818),s=n(354),c=(n.n(s),n(2819)),u={PopupContent:i.a,cls:c.a.Popup,metrikaArgs:[s.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS,s.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_CLICK],directions:["top"],title:"compose-react/Notifications_Title"},l=Object(o.a)(u,c.b);t.b=Object(r.a)("compose-react/ControlPanel_Notifications_Tooltip",l);var p=Object(o.a)(u,a.a)},function(e,t,n){"use strict";var r=n(2831);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return W});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(338),d=n.n(f),y=n(339),b=n.n(y),m=n(342),h=n(341),v=n(361),g=n(363),O=n(356),_=n(366),S=n(2835),E=n(344),P=n(138),C=(n.n(P),n(355)),w=(n.n(C),n(354)),T=(n.n(w),n(2837)),k=n.n(T);function A(e){"@babel/helpers - typeof";return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function L(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function N(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var x="ComposeTemplatesOptions",B={Block:x,List:"".concat(x,"-List"),Separator:"".concat(x,"-Separator"),Action:"".concat(x,"-Action"),ActionSave:"".concat(x,"-Action_save"),ActionUpdate:"".concat(x,"-Action_update"),ActionSaveAs:"".concat(x,"-Action_save_as"),ActionManage:"".concat(x,"-Action_manage")},F=D(E.default,{loc:"compose-react/Templates_Manage"}),z=D(E.default,{loc:"compose-react/Templates_Save"}),U=D(E.default,{loc:"compose-react/Templates_Update"}),K=D(E.default,{loc:"compose-react/Templates_Save_As_New"}),H=D(E.default,{loc:"compose-react/Templates_Save"}),W=Object(m.inject)("controllers","data","services","visual")(r=Object(m.observer)((c=s=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return L(M(n=function(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?M(e):t}(this,(e=j(t)).call.apply(e,[this].concat(o)))),"hasTemplates",i,M(n)),L(M(n),"processTemplates",a,M(n)),n.onSelectTemplate=function(e){n.templatesController.openTemplate(e),n.onAction(w.COMPOSE_METRIKA_FOOTER_TEMPLATES_SELECT)},n.onCreateTemplate=function(){n.templatesController.createTemplate(),n.onAction(w.COMPOSE_METRIKA_FOOTER_TEMPLATES_SAVE)},n.onSaveAsNewTemplate=function(){n.templatesController.saveAsNewTemplate(),n.onAction(w.COMPOSE_METRIKA_FOOTER_TEMPLATES_SAVE_AS_NEW)},n.onUpdateTemplate=function(){n.templatesController.updateTemplate(),n.onAction(w.COMPOSE_METRIKA_FOOTER_TEMPLATES_UPDATE)},n.onManageTemplates=function(){n.composeController.closeCompose({leaveType:C.LeaveTypes.COLLAPSE}),n.templatesController.manageTemplates(),n.metrika.sendFooterMetrika(w.COMPOSE_METRIKA_FOOTER_TEMPLATES,w.COMPOSE_METRIKA_FOOTER_TEMPLATES_MANAGE)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,p.a.PureComponent),function(e,t,n){t&&R(e.prototype,t),n&&R(e,n)}(t,[{key:"onAction",value:function(e){this.metrika.sendFooterMetrika(w.COMPOSE_METRIKA_FOOTER_TEMPLATES,e),this.props.onAction&&this.props.onAction()}},{key:"componentDidMount",value:function(){this.props.services.templates.loadTemplates().then(this.processTemplates)}},{key:"componentDidUpdate",value:function(){this.props.onChange&&this.props.onChange()}},{key:"render",value:function(){return D("div",{className:b()(k.a.root,B.Block,this.props.cls)},void 0,this.renderContent())}},{key:"renderContent",value:function(){return this.hasTemplates?p.a.createElement(p.a.Fragment,null,D(S.a,{cls:b()(B.List,k.a.list),onChange:this.props.onChange,onSelectTemplate:this.onSelectTemplate}),D("div",{className:b()(B.Separator,k.a.separator)}),D(P.Text,{typography:"body-long-m",onClick:this.onManageTemplates,className:b()(B.Action,B.ActionManage,k.a.action)},void 0,F),this.isTemplate?this.renderTemplateActions():this.renderDraftActions()):this.renderDraftActions()}},{key:"renderTemplateActions",value:function(){return this.props.services.composeParams.isNewTemplate()?this.renderNewTemplateActions():this.renderExistingTemplateActions()}},{key:"renderNewTemplateActions",value:function(){return D(P.Text,{typography:"body-long-m",className:b()(B.Action,B.ActionSave,k.a.action),onClick:this.onCreateTemplate},void 0,z)}},{key:"renderExistingTemplateActions",value:function(){return p.a.createElement(p.a.Fragment,null,this.hasChanges&&D(P.Text,{typography:"body-long-m",className:b()(B.Action,B.ActionUpdate,k.a.action),onClick:this.onUpdateTemplate},void 0,U),D(P.Text,{typography:"body-long-m",className:b()(B.Action,B.ActionSaveAs,k.a.action),onClick:this.onSaveAsNewTemplate},void 0,K))}},{key:"renderDraftActions",value:function(){return D(P.Text,{typography:"body-long-m",className:b()(B.Action,B.ActionSave,k.a.action),onClick:this.onCreateTemplate},void 0,H)}},{key:"isTemplate",get:function(){return this.props.data.isTemplate}},{key:"hasChanges",get:function(){return this.props.visual.hasChanges}},{key:"templatesController",get:function(){return this.props.controllers.templates}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"metrika",get:function(){return this.props.services.metrika}}]),t}(),s.propTypes={cls:d.a.string,onChange:d.a.func,onAction:d.a.func,controllers:v.a.isRequired,data:g.a.isRequired,services:O.a.isRequired,visual:_.a.isRequired},i=N((o=c).prototype,"hasTemplates",[h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),N(o.prototype,"isTemplate",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"isTemplate"),o.prototype),N(o.prototype,"hasChanges",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasChanges"),o.prototype),N(o.prototype,"templatesController",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"templatesController"),o.prototype),N(o.prototype,"composeController",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),N(o.prototype,"metrika",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrika"),o.prototype),a=N(o.prototype,"processTemplates",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.items;e.hasTemplates=Boolean(n.length)}}}),r=o))||r)||r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(2843));t.default=o.default},function(e,t,n){"use strict";var r="ComposeMoreOptions";t.a={Block:r,Item:"".concat(r,"-Item"),ItemLabel:"".concat(r,"-ItemLabel"),ItemToggle:"".concat(r,"-ItemToggle"),TemplatesPopup:"".concat(r,"-TemplatesPopup"),TemplatesButton:"".concat(r,"-TemplatesButton")}},function(e,t,n){"use strict";var r=n(420),o=n(2850),i=n(2856);t.a=Object(r.a)(i.a,o.a)},function(e,t,n){"use strict";var r=n(420),o=n(2851),i=n.n(o),a=n(2853);t.a=Object(r.a)(a.a,i.a)},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return $});var r,o,i,a,s,c,u,l,p,f,d=n(135),y=n.n(d),b=n(338),m=n.n(b),h=n(339),v=n.n(h),g=n(136),O=(n.n(g),n(341)),_=n(342),S=n(710),E=n.n(S),P=n(1491),C=n(344),w=n(415),T=n(138),k=(n.n(T),n(361)),A=n(363),R=n(356),j=n(460),M=n(394),I=n.n(M),D=n(355),L=(n.n(D),n(1501)),N=n(354),x=(n.n(N),n(2861));n.n(x);function B(e){"@babel/helpers - typeof";return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function H(e,t,n,r){f||(f="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:f,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function W(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Y(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var G="ComposeLabels",q={Block:G,Content:"".concat(G,"-Content"),Item:{Container:"".concat(G,"-Item"),hidden:"".concat(G,"-Item_hidden")},Toggle:{Container:"".concat(G,"-Toggle"),Text:"".concat(G,"-ToggleText")}},V=H(w.a,{id:"mail--ComposeReact-Expand"}),$=Object(_.inject)("controllers","data","services","visual")(r=Object(_.observer)((p=l=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return(n=function(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?U(e):t}(this,(e=z(t)).call.apply(e,[this].concat(o)))).disposer=new I.a,n.containerRef=y.a.createRef(),n.toggleControlRef=null,W(U(n),"hiddenLabelsCount",i,U(n)),W(U(n),"isExpanded",a,U(n)),W(U(n),"onExpand",s,U(n)),W(U(n),"updateExpanded",c,U(n)),W(U(n),"toggleLabels",u,U(n)),n.refreshLabels=function(){n.props.controllers.labels.refreshUserLabels()},n.setToggleControlRef=function(e){n.toggleControlRef=e},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(t,y.a.Component),function(e,t,n){t&&F(e.prototype,t),n&&F(e,n)}(t,[{key:"removeLabel",value:function(e){this.props.controllers.labels.removeUserLabel(e),this.metrikaService.sendHeaderMetrika(N.COMPOSE_METRIKA_HEADER_LABELS,N.COMPOSE_METRIKA_HEADER_LABELS_REMOVE)}},{key:"expandLabels",value:function(){Array.from(this.containerRef.current.children).forEach(function(e){return e.classList.remove(q.Item.hidden)})}},{key:"collapseLabels",value:function(){var e=this,t=Array.from(this.containerRef.current.children).filter(function(t){return t!==e.toggleControlRef});if(t.length){var n=Object(L.a)({elements:t,hiddenClass:q.Item.hidden,summary:this.toggleControlRef});-1!==n.indexOf(t[0])&&n.splice(0,1),n.forEach(function(e){return e.classList.add(q.Item.hidden)}),n.length&&this.collapseLabels()}}},{key:"componentDidMount",value:function(){var e=this;this.toggleLabels(),this.disposer.addEventListener(this,{element:window,eventName:"resize",listener:this.toggleLabels}),this.previousLabelsLength=this.props.data.userLabels.length,this.disposer.add(this,[Object(O.reaction)(function(){return e.props.visual.topContentInFixedMode},function(t){return e.updateExpanded(t)}),Object(O.reaction)(function(){return e.props.visual.additionalAddressesAreExpanded},function(t){return e.updateExpanded(!t)}),Object(O.reaction)(function(){return e.props.data.userLabels.length},function(t){t>e.previousLabelsLength&&e.onExpand(),e.previousLabelsLength=t}),this.labelsService.subscribeLabelsChanged(this.refreshLabels)])}},{key:"componentDidUpdate",value:function(){this.toggleLabels()}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"render",value:function(){var e=this;return this.userLabels.length?H(E.a,{cls:q.Block,title:"compose-react/Header_Labels",contentClass:q.Content,contentRef:this.containerRef},void 0,this.userLabels.map(function(t){return e.renderLabel(t)}),this.renderToggleControl()):null}},{key:"renderLabel",value:function(e){var t=this;return H(P.a,{cls:q.Item.Container,label:e,onRemove:function(){return t.removeLabel(e)}},e.lid)}},{key:"renderToggleControl",value:function(){var e=this.hiddenLabelsCount;return this.isExpanded||!e?null:y.a.createElement("div",{ref:this.setToggleControlRef,className:v()(q.Item.Container,q.Toggle.Container),onClick:this.onExpand},H(T.Text,{typography:"body-long-m"},void 0,H(C.default,{className:q.Toggle.Text,loc:"compose-react/More_N",params:{count:e}}),V))}},{key:"labelsService",get:function(){return this.props.services.labels}},{key:"userLabels",get:function(){var e=this;return Object(g.sortBy)(this.props.data.userLabels,function(t){return!e.labelsService.isImportantLabel(t)})}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"isBackground",get:function(){return this.props.visual.workMode===D.WorkModes.BACKGROUND}},{key:"hiddenItems",get:function(){return Array.from(this.containerRef.current.children).filter(function(e){return e.classList.contains(q.Item.hidden)})}}]),t}(),l.propTypes={controllers:k.a.isRequired,data:A.a.isRequired,services:R.a.isRequired,visual:j.a.isRequired,onExpand:m.a.func},i=Y((o=p).prototype,"hiddenLabelsCount",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a=Y(o.prototype,"isExpanded",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Y(o.prototype,"labelsService",[O.computed],Object.getOwnPropertyDescriptor(o.prototype,"labelsService"),o.prototype),Y(o.prototype,"userLabels",[O.computed],Object.getOwnPropertyDescriptor(o.prototype,"userLabels"),o.prototype),Y(o.prototype,"metrikaService",[O.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),Y(o.prototype,"isBackground",[O.computed],Object.getOwnPropertyDescriptor(o.prototype,"isBackground"),o.prototype),s=Y(o.prototype,"onExpand",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isExpanded=!0,e.hiddenLabelsCount=0,e.props.onExpand&&e.props.onExpand()}}}),c=Y(o.prototype,"updateExpanded",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.isExpanded&&t&&(e.isExpanded=!1)}}}),u=Y(o.prototype,"toggleLabels",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){if(e.containerRef.current&&!e.isBackground&&(e.expandLabels(),!e.isExpanded)){e.collapseLabels();var t=e.hiddenItems.length;t!==e.hiddenLabelsCount&&(e.hiddenLabelsCount=t)}}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(136);n.n(r);function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=function(e){var t=e.elements,n=e.hiddenClass,i=e.summary;if(Object(r.isEmpty)(t))return[];var a=t[0];if(a.classList.contains(n))return[];var s=a.offsetTop,c=a.offsetTop+a.offsetHeight,u=t.filter(function(e){return e.offsetTop>c});if(!(i&&i.offsetTop>c))return u;var l=Object(r.findLast)(t,function(e){return!e.classList.contains(n)&&e.offsetTop===s});return[].concat(o(l?[l]:[]),o(u))}},,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r,o=n(135),i=n.n(o),a=n(480),s=n(590),c=n(594);function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var b=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,f(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(t,[{key:"render",value:function(){return y("div",{className:"compose-AttachmentsList"},void 0,this.props.attachments.map(this.renderItem))}},{key:"renderItem",value:function(e){return y(c.a,{attachment:e},e.info.id)}}]),t}();b.propTypes={attachments:a.a.arrayOf(s.a).isRequired}},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r=n(135),o=n.n(r),i=n(338),a=n.n(i),s=n(339),c=n.n(s),u=n(569),l=n(2901);n.n(l);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function f(e){"@babel/helpers - typeof";return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=b(this,(e=m(t)).call.apply(e,[this].concat(o)))).state={timeToShow:!1},n.timeout=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,o.a.PureComponent),function(e,t,n){t&&y(e.prototype,t),n&&y(e,n)}(t,[{key:"componentDidUpdate",value:function(e){var t=this,n=this.props,r=n.visible,o=n.delayToShow;e.visible!==r&&(clearTimeout(this.timeout),this.state.timeToShow&&this.setState({timeToShow:!1}),r&&(this.timeout=setTimeout(function(){return t.setState({timeToShow:!0})},o)))}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timeout)}},{key:"render",value:function(){var e=this.props,t=e.cls,n=e.visible,r=d(e,["cls","visible"]),i=this.state.timeToShow,a=n&&i,s=c()("ComposeTooltip",t);return o.a.createElement(u.a,p({cls:s,view:"default",tone:"default",to:"top-left",size:"xs",theme:"normal",visible:a},r))}}]),t}();v.propTypes={cls:a.a.string,visible:a.a.bool,delayToShow:a.a.number},v.defaultProps={visible:!1,delayToShow:300}},function(e,t,n){"use strict";n.d(t,"b",function(){return u}),n.d(t,"a",function(){return l});var r=n(136),o=(n.n(r),n(338)),i=n.n(o),a=n(1466),s=n(1079),c=n(380),u=(n.n(c),{cls:i.a.string,complexityLogger:i.a.instanceOf(a.a),messageBodyController:i.a.instanceOf(s.j),getComposeContainerRef:i.a.func.isRequired,getInlineDropZone:i.a.func,getScrollableRef:i.a.func.isRequired,isCorp:i.a.bool,isMobile:i.a.bool,isQuickReply:i.a.bool,mailAutocomplete:i.a.object,onChange:i.a.func,onChildPopupStateChanged:i.a.func,onEditorInit:i.a.func,onEditorDestroy:i.a.func,onFocus:i.a.func,onInput:i.a.func,onKeyboardMove:i.a.func,onPasteFiles:i.a.func,onToolbarCommandClick:i.a.func,placeholder:i.a.string.isRequired,signatureMatches:i.a.arrayOf(i.a.shape({match:i.a.string,leadingLineBreaks:i.a.number})),size:i.a.oneOf(Object(r.values)(c.ComposeSizes))}),l={onChange:r.noop,onChildPopupStateChanged:r.noop,onEditorInit:r.noop,onEditorDestroy:r.noop,onFocus:r.noop,onInput:r.noop,onPasteFiles:r.noop,onToolbarCommandClick:r.noop}},function(e,t,n){"use strict";var r=n(2911);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";var r=n(2912);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=a(n(135)),l=c(n(339)),p=c(n(360)),f=n(140),d=c(n(2913));t.default=function(e){var t=e.cls,n=e.isExpanded,o=s(e,["cls","isExpanded"]),i=u.useCallback(function(e){e.preventDefault()},[]),a=u.useCallback(function(e){var t;return u.default.createElement("span",{className:l.default(e,d.default.icon)},u.default.createElement(p.default,{id:"mail--ComposeReact-Expand",cls:l.default((t={},t[d.default.expanded]=n,t)),focusable:!1}))},[n]);return u.default.createElement(f.Button,r({className:l.default(t,d.default.root,"ComposeExpanderButton"),view:"clear",size:"m"},o,{onKeyPress:i,iconRight:a,"aria-expanded":n}))}},,function(e,t,n){"use strict";var r=n(420),o=n(2917),i=n(2924);t.a=Object(r.a)(o.a,i.a)},function(e,t,n){"use strict";var r=n(338),o=n.n(r),i=n(361),a=n(366);t.a={suggestId:o.a.string,parentId:o.a.string,field:o.a.string,scope:o.a.object,position:o.a.object,anchor:o.a.object,onClose:o.a.func,onSelectContact:o.a.func,onShowAllContacts:o.a.func,a11yFirstSuggestItem:o.a.string,mailboxUid:o.a.string,controllers:i.a.isRequired,visual:a.a.isRequired}},function(e,t,n){"use strict";n.d(t,"a",function(){return B});var r,o,i,a,s,c,u=n(135),l=n.n(u),p=n(338),f=n.n(p),d=n(339),y=n.n(d),b=n(342),m=n(341),h=n(480),v=n(367),g=n(361),O=n(356),_=n(2919),S=n.n(_),E=n(793),P=n(594),C=n(420),w=n(354),T=(n.n(w),n(2922)),k=n.n(T);function A(e){"@babel/helpers - typeof";return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var L=Object(C.a)(P.c,"div"),N=parseInt(k.a.contactItemHeight),x={Block:"ComposeContactsList",Item:"".concat("ComposeContactsList","-Item")},B=Object(b.inject)("controllers","services")(r=Object(b.observer)((s=a=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=function(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?M(e):t}(this,(e=j(t)).call.apply(e,[this].concat(o))))._disposer=new v.a,n.getContactEmailList=function(e){return!e||e.isLocal()?Promise.resolve():n.contactsController.getEmailList(e).then(function(t){return e.emailList=t})},function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(M(n),"selectContact",i,M(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,l.a.Component),function(e,t,n){t&&R(e.prototype,t),n&&R(e,n)}(t,[{key:"calculateIdOnItem",value:function(e,t,n,r,o){return t?r:n<e&&o<1?r:""}},{key:"componentDidUpdate",value:function(){this.props.onChange&&this.props.onChange()}},{key:"render",value:function(){var e=this;return function(e,t,n,r){c||(c="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:c,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(L,{className:y()(x.Block,this.props.cls),cls:y()(x.Block,this.props.cls),selectedIndex:this.props.selectedContactIndex,itemHeight:N,a11yFirstSuggestItem:this.props.a11yFirstSuggestItem,suggestId:this.props.suggestId},void 0,this.props.contacts.map(function(t,n){return e.renderItem(t,n,e.props.a11yFirstSuggestItem,e.props.contacts.length,e.props.isMobile)}))}},{key:"renderItem",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=this.props,s=a.onHoverContact,c=a.selectedContactIndex,u=t===c,p=this.calculateIdOnItem(c,u,o,r,t),f={className:x.Item,contact:e,query:this.props.query,isActive:u,id:p,key:e.email+e.cid,onClick:function(){return n.selectContact(e)},onMouseEnter:function(){return s&&s(e)},isMobile:i};return l.a.createElement(S.a,f)}},{key:"contactsController",get:function(){return this.props.controllers.contacts}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),t}(),a.propTypes={cls:f.a.string,query:f.a.string,selectedContactIndex:f.a.number,contacts:h.a.arrayOf(E.a),onSelectContact:f.a.func,onHoverContact:f.a.func,onChange:f.a.func,controllers:g.a.isRequired,services:O.a.isRequired,suggestId:f.a.string,a11yFirstSuggestItem:f.a.string,isMobile:f.a.bool},D((o=s).prototype,"contactsController",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsController"),o.prototype),D(o.prototype,"metrikaService",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),i=D(o.prototype,"selectContact",[m.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.getContactEmailList(t),e.props.onSelectContact&&e.props.onSelectContact(t);var n=t.isSelf?w.COMPOSE_METRIKA_HEADER_SUGGEST_SELF:w.COMPOSE_METRIKA_HEADER_SUGGEST_OTHER;e.metrikaService.sendHeaderMetrika(w.COMPOSE_METRIKA_HEADER_SUGGEST,n)}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return U});var r,o,i,a,s,c,u,l,p=n(135),f=n.n(p),d=n(338),y=n.n(d),b=n(339),m=n.n(b),h=n(341),v=n(342),g=n(350),O=n(361),_=n(363),S=n(356),E=n(1115),P=n(366),C=n(2926),w=n(2928),T=n(2929),k=n(367),A=n(2931);n.n(A);function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function j(e){"@babel/helpers - typeof";return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function z(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var U=Object(v.inject)("controllers","data","services","stores","visual")(r=Object(v.observer)((u=c=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=function(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?x(e):t}(this,(e=N(t)).call.apply(e,[this].concat(o))))._disposer=new k.a,n.addYabble=function(e){var t=e.field,r=e.contact;n.props.field===t&&n.composeYabbles.addYabble(r)},n.editBubble=function(e){var t=e.field,r=e.event,o=e.yabble;n.props.field===t&&n.composeYabbles.onYabbleEdit(r,o)},F(x(n),"focusAddresses",i,x(n)),n.collapseField=function(e){e||n.composeYabbles.hideYabbles()},F(x(n),"onBubblesExpanded",a,x(n)),n.onBubblesChanged=function(e){n.props.onYabblesChanged&&n.props.onYabblesChanged(e);var t=n.contacts.map(function(e){return e.email}).sort(),r=e.map(function(e){return e.email}).sort();t.join("")!==r.join("")&&(n.updateAddresses(e),Object(g.isPDD)()&&n.checkIsContactExternal(e).finally(function(){n.updateAddresses(e)}))},n.onClick=function(){if(!n.composeYabbles.isEditing){var e=n.props.onClick;e&&e(n.getLastYabblePosition())}},n.onSpecialKey=function(e){if(!n.composeYabbles.isEditing){var t=n.props.onSpecialKey;t&&t(e,n.getLastYabblePosition())}},n.onInput=function(e){if(!n.composeYabbles.isEditing){var t=n.props.onInput;t&&t(e,n.getLastYabblePosition()),e?n.composeYabbles.setA11Y(n.props.a11yFirstSuggestItem):n.composeYabbles.setA11Y("")}},n.onYabbleRemove=function(e){n.composeYabbles.onYabbleRemove(e);var t=n.props.onYabbleRemove;t&&t(e)},n.onInternalYabbleRemove=function(){var e=n.props.onYabbleRemove;e&&e()},n.renderYabble=function(e){var t=e.contact,r=f.a.createRef();return function(e,t,n,r){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(w.a,{avatars:n.props.controllers.avatars,contact:t,innerRef:r,lang:n.props.services.settings.lang,onClick:function(e){return n.props.onYabbleClick(e,r,t)},onRemove:n.onYabbleRemove})},n.renderShowMoreYabble=function(e){return f.a.createElement(T.a,R({lang:n.props.services.settings.lang},e))},F(x(n),"updateAddresses",s,x(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(t,f.a.Component),function(e,t,n){t&&L(e.prototype,t),n&&L(e,n)}(t,[{key:"focus",value:function(){var e=this;setTimeout(function(){e.composeYabbles.element.focus(),e.composeYabbles.canHideYabbles=!0})}},{key:"getLastYabblePosition",value:function(){var e=this.composeYabbles.element,t=0;return e.childElementCount&&(t=e.lastElementChild.getBoundingClientRect().right-e.getBoundingClientRect().left),{left:t}}},{key:"checkIsContactExternal",value:function(e){var t=this;return this.props.controllers.contactsSuggest.environmentAdapter.loadExternalEmails(D(e.map(function(e){return e.email}))).then(function(){return t.props.controllers.contactsSuggest.environmentAdapter.getExternalEmails()}).then(function(e){t.props.controllers.contactsSuggest.data.updateExternalEmails(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach(function(t){I(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e))})}},{key:"componentDidMount",value:function(){var e=this;this.composeYabbles=new C.a({canHideYabbles:!0,contactsStore:this.contactsStore,convertContactToText:this.props.convertContactToText,formatterService:this.contactsFormatterService,isYabblesExpanded:this.props.visual.expandedFields[this.props.field],name:this.props.field,id:this.props.fieldId,node:this.props.innerRef.current,onBubblesChanged:this.onBubblesChanged,onInternalYabbleRemove:this.onInternalYabbleRemove,onFocus:this.props.onFocus,onClick:this.onClick,onInput:this.onInput,onSpecialKey:this.onSpecialKey,renderShowMoreYabble:this.renderShowMoreYabble,renderYabble:this.renderYabble,draggable:this.props.isDraggable,onDragStart:this.props.onDragStart,onBubblesExpanded:this.onBubblesExpanded,title:this.props.title,isEditContactAllowed:this.props.services.settings.isEditContactAllowed}),this._disposer.add(this,[Object(h.reaction)(function(){return e.contacts},function(){return e.syncYabbles()},{fireImmediately:!0,equals:h.comparer.structural}),Object(h.reaction)(function(){return e.props.visual.expandedFields[e.props.field]},this.collapseField),Object(h.reaction)(function(){return e.props.visual.focusedField},this.focusAddresses),function(){return e.composeYabbles.destroyBubbles()}])}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"render",value:function(){return f.a.createElement("div",{ref:this.props.innerRef,className:m()(this.props.cls,"ComposeYabblesField"),role:"combobox"},this.props.children)}},{key:"syncYabbles",value:function(){this.composeYabbles.syncYabbles(this.contacts)}},{key:"contactsFormatterService",get:function(){return this.props.services.contactsFormatter}},{key:"contactsController",get:function(){return this.props.controllers.contacts}},{key:"contactsStore",get:function(){return this.props.stores.contacts}},{key:"addresses",get:function(){var e=this.props,t=e.data,n=e.field;return t.addresses[n]}},{key:"contacts",get:function(){var e=this;return this.addresses.map(function(t){return e.contactsController.replaceLoadedContact(t)})}}]),t}(),c.propTypes={cls:y.a.string,convertContactToText:y.a.func,field:y.a.string,fieldId:y.a.string,innerRef:y.a.object,onClick:y.a.func,onFocus:y.a.func,onInput:y.a.func,onSpecialKey:y.a.func,onYabbleClick:y.a.func,onYabbleRemove:y.a.func,onYabblesChanged:y.a.func,onDragStart:y.a.func,isDraggable:y.a.bool,title:y.a.string,a11yFirstSuggestItem:y.a.string,controllers:O.a.isRequired,data:_.a.isRequired,services:S.a.isRequired,stores:E.a.isRequired,visual:P.a.isRequired},c.defaultProps={innerRef:f.a.createRef()},z((o=u).prototype,"contactsFormatterService",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsFormatterService"),o.prototype),z(o.prototype,"contactsController",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsController"),o.prototype),z(o.prototype,"contactsStore",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsStore"),o.prototype),z(o.prototype,"addresses",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"addresses"),o.prototype),z(o.prototype,"contacts",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"contacts"),o.prototype),i=z(o.prototype,"focusAddresses",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t===e.props.field&&(e.focus(),e.props.visual.focusedField="")}}}),a=z(o.prototype,"onBubblesExpanded",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.expandedFields[e.props.field]=!0}}}),s=z(o.prototype,"updateAddresses",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=e.props,r=n.data,o=n.field;r.addresses[o]=t}}}),r=o))||r)||r},function(e,t,n){"use strict";var r,o=n(135),i=(n.n(o),n(344)),a=n(1086);var s=function(e){var t=e.contact,n=t.name;return t.isGroup()?function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(i.default,{loc:"compose-react/SearchSuggest_Group",params:{name:n}}):n};t.a=s,s.propTypes={contact:a.a}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonWithIcon=void 0;var r=n(2967);Object.defineProperty(t,"ButtonWithIcon",{enumerable:!0,get:function(){return r.ButtonWithIcon}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("rect",{x:2,y:12,width:12,height:2,rx:1,fill:"currentColor"});t.default=function(e){return o.createElement("svg",i({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 4a3 3 0 013-3h10a3 3 0 013 3v8a3 3 0 01-3 3H3a3 3 0 01-3-3V4zm3-1a1 1 0 00-1 1v8a1 1 0 001 1h10a1 1 0 001-1V4a1 1 0 00-1-1H3z",fill:"currentColor"});t.default=function(e){return o.createElement("svg",i({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 7.3A2.3 2.3 0 016.3 5h3.4A2.3 2.3 0 0112 7.3v3.4A2.3 2.3 0 019.7 13H6.3A2.3 2.3 0 014 10.7V7.3zM6.3 7a.3.3 0 00-.3.3v3.4a.3.3 0 00.3.3h3.4a.3.3 0 00.3-.3V7.3a.3.3 0 00-.3-.3H6.3z",fill:"currentColor"});t.default=function(e){return o.createElement("svg",i({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},function(e,t,n){"use strict";var r,o=n(135),i=(n.n(o),n(349)),a=(n.n(i),n(3009));function s(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var c=Object(i.hasFeature)(i.Features.WEB_CAPTCHA_CHECKBOX),u=s(a.a,{}),l=s(a.b,{}),p=s(a.b,{}),f=s(a.c,{}),d=s(a.d,{}),y=s(a.e,{}),b=s(a.f,{}),m=s(a.g,{}),h=s(a.h,{}),v=s(a.j,{}),g=s(a.i,{});t.a=function(){return s("div",{},void 0,u,c?l:p,f,d,y,b,m,h,v,g)}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MailingLists=void 0;var r=n(3039);Object.defineProperty(t,"MailingLists",{enumerable:!0,get:function(){return r.MailingLists}})},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MailingListRow=void 0;var o=r(n(135)),i=r(n(339)),a=n(138),s=n(146),c=r(n(1130));t.MailingListRow=function(e){var t=e.checked,n=e.onCheck,r=e.children,u=e.className;return o.default.createElement(a.Text,{as:"div",typography:"body-short-m",className:i.default(c.default.row,u),onClick:n},o.default.createElement(s.Checkbox,{className:c.default.checkbox,size:"s",view:"default",checked:t}),r)}},function(e,t,n){"use strict";var r,o=n(135),i=(n.n(o),n(338)),a=n.n(i),s=n(344),c=n(3043);var u=function(e){var t=e.timestamp,n={savedTime:Object(c.a)(t,"%R")};return function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(s.default,{loc:"compose-react/Saved_at",params:n})};t.a=u,u.propTypes={timestamp:a.a.oneOfType([a.a.number,a.a.instanceOf(Date)])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(3053);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.ComposePopup}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(1444),o=n(2609),i=n(2610),a=n(1460),s=n(3062),c=n(3063),u=n(3064),l=n(779),p=n(585);function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._createPromise=Promise.resolve();var t=new r.t,n=new r.q,i=new o.a;this.services={abookPopup:i,metrika:n,settings:t,syncRelatedModels:new l.a},this.controllers={abookPopup:new s.a(i),settings:new c.a(t),dimensions:new u.a(t),leaveCompose:new p.a},this._init(),Daria.maybeSaveReactComposeFirstUsedDate()}return function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(e,[{key:"_init",value:function(){this.inited||(this.inited=!0,this.manager=new a.a({services:this.services,controllers:this.controllers}),this.manager.connect())}},{key:"render",value:function(e){if(this._init(),!this.rendered&&e){var t=this.manager,n=this.services,r=this.controllers;this.rendered=!0,this._destroyer=Object(i.a)({manager:t,services:n,controllers:r,node:e})}}},{key:"unmount",value:function(){this.rendered=!1,this._destroyer&&this._destroyer(),this.manager=null,this.inited=!1}},{key:"createCompose",value:function(e,t,n){var r=this;return this._init(),this._createPromise=this._createPromise.then(function(){var o=r.manager.stack.get(e,t,n);return r.manager.openCompose(o)}),this._createPromise}},{key:"showPromo",value:function(e){this._init(),this.manager.showPromo(e)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(136),o=(n.n(r),n(2555)),i=n(2556),a=n(1069),s=n(782),c=n(1070),u=n(357),l=n(2557),p=n(1071),f=n(1447);function d(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function y(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function b(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){y(i,r,o,a,s,"next",e)}function s(e){y(i,r,o,a,s,"throw",e)}a(void 0)})}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.composeParamsService=t,this.mailboxUid=n}return function(e,t,n){t&&m(e.prototype,t),n&&m(e,n)}(e,[{key:"loadInitialAttachments",value:function(){var e=this.composeParamsService.mMessageBody;return!e||this.composeParamsService.isReplyAny()?[]:e.getAttachments().filter(function(e){return!e.inline}).map(f.a.bind(this,e))}},{key:"getDataForSend",value:function(e){return e.info.type===u.d.FORWARDED_MAIL?{ids:e.info.id}:Object(a.a)(e.info,e.status)}},{key:"getRenderData",value:function(e){return Object(s.a)(e.info,{status:e.status,previewSupported:e.previewSupported})}},{key:"showImagePreview",value:function(e,t,n,r){t.mailboxUid=this.mailboxUid,ns.action.run(e,t,n,r)}},{key:"fileUploadWithDisk",value:function(){var e=b(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.attachment,r=t.onUploadProgress,i=new o.a({attachment:n,onUploadProgress:r}),e.abrupt("return",i.upload());case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"fileUploadDirect",value:function(){var e=b(regeneratorRuntime.mark(function e(t){var n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.attachment,r=t.onUploadProgress,o=new i.a({attachment:n,onUploadProgress:r}),e.abrupt("return",o.upload());case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"attachFromDisk",value:function(){var e=b(regeneratorRuntime.mark(function e(t){var n,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.attachment,o=t.onUploadProgress,i=Object(r.cloneDeep)(n.info),e.abrupt("return",new Promise(function(e,t){Object(c.a)(i,{onUploadProgress:o,onSuccess:function(){return e({info:i})},onFail:function(){t({status:u.c.FAILED})}})}));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"cleanUpYaDiskUrl",value:function(){return Daria.url.cleanUpYaDisk()}},{key:"increaseYaDiskSizeUrl",value:function(){return Daria.url.increaseYaDiskSize()}},{key:"signUpDiskUrl",value:function(){return Daria.url.signUpDisk()}},{key:"diskHelpUrl",value:function(){return"".concat(Daria.url.diskHelp(),"/enlarge/disk-space.html#limit")}},{key:"getForwardedMessagesAttachData",value:function(){var e=b(regeneratorRuntime.mark(function e(){var t,n,r,o,i,a,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("forward"===(n=this.composeParamsService.params).oper){e.next=3;break}return e.abrupt("return",[]);case 3:return r=Object(l.a)(n.tids),o=Object(l.a)(n.ids),i=[].concat(d(r.map(function(e){return{id:"messages",params:{thread_id:e,first:0,count:Math.min(ns.Model.get("message",{ids:e}).getThreadCount(),500)}}})),d(o.map(function(e){return{id:"message",params:{ids:e}}}))),e.next=8,ns.request(i);case 8:return a=e.sent,s=a.map(function(e){return"messages"===e.id?e.models:[e]}),c=(t=[]).concat.apply(t,d(s)),e.abrupt("return",c.map(function(e){return{mid:e.get(".mid"),subject:Object(p.a)(e)}}));case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isCorp",get:function(){return Daria.IS_CORP}},{key:"hasDisk",get:function(){return!Daria.IS_CORP&&!this.mailboxUid&&!this.composeParamsService.mSettings.getSign("disable_disk_attachments")}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r=n(136),o=(n.n(r),n(1061)),i=n(1064),a=n(1065),s=n(1066),c=n(357),u=n(1445);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){f(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function y(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){d(i,r,o,a,s,"next",e)}function s(e){d(i,r,o,a,s,"throw",e)}a(void 0)})}}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(t){var n=t.attachment,r=t.onUploadProgress;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.attachment=n,this.onUploadProgress=r,this.patchedUploadProgress=this._patchUploadProgress()}return function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(e,[{key:"_patchUploadProgress",value:function(){var e=this,t=Object(u.b)({from:0,to:100},{from:0,to:90});return function(n){return e.onUploadProgress(t(n))}}},{key:"upload",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.onUploadProgress(0),e.next=3,this._prepareUpload();case 3:return e.next=5,this._uploadFileXHR();case 5:return e.next=7,this._checkUploadProgress();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_prepareUpload",value:function(){var e=this;return new Promise(function(t,n){Object(o.a)(e.attachment.info,{onError:function(t){var r=t.info,o=t.additionalInfo,i=t.status,a=t.errorCode;e.attachment.status!==c.c.ABORTED&&Jane.ErrorLog.log(p({},r,{method:"_prepareUpload"})),n({status:i,errorCode:a,additionalInfo:o})},onSuccess:t})})}},{key:"_uploadFileXHR",value:function(){var e=this;return new Promise(function(t,n){if(e.attachment.status===c.c.ABORTED)return t();e.attachment.xhr=Object(i.a)(e.attachment.info,{onUploadProgress:e.patchedUploadProgress,onUploadComplete:t,onCancelUpload:t,onError:function(t){var r=t.info,o=t.status,i=t.errorCode;e.attachment.status!==c.c.ABORTED&&Jane.ErrorLog.log(p({},r,{method:"_uploadFileXHR"})),n({status:o,errorCode:i})}})})}},{key:"_checkUploadProgress",value:function(){var e=y(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.attachment.info.narod){e.next=2;break}return e.abrupt("return");case 2:return t=this._launchCheckStatusAnimation(),e.prev=3,e.next=6,this._getDiskProgress();case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,Object(u.c)(t),e.finish(7);case 10:case"end":return e.stop()}},e,this,[[3,,7,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"_launchCheckStatusAnimation",value:function(){var e=this;return Object(u.a)(function(t){e.onUploadProgress(90+t)},10)}},{key:"_getDiskProgress",value:function(){var e=this;return new Promise(function(t,n){var o=Object(r.cloneDeep)(e.attachment.info);e.attachment.status===c.c.ABORTED&&t({info:o}),Object(s.a)(o.narod,function(){Object(a.a)(o,{onError:function(e){var t=e.info,r=e.status,i=e.errorCode;Object(s.b)(o.narod||{}),Jane.ErrorLog.log(p({},t,{method:"_getDiskProgress"})),n({status:r,errorCode:i})},onUploadProgress:function(){e.attachment.status===c.c.ABORTED&&(Object(s.b)(o.narod||{}),t({info:o}))},onUploadComplete:function(){Object(s.b)(o.narod||{}),t({info:o})}})})})}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(136),o=(n.n(r),n(1067)),i=n(1068),a=n(357);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t){var n=t.attachment,r=t.onUploadProgress;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.attachment=n,this.onUploadProgress=r}return function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(e,[{key:"upload",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,s,"next",e)}function s(e){u(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._uploadFileXHR();case 2:return e.next=4,this._processDirectUploadResponse();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_uploadFileXHR",value:function(){var e=this;return new Promise(function(t){e.xhr=Object(o.a)(e.attachment.info,{uploadUrl:e._getUploadUrl(),onUploadProgress:e.onUploadProgress,onUploadComplete:function(){return t()}})})}},{key:"_getUploadUrl",value:function(){return Daria.url.upload()}},{key:"_processDirectUploadResponse",value:function(){var e=this;return new Promise(function(t,n){var o=Object(r.cloneDeep)(e.attachment.info);Object(i.a)({info:o,previewSupported:e.attachment.previewSupported,xhr:e.xhr},{onAuthFail:function(){return Jane.doLogin("upload_attachment")},onError:function(t){var r=t.info,o=t.status,i=t.errorCode;e.attachment.status!==a.c.ABORTED&&Jane.ErrorLog.log(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},r,{method:"_processDirectUploadResponse"})),n({status:o,errorCode:i})},onSuccess:function(){return t({info:o})}})})}}]),e}()},function(e,t,n){"use strict";var r=n(136);n.n(r);t.a=function(e){return e?Object(r.isArray)(e)?e:[e]:[]}},function(e,t,n){"use strict";function r(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return i});var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(e,[{key:"refreshCaptcha",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,c,"next",e)}function c(e){r(a,o,i,s,c,"throw",e)}s(void 0)})}}(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ns.forcedRequest("captcha").then(function(e){return e[0].data});case 2:return t=e.sent,e.abrupt("return",{captchaKey:t.key,captchaUrl:t.url});case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(136),o=(n.n(r),n(353));function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n){var r=n.htmlProcessor;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.emptySend=t,this.processorService=r}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"isEmpty",value:function(e){return!e.to&&!e.cc&&!e.bcc&&this.isSubjectEmpty(e.subj)&&this._isSendEmpty(e.send)&&Object(r.isEmpty)(e.att_ids)&&Object(r.isEmpty)(e.parts)&&!e.disk_att&&Object(r.isEmpty)(e.lids)}},{key:"isSubjectEmpty",value:function(e){return!e||e==="(".concat(Object(o.default)("compose-react/Без_темы"),")")}},{key:"_isSendEmpty",value:function(e){return!e||this.processorService.processHtml(e)===this.processorService.processHtml(this.emptySend)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(702),o=n(1071);function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,c(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,r["a"]),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(t,[{key:"messageSubject",get:function(){return Object(o.a)(this.mMessage||this.mThread)}},{key:"messageSubjectWithPrefix",get:function(){return Object(o.b)(this.mMessage||this.mThread)}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(2562),o=n(2565),i=n(137);n.n(i);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,s,"next",e)}function s(e){u(i,r,o,a,s,"throw",e)}a(void 0)})}}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f={att_ids:null,bcc:"",captcha_entered:null,captcha_key:null,cc:"",charset:null,confirm_limit:null,current_folder:null,doit:null,fid:null,from_mailbox:null,from_name:null,get_abook:null,html:null,idcs:null,ids:[],ign_overwrite:null,initial_cc:"",initial_to:"",inreplyto:null,lids:[],mark_as:null,mark_ids:[],disk_att:null,nosave:null,nosend:null,notify_on_send:null,overwrite:null,parts:null,phone:null,references:null,remind_period:null,retpath:null,returl:null,saveDraft:null,save_symbol:i.WellKnownFolderSymbol.DRAFT,send:"",send_time:null,store_fid:null,store_name:null,strict_charset:null,style:null,subj:null,to:"",ttype:null,withUpdatedUndoAndDelayedErrorHandling:"yes"},d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(e,[{key:"makeRequest",value:function(){var e=l(regeneratorRuntime.mark(function e(t){var n,i,a,c,u,l,p,d,b;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,i=t.send,a=t.mailboxUid,c={_connection_id:Daria.Config.connection_id,_ckey:Daria.ckey,_uid:Daria.uid,_eexp:Daria.Config["eexp-boxes"],_mailboxUid:a},u=s({},f,{},c,{},n,{mailboxUid:a}),l=i?"send":"save",p="".concat(Daria.api["do-send"],"?_").concat(l,"=true"),d=Object(r.a)(u),e.prev=6,e.next=9,fetch(p,d);case 9:b=e.sent,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),Object(o.a)({status:0,statusText:"",text:""},l);case 15:return e.prev=15,e.next=18,y(b);case 18:return e.abrupt("return",e.sent);case 21:e.prev=21,e.t1=e.catch(15),Object(o.a)(e.t1,l);case 24:case"end":return e.stop()}},e,null,[[6,12],[15,21]])}));return function(t){return e.apply(this,arguments)}}()},{key:"removeMidFromFailedMessages",value:function(e){ns.Model.get("message-failed").removeMid(e)}}]),e}();function y(e){return b.apply(this,arguments)}function b(){return(b=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ok){e.next=2;break}throw{status:t.status,statusText:t.statusText,text:t.statusText};case 2:return n={},e.prev=3,e.next=6,t.json();case 6:n=e.sent,e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(3),{status:t.status,statusText:"parsererror",text:e.t0&&e.t0.message||e.t0};case 12:if(Daria.parseLoginInfo(n)){e.next=14;break}throw{status:t.status,statusText:"no_auth"};case 14:if("ok"===n.status||n.limited){e.next=16;break}throw{status:n.status,statusText:n.message,limited:n.limited,response:n};case 16:if(!n.error){e.next=18;break}throw{status:t.status,statusText:n.error,response:n};case 18:return e.abrupt("return",n);case 19:case"end":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}},function(e,t,n){"use strict";t.a=function(e){return{method:"POST",mode:"no-cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.a.stringify(e)}};var r=n(1448),o=n.n(r)},,,function(e,t,n){"use strict";t.a=function(e,t){var n=e.status,i=e.statusText,a=e.response,s=r.SendError.INTERNAL_ERROR,c=s;"parsererror"===i?(c="bad_json",s=r.SendError.NO_DATA):"no_auth"===i||403===n?(c="NoAuth",s=r.SendError.ACCESS_DENIED):s=r.SendError.RETRYABLE_ERRORS.includes(i)?i:413===n?r.SendError.TOO_BIG_ATTACHMENTS:n>0?r.SendError.NO_DATA:n||r.SendError.NO_NETWORK;Jane.ErrorLog.log({type:o.ErrorType.Service,message:"Http Error",block:o.ErrorBlock.Compose,method:"handleRequestError",source:0===n?o.ErrorSource.Network:o.ErrorSource.Request,sourceMethod:o.ErrorSourceMethod.ComposeSendMessage,customMessage:n,statusText:i,stage:t,errorCode:s}),"NoAuth"===c&&Jane.doLogin("composeHandleRequestError");throw new p(s,a)};var r=n(355),o=(n.n(r),n(3));n.n(o);function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){var t="function"==typeof Map?new Map:void 0;return(s=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return c(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,e)})(e)}function c(e,t,n){return(c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&u(o,n.prototype),o}).apply(null,arguments)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=a(this,l(t).call(this))).code=e,n.data=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,s(Error)),t}()},function(e,t,n){"use strict";var r=n(786),o=n.n(r);n.d(t,"a",function(){return o.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(419),o=n(136),i=(n.n(o),n(347));function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){l(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var f={onlyFirstEmail:!0,joinName:!0,withContactEmailList:!0},d=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contactsStore=t,this.errorsService=n,this.externalEmailsBridge=Object(i.getExternalEmailsBridge)()}return function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(e,[{key:"loadContacts",value:function(e){var t=this;if(!e||!e.length)return Promise.resolve();var n=e.map(function(e){return e.email}).filter(function(e){return Jane.FormValidation.checkEmail(e||"")}),r=this._splitToChunks(n).map(function(e){var n=[t._createContactListRequest(e)];return Daria.Config.workspace&&n.push(t._createContactListRequest(e,{shared:1})),ns.request(n).then(function(n){return t._processContactListResponse(n,e)}).fail(function(e){return t._processContactLoadFailure(e)})});return Promise.all(r)}},{key:"_processContactLoadFailure",value:function(e){this.errorsService.log({method:"loadContacts",invalid:e&&e.invalid&&JSON.stringify(ns.Model.collectErrorData(e.invalid))},e)}},{key:"loadContact",value:function(e,t){var n=this;if(!e)return Promise.resolve();var r=[this._createContactRequest(e.email,{mailboxUid:t})];return Daria.Config.workspace&&r.push(this._createContactRequest(e.email,{mailboxUid:t,shared:1})),ns.request(r).then(function(t){return n._processContactResponse(t,e)})}},{key:"_splitToChunks",value:function(e){var t=[],n=[],r=0;return e.forEach(function(e){e.length>=256||((r+=e.length+1)>256&&(t.push(n),n=[],r=0),n.push(e))}),n.length&&t.push(n),t}},{key:"_createContactListRequest",value:function(e){return{id:"abook-contacts",params:u({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{emails:e.join(",")})}}},{key:"_createContactRequest",value:function(e){return{id:"abook-contact",params:u({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{email:e})}}},{key:"_processContactListResponse",value:function(e,t){var n=this,r=s(e,2),o=r[0],i=r[1],c=o.getContactsInfoByEmails(t,f),l=i?i.getContactsInfoByEmails(t,u({},f,{shared:!0})):[];[].concat(a(l),a(c)).forEach(function(e){return n._processContact(e)})}},{key:"_processContactResponse",value:function(e,t){var n=s(e,2),r=n[0],i=n[1],a=!Object(o.isEmpty)(r.getData())&&r.getContactInfo(f,{email:t.email}),c=(i?i.getContactInfo(u({},f,{shared:!0}),{email:t.email}):null)||a;return c?this._processContact(c):t}},{key:"_processContact",value:function(e){var t,n=this.externalEmailsBridge.getExternalEmails();if(e.emailList)t=e.emailList.map(function(t){return r.default.of(u({},e,{email:t,isExternal:Boolean(n[t])}))});else{var o=r.default.of(u({},e,{isExternal:Boolean(n[o.email])}));t=[o]}var i=!0,a=!1,s=void 0;try{for(var c,l=t[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var p=c.value;this.contactsStore.writeContact(p)}}catch(e){a=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw s}}return e}}]),e}()},function(e,t,n){"use strict";var r=/[^a-zа-яё0-9]/i,o=/['"()<>]/g,i=/^[a-zа-яё0-9]/i,a=/[A-ZА-ЯЁ]/g;t.a=function(e,t){if(e&&(e=(e=String(e)).replace(o,""))){var n=e.split(r),s=n[0].match(a)||[];return s.length&&e.charAt(0).match(a)&&(s=s.slice(1)),(e=t?e.charAt(0):-1!==e.indexOf("@")&&i.test(e)?e.charAt(0):2===n[0].length?n[0]:s.length?n[0].charAt(0)+s[0]:n.length>1?n[0].charAt(0)+n[1].charAt(0):n[0].charAt(0)).toUpperCase()}}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"getPassportDate",value:function(e){return Daria.getPassportDate(e)}},{key:"convertPassportDateToTimestamp",value:function(e){return Daria.convertPassportDateToTimestamp(e)}},{key:"now",get:function(){return new Date(Daria.now())}},{key:"passportNow",get:function(){return new Date(Daria.passportNow())}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(3);n.n(r);function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(e,[{key:"sendException",value:function(e,t,n){Jane.ErrorLog.sendException(e,t,n)}},{key:"sendError",value:function(e,t){Jane.ErrorLog.send(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({errorType:e},t))}},{key:"log",value:function(e,t){Jane.ErrorLog.log(Object.assign({type:r.ErrorType.Service,block:r.ErrorBlock.Compose,source:r.ErrorSource.Logic,sourceMethod:r.ErrorSourceMethod.Compose},e),t)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(136),o=(n.n(r),n(1450)),i=n(376),a=n.n(i);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=400,u={leading:!0,trailing:!1},l=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events={save:new o.a,send:new o.a,exit:new o.a},this.setHandlerNode=function(e){t.handlerNode=e},this._onKeyDown=function(e){var n=Modernizr.mac?e.metaKey:e.ctrlKey;if(e.keyCode===a.a.ESC&&t._emitEventDebounced(t.events.exit,e),n)switch(e.keyCode){case a.a.S:t._emitEventDebounced(t.events.save,e);break;case a.a.ENTER:t._emitEventDebounced(t.events.send,e)}},this._emitEvent=function(e,n){t._stopEvent(n),e.emit()},this._stopEvent=function(e){e.preventDefault(),e.stopPropagation()},this.handlerNode=null,this._emitEventDebounced=Object(r.debounce)(this._emitEvent,c,u)}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,[{key:"subscribe",value:function(){this.handlerNode&&this.handlerNode.addEventListener("keydown",this._onKeyDown,!0)}},{key:"unsubscribe",value:function(){this.handlerNode&&this.handlerNode.removeEventListener("keydown",this._onKeyDown,!0)}}]),e}()},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(787);function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r["a"]),function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(t,[{key:"emit",value:function(){this._emit()}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(787);function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r["a"]),function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(t,[{key:"emit",value:function(){this._emit()}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(787);function o(e){"@babel/helpers - typeof";return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,s(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r["a"]),function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(t,[{key:"emit",value:function(){this._emit()}}]),t}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._replacer=document.createElement("div")}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"initDataProcessor",value:function(e){this.dataProcessor=e}},{key:"resetDataProcessor",value:function(){this.dataProcessor=null}},{key:"processHtml",value:function(e){if(!e)return e;var t=this.dataProcessor?this.dataProcessor.toHtml(e):this._stripWhitespaces(e);return this._processHtml(t)}},{key:"_processHtml",value:function(e){this._replacer.innerHTML=e||"";var t=this._replacer.innerHTML;return this._replacer.innerHTML="",t}},{key:"_stripWhitespaces",value:function(e){return e&&e.replace(/\r|\n/gi,"").replace(/(<br\/>)|(&nbsp;)|\s/gi," ")}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(136),o=(n.n(r),n(1452)),i=n(1453),a=n(71);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return Boolean(e)}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,[{key:"splitLabels",value:function(e){var t=this,n=e.map(function(e){return t.mLabels.getLabelById(e)}).filter(c),o=n.filter(function(e){return t.isUserLabel(e)});return{userLabels:o,otherLabels:Object(r.difference)(n,o)}}},{key:"isUserLabel",value:function(e){return e&&(e.user||this.isImportantLabel(e))&&!this.isSystemLabel(e)}},{key:"isImportantLabel",value:function(e){var t=this.mLabels.getImportantLID();return e.lid===t}},{key:"isSystemLabel",value:function(e){return!!e&&(!e.user&&-1!==[this.waitingForReplyLabel,this.delayedMessageLabel].indexOf(e))}},{key:"labelColors",value:function(e){return Object(o.a)(e)}},{key:"getCreatedByUserLabels",value:function(){var e=this;return this.mLabels.models.map(function(e){return e.getData()}).filter(function(t){return e.isUserLabel(t)&&!e.isImportantLabel(t)})}},{key:"subscribeLabelsChanged",value:function(e){return Object(i.a)(this.mLabels,e)}},{key:"refreshUserLabels",value:function(e){var t=this,n=this.mLabels.getLabelsHash();return e.map(function(e){return Object(r.has)(n,e.lid)&&t.mLabels.getLabelById(e.lid)}).filter(c)}},{key:"mLabels",get:function(){var e=Object(a.a)();return ns.Model.get("labels",{mailboxUid:e})}},{key:"waitingForReplyLabel",get:function(){return this.mLabels.getWaitingForReplyLabel()}},{key:"delayedMessageLabel",get:function(){return this.mLabels.getDelayedMessageLabel()}},{key:"importantLabel",get:function(){var e=this;return this.mLabels.models.map(function(e){return e.getData()}).find(function(t){return e.isImportantLabel(t)})}}]),e}()},,function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"_extractSection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n={};return Object.keys(e).filter(function(e){return String(e).indexOf(t)>=0}).forEach(function(t){n[t]=e[t]}),n}},{key:"logValidationFail",value:function(e,t){var n=Daria&&Daria.Recipients&&Daria.Recipients._validityCache,r=Daria&&Daria.Recipients&&Daria.Recipients._cache,o={email:e,contact:t,validity:this._extractSection(n,e),cache:this._extractSection(r,e)};Daria&&Daria.monitoring&&Daria.monitoring.contactValidation&&Daria.monitoring.contactValidation(o)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(136),o=(n.n(r),n(2598)),i=n.n(o),a=n(588),s=n(419);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.preventSuggest={to:!1,cc:!1,bcc:!1},this._suggestShownField=""}return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(e,[{key:"markSuggestShown",value:function(e){this._suggestShownField=e}},{key:"logSuggestUsage",value:function(e,t){var n=e.field,r=e.usedPosition,o=void 0===r?"":r,s=e.usedText,c=void 0===s?"":s,u=e.mailboxUid;if(this.preventSuggest[n])this.preventSuggest[n]=!1;else{var l=o>0;l&&(this.preventSuggest[n]=!0);var p={project:"search_mail",action:"suggest-compose",product:a.b,uid:Daria.uid,filed:n,field:n,suggest_used:l?"yes":"no",suggest_show:this._suggestShownField===n?"yes":"no",pos:o,count:t.contacts&&t.contacts.length||"",user_text:t.query,search_text:c};p.user_text=p.user_text?encodeURIComponent(p.user_text):"",p.search_text=p.search_text?encodeURIComponent(p.search_text):"",Daria.searchClickCounter(i()(p).map(function(e){return e.join("=")})),l&&this._reportAbookSuggest(t.contacts[o-1],t,u),this._suggestShownField=""}}},{key:"_reportAbookSuggest",value:function(e,t,n){if(!Object(r.startsWith)(e.id,s.COUNTER_PREFIX)){var o={q:t.query||"",section:s.default.isGroupContact(e)?"group":"email",id:e.id.replace(/^(cid|mcid|tid|id)/,""),title:e.email,mailboxUid:n};ns.forcedRequest("abook-suggest-report",o)}}}]),e}()},,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(354);n.n(r);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,this.base=this.params.isQuickReply?r.QUICK_REPLY:r.COMPOSE_METRIKA}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(e,[{key:"sendMetrika",value:function(){var e;(e=Jane).c.apply(e,arguments)}},{key:"sendHeaderMetrika",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendMetrika.apply(this,[this.base,r.COMPOSE_METRIKA_HEADER].concat(t))}},{key:"sendRecipientsDiffMetrika",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendMetrika.apply(this,[this.base,r.COMPOSE_METRIKA_RECIPIENTS_DIFF].concat(t))}},{key:"sendWysiwigMetrika",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendMetrika.apply(this,[this.base,r.COMPOSE_METRIKA_WYSIWIG].concat(t))}},{key:"sendFooterMetrika",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendMetrika.apply(this,[this.base,r.COMPOSE_METRIKA_FOOTER].concat(t))}},{key:"sendAttachmentsMetrika",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendMetrika.apply(this,[r.COMPOSE_METRIKA_ATTACHMENTS].concat(t,[r.COMPOSE_METRIKA_ATTACHMENTS_PLACE]))}},{key:"sendPopupsMetrika",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendMetrika.apply(this,[this.base,r.COMPOSE_METRIKA_POPUPS].concat(t))}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1450);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.events={leaveBrowser:new r.b,leavePage:new r.c},this._onBrowserLeave=function(){return t.events.leaveBrowser.emit(),t.hasChanges?"Cannot leave: unsaved changes":void 0},this._onPageLeave=function(){return t.events.leavePage.emit(),!t.hasChanges},this._onNsBrowserLeave=function(){t.events.leaveBrowser.emit(),t.hasChanges&&Daria.addUnloadText("Cannot leave: unsaved changes")},this.hasChanges=!1}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(e,[{key:"subscribe",value:function(){var e=this;return window.addEventListener("beforeunload",this._onBrowserLeave),ns.events.on("beforeunload",this._onNsBrowserLeave),ns.page.blockReload.add(this._onPageLeave),function(){return e.unsubscribe()}}},{key:"unsubscribe",value:function(){window.removeEventListener("beforeunload",this._onBrowserLeave),ns.events.off("beforeunload",this._onNsBrowserLeave),ns.page.blockReload.remove(this._onPageLeave)}}]),e}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"_getMessage",value:function(e){return ns.Model.get("message",{ids:e})}},{key:"removeDraft",value:function(e){Daria.MOPS["remove.draft"](this._getMessage(e).getMessagesCheckedModel())}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(136),o=(n.n(r),n(1453));function i(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e){for(var t=function(e){return e=Daria.Html2Text.text2html(e),e=Object(r.unescape)(e),Daria.Html2Text.html2text(e)}(e),n=0;"\n"===t[n];)n++;return n}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._signs=null}return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(e,[{key:"getRawSignatures",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).mailboxUid;return this._signs=Daria.signs.getHtml({mailboxUid:e}).map(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{idx:e._idx,name:e.name||e.preview,html:e.convert,match:Daria.signs.getSignatureMatch(e.convert),leadingLineBreaks:u(e.convert)})}),this._signs}},{key:"reset",value:function(){this._signs=null}},{key:"getSortFunction",value:function(e,t){return Daria.signs.sort(e,t)}},{key:"getSignature",value:function(e,t){var n=i(this.getRawSignatures()).sort(this.getSortFunction(e,t));return n.length?n[0]:null}},{key:"subscribeSignaturesChanged",value:function(e){return Object(o.a)(ns.Model.get("signs"),e)}}]),e}()},function(e,t,n){"use strict";function r(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return i});var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(e,[{key:"getSmartSubjects",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,c,"next",e)}function c(e){r(a,o,i,s,c,"throw",e)}s(void 0)})}}(regeneratorRuntime.mark(function e(t){var n,r,o,i,a,s,c,u,l,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.position,r=t.messageId,o=t.threadId,i=t.text,a=t.addresses,s=t.attaches,c=Daria.Html2Text.html2text(i),e.next=4,ns.Model.get("compose-smartsubject",{position:n,message_id:r,thread_id:o}).getItemsData({text:c,addresses:a,attaches:s});case 4:return u=e.sent,l=u.items,p=u.requestId,e.abrupt("return",{items:l,requestId:p});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1071),o=n(137),i=(n.n(o),n(1447));function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t){var n=t.contactsFormatter;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contactsFormatter=n}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(e,[{key:"loadTemplates",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{count:20},n=t.first,r=t.count,o=void 0===r?20:r;return this._getTemplatesModel({first:n,count:o}).then(function(t){var n=t.models.map(e._mapModel);return{canLoadMore:t.canLoadMore(),items:n}},function(){return{canLoadMore:!1,items:[]}})}},{key:"_getTemplatesModel",value:function(e){var t=e.count,n=e.first,r=this._getTemplatesFolderFid();return r?ns.request([{id:"messages",params:{current_folder:r,sort_type:"date",first:n,count:t}}]).then(function(e){return e[0]}):Promise.reject("No templates folder")}},{key:"_getTemplatesFolderFid",value:function(){return ns.Model.get("folders").getFidBySymbol(o.WellKnownFolderSymbol.TEMPLATE)}},{key:"_mapModel",value:function(e){return{key:e.key,subject:Object(r.a)(e),mid:e.get(".mid")}}},{key:"loadTemplateData",value:function(e,t){var n=this;return ns.request(["message","message-body"],{ids:e,draft:!0}).then(function(o){var a=o[0],s=o[1];return{mid:e,subject:Object(r.b)(a),messageBody:s.getDraftBody(t),addresses:{to:n.contactsFormatter.parseContacts(s.getAddressField("to")),cc:n.contactsFormatter.parseContacts(s.getAddressField("cc")),bcc:n.contactsFormatter.parseContacts(s.getAddressField("bcc"))},attachments:s.getAttachments().filter(function(e){return!e.inline}).map(function(t){return delete(t=_.extend({},t,{from_template:!0,template_mid:e,template_hid:t.hid})).hid,Object(i.a)(s,t)})}})}},{key:"ensureTemplatesFolder",value:function(){var e=ns.Model.get("folders"),t=e.getFidBySymbol(o.WellKnownFolderSymbol.TEMPLATE);return t?Promise.resolve(t):e.createTemplateFolder().then(function(e){return e.fid})}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(358),o=(n.n(r),n(359)),i=(n.n(o),n(353));function a(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,c,"next",e)}function c(e){a(i,r,o,s,c,"throw",e)}s(void 0)})}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u="translate-langs",l=function(){function e(t){var n=t.composeParams;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentTranslationPromise=null,this.composeParamsService=n,this.languages=ns.Model.get(u)}return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(e,[{key:"init",value:function(){var e=s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ns.request(u);case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),Object(r.showErrorMessage)(o.StatuslineName.TranslationError,Object(i.default)("statusline/statusLineMessageTranslationError")),e.t0;case 9:case"end":return e.stop()}},e,null,[[0,5]])}));return function(){return e.apply(this,arguments)}}()},{key:"translate",value:function(){var e=s(regeneratorRuntime.mark(function e(t,n,a){var s,c,u,l,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",{translation:"",langFrom:n,langTo:a});case 2:return s={text:t,lang:a,format:"html"},n&&a&&(s.lang="".concat(n,"-").concat(a)),e.prev=4,this.currentTranslationPromise=ns.request("do-translate",s),e.next=8,this.currentTranslationPromise;case 8:return c=e.sent,this.currentTranslationPromise=null,u=c.filter(function(e){return"do-translate"===e.id})[0],l=(u.get(".text")||[]).join(""),p=u.get(".detected.lang"),e.abrupt("return",{translation:l,langFrom:n||p,langTo:a});case 16:return e.prev=16,e.t0=e.catch(4),Object(r.showErrorMessage)(o.StatuslineName.TranslationError,Object(i.default)("statusline/statusLineMessageTranslationError")),e.abrupt("return",{translation:"",langFrom:n||"",langTo:a});case 20:case"end":return e.stop()}},e,this,[[4,16]])}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getLanguageName",value:function(e){return this.languages&&this.languages.getName(e)}},{key:"getRecents",value:function(){return this.languages&&this.languages.getRecent()}},{key:"getLangs",value:function(){return this.languages&&this.languages.getLangs()}},{key:"setRecent",value:function(e){this.languages&&this.languages.setRecent(e)}},{key:"getDefaultLanguageFrom",value:function(e){var t;return this.composeParamsService.isReplyAny&&(t=Daria.Translate.getLangByMid(this.composeParamsService.params.ids)),!t&&e.length&&(t=Daria.Translate.defineLanguage(e)),t||(t=Daria.Config.locale),t}},{key:"getDefaultLanguageTo",value:function(e){var t=Daria.Translate.getDefaultLangTo(e);return t||(e!==Daria.Config.locale?Daria.Config.locale:"ru"!==e?"ru":"en")}},{key:"getHelpUrl",value:function(){return Daria.Config["help-url"]+"/web/letter/translation.html#translation-outgoing"}}]),e}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isAbookPopupReady=!1}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"initAbookPopup",value:function(){var e=this;return this.isAbookPopupReady?Promise.resolve():Jane.Services.runModules(["abook.css","abook.js","abook.yate"]).then(function(){return e.isAbookPopupReady=!0})}},{key:"showAbookPopup",value:function(e){var t=e.field,n=e.contacts;return this.initAbookPopup().then(function(){var e=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},t,n.map(function(e){return{email:e.email,name:e.name}})),r=new vow.Deferred;return ns.action.run("mail-common.abook-popup",{popupType:"select",emails:e,resultDeferred:r}),r.promise()})}}]),e}()},function(e,t,n){"use strict";t.a=function(e){var t=e.manager,n=e.services,r=e.controllers,o=e.node,i=Daria.locale||"ru";return a.a.render(u(s.Provider,{state:t,services:n,controllers:r},void 0,u(c.default,{lang:i},void 0,l)),o),function(){a.a.unmountComponentAtNode(o),o.remove()}};var r,o=n(135),i=(n.n(o),n(139)),a=n.n(i),s=n(342),c=n(375);function u(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var l=u(n(2611).a,{})},function(e,t,n){"use strict";var r=n(2612),o=n(440),i=(n.n(o),n(403)),a=(n.n(i),n(349)),s=(n.n(a),Object(o.withPsTheme)({source:i.DarkSource.Content})(r.a));t.a=Object(a.hasFeature)(a.Features.WEB_DARK_COMPOSE)?s:r.a},function(e,t,n){"use strict";n.d(t,"a",function(){return Q});var r,o,i,a,s,c,u,l,p,f,d=n(135),y=n.n(d),b=n(338),m=n.n(b),h=n(136),v=n.n(h),g=n(339),O=n.n(g),_=n(29),S=n(347),E=n(341),P=n(342),C=n(350),w=n(367),T=n(2613),k=n(380),A=(n.n(k),n(1460)),R=n(3049),j=n(1529),M=n.n(j),I=n(1078),D=n(376),L=n.n(D),N=n(3061);n.n(N);function x(){return(x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function B(e){"@babel/helpers - typeof";return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function K(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function W(e,t,n,r){f||(f="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:f,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Y(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function G(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var q="ComposeManager",V={Block:q,hidden:"".concat(q,"_hidden"),visible:"".concat(q,"_visible"),PopupCompose:"".concat(q,"-PopupCompose"),PopupCompose_hidden:"".concat(q,"-PopupCompose_hidden")},Q=(r=Object(P.inject)("state"),o=Object(P.inject)("controllers"),i=E.observable.ref,r(a=o(a=Object(P.observer)((p=l=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=function(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?K(e):t}(this,(e=U(t)).call.apply(e,[this].concat(o))))._disposer=new w.a,Y(K(n),"containerRef",c,K(n)),n._currentOpenComposes=[],Y(K(n),"setContainerRef",u,K(n)),n._renderComposeMeta=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=r.className,i=r.actions,a=void 0===i?{}:i,s=a.onClose,c=[["expandCompose",a.onExpand],["collapseCompose",a.onCollapse],["closeCompose",s]].reduce(function(e,r){var o=F(r,2),i=o[0],a=o[1],s=n.props.state[i];return e[i]=function(){return s(t)&&a&&a()},e},{});return y.a.createElement(R.a,x({mode:e,metaState:t,className:o},c))},n.renderCompose=function(e){var t,r,o=!e.maximized;return e.size!==k.ComposeSizes.LARGE&&e.size!==k.ComposeSizes.SMALL||(t=n.props.controllers.dimensions.composeWidth,r=n.props.controllers.dimensions.composeRight),W(M.a,{scope:n.containerRef,size:e.size,cls:o?V.PopupCompose_hidden:"",visible:!o,onClose:function(t){return n.onClose(t,e)},Body:function(){return W(I.a,{cls:V.PopupCompose,metaState:e})},width:t,right:r,enableFocusTrap:!n.isAbookPopupOpened},e.id)},n.onClose=function(e,t){n.isAbookPopupOpened||Daria.ImageViewer.hasOpenedImages()||e.keyCode!==L.a.ESC&&(!n.containerRef||n.containerRef.contains(e.target))||n.props.state.collapseCompose(t)},n.renderCollapsedComposeAsThumb=function(e){return n._renderComposeMeta(k.ComposeMode.COLLAPSED,e)},n.renderCollapsedComposeAsMenuItem=function(e,t,r){var o={className:t,actions:{onExpand:r}};return n._renderComposeMeta(k.ComposeMode.COLLAPSED,e,o)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,y.a.Component),function(e,t,n){t&&z(e.prototype,t),n&&z(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;_.default.log("promo: ComposeManager mounted"),this._disposer.add(this,[Object(E.reaction)(function(){return e.hasMinimizedComposes},function(t){return e._updatePageClasses(t)}),Object(E.reaction)(function(){return e.hasExpandedCompose},function(t){return e._onComposeExpandedStateChanged(t)},{fireImmediately:!0})]),this._updatePageClasses(this.hasMinimizedComposes)}},{key:"runPromoManager",value:function(e){e&&(Object(S.getPromozavrBridge)()&&Object(S.getPromozavrBridge)().show("compose"),this._disposer.dispose("promo"))}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this),this.hasExpandedCompose&&this._onComposeExpandedStateChanged(!1)}},{key:"_updatePageClasses",value:function(e){Object(C.updatePageClasses)(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},"mail-Page_with_Collapsed_Composes",e))}},{key:"_onComposeExpandedStateChanged",value:function(e){e?$.Shortcuts.modalListPush("compose-react"):$.Shortcuts.modalListPop("compose-react"),Object(S.getPromozavrBridge)()&&Object(S.getPromozavrBridge)().reportComposeState(e)}},{key:"render",value:function(){var e=this.props.state.stack,t=e.composeMetaStates.some(function(e){return e.minimized}),n=this.openComposes.find(function(e){return e.maximized}),r=n&&n.size||k.ComposeSizes.LARGE,o=O()(this.props.className,V.Block,t?V.visible:V.hidden,"".concat(V.Block,"_size_").concat(r));return y.a.createElement("div",{className:o,ref:this.setContainerRef},this.openComposes.map(this.renderCompose),e&&W(T.a,{composeMetaStates:e.composeMetaStates,thumbItemView:this.renderCollapsedComposeAsThumb,menuItemView:this.renderCollapsedComposeAsMenuItem}))}},{key:"hasMinimizedComposes",get:function(){var e=this.props.state;return e.stack&&e.stack.composeMetaStates.some(function(e){return e.minimized})}},{key:"hasExpandedCompose",get:function(){return Boolean(this.props.state.currentCompose)}},{key:"isAbookPopupOpened",get:function(){return this.props.controllers.abookPopup.isAbookPopupOpened}},{key:"openComposes",get:function(){var e=this.props.state,t=e.currentCompose,n=e.stack;return this._currentOpenComposes=v.a.intersection(this._currentOpenComposes,n.composeMetaStates),t&&-1===this._currentOpenComposes.indexOf(t)&&this._currentOpenComposes.push(t),this._currentOpenComposes}}]),t}(),l.propTypes={className:m.a.string,state:m.a.instanceOf(A.a),services:m.a.object,controllers:m.a.object},c=G((s=p).prototype,"containerRef",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G(s.prototype,"hasMinimizedComposes",[E.computed],Object.getOwnPropertyDescriptor(s.prototype,"hasMinimizedComposes"),s.prototype),G(s.prototype,"hasExpandedCompose",[E.computed],Object.getOwnPropertyDescriptor(s.prototype,"hasExpandedCompose"),s.prototype),G(s.prototype,"isAbookPopupOpened",[E.computed],Object.getOwnPropertyDescriptor(s.prototype,"isAbookPopupOpened"),s.prototype),G(s.prototype,"openComposes",[E.computed],Object.getOwnPropertyDescriptor(s.prototype,"openComposes"),s.prototype),u=G(s.prototype,"setContainerRef",[E.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.containerRef=t}}}),a=s))||a)||a)||a)},function(e,t,n){"use strict";n.d(t,"a",function(){return w});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(342),d=n(341),y=n(2614),b=n(2621),m=(n.n(b),n(2622)),h=n(1459),v=n(354);n.n(v);function g(e){"@babel/helpers - typeof";return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var C={Container:"ComposeStack",Item:"ComposeStack-Item"},w=Object(f.inject)("services")(r=Object(f.inject)("controllers")(r=Object(f.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=_(this,(e=S(t)).call.apply(e,[this].concat(o))))._renderThumbs=function(e,t){var r=n.props.thumbItemView;return e.map(function(e){return P(y.b,{title:e.miniData.subject,minimized:e.minimized,inmenu:t.indexOf(e)>-1,className:C.Item},e.id,r(e))})},n._renderMenu=function(e){var t=n.props.menuItemView,r=n.props.controllers.dimensions.windowHeight;return P(y.a,{composeMetaStates:e,className:C.Item,maxHeight:Math.min(r,h.a),onToggle:n.onMenuToggle,onDraftsLinkClick:n.onMenuDraftsLinkClick},void 0,t)},n.onMenuToggle=function(){n.metrikaService.sendHeaderMetrika(v.COMPOSE_METRIKA_HEADER_TOGGLE_STACK)},n.onMenuDraftsLinkClick=function(){n.metrikaService.sendHeaderMetrika(v.COMPOSE_METRIKA_HEADER_STACK_DRAFTS_LINK)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,u.a.Component),function(e,t,n){t&&O(e.prototype,t),n&&O(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this.props.controllers,t=e.dimensions,n=e.settings;t.subscribe(),n.subscribe()}},{key:"componentWillUnmount",value:function(){var e=this.props.controllers,t=e.dimensions,n=e.settings;t.unsubscribe(),n.unsubscribe()}},{key:"render",value:function(){var e=this.props.composeMetaStates;if(!e.length)return null;var t={},n=this.props.controllers.dimensions.rightSpace,r=this.props.controllers.settings,o=r.timelineEnabled,i=r.timelineExpanded,a=r.todoEnabled,s=n;t.maxWidth="".concat(n,"px"),o&&i&&(t.bottom="".concat(h.e,"px")),!a||o&&i||(s=n-h.f-h.d,t.right="".concat(h.f+h.d,"px"),t.maxWidth="".concat(s,"px"));var c=Object(m.a)(e,s),u=c.toShow,l=c.toMenu;return P("div",{className:C.Container,role:"complementary",style:t},void 0,l.length?this._renderMenu(l):null,u.length?this._renderThumbs(u.reverse(),l):null)}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),t}(),i.propTypes={thumbItemView:p.a.func.isRequired,menuItemView:p.a.func.isRequired,composeMetaStates:f.PropTypes.observableArray.isRequired,services:p.a.object.isRequired,controllers:p.a.object.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"metrikaService",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),r=o))||r)||r)||r},function(e,t,n){"use strict";var r=n(2615);n.d(t,"b",function(){return r.a});var o=n(2617);n.d(t,"a",function(){return o.a});n(2619)},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(2616);n.n(l);function p(e){"@babel/helpers - typeof";return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m="ComposeStackThumb",h="ComposeStackThumb_collapsed",v="ComposeStackThumb-Content",g=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),d(this,y(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,i.a.Component),function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.minimized,o=t.inmenu,a=t.className,s=u()(a,m,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},h,!n||o));return i.a.createElement("div",{className:s,ref:function(t){return e.thumb=t}},function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("div",{className:v},void 0,this.props.children))}}]),t}();g.propTypes={minimized:s.a.bool.isRequired,inmenu:s.a.bool.isRequired,className:s.a.string}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return R});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(2618),p=(n.n(l),n(415)),f=n(344);function d(e){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var O="ComposeStackMenu",_="ComposeStackMenu_active",S="ComposeStackMenu-Content",E="ComposeStackMenu-Title",P="ComposeStackMenu-TitleText",C="ComposeStackMenu-TitleIcon",w="ComposeStackMenu-Items",T="ComposeStackMenu-Item",k="ComposeStackMenu-ItemContent",A="ComposeStackMenu-ItemContent_active",R=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=m(this,(e=h(t)).call.apply(e,[this].concat(o)))).state={isOpened:!1},n.close=function(){n.setState({isOpened:!1})},n.onToggle=function(e){e.stopPropagation(),n.setState(function(e){return{isOpened:!e.isOpened}});var t=n.props.onToggle;t&&t()},n.handleClickOutside=function(e){n.blockRef&&!n.blockRef.contains(e.target)&&n.close()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleClickOutside,!0)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleClickOutside,!0)}},{key:"_renderItem",value:function(e){var t=u()(k,y({},A,!e.minimized));return g("div",{className:T},e.id,this.props.children(e,t,this.close))}},{key:"_renderItems",value:function(e){var t=this;return this.state.isOpened?g("div",{className:w},void 0,e.map(function(e){return t._renderItem(e)})):null}},{key:"render",value:function(){var e=this,t=this.props,n=t.composeMetaStates,r=t.maxHeight,o=this.state.isOpened,a=Math.min(r,this.thumbHeight+5.5*this.itemHeight),s=u()(O,y({},_,o)),c={};if(o){var l=Math.min(a,this.thumbHeight+this.itemHeight*n.length);c.height=l,c.bottom=l-this.thumbHeight}return i.a.createElement("div",{className:s,style:c,ref:function(t){return e.blockRef=t}},g("div",{className:S},void 0,this._renderItems(n)),g("div",{className:u()(E),onClick:this.onToggle},void 0,g("span",{className:P},void 0,this.renderTitle()),g(p.a,{cls:C,id:"mail--ComposeManager-Arrow"})))}},{key:"renderTitle",value:function(){var e=this.props.composeMetaStates;return g(f.default,{loc:"compose-react/ComposesMenu_DraftsMoreN",params:{count:e.length}})}},{key:"itemHeight",get:function(){return 36}},{key:"thumbHeight",get:function(){return 36}}]),t}();R.propTypes={composeMetaStates:s.a.array.isRequired,maxHeight:s.a.number.isRequired,onToggle:s.a.func,onDraftsLinkClick:s.a.func}},function(e,t){},function(e,t,n){"use strict";var r=n(135),o=n.n(r),i=n(338),a=n.n(i),s=n(136),c=(n.n(s),n(1018)),u=n(2620);n.n(u);function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var p=function(e){var t=e.isShown,n=e.title,r=e.anchorNode,i={target:"anchor",directions:["top-left","top-right"],size:"m",autoclosable:!0,theme:"normal",onClose:s.noop};return r&&o.a.createElement(c.a,l({cls:"composeTooltip"},i,{anchor:r,visible:t}),n)};p.propTypes={anchorNode:a.a.instanceOf(Element),isShown:a.a.bool.isRequired,title:a.a.string.isRequired}},function(e,t){},function(e,t){},function(e,t,n){"use strict";t.a=function(e,t){if(e.reduce(function(e,t){return e+o(t)},0)<=t)return{toShow:e,toMenu:[]};var n=t-r.b-r.d,i=e.reduce(function(e,t){var r=e.toShow,i=e.toMenu,a=e.space;return a+=o(t),r.push(t),a>n&&i.push(t),{toShow:r,toMenu:i,space:a}},{toShow:[],toMenu:[],space:0}),a=i.toShow,s=i.toMenu;return{toShow:a,toMenu:s}};var r=n(1459),o=function(e){return e.minimized?r.c:0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EXPANDED=t.COLLAPSED=void 0,t.COLLAPSED="collapsed",t.EXPANDED="expanded"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LARGE=t.SMALL=void 0,t.SMALL="small",t.LARGE="large"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MINIMIZE=t.MAXIMIZE_SMALL=t.MAXIMIZE=t.CLOSE=void 0,t.CLOSE="close",t.MAXIMIZE="maximize",t.MAXIMIZE_SMALL="maximize_small",t.MINIMIZE="collapse"},function(e,t,n){"use strict";var r=n(2627),o=n(2668);n.d(t,"b",function(){return r.a}),n.d(t,"a",function(){return o.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var r=n(1461),o=n(2664),i=n(2665),a=n(1469);function s(e){"@babel/helpers - typeof";return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){c(i,r,o,a,s,"next",e)}function s(e){c(i,r,o,a,s,"throw",e)}a(void 0)})}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=p(this,f(t).call(this,e))).receiver=new i.a(e),n.composeState=new r.a(n.receiver,e.size),n.sender=new a.a(n.composeState),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o["a"]),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(t,[{key:"disconnect",value:function(){this.composeState.disconnect()}},{key:"setCurrentScenario",value:function(){var e=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.composeState.data.currentScenario=t;case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getMiniData",value:function(){var e=u(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.composeState.getMiniData());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return K});var r,o,i,a,s,c,u,l,p,f=n(136),d=(n.n(f),n(341)),y=n(2629),b=n(2631),m=n(2632),h=n(1463),v=n(1464),g=n(2662),O=n(367),_=n(1084),S=n(2663),E=n(780),P=n(343),C=n.n(P),w=n(1085),T=n.n(w),k=n(380),A=(n.n(k),n(405)),R=n(370),j=n(459),M=(n.n(j),n(589)),I=n(553),D=(n.n(I),n(350));function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function B(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){x(i,r,o,a,s,"next",e)}function s(e){x(i,r,o,a,s,"throw",e)}a(void 0)})}}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function U(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var K=(r=d.observable.ref,p=l=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k.ComposeSizes.LARGE;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),z(this,"data",i,this),z(this,"_params",a,this),z(this,"_predefinedData",s,this),z(this,"changeWorkMode",c,this),z(this,"changeSize",u,this),this.id=Object(f.uniqueId)("compose_state_"),this._dataLoaded=!1,this._disposer=new O.a,this.environmentAdapter=t,this.stores=null,this.services=null,this.controllers=null,this.visual=new y.a(n),this.validation=null,this.setData(null)}return function(e,t,n){t&&F(e.prototype,t),n&&F(e,n)}(e,[{key:"setData",value:function(e){this.data?Object.assign(this.data,e):this.data=e}},{key:"connect",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=Object.getOwnPropertyNames(this.controllers)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;this.controllers[i].init&&this.controllers[i].init()}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}},{key:"disconnect",value:function(){if(this.controllers){var e=!0,t=!1,n=void 0;try{for(var r,o=Object.getOwnPropertyNames(this.controllers)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;this.controllers[i].destroy()}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}}},{key:"setInitParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.params,n=e.predefinedData;this._params=t,this._predefinedData=n}},{key:"fill",value:function(){var e=B(regeneratorRuntime.mark(function e(){var t,n,r,o,i,a,s,c,u,l,p,d,y,O,S,E,P,w;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(f.isEmpty)(this.data)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.loadData();case 4:if(t=e.sent,this._dataLoaded||console.warn("Не смогли загрузить данные для письма"),n=this.visual,r=new b.a,o=new m.a,(i=new h.a(o,this,{mailboxUid:this.mailboxUid})).composeParams.newMessageId=Object(_.a)(t),a=i.settings.lang,C.a.locale(T.a[a]),s=i.composeParams,c=s.fromName,u=s.fromEmails,l=this.createInputComposeData(i),!Object(D.isB2BUser)()||Object(D.isCorp)()){e.next=20;break}return p=(l||{}).to||[],d=p.map(function(e){return e.email}),e.next=20,this.environmentAdapter.loadExternalEmails(d);case 20:return y=function(e){return{email:e,name:l.from_name||c}},e.next=23,this.environmentAdapter.getExternalEmails();case 23:O=e.sent,S=y(l.from_mailbox),E=i.signatures.getSignature(S,a),P=new g.a(S,l,E,O),w=new v.a({services:i,stores:o,environmentAdapter:this.environmentAdapter,visualState:n,data:P,validation:r,mailboxUid:this.mailboxUid}),o.addressesFrom.addresses=u.map(y),Object.assign(this,{stores:o,services:i,controllers:w,validation:r}),this.connect(),this.fillData(P);case 32:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"createInputComposeData",value:function(e){var t=e.composeParams.messageData,n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach(function(t){N(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t,{},Object(f.omit)(this.predefinedData,"send"),{},Object(E.a)(t));return e.checkEmptyDraft.isSubjectEmpty(n.subj)&&(n.subj=""),["to","cc","bcc","initial_to","initial_cc"].forEach(function(t){n[t]=e.contactsFormatter.parseContacts(n[t])}),n}},{key:"getMiniData",value:function(){var e=this.data||{addresses:{to:[],cc:[],bcc:[]}},t={subject:e.subject,addresses:e.addresses,lastSaved:e.lastSaved};return Object(d.toJS)(t,{recurseEverything:!0})}},{key:"fillData",value:function(e){this.setData(e),this.checkIfAdditionalAddressIsExpanded(),this.isDraft=this.services.composeParams.isDraft(),this.visual.expandedFields={to:!this.services.composeParams.isReplyAny(),cc:!1,bcc:!1}}},{key:"checkIfAdditionalAddressIsExpanded",value:function(){var e=Boolean(Object(f.get)(this,"data.addresses.cc.length")),t=Boolean(Object(f.get)(this,"data.addresses.bcc.length")),n=Object(f.get)(this,"data.addresses.from.email"),r=this.visual,o=r.currentPromo,i=r.promoData,a=o===j.PROMO_COMPOSE_SUGGEST_BEAUTIFUL_EMAIL||Boolean(o===j.PROMO_COMPOSE_BEAUTIFUL_EMAIL&&n&&Object(I.areEmailsEqual)(n,i));this.visual.additionalAddressesAreExpanded=e||t||a}},{key:"loadData",value:function(){var e=B(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._dataLoaded){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Object(S.a)(this.params);case 5:return t=e.sent,this._dataLoaded=!0,e.abrupt("return",t);case 10:e.prev=10,e.t0=e.catch(2),this._dataLoaded=!1;case 13:case"end":return e.stop()}},e,this,[[2,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"saveData",value:function(){var e=B(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.controllers&&this.data){e.next=2;break}return e.abrupt("return",{canContinue:!0});case 2:return this.data.currentScenario&&(this.data.currentScenario.qualityMetrics=function(){return n.controllers.compose.getQualityMetrics(n.data)}),e.next=5,this.controllers.checkUnsavedChanges.checkUnsavedChanges();case 5:return t=e.sent,e.abrupt("return",Object(f.omit)(t,"savePromise"));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_getChangeSizeParams",value:function(e){return this.controllers&&this.controllers.compose?this.controllers.compose.getParamsForQualityMetrics():{usedSmall:e===k.ComposeSizes.SMALL}}},{key:"setCurrentPromo",value:function(e,t){this.visual.setCurrentPromo(e,t),e&&this.checkIfAdditionalAddressIsExpanded()}},{key:"params",get:function(){return{ids:this.isDraft&&this.data&&this.data.overwriteIds||this._params.ids,tids:this._params.tids,oper:this._params.oper,isQuickReply:this._params.isQuickReply,qrAttaches:this._params.qrAttaches||[],mailboxUid:this._params.mailboxUid}}},{key:"mailboxUid",get:function(){return this._params.mailboxUid}},{key:"predefinedData",get:function(){return this._predefinedData}},{key:"providedState",get:function(){return Object(f.pick)(this,this.constructor.PROVIDED_PROPS)}}]),e}(),l.PROVIDED_PROPS=["data","visual","controllers","services","stores","validation","environmentAdapter"],i=U((o=p).prototype,"data",[d.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U(o.prototype,"setData",[d.action],Object.getOwnPropertyDescriptor(o.prototype,"setData"),o.prototype),a=U(o.prototype,"_params",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U(o.prototype,"params",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"params"),o.prototype),U(o.prototype,"mailboxUid",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"mailboxUid"),o.prototype),s=U(o.prototype,"_predefinedData",[d.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U(o.prototype,"predefinedData",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"predefinedData"),o.prototype),U(o.prototype,"fillData",[d.action],Object.getOwnPropertyDescriptor(o.prototype,"fillData"),o.prototype),U(o.prototype,"checkIfAdditionalAddressIsExpanded",[d.action],Object.getOwnPropertyDescriptor(o.prototype,"checkIfAdditionalAddressIsExpanded"),o.prototype),U(o.prototype,"providedState",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"providedState"),o.prototype),c=U(o.prototype,"changeWorkMode",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.mode;e.visual.workMode=n}}}),u=U(o.prototype,"changeSize",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){if(e.visual.size!==t){var n=A.a.getActiveScenario(R.b);n&&n.logStep(t===k.ComposeSizes.SMALL?M.b:M.c,e._getChangeSizeParams(t)),e.visual.size=t,t===k.ComposeSizes.SMALL&&(e.visual.translate.isEnabled=!1)}}}}),o)},function(e,t,n){"use strict";n.d(t,"a",function(){return A});var r,o,i,a,s,c,u,l,p,f,d,y,b,m,h,v,g,O,_,S=n(341),E=n(355),P=(n.n(E),n(2630)),C=n(380);n.n(C);function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function k(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var A=(o=k((r=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C.ComposeSizes.LARGE;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),T(this,"isLocked",o,this),T(this,"isSending",i,this),T(this,"isHScrollVisible",a,this),T(this,"additionalAddressesAreExpanded",s,this),T(this,"topContentInFixedMode",c,this),T(this,"currentPopup",u,this),T(this,"refs",l,this),T(this,"yabbleMenuPopup",p,this),T(this,"contactsSuggest",f,this),T(this,"subjectsSuggest",d,this),T(this,"translate",y,this),T(this,"workMode",b,this),this.isInIframe=Object(P.a)(),T(this,"size",m,this),T(this,"hasChanges",h,this),T(this,"currentPromo",v,this),T(this,"promoData",g,this),T(this,"focusedField",O,this),T(this,"expandedFields",_,this),this.size=t}return function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(e,[{key:"setCurrentPromo",value:function(e,t){this.currentPromo=e,this.promoData=t}},{key:"composeContainerRef",get:function(){return{current:this.refs.composeContainer}}}]),e}()).prototype,"isLocked",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),i=k(r.prototype,"isSending",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=k(r.prototype,"isHScrollVisible",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s=k(r.prototype,"additionalAddressesAreExpanded",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),c=k(r.prototype,"topContentInFixedMode",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u=k(r.prototype,"currentPopup",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),l=k(r.prototype,"refs",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e,t,n,r,o,i,a;return e=S.observable.ref,t=S.observable.ref,n=S.observable.ref,k(r={composeContainer:null,composeScrollableContainer:null,topContent:null},"composeContainer",[e],(o=(o=Object.getOwnPropertyDescriptor(r,"composeContainer"))?o.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return o}}),r),k(r,"composeScrollableContainer",[t],(i=(i=Object.getOwnPropertyDescriptor(r,"composeScrollableContainer"))?i.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return i}}),r),k(r,"topContent",[n],(a=(a=Object.getOwnPropertyDescriptor(r,"topContent"))?a.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return a}}),r),r}}),p=k(r.prototype,"yabbleMenuPopup",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{field:""}}}),f=k(r.prototype,"contactsSuggest",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{contacts:[],canShowSuggest:!0,type:"",query:"",field:""}}}),d=k(r.prototype,"subjectsSuggest",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{requestId:"",suggestItems:[],suggestType:""}}}),y=k(r.prototype,"translate",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{isEnabled:!1,translateFrom:"",translateTo:"",translation:"",translationsInProgress:0}}}),b=k(r.prototype,"workMode",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return E.WorkModes.FOREGROUND}}),m=k(r.prototype,"size",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return C.ComposeSizes.LARGE}}),h=k(r.prototype,"hasChanges",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),v=k(r.prototype,"currentPromo",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=k(r.prototype,"promoData",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=k(r.prototype,"focusedField",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=k(r.prototype,"expandedFields",[S.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),k(r.prototype,"setCurrentPromo",[S.action],Object.getOwnPropertyDescriptor(r.prototype,"setCurrentPromo"),r.prototype),k(r.prototype,"composeContainerRef",[S.computed],Object.getOwnPropertyDescriptor(r.prototype,"composeContainerRef"),r.prototype),r)},function(e,t,n){"use strict";t.a=function(){try{return window.self!==window.top}catch(e){return!0}}},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r,o,i,a,s,c=n(341),u=n(136);n.n(u);function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function f(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var d=(r=c.observable.ref,i=f((o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"errors",i,this),p(this,"sendError",a,this),p(this,"limitedRecipients",s,this)}return function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(e,[{key:"getAddressError",value:function(){var e=Object(u.head)(Object(u.filter)(this.errors,{fieldName:"addresses"}));if(e)return"incorrect_".concat(e.additionalFieldNames[0])}}]),e}()).prototype,"errors",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),a=f(o.prototype,"sendError",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s=f(o.prototype,"limitedRecipients",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(1462);var o=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.addressesFrom=new r.b,this.contacts=new r.a}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._addresses=null}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"addresses",get:function(){if(!this._addresses)throw new TypeError("FromAddressStore `addresses` field should be inited before call.");return this._addresses},set:function(e){this._addresses=e}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return F});var r,o,i,a,s,c,u=n(341),l=n(783),p=n(479),f=n(1080),d=n(1081),y=n(357),b=n(1082),m=n(707),h=n(1445),v=n(381),g=n.n(v),O=n(586),_=n(1465),S=n(450),E=(n.n(S),n(354));n.n(E);function P(e){"@babel/helpers - typeof";return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach(function(t){T(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function A(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){k(i,r,o,a,s,"next",e)}function s(e){k(i,r,o,a,s,"throw",e)}a(void 0)})}}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function L(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var N=5,x=95,B=[y.c.FAILED,y.c.VIRUS,y.c.RESTRICTED],F=(o=L((r=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),D(M(n=function(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?M(e):t}(this,j(t).call(this,e))),"forwardedMessages",o,M(n)),n.adjustProgress=Object(h.b)({from:0,to:100},{from:N,to:x}),D(M(n),"_maybeShowErrorsPopup",i,M(n)),D(M(n),"onUploadProgress",a,M(n)),D(M(n),"onUploadSuccess",s,M(n)),D(M(n),"onUploadFailure",c,M(n)),n._mapForwardedMessage=function(e){var t={status:y.c.COMPLETED,previewSupported:!1,info:{id:e.mid,mid:e.mid,type:y.d.FORWARDED_MAIL,name:e.subject}};return t.visual=n.services.attachments.getRenderData(t),t},n.initPromise=n.initAttachments().catch(function(e){n.services.errors.log({method:"initAttachments"},e)}).then(function(){return n.subscribeToFieldsChanged()}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,g.a),function(e,t,n){t&&R(e.prototype,t),n&&R(e,n)}(t,[{key:"subscribeToFieldsChanged",value:function(){var e=this;this._disposer.add(this,[Object(u.reaction)(function(){return e.validAttachments.length},function(){return e.environmentAdapter.onFieldChanged({fieldName:"attachments"})})])}},{key:"isValidAttachment",value:function(e){return!B.includes(e.status)}},{key:"createSendData",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(t){return e.services.attachments.getDataForSend(t)}),n=this._extractDataByField(t,function(e){return e.disk}),r=t.filter(function(e){return e.from_template}).map(function(e){return{mid:e.template_mid,hid:e.template_hid}}),o={att_ids:this._extractDataByField(t,function(e){return e.att_id}),parts:this._extractDataByField(t,function(e){return e.hid}),parts_json:r.length?JSON.stringify(r):"",disk_att:n.length?JSON.stringify(n):"",ids:this._extractDataByField(t,function(e){return e.ids})},i=this._extractDataByField(t,function(e){return e.ids});return i.length&&(o.mark_ids=i),o}},{key:"_extractDataByField",value:function(e,t){return e.map(t).filter(function(e){return Boolean(e)})}},{key:"attachFilesMixed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e.filter(function(e){return e.source===y.b.LOCAL}).map(function(e){return e.data}),n=e.filter(function(e){return e.source===y.b.DISK}).map(function(e){return e.data});this.attachFilesFromDisk(n),this.attachFilesFromLocal(t)}},{key:"attachFilesFromLocal",value:function(e){var t=this;if(this.services.composeParams.params.isQuickReply){var n=Array.from(e).map(Object(u.action)(function(e){return{source:y.b.LOCAL,data:e}}));return this.controllers.quickReply.goToFullCompose({qrAttaches:n})}e.forEach(Object(u.action)(function(e){var n=Object(l.a)({file:e});n.source=y.b.LOCAL,n.info.type=y.d.FILE,n.visual=t.services.attachments.getRenderData(n),t.attachments.push(n)})),this._processNextFileInQueue()}},{key:"attachFilesFromDisk",value:function(e){var t=this;if(this.services.composeParams.params.isQuickReply){var n=Array.from(e).map(Object(u.action)(function(e){return{source:y.b.DISK,data:e}}));return this.controllers.quickReply.goToFullCompose({qrAttaches:n})}e.forEach(Object(u.action)(function(e){var n=Object(f.a)(e),r=Object(l.a)(n);r.source=y.b.DISK,r.status=y.c.NEW,r.visual=t.services.attachments.getRenderData(r),t.attachments.push(r)})),this._processNextFileInQueue()}},{key:"_getTotalAttachmentsSize",value:function(){return this.attachments.reduce(function(e,t){return t.status===y.c.COMPLETED&&t.info.type!==y.d.YADISK?e+Object(p.a)(t.info):e},0)}},{key:"_processAttachmentSize",value:function(e,t){var n=Object(p.a)(e.info);if(n>this.services.limits.getMaxSizeForSingleFile(this.services.attachments.hasDisk))throw{status:y.c.FAILED,errorCode:y.e.FILE_LIMIT};if(t+n>this.services.limits.maxTotalAttachmentsSize){if(this.services.attachments.hasDisk)return y.d.YADISK;throw{status:y.c.FAILED,errorCode:y.e.TOTAL_LIMIT}}return n>this.services.limits.maxSizeForDirectUploadSingleFile?y.d.YADISK:y.d.FILE}},{key:"_processNextFileInQueue",value:function(){var e=A(regeneratorRuntime.mark(function e(){var t,n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this._findNextFileInQueue())){e.next=18;break}return e.prev=2,e.next=5,this._processAttachment(t);case 5:n=e.sent,this.onUploadSuccess(w({attachment:t},n)),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),r=e.t0.status||y.c.FAILED,o=e.t0.errorCode||y.e.UNKNOWN,this.onUploadFailure({attachment:t,status:r,errorCode:o});case 14:this._maybeShowErrorsPopup(),this._processNextFileInQueue(),e.next=19;break;case 18:this._maybeShowErrorsPopup();case 19:case"end":return e.stop()}},e,this,[[2,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"_findNextFileInQueue",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,o=this.attachments[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;if(i.status===y.c.UPLOADING)return!1;if(i.status===y.c.NEW)return i}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}return null}},{key:"_processAttachment",value:function(){var e=A(regeneratorRuntime.mark(function e(t){var n,r,o,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=function(e){return i.onUploadProgress({attachment:t,progress:e})},t.source!==y.b.DISK){e.next=6;break}return this.onUploadStarted({attachment:t}),e.next=5,this.services.attachments.attachFromDisk({attachment:t,onUploadProgress:n});case 5:return e.abrupt("return",e.sent);case 6:if(r=this._getTotalAttachmentsSize(),(o=this._processAttachmentSize(t,r))!==y.d.YADISK||!this.controllers.compose.isPddRestricted){e.next=10;break}throw{status:y.c.RESTRICTED};case 10:if(this.onUploadStarted({attachment:t,type:o}),t.info.type!==y.d.YADISK){e.next=15;break}return e.next=14,this.services.attachments.fileUploadWithDisk({attachment:t,onUploadProgress:n});case 14:return e.abrupt("return",e.sent);case 15:return e.next=17,this.services.attachments.fileUploadDirect({attachment:t,onUploadProgress:n});case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onUploadStarted",value:function(e){var t=e.attachment,n=e.type;n&&(t.info.type=n),t.progress=0,t.status=y.c.UPLOADING}},{key:"removeNotValidAttachments",value:function(){this.attachments=this.validAttachments}},{key:"initAttachments",value:function(){var e=A(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.attachments=this.services.attachments.loadInitialAttachments(),t=this.services.composeParams.params||{},(n=t.qrAttaches)&&n.length&&this.attachFilesMixed(n),e.next=5,this.services.attachments.getForwardedMessagesAttachData();case 5:r=e.sent,this.setForwardedMessages(r),r.length>1&&this.updateAttachments(r.map(this._mapForwardedMessage));case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setForwardedMessages",value:function(e){this.forwardedMessages=e}},{key:"updateAttachments",value:function(e){var t=this;e.reverse().forEach(Object(u.action)(function(e){t.attachments.unshift(e)}))}},{key:"updateAfterSave",value:function(e,t,n){e.forEach(Object(u.action)(function(e){Object(b.a)(e.info,t,n)}))}},{key:"getSummaryForLog",value:function(e){return Object(d.a)(e)}},{key:"addForwardAsAttachment",value:function(){var e=A(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.attachments.getForwardedMessagesAttachData();case 2:t=e.sent,n=t.map(this._mapForwardedMessage),this.addAttachments(n);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"addAttachments",value:function(e){var t=this;e.forEach(Object(u.action)(function(e){t.data.attachments.push(e)}))}},{key:"attachments",get:function(){return this.data.attachments},set:function(e){this.data.attachments=e}},{key:"isUploadedAll",get:function(){return!this.attachments.some(function(e){return e.status===y.c.NEW||e.status===y.c.UPLOADING})}},{key:"hasPendingAttachments",get:function(){return this.attachments.some(function(e){return e.status!==y.c.COMPLETED})}},{key:"hasRestrictedAttachments",get:function(){return this.attachments.some(function(e){return e.status===y.c.RESTRICTED})}},{key:"validAttachments",get:function(){return this.attachments.filter(this.isValidAttachment)}},{key:"notValidAttachments",get:function(){var e=this;return this.attachments.filter(function(t){return!e.isValidAttachment(t)})}},{key:"forwardMailAttachments",get:function(){return this.attachments.filter(function(e){return e.info.type===y.d.FORWARDED_MAIL})}},{key:"uploadedCount",get:function(){return this.validAttachments.filter(function(e){return e.status===y.c.COMPLETED}).length}},{key:"yaDiskCount",get:function(){return this.validAttachments.filter(function(e){return e.info.type===y.d.YADISK}).length}}]),t}()).prototype,"forwardedMessages",[u.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),L(r.prototype,"attachments",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"attachments"),r.prototype),L(r.prototype,"isUploadedAll",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"isUploadedAll"),r.prototype),L(r.prototype,"hasPendingAttachments",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"hasPendingAttachments"),r.prototype),L(r.prototype,"hasRestrictedAttachments",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"hasRestrictedAttachments"),r.prototype),L(r.prototype,"validAttachments",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"validAttachments"),r.prototype),L(r.prototype,"notValidAttachments",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"notValidAttachments"),r.prototype),L(r.prototype,"forwardMailAttachments",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"forwardMailAttachments"),r.prototype),L(r.prototype,"uploadedCount",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"uploadedCount"),r.prototype),L(r.prototype,"yaDiskCount",[u.computed],Object.getOwnPropertyDescriptor(r.prototype,"yaDiskCount"),r.prototype),L(r.prototype,"attachFilesFromLocal",[u.action],Object.getOwnPropertyDescriptor(r.prototype,"attachFilesFromLocal"),r.prototype),L(r.prototype,"attachFilesFromDisk",[u.action],Object.getOwnPropertyDescriptor(r.prototype,"attachFilesFromDisk"),r.prototype),i=L(r.prototype,"_maybeShowErrorsPopup",[u.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){if(e.notValidAttachments.length){if(e.hasRestrictedAttachments)return e.controllers.compose.showPddRestrictPopup();e.visualState.currentPopup=S.ATTACHMENTS_ERROR,e.notValidAttachments.forEach(Object(u.action)(function(t){e.services.metrika.sendPopupsMetrika(E.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS,E.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_SHOW,_.c[t.errorCode||O.UNKNOWN])}))}}}}),L(r.prototype,"onUploadStarted",[u.action],Object.getOwnPropertyDescriptor(r.prototype,"onUploadStarted"),r.prototype),a=L(r.prototype,"onUploadProgress",[u.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.attachment,r=t.progress;r=e.adjustProgress(r),n.status===y.c.UPLOADING&&(n.progress=r)}}}),s=L(r.prototype,"onUploadSuccess",[u.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.attachment,r=t.info;n.status=y.c.COMPLETED,r&&(r.size=Object(p.a)(r),n.info=r,n.visual=e.services.attachments.getRenderData(n)),n.previewSupported&&Object(m.a)(n.info)}}}),c=L(r.prototype,"onUploadFailure",[u.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(e){var t=e.attachment,n=e.status,r=e.errorCode;t.status=n||y.c.FAILED,t.errorCode=r}}}),L(r.prototype,"setForwardedMessages",[u.action],Object.getOwnPropertyDescriptor(r.prototype,"setForwardedMessages"),r.prototype),L(r.prototype,"updateAttachments",[u.action],Object.getOwnPropertyDescriptor(r.prototype,"updateAttachments"),r.prototype),L(r.prototype,"updateAfterSave",[u.action],Object.getOwnPropertyDescriptor(r.prototype,"updateAfterSave"),r.prototype),L(r.prototype,"addAttachments",[u.action],Object.getOwnPropertyDescriptor(r.prototype,"addAttachments"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(381),o=n.n(r);function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=1e4,p=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=s(this,c(t).call(this,e)))._autosave=function(){n.controllers.saveSend.saveMessage()},n.periodMs=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,o.a),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(t,[{key:"init",value:function(){this.startAutosave()}},{key:"startAutosave",value:function(){this._isAutoSaveEnabled&&!this.interval&&(this.interval=setInterval(this._autosave,this.periodMs))}},{key:"autosave",value:function(){this._isAutoSaveEnabled&&this._autosave()}},{key:"stopAutosave",value:function(){this.interval&&(clearInterval(this.interval),delete this.interval)}},{key:"destroy",value:function(){this.stopAutosave()}},{key:"_isAutoSaveEnabled",get:function(){return!this.services.composeParams.isTemplate()}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(136),o=(n.n(r),n(419));function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=100,s=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cache={},this._queue=[],this._requestAvatars=function(){var e=n._queue.splice(0);n.avatarsService.loadAvatars(e).then(n._processAvatarsResults)},this._processAvatarsResults=function(e){e.forEach(n._processAvatarResult)},this._processAvatarResult=function(e){var t=e.contact,r=e.avatar;if(t){var o=n._getCacheId(t),i=n._cache[o];i.result=r,i.resolve(r),delete i.resolve,delete i.reject,delete i.promise}},this.avatarsService=t,this._requestAvatars=Object(r.debounce)(this._requestAvatars,a)}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,[{key:"getAvatarForContact",value:function(e){if(o.default.isGroupContact(e))return Promise.resolve(e.avatar);var t=this._getCacheId(e),n=this._cache[t]||{};return n.result?Promise.resolve(n.result):n.promise?n.promise:(this._cache[t]=n,n.promise=new Promise(function(e,t){n.resolve=e,n.reject=t}),this._queue.push(e),this._requestAvatars(),n.promise)}},{key:"_getCacheId",value:function(e){var t=e.email,n=e.name;return"".concat(t," <").concat(n,">")}},{key:"destroy",value:function(){this._queue=[]}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var r,o=n(341),i=n(405),a=n(370),s=n(709),c=n(355),u=(n.n(c),n(355)),l=(n.n(u),n(381)),p=n.n(l),f=n(354);n.n(f);function d(e){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function b(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){y(i,r,o,a,s,"next",e)}function s(e){y(i,r,o,a,s,"throw",e)}a(void 0)})}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var _=(O((r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,v(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,p.a),function(e,t,n){t&&m(e.prototype,t),n&&m(e,n)}(t,[{key:"checkUnsavedChanges",value:function(){var e=b(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sendData=this.serializationController.createSendData(),!this.saveSendController.isSaving){e.next=3;break}return e.abrupt("return",this._saveAndContinue());case 3:if(!this._hasChanges()){e.next=7;break}return e.abrupt("return",this._continueUnSavedChanges());case 7:return e.abrupt("return",this._continueSavedChanges());case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_continueSavedChanges",value:function(){return this._isEmpty()?this._removeAndContinue():this._continueNoChanges()}},{key:"_removeAndContinue",value:function(){return this.controllers.deleteDraft.deleteDraft(),this._finishScenarioIfCurrent(s.e),{canContinue:!0,resolution:u.ResolutionTypes.DRAFT_REMOVED}}},{key:"_continueNoChanges",value:function(){return this._finishScenarioIfCurrent(s.c),{canContinue:!0,resolution:u.ResolutionTypes.NO_CHANGES}}},{key:"_continueUnSavedChanges",value:function(){var e=b(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this._isEmpty()&&!this.attachmentsController.hasPendingAttachments){e.next=3;break}return e.abrupt("return",this._saveAndContinue());case 3:if(!this.saveSendController.isSaved){e.next=8;break}return e.next=6,this._promptRemoveDraft();case 6:return t=e.sent,e.abrupt("return",t?this._removeAndContinue():this._continueWithoutSaving());case 8:return e.abrupt("return",this._removeAndContinue());case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",{canContinue:!1});case 14:case"end":return e.stop()}},e,this,[[0,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"_continueWithoutSaving",value:function(){return this._finishScenarioIfCurrent(s.b),{canContinue:!0,resolution:u.ResolutionTypes.DRAFT_NOT_SAVED}}},{key:"_saveAndContinue",value:function(){var e=this,t=this.saveSendController.saveMessage().then(function(){return s.f},function(){return s.d}).then(function(t){return e._finishScenarioIfCurrent(t)});return{canContinue:!0,resolution:u.ResolutionTypes.DRAFT_SAVED,savePromise:t}}},{key:"_promptRemoveDraft",value:function(){return this.promptRemoveDraftPromise||(this.promptRemoveDraftPromise=this._makePromptRemoveDraftPromise()),this.promptRemoveDraftPromise}},{key:"_makePromptRemoveDraftPromise",value:function(){var e=this;return this._showConfirmRemovePopup(),new Promise(function(t,n){e.resolveRemoveDraftPromise=t,e.rejectRemoveDraftPromise=n})}},{key:"_showConfirmRemovePopup",value:function(){this.visualState.currentPopup=c.Popups.CONFIRM_REMOVE,this.autoSaveController.stopAutosave(),this.metrikaService.sendPopupsMetrika(f.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE,f.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_SHOW)}},{key:"_closeConfirmRemovePopup",value:function(){this.visualState.currentPopup="",this.autoSaveController.startAutosave(),this.promptRemoveDraftPromise=null,this.resolveRemoveDraftPromise=null,this.rejectRemoveDraftPromise=null}},{key:"confirmRemoveDraft",value:function(){this.resolveRemoveDraftPromise(!0),this._closeConfirmRemovePopup(),this.metrikaService.sendPopupsMetrika(f.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE,f.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_ACTION)}},{key:"rejectRemoveDraft",value:function(){this.resolveRemoveDraftPromise(!1),this._closeConfirmRemovePopup(),this.metrikaService.sendPopupsMetrika(f.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE,f.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_CANCEL)}},{key:"cancelRemoveDraft",value:function(){this.rejectRemoveDraftPromise(),this._closeConfirmRemovePopup(),this.composeController.focusCompose(),this.metrikaService.sendPopupsMetrika(f.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE,f.COMPOSE_METRIKA_POPUPS_CONFIRM_REMOVE_CLOSE)}},{key:"_finishScenarioIfCurrent",value:function(e){this.composeParamsService.params.isQuickReply||i.a.getActiveScenario(a.b)===this.data.currentScenario&&i.a.finishScenario(a.b,e,this.composeController.getQualityMetrics(this.data))}},{key:"_hasChanges",value:function(){return this.attachmentsController.hasPendingAttachments||this.visualState.hasChanges}},{key:"_isEmpty",value:function(){return!this.sendData||this.checkEmptyDraftService.isEmpty(this.sendData)}},{key:"composeController",get:function(){return this.controllers.compose}},{key:"attachmentsController",get:function(){return this.controllers.attachments}},{key:"checkEmptyDraftService",get:function(){return this.services.checkEmptyDraft}},{key:"autoSaveController",get:function(){return this.controllers.autoSave}},{key:"serializationController",get:function(){return this.controllers.serialization}},{key:"metrikaService",get:function(){return this.services.metrika}},{key:"saveSendController",get:function(){return this.controllers.saveSend}},{key:"composeParamsService",get:function(){return this.services.composeParams}}]),t}()).prototype,"_showConfirmRemovePopup",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"_showConfirmRemovePopup"),r.prototype),O(r.prototype,"_closeConfirmRemovePopup",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"_closeConfirmRemovePopup"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return C});var r,o=n(136),i=(n.n(o),n(341)),a=n(791),s=n(1466),c=n(355),u=(n.n(c),n(380)),l=(n.n(u),n(381)),p=n.n(l),f=n(1083),d=n(350);function y(e){"@babel/helpers - typeof";return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e,t,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=O(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&_(e.prototype,t),n&&_(e,n),e}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var C=(P((r=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=v(this,O(t).call(this,e))).complexityLogger=new s.a,n.fpsCounter=new f.a("compose-react",f.a.defaultConfig),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,p.a),S(t,[{key:"attachmentsController",get:function(){return this.controllers.attachments}},{key:"composeParamsService",get:function(){return this.services.composeParams}},{key:"settingsService",get:function(){return this.services.settings}}]),S(t,[{key:"init",value:function(){this._initialBodyLength=Object(a.a)(this.controllers.messageBody.text),this.fpsCounter.start()}},{key:"destroy",value:function(){g(O(t.prototype),"destroy",this).call(this),this.fpsCounter.finish()}},{key:"closeCompose",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{leaveType:c.LeaveTypes.CLOSE}).leaveType;this.visualState.isLocked=!1,this.environmentAdapter.onClose({leaveType:e})}},{key:"focusCompose",value:function(){this.visualState.focusedField="compose"}},{key:"focusComposeField",value:function(e){Object(o.startsWith)(e,"addresses.")&&(e=e.substring("addresses.".length)),this.visualState.focusedField=e}},{key:"focusAttachments",value:function(){this.visualState.focusedField="attachments"}},{key:"getParamsForQualityMetrics",value:function(){return{usedSmall:this.visualState.size===u.ComposeSizes.SMALL}}},{key:"getQualityMetrics",value:function(){var e=this.attachmentsController.getSummaryForLog(this.data.attachments),t=e.relatedMailIds;!t.length&&this.data.markIds.length&&(t=this.data.markIds);var n=this.complexityLogger.getSummary(this.data);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){h(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({bodyLength:Object(a.a)(this.controllers.messageBody.text),initialBodyLength:this._initialBodyLength,hasDelayedSending:Boolean(this.data.sendTime),hasReplyNotification:this.data.notifications.reply,hasDeliveryNotification:this.data.notifications.delivery,hasLabels:this.data.userLabels.length>0},e,{},n,{relatedMailIds:t},this.getParamsForQualityMetrics())}},{key:"getComposeParamsData",value:function(){var e=this.composeParamsService;return{params:e.params,data:e.data}}},{key:"getMiniData",value:function(){var e=this.data||{addresses:{to:[],cc:[],bcc:[]}},t={subject:e.subject,addresses:e.addresses,lastSaved:e.lastSaved};return Object(i.toJS)(t,{recurseEverything:!0})}},{key:"changeSize",value:function(e,t){this.environmentAdapter.changeSize(e,t)}},{key:"checkAuthConfirmed",value:function(e){return this.environmentAdapter.checkAuthConfirmed(e)}},{key:"showAbookPopup",value:function(e){this.environmentAdapter.showAbookPopup(e)}},{key:"showPddRestrictPopup",value:function(){this.environmentAdapter.showPddRestrictPopup()}},{key:"isPddRestricted",get:function(){return Object(d.isPDD)()&&!this.settingsService.canWriteLetters}},{key:"isPddRestrictedSending",get:function(){if(this.isPddRestricted){var e=ns.Model.get("system-status").get(".allowList");return[].concat(b(this.data.addresses.to),b(this.data.addresses.cc),b(this.data.addresses.bcc)).some(function(t){var n=t.email;return!e.includes(n.toLowerCase())})}return!1}}]),t}()).prototype,"closeCompose",[i.action],Object.getOwnPropertyDescriptor(r.prototype,"closeCompose"),r.prototype),P(r.prototype,"focusCompose",[i.action],Object.getOwnPropertyDescriptor(r.prototype,"focusCompose"),r.prototype),P(r.prototype,"focusComposeField",[i.action],Object.getOwnPropertyDescriptor(r.prototype,"focusComposeField"),r.prototype),P(r.prototype,"focusAttachments",[i.action],Object.getOwnPropertyDescriptor(r.prototype,"focusAttachments"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r,o=n(341),i=n(419),a=n(381),s=n.n(a);function c(e){"@babel/helpers - typeof";return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach(function(t){p(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var v=(h((r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),y(this,b(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,s.a),function(e,t,n){t&&d(e.prototype,t),n&&d(e,n)}(t,[{key:"init",value:function(){var e=this,t=[].concat(f(this.data.addresses.to),f(this.data.addresses.cc),f(this.data.addresses.bcc));return this.contactsService.loadContacts(t).then(function(){e.initAddresses()}).catch(function(){}).then(function(){return e.subscribeToFieldsChanged()})}},{key:"initAddresses",value:function(){var e=this.data.addresses,t=e.to,n=e.cc,r=e.bcc;Object.assign(this.data.addresses,{to:this.replaceLoadedContacts(t),cc:this.replaceLoadedContacts(n),bcc:this.replaceLoadedContacts(r)})}},{key:"subscribeToFieldsChanged",value:function(){var e=this;this._disposer.add(this,[Object(o.reaction)(function(){return e.data.subject},function(){return e.environmentAdapter.onFieldChanged({fieldName:"subject"})}),Object(o.reaction)(function(){return e.controllers.messageBody.text},function(){return e.environmentAdapter.onFieldChanged({fieldName:"body"})}),Object(o.reaction)(function(){return e.data.addresses.to},function(){return e.environmentAdapter.onFieldChanged({fieldName:"to"})}),Object(o.reaction)(function(){return e.data.addresses.cc},function(){return e.environmentAdapter.onFieldChanged({fieldName:"cc"})}),Object(o.reaction)(function(){return e.data.addresses.bcc},function(){return e.environmentAdapter.onFieldChanged({fieldName:"bcc"})})])}},{key:"getEmailList",value:function(e){return e.emailList||e.isGroup()?Promise.resolve(e.emailList):this.contactsService.loadContact(e,this.mailboxUid).then(function(e){return e&&e.emailList||null},function(){return null})}},{key:"replaceLoadedContacts",value:function(e){var t=this;return e.map(function(e){return t.replaceLoadedContact(e)})}},{key:"replaceLoadedContact",value:function(e){if(e instanceof i.default&&!e.isLocal())return e;var t=this.contactsStore.findContactByEmail(e.email),n=t?t.toJSON():e;n.name!==e.name&&(n.name=e.name);var r=l({},this.data.externalEmails);return i.default.of(l({},n,{isExternal:Boolean(r[n.email])}))}},{key:"setSingleRecipient",value:function(e){var t=e.email,n=e.name;this.data.addresses.to=[this.contactsStore.findContactByEmail(t)||i.default.of({email:t,name:n})],this.data.addresses.cc=[],this.data.addresses.bcc=[]}},{key:"contactsStore",get:function(){return this.stores.contacts}},{key:"contactsService",get:function(){return this.services.contacts}}]),t}()).prototype,"initAddresses",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"initAddresses"),r.prototype),h(r.prototype,"setSingleRecipient",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"setSingleRecipient"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r,o=n(341),i=n(354),a=(n.n(i),n(450)),s=(n.n(a),n(381)),c=n.n(s),u=n(355);n.n(u);function l(e){"@babel/helpers - typeof";return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var m=(b((r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,d(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,c.a),function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(t,[{key:"doDelete",value:function(){this.services.composeParams.isDraft()?this._promptDeleteDraft():this._removeUnsaved()}},{key:"_promptDeleteDraft",value:function(){this.visualState.currentPopup=a.REMOVE_DRAFT,this.autoSaveController.stopAutosave(),this.services.metrika.sendPopupsMetrika(i.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT,i.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_SHOW)}},{key:"_removeUnsaved",value:function(){this.controllers.compose.closeCompose({leaveType:u.LeaveTypes.DELETE}),this.services.metrika.sendPopupsMetrika(i.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT,i.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_ACTION)}},{key:"_closeRemoveDraftPopup",value:function(){this.visualState.currentPopup=""}},{key:"cancelRemoveDraft",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{isClose:!1}).isClose;this._closeRemoveDraftPopup(),this.autoSaveController.startAutosave(),this.controllers.compose.focusCompose(),this.services.metrika.sendPopupsMetrika(i.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT,e?i.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_CLOSE:i.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_CANCEL)}},{key:"removeDraftAndClose",value:function(){this._closeRemoveDraftPopup(),this.deleteDraft(),this.controllers.compose.closeCompose({leaveType:u.LeaveTypes.DELETE}),this.services.metrika.sendPopupsMetrika(i.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT,i.COMPOSE_METRIKA_POPUPS_REMOVE_DRAFT_ACTION)}},{key:"deleteDraft",value:function(){var e=this.controllers.serialization.createSendData().overwrite;e&&this.environmentAdapter.onNeedRemoveDraft(e).catch(function(){})}},{key:"autoSaveController",get:function(){return this.controllers.autoSave}}]),t}()).prototype,"doDelete",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"doDelete"),r.prototype),b(r.prototype,"_closeRemoveDraftPopup",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"_closeRemoveDraftPopup"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var r=n(381),o=n.n(r),i=n(341);function a(e){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=c(this,(e=l(t)).call.apply(e,[this].concat(o)))).save=function(){n.areHotkeysEnabled&&n.controllers.saveSend.saveMessage({isForce:!0})},n.send=function(){n.areHotkeysEnabled&&n.controllers.saveSend.sendMessage()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,o.a),function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(t,[{key:"attachNode",value:function(e){var t=this;this.services.hotkeys.setHandlerNode(e),this.services.hotkeys.subscribe(),this._disposer.add(this,[this.services.hotkeys.events.save.on(this.save),this.services.hotkeys.events.send.on(this.send),Object(i.reaction)(function(){return t.visualState.currentPopup},function(e){return t.onCurrentPopupChanged(e)})])}},{key:"destroy",value:function(){u(l(t.prototype),"destroy",this).call(this),this.services.hotkeys.unsubscribe()}},{key:"suspend",value:function(){this.services.hotkeys.unsubscribe()}},{key:"resume",value:function(){this.services.hotkeys.subscribe()}},{key:"onCurrentPopupChanged",value:function(e){e?this.suspend():this.resume()}},{key:"areHotkeysEnabled",get:function(){return this.services.settings.areHotkeysEnabled}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r,o=n(341),i=n(381),a=n.n(i);function s(e){"@babel/helpers - typeof";return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function u(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var b=(y((r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,f(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,a.a),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(t,[{key:"init",value:function(){var e=this.services.labels,t=this.data,n=e.splitLabels(t.labelIds),r=n.userLabels,o=n.otherLabels;t.userLabels=r,t.otherLabels=o}},{key:"removeUserLabel",value:function(e){var t=this.data.userLabels.indexOf(e);-1!==t&&this.data.userLabels.splice(t,1)}},{key:"getUnusedLabels",value:function(){var e=this;return[this.services.labels.importantLabel].concat(u(this.services.labels.getCreatedByUserLabels())).filter(function(t){return!e.data.userLabels.find(function(e){return e.lid===t.lid})})}},{key:"addLabel",value:function(e){this.data.userLabels.push(e)}},{key:"refreshUserLabels",value:function(){this.data.userLabels=this.services.labels.refreshUserLabels(this.data.userLabels)}},{key:"manageLabels",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){c(i,r,o,a,s,"next",e)}function s(e){c(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.environmentAdapter.manageLabels();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}()).prototype,"init",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"init"),r.prototype),y(r.prototype,"removeUserLabel",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"removeUserLabel"),r.prototype),y(r.prototype,"addLabel",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"addLabel"),r.prototype),y(r.prototype,"refreshUserLabels",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"refreshUserLabels"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var r=n(381),o=n.n(r);function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,l(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,o.a),function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(t,[{key:"goToFullCompose",value:function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},this.paramsService.getParams(),{isQuickReply:!1,qrText:this.controllers.messageBody.text},e);return this.paramsService.isDraft()&&this.paramsService.data&&this.paramsService.data.overwrite&&(t.ids=[this.paramsService.data.overwrite]),this.controllers.autoSave.stopAutosave(),this.environmentAdapter.goToFullCompose(t)}},{key:"paramsService",get:function(){return this.services.composeParams}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r,o,i=n(136),a=(n.n(i),n(341)),s=n(353),c=n(381),u=n.n(c);function l(e){"@babel/helpers - typeof";return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var h=(o=m((r=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(y(n=function(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?y(e):t}(this,(e=d(t)).call.apply(e,[this].concat(i)))),"_isRecipientsDiffEnabled",o,y(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,u.a),function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(t,[{key:"setIsRecipientsDiffEnabled",value:function(e){this._isRecipientsDiffEnabled=this.isRecipientsDiffAvailable&&e}},{key:"isEmptyDiff",value:function(e){return Object(i.isEqual)(e,this._emptyDiff)}},{key:"_getContactsDict",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return[].concat(p(e),p(t)).reduce(function(e,t){return t.isValid&&!t.isValid()?e:(e[t.email]=t,e)},{})}},{key:"_getDiff",value:function(e,t){return Object.keys(e).reduce(function(n,r){return t[r]||n.push(e[r]),n},[]).sort(function(e,t){return String(e.email).localeCompare(t.email)})}},{key:"getRecipientsDiff",value:function(){if(!this.isRecipientsDiffAvailable)return this._emptyDiff;var e=this._getContactsDict(this.data.addresses.initial_to,this.data.addresses.initial_cc),t=Object.keys(e).length;if(!t)return this._emptyDiff;var n=this._getContactsDict(this.data.addresses.to,this.data.addresses.cc),r=this._getDiff(n,e),o=this._getDiff(e,n),i=this._createLoginsDict(r,o),a=0!==o.length,s=o.length===t,c=t-o.length==1;return{added:this._extractLogins(r,i),removed:this._extractLogins(o,i),removeAll:a&&(s||c)}}},{key:"_createLoginsDict",value:function(e,t){var n=this,r={};return[].concat(p(e),p(t)).forEach(function(e){var t=n._parseLoginInfo(e.email).login;r[t]=(r[t]||0)+1}),r}},{key:"_parseLoginInfo",value:function(e){return{login:"".concat(e.replace(/@.*/gi,""),"@"),email:e}}},{key:"_extractLogins",value:function(e,t){var n=this;return e.map(function(e){var r=n._parseLoginInfo(e.email),o=r.login,i=r.email;return{login:1===t[o]?o:i,contact:e}})}},{key:"_formatLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"&nbsp;";return"<div>".concat(e,"</div>")}},{key:"_formatLoginsSection",value:function(e,t){var n=e.join(", ");return this._formatLine("".concat(t).concat(n))}},{key:"_formatContactsSection",value:function(e,t){var n=e.map(function(e){return e.login});return this._formatLoginsSection(n,t)}},{key:"insertDiffIntoMessage",value:function(e,t){if(!this.isRecipientsDiffEnabled||this.isEmptyDiff(t))return e;var n=Object(s.default)("compose-react/RecipientsAll"),r="";return t.added&&t.added.length&&(r+=this._formatContactsSection(t.added,"+ ")),t.removeAll?r+=this._formatLoginsSection([n],"- "):t.removed&&t.removed.length&&(r+=this._formatContactsSection(t.removed,"- ")),r?"".concat(r).concat(this._formatLine()).concat(e):e}},{key:"paramsService",get:function(){return this.services.composeParams}},{key:"_isTemplate",get:function(){return this.paramsService.isTemplate()}},{key:"_isNewMessage",get:function(){return!this.paramsService.hasMessage}},{key:"_isForward",get:function(){return this.paramsService.isForward()}},{key:"_emptyDiff",get:function(){return{added:[],removed:[],removeAll:!1}}},{key:"isRecipientsDiffAvailable",get:function(){return Boolean(!this._isTemplate&&!this._isNewMessage&&!this._isForward)}},{key:"isRecipientsDiffEnabled",get:function(){return this._isRecipientsDiffEnabled&&this.isRecipientsDiffAvailable}}]),t}()).prototype,"_isRecipientsDiffEnabled",[a.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),m(r.prototype,"isRecipientsDiffEnabled",[a.computed],Object.getOwnPropertyDescriptor(r.prototype,"isRecipientsDiffEnabled"),r.prototype),m(r.prototype,"setIsRecipientsDiffEnabled",[a.action],Object.getOwnPropertyDescriptor(r.prototype,"setIsRecipientsDiffEnabled"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(381),o=n.n(r);function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=s(this,(e=c(t)).call.apply(e,[this].concat(o)))).onBrowserLeave=function(){n._onQuit()},n.onPageReload=function(){n._onQuit(),n.closeCompose()},n._onQuit=function(){n.pageReloadService.hasChanges=n.visualState.hasChanges},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,o.a),function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(t,[{key:"init",value:function(){this._disposer.add(this,[this.pageReloadService.subscribe(),this.pageReloadService.events.leaveBrowser.on(this.onBrowserLeave),this.pageReloadService.events.leavePage.on(this.onPageReload)])}},{key:"destroy",value:function(){this._disposer.disposeAll()}},{key:"closeCompose",value:function(){this.controllers.compose.closeCompose()}},{key:"pageReloadService",get:function(){return this.services.pageReload}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return A});var r,o,i,a=n(136),s=(n.n(a),n(341)),c=n(381),u=n.n(c),l=n(405),p=n(370),f=n(589),d=n(355),y=(n.n(d),n(709)),b=n(2647),m=(n.n(b),n(2648)),h=(n.n(m),n(498));n.n(h);function v(e){"@babel/helpers - typeof";return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),e}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function k(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var A=(o=k((r=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?E(e):t}(this,S(t).call(this,e)))._lastSavedData=null,n._messageSendBodyLength=null,n._wasUnknownErrorWithClosedCompose=!1,n._queue=new m.RequestQueue,T(E(n),"setHasChanges",o,E(n)),n._onSaveError=function(e,t){n.composeRequestService.removeMidFromFailedMessages(t.overwrite),e.code!==d.SendError.ILLEGAL_PARAMS&&e.code!==d.SendError.MAX_EMAIL_ADDRESS_REACHED||(n.autoSave.stopAutosave(),Object(b.showDraftSaveErrorMessage)({error:e.code})),e.code===d.SendError.TOO_BIG&&(n._messageSendBodyLength=t.send.length,n.autoSave.stopAutosave(),Object(b.showDraftSaveErrorMessage)({error:e.code})),e.code&&!n._wasUnknownErrorWithClosedCompose&&n.visualState.workMode===d.WorkModes.BACKGROUND&&(n._wasUnknownErrorWithClosedCompose=!0,Object(b.showDraftSaveErrorMessage)({error:e.code,needShowUnknownError:!0})),n.environmentAdapter.onSaveFailed({error:e.code})},T(E(n),"_onSentError",i,E(n)),n.subscribeToChanges(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,u.a),C(t,[{key:"composeParamsService",get:function(){return this.services.composeParams}},{key:"composeRequestService",get:function(){return this.services.composeRequest}},{key:"dateService",get:function(){return this.services.date}},{key:"settingsService",get:function(){return this.services.settings}},{key:"attachmentsController",get:function(){return this.controllers.attachments}},{key:"composeController",get:function(){return this.controllers.compose}},{key:"serializationController",get:function(){return this.controllers.serialization}},{key:"validationController",get:function(){return this.controllers.validation}},{key:"recipientsDiff",get:function(){return this.controllers.recipientsDiff}},{key:"isSaving",get:function(){return this._queue.isWorking}},{key:"isSaved",get:function(){return Boolean(this._lastSavedData&&this._lastSavedData.overwrite)}},{key:"autoSave",get:function(){return this.controllers.autoSave}}]),C(t,[{key:"subscribeToChanges",value:function(){var e=this;Object(s.reaction)(function(){return e.data&&e.serializationController.createSendData()},function(t){e.setHasChanges(t),e.autoSave.startAutosave()})}},{key:"init",value:function(){this._lastSavedData=this.serializationController.createSendData()}},{key:"saveMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.isForce,r=t.asTemplate;if(!n&&!this.visualState.hasChanges)return this._queue.pending();var o=this.serializationController.createSendData({asTemplate:r}).send;return this._messageSendBodyLength&&o.length>=this._messageSendBodyLength?this._queue.pending():this._queue.enqueueDraft(function(){var t=e.serializationController.createSendData({asTemplate:r});return e.composeParamsService.data=t,e.data.isTemplate&&!r&&e.markAsDraft(),e.composeRequestService.makeRequest({data:O({},t,{nosend:"yes"}),mailboxUid:e.mailboxUid}).then(function(n){return e._onSaveSuccess(n,t)},function(n){return e._onSaveError(n||new Error,t)})})}},{key:"markAsDraft",value:function(){this.data.isTemplate=!1}},{key:"_onSaveSuccess",value:function(e,t){var n={ignOverwrite:"no",overwriteIds:e.storedmid||t.overwrite,currentFolder:e.store_fid||this.composeParamsService.data.current_folder,attachmentsJson:e.attachment||t.attachment,lastSaved:this.dateService.passportNow};t.current_folder=n.currentFolder,t.overwrite=n.overwriteIds,t.ign_overwrite=n.ignOverwrite,this.attachmentsController.updateAfterSave(this.data.attachments,n.attachmentsJson,n.overwriteIds),Object(a.extend)(t,this.attachmentsController.createSendData(this.data.attachments)),this._lastSavedData=t,this.composeParamsService.data=t,this._messageSendBodyLength=null,this._wasUnknownErrorWithClosedCompose=!1;var r=this.composeController.getComposeParamsData();Object.assign(this.data,n);var o=this.composeController.getMiniData();this.setHasChanges(this.serializationController.createSendData()),this.environmentAdapter.onSaveSuccess({dataUpdate:n,composeParamsData:r,responseData:e,miniData:o})}},{key:"logSendWasTriggered",value:function(){this.composeParamsService.getParams().isQuickReply||l.a.getActiveScenario(p.b).logStep(f.f,this.composeController.getParamsForQualityMetrics())}},{key:"sendTranslation",value:function(e){var t=this;this.logSendWasTriggered(),this.controllers.translate.doAfterTranslate(Object(s.action)(function(n){t.controllers.messageBody.replaceText(n),t._sendMessage(),e(n)}),Object(s.action)(function(e){t.services.errors.log({method:"sendTranslation"},e),t.logSendingHaveFailed("translate_error")}))}},{key:"sendMessage",value:function(e){return this.logSendWasTriggered(),this._sendMessage(e)}},{key:"_sendMessage",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).withoutUndoAndDelay;return this.composeController.isPddRestrictedSending?(this.logSendingHaveFailed("pdd_restricted_sending"),this.composeController.showPddRestrictPopup()):this._validateData()?(this.startSending(),this._queue.enqueueSend(Object(s.action)(function(){var n=e.serializationController.createSendData({withoutUndoAndDelay:t});e.composeParamsService.data=n;var r=e.recipientsDiff.getRecipientsDiff();return n.send=e.recipientsDiff.insertDiffIntoMessage(n.send,r),e.composeRequestService.makeRequest({data:n,send:!0,mailboxUid:e.mailboxUid}).then(Object(s.action)(function(n){return e._onSentSuccess(n,{withoutUndoAndDelay:t})}),Object(s.action)(function(t){return e._onSentError(t,n)})).then(Object(s.action)(function(){return e.finishSending()}))}))):void 0}},{key:"logSendingHaveFailed",value:function(e){l.a.getActiveScenario(p.b).logStep(f.g,O({error:e},this.composeController.getParamsForQualityMetrics()))}},{key:"_validateData",value:function(){if(!this.validationController.validateData()){var e=this.validation.getAddressError();return!this.composeParamsService.getParams().isQuickReply&&(this.logSendingHaveFailed(e),!1)}return!(!this.data.allowEmptySubject&&!this.data.subject&&this.settingsService.hasEmptySubjectPopup)||(this.validation.sendError={error:d.SendError.EMPTY_SUBJECT},this.environmentAdapter.onSendFailed(this.validation.sendError),!1)}},{key:"startSending",value:function(){this.visualState.isLocked=!0,this.visualState.isSending=!0,this.environmentAdapter.onSending(),this.environmentAdapter.apdexStart(["Performance_sendMessage"],!0)}},{key:"finishSending",value:function(){this.visualState.isSending=!1}},{key:"retryToSendMessageWithoutUndoAndDelayed",value:function(){return this.sendMessage({withoutUndoAndDelay:!0})}},{key:"_onSentSuccess",value:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).withoutUndoAndDelay;this.composeParamsService.getParams().isQuickReply||l.a.finishScenario(p.b,y.h,this.composeController.getQualityMetrics());var r=this._checkLimitedRecipients(e.limited),o=this.composeController.getComposeParamsData(),i=this.composeController.getMiniData();this.environmentAdapter.onSendSuccess({responseData:e,composeParamsData:o,miniData:i,withUndo:n?null:this._withUndo(),sendTime:n?null:this.data.sendTime,preventLeave:r})}},{key:"_withUndo",value:function(){return Daria.SendMail.shouldShowUndoSend()&&!this.data.sendTime}},{key:"_checkLimitedRecipients",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).recipient;return!(!Array.isArray(e)||!e.length)&&(this.validation.limitedRecipients=e.map(Object(s.action)(function(e){var t=e.login,n=e.domain;return"".concat(t,"@").concat(n)})),!0)}}]),t}()).prototype,"setHasChanges",[s.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.visualState.hasChanges=e.serializationController.compareSendData(e._lastSavedData,t)}}}),k(r.prototype,"markAsDraft",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"markAsDraft"),r.prototype),k(r.prototype,"_onSaveSuccess",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"_onSaveSuccess"),r.prototype),k(r.prototype,"sendTranslation",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"sendTranslation"),r.prototype),k(r.prototype,"_sendMessage",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"_sendMessage"),r.prototype),k(r.prototype,"startSending",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"startSending"),r.prototype),k(r.prototype,"finishSending",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"finishSending"),r.prototype),k(r.prototype,"_checkLimitedRecipients",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"_checkLimitedRecipients"),r.prototype),i=k(r.prototype,"_onSentError",[s.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){if(e.composeParamsService.getParams().isQuickReply||l.a.getActiveScenario(p.b).logStep(f.g,O({error:t.code},e.composeController.getParamsForQualityMetrics())),h.UNDO_ERRORS.includes(t.code)){var r=t.data.storedmid;e._onSaveSuccess({storedmid:r},n)}e.composeRequestService.removeMidFromFailedMessages(n.overwrite);var o=t.data||{};e.validation.sendError={error:t.code,captchaKey:o.captcha_key,captchaUrl:o.captcha_url,banReason:o.banReason,recipients:o.recipients},e.environmentAdapter.onSendFailed(e.validation.sendError)}}}),r)},function(e,t,n){"use strict";var r,o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.showDraftSaveErrorMessage=void 0;var i=n(358),a=n(359),s=o(n(353)),c=n(355),u=((r={})[c.SendError.MAX_EMAIL_ADDRESS_REACHED]="compose-react/ErrorCode_Draft_MaxEmailAddressReached",r[c.SendError.TOO_BIG]="compose-react/ErrorCode_Draft_MaxSendSize",r);t.showDraftSaveErrorMessage=function(e){var t=e.error,n=e.needShowUnknownError,r=u[t];r?i.showErrorMessage(a.StatuslineName.DraftSaveError,s.default(r)):n&&i.showErrorMessage(a.StatuslineName.DraftSaveError,s.default("compose-react/ErrorCode_Draft_UnknownError"))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestQueue=void 0;var r=function(){function e(){this._queue=Promise.resolve(),this._closed=!1,this._queuedCount=0}return Object.defineProperty(e.prototype,"isWorking",{get:function(){return this._queuedCount>0},enumerable:!1,configurable:!0}),e.prototype.enqueueDraft=function(e){return this._queuedCount>1?this._queue:this._enqueue(e)},e.prototype.enqueueSend=function(e){var t=this,n=this._enqueue(e).then(function(e){return t._closed=!1,e});return this._closed=!0,n},e.prototype.pending=function(){return this._queue},e.prototype._enqueue=function(e){var t=this;return this._closed?this._queue:(this._queuedCount++,this._queue=this._queue.then(e).then(function(e){return t._queuedCount--,e}),this._queue)},e}();t.RequestQueue=r},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r,o=n(341),i=n(419),a=n(355),s=(n.n(a),n(381)),c=n.n(s);function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=(function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((r=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=f(this,(e=d(t)).call.apply(e,[this].concat(o))))._onChangedFromName=function(e){var t=e.previousValue,r=n.data.addresses.from.name===t&&!n.services.composeParams.isDraft();n.updateFromNameAndAddresses(r)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,c.a),function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(t,[{key:"init",value:function(){this._disposer.add(this,[this.services.settings.registerChangeSettingsHandler(this._onChangedFromName,a.Settings.FROM_NAME)])}},{key:"setFrom",value:function(e){var t=e.email,n=e.name;this.availableAddresses.length&&this.availableAddresses[0].name===n||(this.availableAddresses=this.availableAddresses.map(function(e){return{email:e.email,name:n}}));var r=t.toLowerCase(),o=this.availableAddresses.filter(function(e){return e.email.toLowerCase()===r});this.data.addresses.from=o.length?o[0]:{email:t,name:n}}},{key:"processSelfRecipient",value:function(e){var t=e.contacts,n=void 0===t?[]:t,r=e.suggestType;if(!this.data.addresses.from)return n;var o=this._markSelfInSuggestContacts(n);return r===a.SuggestTypes.POPULAR?(o||this._hasSelfAddress()||(o=this._generateSelfContact()),o?[o].concat(l(n.filter(function(e){return e.email!==o.email}))):n):n}},{key:"_markSelfInSuggestContacts",value:function(e){var t,n=this.data.addresses.from.email;return e.forEach(function(e){e.isSelf=e.email===n,e.isSelf&&(t=e)}),t}},{key:"_hasSelfAddress",value:function(){var e=this;return this.controllers.contactsSuggest.excludedAddresses.some(function(t){return t===e.data.addresses.from.email})}},{key:"_generateSelfContact",value:function(){var e=this.data.addresses.from,t=this.stores.contacts.findContactByEmail(e.email);return t||(t=i.default.of(e),this.services.contacts.loadContact(t,this.mailboxUid).then(function(e){t.name=e.name,t.emailList=e.emailList}),this.stores.contacts.writeContact(t)),t.isSelf=!0,t}},{key:"updateFromNameAndAddresses",value:function(e){var t=this.services.composeParams.getFromName();e&&(this.data.addresses.from.name=t),this.availableAddresses=this.services.composeParams.getAvailableFromEmails().map(Object(o.action)(function(e){return{email:e,name:t}}))}},{key:"availableAddresses",get:function(){return this.stores.addressesFrom.addresses||[]},set:function(e){this.stores.addressesFrom.addresses=e}}]),t}()).prototype,"updateFromNameAndAddresses",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"updateFromNameAndAddresses"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r=n(136),o=(n.n(r),n(343)),i=n.n(o),a=n(381),s=n.n(a),c=n(419),u=n(137);n.n(u);function l(e){"@babel/helpers - typeof";return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=b(this,(e=m(t)).call.apply(e,[this].concat(o))))._formatContact=function(e){return n.services.contactsFormatter.contactToString(e)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,s.a),function(e,t,n){t&&y(e.prototype,t),n&&y(e,n)}(t,[{key:"createSendData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.asTemplate,n=e.withoutUndoAndDelay,r=this._formatMessageBody(this.controllers.messageBody.text);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){d(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({from_mailbox:this.data.addresses.from.email,from_name:this.data.addresses.from.name,to:this._mapAddresses(this.data.addresses.to),cc:this._mapAddresses(this.data.addresses.cc),bcc:this._mapAddresses(this.data.addresses.bcc),subj:this.data.subject,send:r,ttype:this.data.messageFormat,inreplyto:this.data.inReplyTo,current_folder:this.data.currentFolder,overwrite:this.data.overwriteIds,ign_overwrite:this.data.ignOverwrite,references:this.data.references,mark_ids:this.data.markIds,mark_as:this.data.markAs,message_id:this.data.messageId,current_time:this.dateService.now,send_time:this._getSendTime(n),notify_on_send:this.data.notifications.delivery?"yes":"no",captcha_key:this.data.captcha.key,captcha_entered:this.data.captcha.value,captcha_token:this.data.checkboxCaptcha.token},this._serializeLabelsAndNotifications(),{},this._serializeAttachments(),{},this._serializeUndoData(n),{},this._serializeTemplateData(t))}},{key:"_mapAddresses",value:function(e){return Object(r.uniq)(c.default.flattenContacts(e,this._formatContact)).join(", ")}},{key:"_formatMessageBody",value:function(e){return this.settingsService.isMobile?e.replace(/<br\/>/gi,"<br>"):this.composeParamsService.getParams().isQuickReply?e+this.composeParamsService.getReplyBody():e}},{key:"_getSendTime",value:function(e){if(this.data.sendTime&&!e)return this.dateService.convertPassportDateToTimestamp(this.data.sendTime)}},{key:"_serializeLabelsAndNotifications",value:function(){var e=[].concat(p(this.data.userLabels.map(function(e){return e.lid})),p(this.data.otherLabels.map(function(e){return e.lid})));if(this.data.notifications.reply){var t=this.labelsService.waitingForReplyLabel.lid,n=i()(this.data.notifications.replyTime).diff(this.dateService.passportNow,"seconds");return{lids:[].concat(p(e),[t]),remind_period:n}}return{lids:e}}},{key:"_serializeAttachments",value:function(){return this.attachmentsController.createSendData(this.attachmentsController.validAttachments)}},{key:"_serializeUndoData",value:function(e){return Daria.SendMail.shouldShowUndoSend()&&!this.data.sendTime&&!e?{send_time:Daria.SendMail.getUndoSendTime(),relative:!0}:{}}},{key:"_serializeTemplateData",value:function(e){return e?{save_symbol:u.WellKnownFolderSymbol.TEMPLATE,templates_fid:this.data.templatesFolderId}:{}}},{key:"compareSendData",value:function(e,t){return!(this.composeParamsService.isDraft()||this.composeParamsService.isTemplate())&&!this.composeParamsService.isPredefinedDataEmpty()||e&&!this._isRelevantDataEqual(e,t)}},{key:"_isRelevantDataEqual",value:function(e,t){var n=["ids","mark_ids","save_symbol","templates_fid","current_time"],o=r.omit.apply(void 0,[e].concat(n)),i=r.omit.apply(void 0,[t].concat(n));return Object(r.isEqual)(o,i)}},{key:"isEmpty",value:function(){var e=this.createSendData();return this.services.checkEmptyDraft.isEmpty(e)}},{key:"settingsService",get:function(){return this.services.settings}},{key:"dateService",get:function(){return this.services.date}},{key:"labelsService",get:function(){return this.services.labels}},{key:"composeParamsService",get:function(){return this.services.composeParams}},{key:"attachmentsController",get:function(){return this.controllers.attachments}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r,o,i=n(341);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var c=(o=s((r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(this,"settings",o,this),this.service=t}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(e,[{key:"toggleAutocomplete",value:function(){this.service.toggleAutocomplete()}},{key:"destroy",value:function(){}},{key:"areHotkeysEnabled",get:function(){return this.service.areHotkeysEnabled}},{key:"isAutocompleteEnabled",get:function(){return this.service.isComposeAutocompleteEnabled}}]),e}()).prototype,"settings",[i.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s(r.prototype,"areHotkeysEnabled",[i.computed],Object.getOwnPropertyDescriptor(r.prototype,"areHotkeysEnabled"),r.prototype),s(r.prototype,"isAutocompleteEnabled",[i.computed],Object.getOwnPropertyDescriptor(r.prototype,"isAutocompleteEnabled"),r.prototype),r)},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):function(e){return e instanceof n?e:new n(function(t){t(e)})}(e.value).then(a,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},c=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var l=n(341),p=n(136),f=n(355),d=function(e){function t(t){var n=e.call(this,t)||this;return n.rawSignatures=[],n.onSignsChanged=function(){n.services.signatures.reset(),n.loadRawSignatures()},n.services.signatures.subscribeSignaturesChanged(n.onSignsChanged),n.loadRawSignatures({mailboxUid:n.mailboxUid}),n}return r(t,e),Object.defineProperty(t.prototype,"signatures",{get:function(){var e=this.data.addresses.from.email,t=this.services,n=t.settings.lang,r=t.signatures.getSortFunction;return c(this.rawSignatures).sort(r(e,n))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"matches",{get:function(){return p.uniq(this.rawSignatures.map(function(e){return{match:e.match,leadingLineBreaks:e.leadingLineBreaks}}))},enumerable:!1,configurable:!0}),t.prototype.loadRawSignatures=function(e){var t=(void 0===e?{}:e).mailboxUid;this.rawSignatures=this.services.signatures.getRawSignatures({mailboxUid:t})},t.prototype.openSettings=function(){return i(this,void 0,Promise,function(){return a(this,function(e){switch(e.label){case 0:return this.controllers.compose.closeCompose({leaveType:f.LeaveTypes.COLLAPSE}),[4,this.environmentAdapter.openSignaturesSettings()];case 1:return e.sent(),[2]}})})},t.prototype.setSignature=function(e){this.data.signature=e},o([l.observable],t.prototype,"rawSignatures",void 0),o([l.computed],t.prototype,"signatures",null),o([l.computed],t.prototype,"matches",null),o([l.action],t.prototype,"loadRawSignatures",null),o([l.action],t.prototype,"setSignature",null),o([l.action],t.prototype,"onSignsChanged",void 0),t}(u(n(381)).default);t.default=d},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var r,o=n(341),i=n(355),a=(n.n(i),n(405)),s=n(370),c=n(589),u=n(381),l=n.n(u);function p(e){"@babel/helpers - typeof";return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function b(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){y(i,r,o,a,s,"next",e)}function s(e){y(i,r,o,a,s,"throw",e)}a(void 0)})}}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O=(function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,v(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,l.a),function(e,t,n){t&&m(e.prototype,t),n&&m(e,n)}(t,[{key:"getSmartSubjectsForInput",value:function(){var e=b(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getSmartSubjects(i.SmartSubjectType.INPUT);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getSmartSubjectForPopup",value:function(){var e=b(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getSmartSubjects(i.SmartSubjectType.POPUP);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_getSmartSubjects",value:function(){var e=b(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.services.settings.hasEmptySubjectPopup){e.next=3;break}return this._updateResults([],"",""),e.abrupt("return");case 3:return e.prev=3,e.next=6,this.services.smartSubject.getSmartSubjects({position:t,messageId:this.data.messageId,threadId:this.services.composeParams.relatedThreadId,text:this.controllers.messageBody.text,addresses:Object(o.toJS)(this.data.addresses),attaches:Object(o.toJS)(this.data.attachments)});case 6:n=e.sent,r=n.items,i=n.requestId,this._updateResults(r,t,i),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),this._updateResults([],"","");case 15:case"end":return e.stop()}},e,this,[[3,12]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_updateResults",value:function(e,t,n){if(this.subjectsSuggest.suggestItems=e,this.subjectsSuggest.suggestType=t,this.subjectsSuggest.requestId=n,n){var r=a.a.getActiveScenario(s.b);r&&r.logStep(c.i,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){d(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({reqid:n,position:t,answersCount:e.length,showedAnswersCount:this._getShownItemsCount(e,t)},this.controllers.compose.getParamsForQualityMetrics()))}}},{key:"logSuggestSelect",value:function(e){var t=a.a.getActiveScenario(s.b),n=this.subjectsSuggest,r=n.requestId,o=n.suggestItems,i=n.suggestType;t&&t.logStep(c.h,{reqid:r,position:i,answersCount:o.length,showedAnswersCount:this._getShownItemsCount(o,i),answerLen:(e&&e.text||"").length,clickPosition:_.indexOf(o,e)}),this.complexityLogger.addSmartSubjectUsage(e,o)}},{key:"_getShownItemsCount",value:function(e,t){return t===i.SmartSubjectType.POPUP?Math.min(e.length,i.Limits.MAX_SUGGEST_ITEMS_FOR_POPUP):e.length}},{key:"complexityLogger",get:function(){return this.controllers.compose.complexityLogger}},{key:"subjectsSuggest",get:function(){return this.visualState.subjectsSuggest}}]),t}()).prototype,"_updateResults",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"_updateResults"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r,o=n(341),i=n(350),a=n(419),s=n(355),c=(n.n(s),n(381)),u=n.n(c);function l(e){"@babel/helpers - typeof";return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function f(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var v=(h((r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),y(this,b(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,u.a),function(e,t,n){t&&d(e.prototype,t),n&&d(e,n)}(t,[{key:"searchContacts",value:function(e,t){this._search(s.SuggestTypes.QUERY,e,t)}},{key:"searchPopular",value:function(e){this._search(s.SuggestTypes.POPULAR,null,e)}},{key:"isSuggestOpened",value:function(e){return this.suggest.field===e}},{key:"getExternalEmails",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){f(i,r,o,a,s,"next",e)}function s(e){f(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){var t,n,r,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:[],!Object(i.isB2BUser)()||Object(i.isCorp)()){e.next=13;break}return n=t.map(function(e){return e.email}).filter(function(e){return e.includes("@")}),e.next=5,this.environmentAdapter.loadExternalEmails(n);case 5:return e.next=7,this.environmentAdapter.getExternalEmails();case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0={};case 10:return r=e.t0,this.data.updateExternalEmails(r),e.abrupt("return",{contacts:t,externalEmails:r});case 13:return e.abrupt("return",{contacts:t,externalEmails:{}});case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_search",value:function(e,t,n){var r=this;this.showSuggest({field:n,query:t});var o=this.excludedAddresses,i=Promise.resolve([]);e===s.SuggestTypes.POPULAR?i=this.suggestService.getPopularContactsSuggest(o,{mailboxUid:this.mailboxUid}):e===s.SuggestTypes.QUERY&&t?i=this.suggestService.getQuerySuggest(t,o,{useAbook:!0,mailboxUid:this.mailboxUid}):e=null;var a=window.performance.now();i.then(function(t){return r._updateContacts(t,e,n),r.getExternalEmails(t)}).then(function(t){var o=t.contacts,i=t.externalEmails;if(o.forEach(function(e){e.setIsExternalFlag(Boolean(i[e.email]))}),r._updateContacts(o,e,n),o.length){var s=window.performance.now();r.environmentAdapter.apdexSendDelta("Performance_suggestRecepient",a,s)}})}},{key:"showSuggest",value:function(e){var t=e.field,n=e.query;this.suggest.field=t,this.suggest.query=n,this.logSuggestService.markSuggestShown(t)}},{key:"closeSuggest",value:function(e){this._updateContacts([],null,e),this.suggest.field===e&&(this.suggest.field="")}},{key:"_updateContacts",value:function(e,t,n){if(this.suggest.field===n){var r=this.selfRecipientController.processSelfRecipient({contacts:e,suggestType:t});this.suggest.contacts=r,this.suggest.type=t}}},{key:"getSuggestContacts",value:function(e){return e===this.suggest.field?this.suggest.contacts:o.observable.array([])}},{key:"suggestService",get:function(){return this.services.suggest}},{key:"selfRecipientController",get:function(){return this.controllers.selfRecipient}},{key:"logSuggestService",get:function(){return this.services.logSuggest}},{key:"suggest",get:function(){return this.visualState.contactsSuggest}},{key:"excludedAddresses",get:function(){return[].concat(p(a.default.flattenContacts(this.data.addresses.to)),p(a.default.flattenContacts(this.data.addresses.cc)),p(a.default.flattenContacts(this.data.addresses.bcc)))}}]),t}()).prototype,"showSuggest",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"showSuggest"),r.prototype),h(r.prototype,"closeSuggest",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"closeSuggest"),r.prototype),h(r.prototype,"_updateContacts",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"_updateContacts"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var r,o=n(136),i=(n.n(o),n(341)),a=n(791),s=n(353),c=n(381),u=n.n(c),l=n(359);n.n(l);function p(e){"@babel/helpers - typeof";return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function d(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){f(i,r,o,a,s,"next",e)}function s(e){f(i,r,o,a,s,"throw",e)}a(void 0)})}}function y(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var O="<div><br/></div>",_=(g((r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,h(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,u.a),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"openTemplate",value:function(e){var t=this,n=this.controllers.serialization.isEmpty();this.services.composeParams.isNewMessage()&&n?this.environmentAdapter.openTemplate({params:{ids:e.mid}}):this.services.templates.loadTemplateData(e.mid,this.services.composeParams.getMessageType()).then(function(e){return t.applyTemplateData(e)})}},{key:"applyTemplateData",value:function(e){var t=this,n=this.services.checkEmptyDraft.isSubjectEmpty(this.data.subject),r=this.services.checkEmptyDraft.isSubjectEmpty(e.subject);n&&!r&&(this.data.subject=e.subject),["to","cc","bcc"].forEach(Object(i.action)(function(n){t.data.addresses[n]=t.mergeContacts(t.data.addresses[n],e.addresses[n])})),e.messageBody&&this.controllers.messageBody.replaceText(this.makeMessageBody(e.messageBody,this.controllers.messageBody.text)),this.data.attachments=[].concat(y(this.data.attachments),y(e.attachments))}},{key:"makeMessageBody",value:function(e,t){var n=Object(a.b)({messageBody:t,signatureMatches:this.controllers.signatures.matches}),r=n.quotes,o=n.forward;if(!r&&!o)return e;var i=Object(a.c)({messageBody:e,signatureMatches:this.controllers.signatures.matches}),s=i.beforeSignature,c=i.signature,u=i.afterSignature;return this.concatBodyParts({quotes:r,forward:o,beforeSignature:s,signature:c,afterSignature:u})}},{key:"concatBodyParts",value:function(e){var t=e.forward,n=e.quotes,r=e.beforeSignature,o=e.signature,i=e.afterSignature,a=r;return this.services.settings.isTopSignature&&(a+=o),t&&(a=this.smartPadText(a),a+=t),n&&(a=this.smartPadText(a),a+=n),o&&!this.services.settings.isTopSignature&&((t||n)&&(a=this.smartPadText(a)),a+=o),a+=i}},{key:"smartPadText",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=e;t&&(Object(o.endsWith)(n,O)||Object(o.endsWith)(n,"<div>&nbsp;</div>"));){var r=Object(o.endsWith)(n,O)?O.length:"<div>&nbsp;</div>".length;n=n.substring(0,n.length-r),t-=1}for(;t>0;)e+=O,t-=1;return e}},{key:"mergeContacts",value:function(e,t){var n=[].concat(y(e),y(t));return Object(o.uniq)(n,function(e){return e.email})}},{key:"createTemplate",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveTemplate();case 2:if(!e.sent){e.next=4;break}this.environmentAdapter.onShowNotification({name:l.StatuslineName.TemplateCreated});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateTemplate",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveTemplate();case 2:if(!e.sent){e.next=6;break}(t=this.data.subject||Object(s.default)("compose-react/Без_темы")||"").length>15&&(t="".concat(t.substring(0,12),"...")),this.environmentAdapter.onShowNotification({name:l.StatuslineName.TemplateUpdated,params:{text:t}});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"saveTemplate",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.prepareTemplate();case 2:if(!e.sent){e.next=6;break}return e.next=5,this.controllers.saveSend.saveMessage({asTemplate:!0,isForce:!0});case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"prepareTemplate",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t,n,r,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},n=t.asNew,e.prev=1,e.next=4,this.services.templates.ensureTemplatesFolder();case 4:return r=e.sent,this.markAsTemplate(r,n),this.controllers.autoSave.stopAutosave(),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(1),this.services.errors.log({method:"prepareTemplate"},e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}},e,this,[[1,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"markAsTemplate",value:function(e,t){this.data.isTemplate=!0,this.data.templatesFolderId=e,t&&(this.data.overwriteIds=null)}},{key:"saveAsNewTemplate",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.prepareTemplate({asNew:!0});case 2:if(!e.sent){e.next=6;break}return e.next=5,this.controllers.saveSend.saveMessage({asTemplate:!0,isForce:!0});case 5:this.environmentAdapter.onShowNotification({name:l.StatuslineName.TemplateCreated});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"manageTemplates",value:function(){var e=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.environmentAdapter.openTemplatesManager();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),t}()).prototype,"applyTemplateData",[i.action],Object.getOwnPropertyDescriptor(r.prototype,"applyTemplateData"),r.prototype),g(r.prototype,"markAsTemplate",[i.action],Object.getOwnPropertyDescriptor(r.prototype,"markAsTemplate"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r,o,i=n(341),a=n(381),s=n.n(a),c=n(354);n.n(c);function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var m=(b((r=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(d(n=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?d(e):t}(this,(e=f(t)).call.apply(e,[this].concat(i)))),"doAfterTranslate",o,d(n)),n.toggleTranslator=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){l(i,r,o,a,s,"next",e)}function s(e){l(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=!n.isTranslatorEnabled)){e.next=6;break}return n.controllers.messageBody.dumpText({withRaw:!0}),e.next=5,n.services.translate.init();case 5:n.setDefaultLanguages();case 6:n.isTranslatorEnabled=t,n.services.metrika.sendFooterMetrika(c.COMPOSE_METRIKA_TRANSLATION_TRANSLATE_BUTTON);case 8:case"end":return e.stop()}},e)})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,s.a),function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(t,[{key:"setDefaultLanguages",value:function(){var e=this.visualState.translate;e.translateFrom||(e.translateFrom=this.services.translate.getDefaultLanguageFrom(this.controllers.messageBody.text)),e.translateTo||(e.translateTo=this.services.translate.getDefaultLanguageTo(e.translateFrom))}},{key:"isTranslatorEnabled",get:function(){return this.visualState.translate.isEnabled},set:function(e){this.visualState.translate.isEnabled=e}}]),t}()).prototype,"isTranslatorEnabled",[i.computed],Object.getOwnPropertyDescriptor(r.prototype,"isTranslatorEnabled"),r.prototype),o=b(r.prototype,"doAfterTranslate",[i.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){var r=e.services.translate,o=e.visualState;if(r.currentTranslationPromise)return o.isLocked=!0,void r.currentTranslationPromise.then(Object(i.action)(function(){return e.doAfterTranslate(t)}),n);try{o.isLocked=!1;var a=o.translate.translation,s=o.translate.postTranslation?o.translate.postTranslation(a):a;t(s)}catch(e){n(e)}}}}),b(r.prototype,"setDefaultLanguages",[i.action],Object.getOwnPropertyDescriptor(r.prototype,"setDefaultLanguages"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r,o=n(136),i=(n.n(o),n(341)),a=n(357),s=n(381),c=n.n(s);function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=(function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,d(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,c.a),function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(t,[{key:"validateData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._getValidationErrors(e);return this.validation.errors=t,!t.length}},{key:"_getValidationErrors",value:function(e){var t=this._validateAddresses("addresses",[{fieldName:"to",addresses:this.data.addresses.to},{fieldName:"cc",addresses:this.data.addresses.cc},{fieldName:"bcc",addresses:this.data.addresses.bcc}]);return[].concat(l(this._validateRequiredAddresses("addresses",["to"],[].concat(l(this.data.addresses.to),l(this.data.addresses.cc),l(this.data.addresses.bcc)))),l(e?t:[]),l(this._validateAttachments("attachments",this.data.attachments)))}},{key:"_validateRequiredAddresses",value:function(e,t,n){return n&&n.length?[]:[{fieldName:e,additionalFieldNames:t,errorKey:"compose-react/Validation_errors_RecipientRequired"}]}},{key:"_trimEmail",value:function(e){return e.length>23?"".concat(e.slice(0,22),"…"):e}},{key:"_validateAddresses",value:function(e,t){var n=new Set,r=[],o=0,i=!0,a=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(i=(c=u.next()).done);i=!0){var p=c.value,f=p.fieldName,d=p.addresses,y=!0,b=!1,m=void 0;try{for(var h,v=d[Symbol.iterator]();!(y=(h=v.next()).done);y=!0){var g=h.value;o++;var O=this.contactsStore.findContactByEmail(g.email);O&&O.isValid()||(this.logService.logValidationFail(g.email,O),r.push(g.email),n.add(f))}}catch(e){b=!0,m=e}finally{try{y||null==v.return||v.return()}finally{if(b)throw m}}}}catch(e){a=!0,s=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}var _=[];if(r.length>0){var S=1===o?"compose-react/Validation_errors_InvalidOnlyOneEmail_Detailed":"compose-react/Validation_errors_InvalidEmails_Detailed",E=(r.length>3?[].concat(l(r.slice(0,3)),[".."]):r).map(this._trimEmail),P={fieldName:e,additionalFieldNames:l(n),errorTitleKey:"compose-react/Validation_errors_InvalidEmails_Title",errorTitleKeyParams:{isOne:1===r.length},errorKey:S,errorKeyParams:{count:r.length,emails:E.join(", "),email:E[0]}};_.push(P)}return _}},{key:"_validateAttachments",value:function(e,t){return t.filter(function(e){return e.status!==a.c.COMPLETED}).length?[{fieldName:e,errorTitleKey:"compose-react/Validation_errors_AttachmentsLoading_Title",errorKey:"compose-react/Validation_errors_AttachmentsLoading"}]:[]}},{key:"processValidationErrors",value:function(e,t){var n=this;e.forEach(function(e){var r=e.fieldName,i=e.additionalFieldNames;"addresses"===r&&i.forEach(function(e){["to","cc","bcc"].includes(e)&&(t.addresses[e]=Object(o.sortBy)(t.addresses[e],function(e){var t=n.contactsStore.findContactByEmail(e.email);return t&&t.isValid()}))})})}},{key:"contactsStore",get:function(){return this.stores.contacts}},{key:"logService",get:function(){return this.services.logContactValidation}}]),t}()).prototype,"validateData",[i.action],Object.getOwnPropertyDescriptor(r.prototype,"validateData"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r,o=n(381),i=n.n(o),a=n(341),s=n(380),c=(n.n(s),n(458));function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var b=(y((r=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,f(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,i.a),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(t,[{key:"onClosePromo",value:function(){this.visualState.currentPromo=null,this.environmentAdapter.onClosePromo()}},{key:"onShowPromo",value:function(){this.environmentAdapter.onShowPromo()}},{key:"collapseAllComposes",value:function(){this.environmentAdapter.collapseAllComposes()}},{key:"closeCurrentPopup",value:function(){this.visualState.currentPopup="",this.visualState.isLocked=!1,this.validation.sendError=null}},{key:"openPopup",value:function(e){this.visualState.currentPopup=e}},{key:"isSmall",get:function(){return this.visualState.size===s.ComposeSizes.SMALL}},{key:"moreButtonOptions",get:function(){var e=[];return e.push(c.a.LABELS),e.push(c.a.SIGNATURES),e.push(c.a.SEPARATOR),this.isSmall&&e.push(c.a.TRANSLATOR),e.push(c.a.AUTOCOMPLETE),e.push(c.a.SMART_SUBJECT),e}}]),t}()).prototype,"isSmall",[a.computed],Object.getOwnPropertyDescriptor(r.prototype,"isSmall"),r.prototype),y(r.prototype,"moreButtonOptions",[a.computed],Object.getOwnPropertyDescriptor(r.prototype,"moreButtonOptions"),r.prototype),y(r.prototype,"onClosePromo",[a.action],Object.getOwnPropertyDescriptor(r.prototype,"onClosePromo"),r.prototype),y(r.prototype,"closeCurrentPopup",[a.action],Object.getOwnPropertyDescriptor(r.prototype,"closeCurrentPopup"),r.prototype),y(r.prototype,"openPopup",[a.action],Object.getOwnPropertyDescriptor(r.prototype,"openPopup"),r.prototype),r)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"ATTACHMENTS",function(){return r}),n.d(t,"ATTACHMENTS_DISK",function(){return o}),n.d(t,"ATTACHMENTS_MAIL",function(){return i}),n.d(t,"AUTOCOMPLETE",function(){return a}),n.d(t,"DELAYED_SENDING",function(){return s}),n.d(t,"DELETE_DRAFT",function(){return c}),n.d(t,"LABELS",function(){return u}),n.d(t,"NOTIFICATIONS",function(){return l}),n.d(t,"SMART_SUBJECT",function(){return p}),n.d(t,"TEMPLATES",function(){return f}),n.d(t,"TRANSLATOR",function(){return d}),n.d(t,"SEPARATOR",function(){return y}),n.d(t,"SIGNATURES",function(){return b});var r="Attachments",o="Attachments Disk",i="Attachments Mail",a="Autocomplete",s="DelayedSending",c="DeleteDraft",u="Labels",l="Notifications",p="Smart Subject",f="Templates",d="Translator",y="Separator",b="Signatures"},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MessageBodyController=void 0;var a=n(341),s=function(e){function t(t){var n=e.call(this,t)||this;return n._text="",n._rawText="",n._text=t.data.initialMessageBody,n}return r(t,e),t.prototype.connect=function(e){this.textGetters=e},t.prototype.dumpText=function(e){var t=e.withRaw;this.textGetters&&(this._text=this.textGetters.text(),t&&(this._rawText=this.textGetters.raw()))},t.prototype.replaceText=function(e){var t;this._text=e,null===(t=this.textGetters)||void 0===t||t.onReplace(e)},Object.defineProperty(t.prototype,"text",{get:function(){return this._text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rawText",{get:function(){return this._rawText},enumerable:!1,configurable:!0}),o([a.observable],t.prototype,"_text",void 0),o([a.observable],t.prototype,"_rawText",void 0),o([a.action],t.prototype,"dumpText",null),o([a.action],t.prototype,"replaceText",null),o([a.computed],t.prototype,"text",null),o([a.computed],t.prototype,"rawText",null),t}(i(n(381)).default);t.MessageBodyController=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(341),s=i(n(381)),c=n(792),u=4*c.SECOND,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isVisible=!1,t.hide=function(){t.isVisible=!1},t}return r(t,e),Object.defineProperty(t.prototype,"settingsService",{get:function(){return this.services.settings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dateService",{get:function(){return this.services.date},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metrikaService",{get:function(){return this.services.metrika},enumerable:!1,configurable:!0}),t.prototype.showAutosaveNotification=function(e){var t=this.dateService.now.getTime();this.settingsService.muteAutosavePromoUntil>t||this.settingsService.numberOfAutosavePromoShow>2||(this.settingsService.numberOfAutosavePromoShow++,this.settingsService.muteAutosavePromoUntil=t+this.settingsService.numberOfAutosavePromoShow*c.WEEK,this.show(e),this.metrikaService.sendMetrika("compose tooltip","show","autosave"))},t.prototype.show=function(e){window.clearTimeout(this.timer),this.content=e,this.isVisible=!0,this.timer=window.setTimeout(this.hide,u)},o([a.observable],t.prototype,"isVisible",void 0),o([a.observable],t.prototype,"content",void 0),o([a.action],t.prototype,"show",null),o([a.action],t.prototype,"hide",void 0),t}(s.default);t.default=l},function(e,t,n){"use strict";n.d(t,"a",function(){return z});var r,o,i,a,s,c,u,l,p,f,d,y,b,m,h,v,g,O,S,E,P,C,w,T,k,A,R,j,M,I,D,L=n(341),N=n(137);n.n(N);function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function F(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var z=(r=L.observable.ref,o=L.observable.ref,i=L.observable.ref,s=F((a=function(){function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),B(this,"addresses",s,this),B(this,"externalEmails",c,this),B(this,"subject",u,this),B(this,"_initialMessageBody",l,this),B(this,"messageFormat",p,this),B(this,"inReplyTo",f,this),B(this,"currentFolder",d,this),B(this,"overwriteIds",y,this),B(this,"ignOverwrite",b,this),B(this,"references",m,this),B(this,"markIds",h,this),B(this,"markAs",v,this),B(this,"lastSaved",g,this),B(this,"attachments",O,this),B(this,"sendTime",S,this),B(this,"messageId",E,this),B(this,"notifications",P,this),B(this,"captcha",C,this),B(this,"checkboxCaptcha",w,this),B(this,"labelIds",T,this),B(this,"userLabels",k,this),B(this,"otherLabels",A,this),B(this,"templatesFolderId",R,this),B(this,"isTemplate",j,this),B(this,"allowEmptySubject",M,this),B(this,"signature",I,this),B(this,"externalEmails",D,this),this.addresses={from:t,to:n.to,cc:n.cc,bcc:n.bcc,initial_to:n.initial_to||[],initial_cc:n.initial_cc||[]},this.subject=n.subj,this._initialMessageBody=n.send,this.messageFormat=n.ttype,this.inReplyTo=n.inreplyto,this.currentFolder=n.current_folder,this.overwriteIds=n.overwrite,this.ignOverwrite=n.ign_overwrite,this.references=n.references,this.markIds=n.mark_ids||[],this.markAs=n.mark_as,this.sendTime=n.send_time?new Date(n.send_time):null,this.labelIds=n.lids||[],this.templatesFolderId=n.templates_fid,this.isTemplate=n.save_symbol===N.WellKnownFolderSymbol.TEMPLATE,this.messageId=n.message_id,this.signature=r,this.externalEmails=o}return function(e,t,n){t&&x(e.prototype,t),n&&x(e,n)}(e,[{key:"updateExternalEmails",value:function(e){this.externalEmails=e}},{key:"hasNotifications",get:function(){return _.values(this.notifications).filter(function(e){return e}).length>0}},{key:"initialMessageBody",get:function(){return this._initialMessageBody}}]),e}()).prototype,"addresses",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=F(a.prototype,"externalEmails",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=F(a.prototype,"subject",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=F(a.prototype,"_initialMessageBody",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=F(a.prototype,"messageFormat",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=F(a.prototype,"inReplyTo",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=F(a.prototype,"currentFolder",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=F(a.prototype,"overwriteIds",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=F(a.prototype,"ignOverwrite",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=F(a.prototype,"references",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=F(a.prototype,"markIds",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=F(a.prototype,"markAs",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=F(a.prototype,"lastSaved",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=F(a.prototype,"attachments",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),S=F(a.prototype,"sendTime",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=F(a.prototype,"messageId",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=F(a.prototype,"notifications",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{delivery:!1,reply:!1,replyTime:null}}}),C=F(a.prototype,"captcha",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{key:"",imgUrl:"",value:""}}}),w=F(a.prototype,"checkboxCaptcha",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{token:""}}}),T=F(a.prototype,"labelIds",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),k=F(a.prototype,"userLabels",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A=F(a.prototype,"otherLabels",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),R=F(a.prototype,"templatesFolderId",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=F(a.prototype,"isTemplate",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),M=F(a.prototype,"allowEmptySubject",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),I=F(a.prototype,"signature",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=F(a.prototype,"externalEmails",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F(a.prototype,"hasNotifications",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"hasNotifications"),a.prototype),F(a.prototype,"initialMessageBody",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"initialMessageBody"),a.prototype),F(a.prototype,"updateExternalEmails",[L.action],Object.getOwnPropertyDescriptor(a.prototype,"updateExternalEmails"),a.prototype),a)},function(e,t,n){"use strict";t.a=function(e){return Daria.requestModelsForCompose(e)}},function(e,t,n){"use strict";function r(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return i});var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metaState=t}return function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(e,[{key:"waitLoad",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,c,"next",e)}function c(e){r(a,o,i,s,c,"throw",e)}s(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var r=n(2666),o=n(1467),i=n(1246),a=(n.n(i),n(347)),s=n(359),c=(n.n(s),n(353)),u=n(350),l=n(358),p=(n.n(l),n(358));n.n(p);function f(e){"@babel/helpers - typeof";return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function y(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){d(i,r,o,a,s,"next",e)}function s(e){d(i,r,o,a,s,"throw",e)}a(void 0)})}}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=m(this,h(t).call(this))).metaState=e,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,o["a"]),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"onSaveSuccess",value:function(){var e=y(regeneratorRuntime.mark(function e(){var t,n=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.metaState).onSaveSuccess.apply(t,n));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onSaveFailed",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onSending",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.metaState.undoSendController.logSendMail();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onSendSuccess",value:function(){var e=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"reply"===t.composeParamsData.params.oper||"reply-all"===t.composeParamsData.params.oper?ns.events.trigger("daria:messageReply:sent"):ns.events.trigger("daria:message:sent"),e.abrupt("return",this.metaState.onSendSuccess(t));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onSendFailed",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"onShowNotification",value:function(){var e=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.name,e.next=e.t0===s.StatuslineName.TemplateUpdated?3:e.t0===s.StatuslineName.TemplateCreated?5:7;break;case 3:return Object(p.showStatuslineComponent)({name:s.StatuslineName.TemplateUpdated,text:t.params.text}),e.abrupt("break",7);case 5:return Object(l.showSuccessMessage)(s.StatuslineName.TemplateCreated,Object(c.default)("statusline/template_created")),e.abrupt("break",7);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"onNeedRemoveDraft",value:function(){var e=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.a.removeDraft(t);case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:Object(l.showSuccessMessage)(s.StatuslineName.DraftRemoved,Object(c.default)("statusline/draft_removed"));case 8:case"end":return e.stop()}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}()},{key:"onFieldChanged",value:function(){var e=y(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.fieldName,r=this.metaState.undoSendController,e.t0=n,e.next="to"===e.t0?5:"cc"===e.t0?5:"bcc"===e.t0?5:"subject"===e.t0?7:"body"===e.t0?9:"attachments"===e.t0?11:13;break;case 5:return r.logRecipientsChanged(n),e.abrupt("break",13);case 7:return r.logSubjectChanged(),e.abrupt("break",13);case 9:return r.logBodyChanged(),e.abrupt("break",13);case 11:return r.logAttachesChanged(),e.abrupt("break",13);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onClose",value:function(){var e=y(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.leaveType,this.metaState.onClose({leaveType:n});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"openTemplate",value:function(){var e=y(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params,e.next=3,Daria.composeGo(n);case 3:this.metaState.setWaitToClose(!0);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"openTemplatesManager",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:ns.page.go("#template");case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"openSignaturesSettings",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:ns.page.go("#setup/sender");case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"manageLabels",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.metaState.setWaitToCollapse(!0),ns.page.go("#setup/folders");case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"changeSize",value:function(){var e=y(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.metaState.changeSize(t,n);case 1:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"onClosePromo",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.metaState.onClosePromo();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onShowPromo",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.metaState.onShowPromo();case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"collapseAllComposes",value:function(){this.metaState.collapseAllComposes()}},{key:"checkAuthConfirmed",value:function(e){return i.PassportStore.instance().checkAuthConfirmed(e)}},{key:"showAbookPopup",value:function(e){return this.metaState.showAbookPopup(e)}},{key:"showPddRestrictPopup",value:function(){Object(a.getPddRestrictNotificationsModel)().showPopup()}},{key:"loadExternalEmails",value:function(){var e=y(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(u.isPDD)()){e.next=2;break}return e.abrupt("return",null);case 2:return n=Object(a.getExternalEmailsBridge)(),e.abrupt("return",n.loadAreExternalEmails(t));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"getExternalEmails",value:function(){return Object(u.isPDD)()?Object(a.getExternalEmailsBridge)().getExternalEmails():{}}},{key:"apdexStart",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return window.Apdex.start.apply(window.Apdex,t)}},{key:"apdexSendDelta",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return window.Apdex.sendDelta.apply(window.Apdex,t)}},{key:"apdexSend",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return window.Apdex.send.apply(window.Apdex,t)}}]),t}()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"_getMessage",value:function(e){return ns.Model.get("message",{ids:e})}},{key:"removeDraft",value:function(e){return Daria.MOPS["remove.draft"](this._getMessage(e).getMessagesCheckedModel())}}]),e}();t.a=new o},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1468);function o(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)})}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(e,[{key:"loadWithParams",value:function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.initParams,t.options;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"saveData",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"changeWorkMode",value:function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.mode;case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"changeSize",value:function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"setCurrentPromo",value:function(){var e=i(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();Object(r.a)(s)},function(e,t,n){"use strict";n.d(t,"a",function(){return T});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(338),d=n.n(f),y=n(341),b=n(342),m=n(1470);function h(e){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function P(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function C(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var w=E(n(1524).a,{}),T=Object(b.observer)((c=s=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return P(_(n=function(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?_(e):t}(this,(e=O(t)).call.apply(e,[this].concat(o)))),"isLoaded",i,_(n)),P(_(n),"setIsLoaded",a,_(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,p.a.PureComponent),function(e,t,n){t&&g(e.prototype,t),n&&g(e,n)}(t,[{key:"componentDidMount",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){v(i,r,o,a,s,"next",e)}function s(e){v(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.metaState,e.next=3,t.waitLoad();case 3:this.setIsLoaded(!0);case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.cls,n=e.metaState;if(!this.isLoaded)return null;var r=n.composeAdapter.composeState;return p.a.createElement(b.Provider,r.providedState,E(m.a,{cls:t,mailboxUid:n.mailboxUid}),w)}}]),t}(),s.propTypes={cls:d.a.string,Meta:d.a.func,metaState:d.a.object},i=C((o=c).prototype,"isLoaded",[y.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=C(o.prototype,"setIsLoaded",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.isLoaded=t}}}),r=o))||r},function(e,t,n){"use strict";var r=n(342),o=n(480),i=r.PropTypes.arrayOrObservableArrayOf;o.a.arrayOf=i},function(e,t,n){"use strict";var r=n(338),o=(n.n(r),n(480)),i=n(2671),a=n(2672),s=n(2673),c=n(590);t.a=r.PropTypes.shape({addresses:i.a.isRequired,allowEmptySubject:r.PropTypes.bool,subject:r.PropTypes.string,initialMessageBody:r.PropTypes.string.isRequired,attachments:o.a.arrayOf(c.a),captcha:a.a,checkboxCaptcha:s.a})},function(e,t,n){"use strict";var r=n(338),o=(n.n(r),n(480)),i=n(793);t.a=r.PropTypes.shape({from:i.a,to:o.a.arrayOf(i.a),cc:o.a.arrayOf(i.a),bcc:o.a.arrayOf(i.a),initial_to:o.a.arrayOf(i.a),initial_cc:o.a.arrayOf(i.a)})},function(e,t,n){"use strict";var r=n(338);n.n(r);t.a=r.PropTypes.shape({key:r.PropTypes.string,imgUrl:r.PropTypes.string,value:r.PropTypes.string})},function(e,t,n){"use strict";var r=n(338);n.n(r);t.a=r.PropTypes.shape({token:r.PropTypes.string})},function(e,t,n){"use strict";var r=n(136),o=(n.n(r),n(338)),i=n.n(o),a=n(2675),s=n(2676),c=n(357);t.a=i.a.shape({id:i.a.string.isRequired,type:i.a.oneOf(Object(r.values)(c.d)).isRequired,att_id:i.a.string,class:i.a.string,diskSrcPath:i.a.string,extension:s.a,external_transformer_filetype:i.a.string,external_transformer:i.a.string,file:i.a.object,folder:i.a.bool,from_template:i.a.bool,hid:i.a.string,mediaType:i.a.string,mid:i.a.string,name:i.a.string,narod:a.a,narodPreview:i.a.string,narodUrl:i.a.string,previewHref:i.a.string,previewSrc:i.a.string,size:i.a.oneOfType([i.a.string,i.a.number]),template_hid:i.a.string,template_mid:i.a.string,url:i.a.string})},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a=o.a.shape({url:o.a.string.isRequired,oid:o.a.string,getProgressTimer:o.a.number})},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a=o.a.shape({icon:o.a.string})},function(e,t,n){"use strict";var r=n(338),o=n.n(r),i=n(136),a=(n.n(i),n(1086)),s=n(355);n.n(s);t.a=o.a.shape({contactsSuggest:o.a.arrayOf(o.a.instanceOf(a.a)),suggestField:o.a.string,suggestType:o.a.oneOf(Object(i.values)(s.SuggestTypes)),suggestQuery:o.a.string})},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a=o.a.shape({url:o.a.string,monogram:o.a.string,color:o.a.string})},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a=o.a.shape({isEnabled:o.a.bool.isRequired,translateFrom:o.a.string,translateTo:o.a.string,source:o.a.string,translation:o.a.string,translationsInProgress:o.a.number,postTranslation:o.a.func})},function(e,t){},function(e,t){},function(e,t){},,,,,,,function(e,t,n){"use strict";var r=n(135),o=(n.n(r),n(1086)),i=function(e){var t=e.contact;return t&&t.email||null};t.a=i,i.propTypes={contact:o.a}},function(e,t,n){"use strict";n.d(t,"a",function(){return D});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(342),b=n(341),m=n(793),h=n(356),v=n(344),g=n(2691),O=n(2694),_=n(2696),S=n(419),E=n(2707);n.n(E);function P(e){"@babel/helpers - typeof";return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function R(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var j="ComposeYabbleMenu",M={Block:j,Block_mobile:"".concat(j,"_mobile"),Block_desktop:"".concat(j,"_desktop"),Addresses:"".concat(j,"-Addresses"),Actions:"".concat(j,"-Actions"),Item:"".concat(j,"-Item"),Item_hover:"".concat(j,"-Item_hover"),Item_active:"".concat(j,"-Item_active"),Item_address:"".concat(j,"-Item_address")},I=A("hr",{}),D=Object(y.inject)("services")(r=Object(y.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=w(this,(e=T(t)).call.apply(e,[this].concat(o)))).copyActionRef=u.a.createRef(),n.renderAddress=function(e){var t=e.email,r=t===n.props.contact.email,o=d()(M.Item,M.Item_address,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},M.Item_active,r));return A(g.a,{selected:r,address:e,cls:o,onClick:function(){return n.onSelectAddress(e)}},t)},n.renderAction=function(e){var t=e.key,n=e.Content,r=e.handler,o=e.ref;return A(O.a,{cls:M.Item,innerRef:o,onClick:r},t,n)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&C(e.prototype,t),n&&C(e,n)}(t,[{key:"makeActionContent",value:function(e){return A(v.default,{className:M.Item.Content,loc:e})}},{key:"componentDidMount",value:function(){this._initClipboard()}},{key:"_initClipboard",value:function(){var e=this;if(this.copyActionRef.current){var t=new _.a(this.copyActionRef.current,{getText:function(){return e.props.contact.email},hoverClass:M.Item_hover});this.clip=t,t.on("success",function(){e.props.onCopy&&e.props.onCopy()})}}},{key:"componentWillUnmount",value:function(){this.clip&&this.clip.destroy()}},{key:"render",value:function(){var e=this.props.availableAddresses,t=this.actions,n=e.length&&t.length;return A("div",{className:d()(M.Block,this.isMobile?M.Block_mobile:M.Block_desktop)},void 0,e.length?A("div",{className:M.Addresses},void 0,e.map(this.renderAddress)):null,n?I:null,A("div",{className:M.Actions},void 0,t.map(this.renderAction)))}},{key:"onSelectAddress",value:function(e){this.props.onSelectAddress&&this.props.onSelectAddress(e.email,this.props.contact)}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}},{key:"isEditContactAllowed",get:function(){return this.props.services.settings.isEditContactAllowed}},{key:"actions",get:function(){if(S.default.isGroupContact(this.props.contact))return[];var e=[{Content:this.makeActionContent("compose-react/WriteToThisContact"),key:"write",handler:this.props.onWriteOnly}];return this.isEditContactAllowed&&e.unshift({Content:this.makeActionContent("compose-react/Edit"),key:"edit",handler:this.props.onEdit}),_.a.canUse&&e.unshift({Content:this.makeActionContent("compose-react/Copy"),key:"copy",handler:this.props.onCopy,ref:this.copyActionRef}),e}}]),t}(),i.propTypes={contact:m.a,availableAddresses:p.a.arrayOf(m.a).isRequired,onEdit:p.a.func,onCopy:p.a.func,onSelectAddress:p.a.func,onWriteOnly:p.a.func,services:h.a.isRequired},R((o=a).prototype,"isMobile",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),R(o.prototype,"isEditContactAllowed",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"isEditContactAllowed"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return A});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(342),d=n(341),y=n(793),b=n(356),m=n(1089),h=n.n(m),v=n(138),g=(n.n(v),n(1475)),O=(n.n(g),n(2693));n.n(O);function _(e){"@babel/helpers - typeof";return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var T="ComposeAddressItem",k={Block:T,Avatar:"".concat(T,"-Avatar"),Name:"".concat(T,"-Name"),Email:"".concat(T,"-Email")},A=Object(f.inject)("services")(r=Object(f.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=E(this,(e=P(t)).call.apply(e,[this].concat(o)))).renderAvatar=function(e){return w(h.a,{size:"m",contact:n.props.address,className:e})},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&S(e.prototype,t),n&&S(e,n)}(t,[{key:"render",value:function(){var e=this.props.address,t=e.name,n=e.email;return w(g.ContactItem,{onMouseDown:function(e){return e.preventDefault()},onClick:this.props.onClick,renderAvatar:this.renderAvatar,name:t,description:n,isActive:this.props.selected})}},{key:"renderName",value:function(){var e=this.props.address,t=e.name,n=e.email;if(this.isMobile)return w("span",{className:k.Name},void 0,n);var r=this.props.selected?"medium":"regular";return u.a.createElement(u.a.Fragment,null,w(v.Text,{weight:r,typography:"body-long-m",className:k.Name},void 0,t),w(v.Text,{weight:r,typography:"body-long-m",color:"secondary",className:k.Email},void 0,n))}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}}]),t}(),i.propTypes={address:y.a,cls:p.a.string,onClick:p.a.func,services:b.a.isRequired,selected:p.a.bool},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"isMobile",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),r=o))||r)||r},function(e,t){e.exports={variables:'"./variables.m.css"',contactItemHeight:"52px",root:"Recipients__root--IfZfl",active:"Recipients__active--3nLXn",avatar:"Recipients__avatar--1_Fmg",content:"Recipients__content--3HrD6",name:"Recipients__name--37zrH",description:"Recipients__description--24PqJ",externalEmailDivider:"Recipients__externalEmailDivider--nGsVt",externalEmailBadge:"Recipients__externalEmailBadge--3bozm",containerDescAndBadge:"Recipients__containerDescAndBadge--2yXa8"}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(138),p=(n.n(l),n(2695));n.n(p);function f(e){"@babel/helpers - typeof";return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h="ComposeActionItem",v={Block:h,Content:"".concat(h,"-Content")},g=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),y(this,b(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&d(e.prototype,t),n&&d(e,n)}(t,[{key:"render",value:function(){return i.a.createElement("div",{className:u()(this.props.cls,v.Block),onClick:this.props.onClick,ref:this.props.innerRef},function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(l.Text,{typography:"body-long-m",className:v.Content},void 0,this.props.children))}}]),t}();g.propTypes={cls:s.a.string,innerRef:s.a.oneOfType([s.a.func,s.a.shape({current:s.a.object})]),onClick:s.a.func}},function(e,t){},function(e,t,n){"use strict";var r=n(2697);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var r=n(1074),o=n.n(r),i=n(2698),a=n.n(i),s=n(2701),c=n.n(s),u=n(2704),l=n(2705);function p(e){"@babel/helpers - typeof";return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=[{name:"native",adapter:u.a},{name:"flash",adapter:l.a}],g=c()(v,function(e){return e.adapter.canUse}),O=g?g.name:null,_=function(e){function t(e,n){var r;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!t.canUse)throw new Error("Clipboard not supported");if(!n||"function"!=typeof n.getText)throw new Error("Options.getText is required for Clipboard");return(r=function(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?b(e):t}(this,y(t).call(this))).destroy=function(){return r._target&&(r._target.removeEventListener("mousedown",r._onMouseDown),r._target=null),r._currentCommand.then(function(){a()(b(r)),r._clipboard.destroy()})},r._initAdapter=function(e,n){r._clipboard=new t.ClipboardAdapter(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){d(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({onReady:function(){return r.emit("ready")},onSuccess:function(){r.emit("success"),r.emit("complete")},onError:function(e){r.emit("error",e),r.emit("complete")}},n))},r._onMouseDown=function(){r._currentCommand=r._currentCommand.then(function(){return new Promise(function(e){return r.once("complete",e)})})},r._currentCommand=Promise.resolve(),r._target=e,r._target.addEventListener("mousedown",r._onMouseDown),r._initAdapter(e,n),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,o.a),function(e,t,n){t&&m(e.prototype,t),n&&m(e,n)}(t,null,[{key:"canUse",get:function(){return Boolean(this.tech)}},{key:"ClipboardAdapter",get:function(){var e=c()(v,{name:this.tech});return e?e.adapter:null}}]),t}();_.tech=O,window.ReactClipboard=_},,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(1438),o=n.n(r),i=n(8);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=!(!i.a.UA||"MSIE"!==i.a.UA.BrowserName)&&document.documentMode,c=function(){function e(t,n){var r=this,i=n.getText,a=n.onReady,s=n.onSuccess,c=n.onError;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._clip=null,this.destroy=function(){r._clip&&r._clip.destroy()};var u=new o.a(t,{text:i});u.on("success",s),u.on("error",c),this._clip=u,setTimeout(a)}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(e,null,[{key:"canUse",get:function(){var e;try{(e=document.queryCommandSupported("copy"))&&!s&&document.execCommand("copy")}catch(t){e=!1}return e}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(1439),o=n.n(r);n(1031);function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(2706);o.a.config({swfPath:a,trustedDomains:[window.location.protocol+"//"+window.location.host],allowScriptAccess:"always"});var s=function(){function e(t,n){var r=this,i=n.getText,a=n.hoverClass,s=n.onReady,c=n.onSuccess,u=n.onError;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._clipboard=null,this.destroy=function(){o.a.destroy(),r._clipboard&&r._clipboard.destroy()},this._target=t,o.a.config({hoverClass:a}),this._clipboard=new o.a(t),this._clipboard.on("ready",function(){return setTimeout(s)}),this._clipboard.on("copy",function(){r._clipboard.setText(i()),c()}),this._clipboard.on("error",u)}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(e,null,[{key:"canUse",get:function(){return window.swfobject.hasFlashPlayerVersion("11.0.0")}}]),e}()},function(e,t,n){e.exports=n.p+"_/a573941f02f4331f81046356ebb667eb-ZeroClipboard.swf"},function(e,t){},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(135)),c=n(342),u=a(n(339)),l=n(1477),p=n(397),f=n(380),d=n(349),y=a(n(2711)),b=c.observer(function(e){var t,n=e.anchor,r=e.cls,o=e.children,i=e.onClose,a=s.useRef(!d.hasFeature(d.Features.REACT_LAYOUT)&&document.querySelector(".js-mail-App")?document.querySelector(".js-mail-App"):document.documentElement),c=p.useStores().visual,b=c.composeContainerRef,m=c.size===f.ComposeSizes.SMALL;return s.default.createElement(l.Popup,{scope:b,className:u.default(y.default.root,"qa-ComposeYabblePopupDesktop",r,(t={},t[y.default.small]=m,t)),anchor:n,direction:["bottom-start","bottom","bottom-end"],onClose:i,visible:!0,boundary:a,hasTail:!0},o)});t.default=b},,function(e,t){e.exports={root:"Popup__root--2YGQq"}},function(e,t){e.exports={variables:'"../../../variables.m.css"',popupLargeWidth:"460px",popupSmallWidth:"385px",root:"YabblePopup__root--1ZI9z",small:"YabblePopup__small--37FQP"}},function(e,t,n){"use strict";var r=n(135),o=n.n(r),i=n(139),a=n.n(i),s=n(1478),c=n(2713),u=n(2714);n.n(u);function l(e){"@babel/helpers - typeof";return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=f(this,(e=d(t)).call.apply(e,[this].concat(i)))).containerRef=o.a.createRef(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,o.a.Component),function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.scope,n=e.anchor,r=e.children;if(!t)return null;var i=n.current?{top:n.current.offsetTop+n.current.clientHeight}:null;return a.a.createPortal(o.a.createElement("div",{className:"ComposeYabblePopupMobile",ref:this.containerRef,style:i},r),t)}}]),t}();b.propTypes=c.a,t.a=Object(s.a)(b)},function(e,t,n){"use strict";var r=n(338),o=n.n(r),i=n(366);t.a={anchor:o.a.object,cls:o.a.string,scope:o.a.object,bounds:o.a.object,onClose:o.a.func,visual:i.a}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return M});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(569),h=n(344),v=n(394),g=n.n(v),O=n(356),_=n(354),S=(n.n(_),n(2716));n.n(S);function E(e){"@babel/helpers - typeof";return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t&&w(e.prototype,t),n&&w(e,n),e}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var R="BeautifulEmailAddressFromPromo",j=A(m.a.Description,{},void 0,A(h.default,{loc:"promo-react/beautiful-email-promo-compose-address"})),M=Object(b.inject)("services")(r=Object(b.observer)((a=i=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?C(e):t}(this,P(t).call(this,e))).disposer=new g.a,n.onCloseClick=function(){n.close(),n.metrikaService.sendHeaderMetrika(_.COMPOSE_METRIKA_HEADER_PROMO_BEAUTIFUL_EMAIL_CLOSE)},n.logShow=function(e){e&&n.metrikaService.sendHeaderMetrika(_.COMPOSE_METRIKA_HEADER_PROMO_BEAUTIFUL_EMAIL_SHOW)},n.disposer.add(C(n),[Object(y.reaction)(function(){return n.props.canBeShowed},n.logShow,{fireImmediately:!0})]),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,u.a.PureComponent),T(t,[{key:"close",value:function(){this.props.onClose&&this.props.onClose()}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),T(t,[{key:"componentWillUnmount",value:function(){this.disposer.disposeAll()}},{key:"render",value:function(){var e=this.props,t=e.promoRef,n=e.anchorRef,r=e.scopeRef,o=e.cls,i=e.canBeShowed,a=this.onCloseClick;if(!this.wasRendered&&!i)return null;this.wasRendered=!0,this.props.onShow&&this.props.onShow();return n.current&&u.a.createElement(m.a,{ref:t,cls:d()(R,o),theme:"promo",tone:"default",size:"m",anchor:n.current,scope:r.current,visible:i,to:["top-center","top-left","top-right"],popupProps:{hiding:!0,mainOffset:0,secondaryOffset:-8,style:{position:"absolute"},tailOffset:32,zIndex:1e4},tail:!0},A(m.a.Close,{onClick:a}),j)}}]),t}(),i.propTypes={promoRef:p.a.object,anchorRef:p.a.object,scopeRef:p.a.object,canBeShowed:p.a.bool,cls:p.a.string,onClose:p.a.func,onShow:p.a.func,services:O.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"metrikaService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return j});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(344),d=n(464),y=n(502),b=n(341),m=n(342),h=n(356),v=n(354),g=(n.n(v),n(2718));n.n(g);function O(e){"@babel/helpers - typeof";return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var w="SuggestBeautifulEmailPromoTooltip",T="SuggestBeautifulEmailPromoTooltip__Description",k="SuggestBeautifulEmailPromoTooltip__Button",A=C(d.default,{}),R=C(f.default,{loc:"promo-react/suggest-beautiful-email-promo-compose-button"}),j=Object(m.inject)("services")(r=Object(m.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=S(this,(e=E(t)).call.apply(e,[this].concat(o)))).onCloseClick=function(){n.props.onClose&&n.props.onClose(),n.metrikaService.sendHeaderMetrika(v.COMPOSE_METRIKA_HEADER_PROMO_SUGGEST_BEAUTIFUL_EMAIL_CLOSE)},n.onActionClick=function(){n.props.onAction&&n.props.onAction(),n.props.onClose&&n.props.onClose(),n.metrikaService.sendHeaderMetrika(v.COMPOSE_METRIKA_HEADER_PROMO_SUGGEST_BEAUTIFUL_EMAIL_ACTION)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(t,[{key:"componentDidMount",value:function(){this.props.onShow&&this.props.onShow(),this.metrikaService.sendHeaderMetrika(v.COMPOSE_METRIKA_HEADER_PROMO_SUGGEST_BEAUTIFUL_EMAIL_SHOW)}},{key:"render",value:function(){var e=this.props,t=e.promoRef,n=e.anchorRef,r=e.scopeRef,o=e.suggestedEmail,i=e.toBottom,a=this.onCloseClick,s=i?["bottom-center"]:["right-center","bottom-center"];return u.a.createElement(y.f,{ref:t,cls:w,anchor:n.current,scope:r.current,visible:!0,to:s,popupProps:{hiding:!0,style:{position:"absolute"}}},C(y.f.Close,{onClick:a},void 0,A),C("div",{className:T},void 0,C(f.default,{loc:"promo-react/suggest-beautiful-email-promo-compose-text",params:{email:o}})),C(y.a,{cls:k,theme:"clear",view:"default",tone:"default",type:"link",url:"#setup/beautiful-email",onClick:this.onActionClick},void 0,R))}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),t}(),i.propTypes={promoRef:p.a.object,anchorRef:p.a.object,scopeRef:p.a.object,onClose:p.a.func,onShow:p.a.func,onAction:p.a.func,toBottom:p.a.bool,suggestedEmail:p.a.string.isRequired,services:h.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"metrikaService",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var r,o,i,a,s=n(135),c=n.n(s),u=n(342),l=n(341),p=n(716),f=n(2721),d=n(2971),y=n(367),b=n(355),m=(n.n(b),n(2993));n.n(m);function h(e){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var P=Object(u.inject)("controllers","data","services","visual")(r=Object(u.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=O(this,(e=_(t)).call.apply(e,[this].concat(o))))._disposer=new y.a,n.onWorkModeChanged=function(e){e===b.WorkModes.FOREGROUND&&n.initialized&&n.focus()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,c.a.Component),function(e,t,n){t&&g(e.prototype,t),n&&g(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this.hotkeysController.attachNode(this.composeContainerRef),this._disposer.add(this,[Object(l.reaction)(function(){return e.props.visual.workMode},this.onWorkModeChanged)]);var t=setTimeout(function(){e.focus(),e.initialized=!0});this._disposer.add(this,function(){return clearTimeout(t)})}},{key:"focus",value:function(){var e=this;this.composeParamsService.isReplyAny()?setTimeout(function(){return e.composeController.focusComposeField("body")},0):this.composeController.focusComposeField("addresses.to")}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"render",value:function(){var e=this.props,t=e.services,n=v(e,["services"]);return t.settings.isMobile?c.a.createElement(d.a,n):c.a.createElement(f.a,n)}},{key:"autoSaveController",get:function(){return this.props.controllers.autoSave}},{key:"hotkeysController",get:function(){return this.props.controllers.hotkeys}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"composeParamsService",get:function(){return this.props.services.composeParams}},{key:"saveOnCloseController",get:function(){return this.props.controllers.saveOnClose}},{key:"composeContainerRef",get:function(){return this.props.visual.refs.composeContainer}}]),t}(),i.propTypes=p.a,E((o=a).prototype,"autoSaveController",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"autoSaveController"),o.prototype),E(o.prototype,"hotkeysController",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"hotkeysController"),o.prototype),E(o.prototype,"composeController",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),E(o.prototype,"composeParamsService",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeParamsService"),o.prototype),E(o.prototype,"saveOnCloseController",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"saveOnCloseController"),o.prototype),E(o.prototype,"composeContainerRef",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeContainerRef"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return Ge});var r,o,i,a,s,c,u,l,p,f,d,y,b,m,h,v,g,O,_,S,E,P,C,w,T,k,A,R,j,M=n(136),I=(n.n(M),n(135)),D=n.n(I),L=n(341),N=n(342),x=n(339),B=n.n(x),F=n(379),z=n(756),U=(n.n(z),n(138)),K=(n.n(U),n(140)),H=(n.n(K),n(353)),W=n(1479),Y=n(716),G=n(367),q=n(376),V=(n.n(q),n(344)),$=n(2722),Q=n(1106),X=(n.n(Q),n(347)),J=n(2723),Z=n(1108),ee=n(1500),te=n(803),ne=n(807),re=n(1511),oe=n(2938),ie=n(1118),ae=n(2945),se=n(2949),ce=n(2951),ue=n(2953),le=n(355),pe=(n.n(le),n(380)),fe=(n.n(pe),n(1512)),de=n(357),ye=n(350),be=n(354),me=(n.n(be),n(767)),he=(n.n(me),n(2965)),ve=(n.n(he),n(2970)),ge=(n.n(ve),n(400));n.n(ge);function Oe(e){"@babel/helpers - typeof";return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _e(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Se(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Ee(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pe(e){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function we(e,t){return(we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ke(e,t,n,r){j||(j="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:j,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Ae(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Re(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var je,Me="composeReact__scrollable-content",Ie="composeReact-MBodyPanels",De=124,Le=36,Ne=(Te(R={},le.FixedModes.NORMAL,{minContentHeight:504}),Te(R,le.FixedModes.SMALL,{minContentHeight:291}),R),xe=7,Be=ke(U.Text,{color:"control-faint",typography:"body-short-s",className:"composeReact__notify__text",weight:"medium"},void 0,ke(V.default,{loc:"compose-react/PopupActions_CloseWindow"})),Fe=ke(he.HeaderButtons,{}),ze=ke(W.a,{className:"composeReact__externalBadgeIcon"}),Ue=ke(ae.a,{}),Ke=ke(ce.a,{}),He=ke(Z.b,{}),We=ke(te.a,{}),Ye=ke(se.a,{}),Ge=(r=Object(N.inject)("data","visual","services","controllers"),o=L.observable.ref,r(i=Object(N.observer)((A=k=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=function(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?Ce(e):t}(this,(e=Pe(t)).call.apply(e,[this].concat(o)))).externalEmailBridge=Object(X.getExternalEmailsBridge)(),n.afterUpdateQueue=[],n.disposer=new G.a,n.domNode=null,n.messageBodyRef=D.a.createRef(),n.footerRef=D.a.createRef(),n.attachmentsBodyRef=D.a.createRef(),n.attachmentsHeaderRef=D.a.createRef(),n.firstAttachmentRef=D.a.createRef(),n.attachmentsIntersectionObserver=null,n.toolbarNodeId=Object(M.uniqueId)("ComposeReact-Toolbar"),n.state={notifyVisible:!1,notifyTimeoutId:void 0},n.subjectRef=D.a.createRef(),Ae(Ce(n),"mainContent",s,Ce(n)),Ae(Ce(n),"attachesHeaderFixed",c,Ce(n)),n.bodyHeader=D.a.createRef(),n.hScrollRef=D.a.createRef(),n.hExtraScrollRef=D.a.createRef(),Ae(Ce(n),"setMainContent",u,Ce(n)),n.afterUpdate=function(e){n.afterUpdateQueue.push(e)},n.focus=function(){n.domNode&&(n.domNode.focus(),n.domNode.tabIndex=-1)},n.focusBody=function(){n.focus();var e=n.messageBodyRef.current;e&&e.focus()},Ae(Ce(n),"focusField",l,Ce(n)),Ae(Ce(n),"saveComposeContainerRef",p,Ce(n)),Ae(Ce(n),"saveTopContentRef",f,Ce(n)),Ae(Ce(n),"saveScrollableContentRef",d,Ce(n)),Ae(Ce(n),"onChangeSize",y,Ce(n)),Ae(Ce(n),"onDeleteAll",b,Ce(n)),Ae(Ce(n),"onAttachmentIntersection",m,Ce(n)),Ae(Ce(n),"blockScrollWidth",h,Ce(n)),Ae(Ce(n),"hasScroll",v,Ce(n)),Ae(Ce(n),"fixedMode",g,Ce(n)),Ae(Ce(n),"wasChangedSizeOnce",O,Ce(n)),Ae(Ce(n),"onEditorInit",_,Ce(n)),Ae(Ce(n),"recalculateFixedContent",S,Ce(n)),Ae(Ce(n),"onToggleRecipients",E,Ce(n)),Ae(Ce(n),"onRecipientsFieldFocus",P,Ce(n)),Ae(Ce(n),"onRecipientsFieldDragStart",C,Ce(n)),Ae(Ce(n),"onWorkModeChanged",w,Ce(n)),n.handleScrollListeningEvents=function(e){var t=Object(M.throttle)(function(){n.hExtraScrollRef.current.scrollTo({left:n.hScrollRef.scrollLeft})},17),r=Object(M.throttle)(function(){n.hScrollRef.scrollTo({left:n.hExtraScrollRef.current.scrollLeft})},17);if(e)return n.hScrollRef.addEventListener("scroll",t),void n.hExtraScrollRef.current.addEventListener("scroll",r);n.hScrollRef.removeEventListener("scroll",t),n.hExtraScrollRef.current.removeEventListener("scroll",r)},n.recalculateTopFixedContent=function(){var e=n.mainContent.offsetTop-n.topContentCollapsedHeight,t=n.hScrollRef.scrollWidth!==n.hScrollRef.clientWidth&&Daria.hasFeature(ge.Features.WEB_NEW_HORIZONTAL_SCROLL);t!==n.isHScrollVisible&&(n.isHScrollVisible=t,setTimeout(function(){return n.handleScrollListeningEvents(t)},100)),e<0&&(e=0);var r=n.scrollableContent.scrollTop>e;if(r!==n.topContentInFixedMode&&(n.topContentInFixedMode=r,r)){var o=n.scrollableContent.scrollHeight-n.scrollableContent.scrollTop;n.afterUpdate(function(){Object(Q.scrollTo)(n.scrollableContent,{top:n.scrollableContent.scrollHeight-o,isSmooth:!1})})}},n.onAttachesExpand=function(){n.metrikaService.sendAttachmentsMetrika(be.COMPOSE_METRIKA_ATTACHMENTS_TOGGLE),n.attachesHeaderFixed&&n.firstAttachmentRef.current&&Object(Q.scrollIntoView)(n.firstAttachmentRef.current,!1)},n.expandLabels=function(){n.topContentInFixedMode&&Object(Q.scrollTo)(n.scrollableContent,{top:0})},n.onSubjectFocus=function(){n.data.subject||n.props.controllers.smartSubject.getSmartSubjectsForInput()},Ae(Ce(n),"onSubjectClick",T,Ce(n)),n.getInlineDropZone=function(){return n.scrollableContent},n.scrollCursorIntoView=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.boundingRect,r=e.reserveBottom,o=void 0!==r&&r,i=e.reserveTop,a=void 0!==i&&i;if(t&&!Object.keys(t).every(function(e){return 0===e})){var s=t.height+xe,c=a?s:0,u=o?s:0,l=n.checkCursorForTop({boundingRect:t,reserveHeight:c})||n.checkCursorForBottom({boundingRect:t,reserveHeight:u});if(null!==l){var p=n.scrollableContent.scrollTop;Object(Q.scrollTo)(n.scrollableContent,{top:p+l,isSmooth:!1})}}},n.onKeyboardMove=function(e){var t=e.boundingRect,r=e.keyCode;n.scrollCursorIntoView({boundingRect:t,reserveBottom:r===q.KeyCodes.DOWN,reserveTop:r===q.KeyCodes.UP})},n.onChange=function(e){n.scrollCursorIntoView({boundingRect:e}),n.recalculateFixedContent()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(t,D.a.Component),function(e,t,n){t&&Ee(e.prototype,t),n&&Ee(e,n)}(t,[{key:"getDropZoneCssRule",value:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){Se(i,r,o,a,s,"next",e)}function s(e){Se(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(je){e.next=4;break}return e.next=3,Object($.a)(".".concat(Me,".cke_pasteimage_placeholder::after"));case 3:je=e.sent;case 4:return e.abrupt("return",je);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this;this.createAttachmentsIntersectionObserver(),window.addEventListener("resize",this.recalculateFixedContent),this.disposer.add(this,function(){return window.removeEventListener("resize",e.recalculateFixedContent)}),this.disposer.add(this,[Object(L.reaction)(function(){return e.props.visual.focusedField},this.focusField),Object(L.reaction)(function(){return e.props.visual.size},this.onChangeSize),Object(L.reaction)(function(){return e.props.visual.workMode},this.onWorkModeChanged)]),this.updateNotifyVisibility(!0)}},{key:"updateNotifyVisibility",value:function(e){var t=this;if(this.props.mailboxUid)if(e){var n=setTimeout(function(){return t.updateNotifyVisibility(!1)},3e3);this.setState({notifyVisible:e,notifyTimeoutId:n})}else clearTimeout(this.state.notifyTimeoutId),this.setState({notifyVisible:e})}},{key:"componentDidUpdate",value:function(){this.afterUpdateQueue.forEach(function(e){return e()}),this.afterUpdateQueue=[],this.observeAttachmentBody()}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"createAttachmentsIntersectionObserver",value:function(){var e=this;if(this.scrollableComposeContainer&&window.IntersectionObserver){var t={root:this.scrollableComposeContainer};this.attachmentsIntersectionObserver=new IntersectionObserver(this.onAttachmentIntersection,t),this.disposer.add(this,function(){return e.attachmentsIntersectionObserver.disconnect()})}}},{key:"observeAttachmentBody",value:function(){this.attachmentsIntersectionObserver&&this.attachmentsBodyRef.current&&(this.attachmentsIntersectionObserver.disconnect(),this.attachmentsIntersectionObserver.observe(this.attachmentsBodyRef.current))}},{key:"recalculateFixedMode",value:function(){if(!this.scrollableContent)return le.FixedModes.NONE;var e=this.scrollableContent.clientHeight;return e<Ne[le.FixedModes.SMALL].minContentHeight?le.FixedModes.NONE:e>Ne[le.FixedModes.NORMAL].minContentHeight?le.FixedModes.NORMAL:le.FixedModes.SMALL}},{key:"scrollTopIfFixed",value:function(){this.topContentInFixedMode&&Object(Q.scrollTo)(this.scrollableContent,{top:0})}},{key:"checkCursorForTop",value:function(e){var t=e.boundingRect,n=e.reserveHeight;if(!this.topContentInFixedMode)return null;var r=this.scrollableContent.getBoundingClientRect(),o=t.top+this.scrollableContent.scrollTop-r.top,i=this.scrollableContent.scrollTop,a=this.topContentCollapsedHeight+i-Math.max(o-n,this.headerPanelHeight+1);return a>0?-1*a:null}},{key:"checkCursorForBottom",value:function(e){var t=e.boundingRect,n=e.reserveHeight;if(!this.attachesHeaderFixed||!this.attachmentsHeaderRef.current)return null;var r=this.attachmentsHeaderRef.current.getBoundingClientRect(),o=t.bottom+n-r.top;return o>0?o:null}},{key:"closeNotify",value:function(){this.updateNotifyVisibility(!1)}},{key:"renderNotify",value:function(){return this.props.mailboxUid&&this.state.notifyVisible?ke("div",{className:B()(Object(F.cnTheme)(z.PS_DARK),"composeReact__notify")},void 0,ke(U.Text,{color:"control-faint",typography:"body-short-s",className:"composeReact__notify__text"},void 0,ke(V.default,{loc:"compose-react/Notify_MessageWillBeSended_From",params:{value:this.props.data.addresses.from.name}})),ke(K.Button,{view:"default",size:"s",className:"composeReact__notify__button",onClick:this.closeNotify.bind(this)},void 0,Be)):null}},{key:"render",value:function(){var e=this,t=this.props.cls,n=this.hasExternalEmailAddress,r=this.topContentInFixedMode,o=this.blockScrollWidth,i=this.toolbarNodeId,a=this.areAdditionalAddressesExpanded,s=this.onToggleRecipients,c=this.onRecipientsFieldFocus,u=this.onRecipientsFieldDragStart,l=this.onSubjectFocus,p={marginRight:"".concat(o,"px")},f=r?p:{},d={height:"".concat(r?this.headerPanelHeight:0,"px")},y={width:this.hScrollRef.scrollWidth},b=B()("composeReact__scrollable-container",{"composeReact__scrollable-container__with-hz-scroll":this.isHScrollVisible}),m=B()("composeReact__scrollable-top-content",{"composeReact__scrollable-top-content__with-hz-scroll":this.isHScrollVisible,"composeReact__scrollable-top-content__fixed":r}),h=B()("composeReact",t);return D.a.createElement("div",{className:h,ref:this.saveComposeContainerRef,tabIndex:"-1"},ke("div",{className:"composeReact__inner"},void 0,D.a.createElement("div",{className:b,ref:function(t){return e.scrollableComposeContainer=t}},D.a.createElement("div",{className:Me,ref:this.saveScrollableContentRef,onScroll:this.recalculateFixedContent},D.a.createElement("div",{className:m,ref:this.saveTopContentRef,style:f},ke("div",{className:"composeReact__header"},void 0,ke("div",{className:"composeReact__headerInputs"},void 0,ke(re.a,{isShowAdditionalAddresses:a,onToggleExpandedState:s,onFieldFocus:c,isAddressesCollapsed:r,onFieldDragStart:u,mailboxUid:this.props.mailboxUid},void 0,ke(ie.a,{inputRef:this.subjectRef,title:"compose-react/Header_Subject",onFocus:l}),ke(oe.a,{scope:this.props.visual.refs.topContent,anchor:this.subjectRef.current}),ke(ee.a,{onExpand:this.expandLabels}))),ke("div",{className:"composeReact__headerButtons"},void 0,Fe,ke(fe.a,{cls:"ComposeRecipients-Expander",isExpanded:a,onToggleExpanded:s,mailboxUid:this.props.mailboxUid}))),n&&ke("div",{className:"composeReact__externalBadge"},void 0,ze,Object(H.default)("compose-react/toExternalContactMessage")),ke("div",{id:i,className:"composeReact__toolbar"}),Ue),ke("div",{className:"composeReact__placeholder",style:d}),D.a.createElement("div",{className:"composeReact__main-content",ref:this.setMainContent},ke(ue.a,{innerRef:this.bodyHeader,containerRef:this.mainContent}),ke("div",{className:Ie},void 0,D.a.createElement(ne.a,{cls:"composeReact__message-body",getInlineDropZone:this.getInlineDropZone,onChange:this.onChange,onKeyboardMove:this.onKeyboardMove,onEditorInit:this.onEditorInit,placeholder:Object(H.default)("compose-react/Editor_Placeholder"),ref:this.messageBodyRef,toolbarNodeId:i}),Ke)),ke("div",{className:"composeReact__scrollable-bottom-content-new"},void 0,this.shouldShowAttachments&&ke(J.a,{onDeleteAll:this.onDeleteAll,onExpand:this.onAttachesExpand,onMount:this.onAttachesMount,isFixed:this.attachesHeaderFixed,attachmentsBodyRef:this.attachmentsBodyRef,attachmentsHeaderRef:this.attachmentsHeaderRef,firstAttachmentRef:this.firstAttachmentRef}))),this.isHScrollVisible&&D.a.createElement("div",{id:"hz-scroll",ref:this.hExtraScrollRef,className:"HorizontalScroll"},ke("div",{id:"hz-scroll-inner",className:"HorizontalScroll__inner",style:y}))),D.a.createElement("div",{className:"composeReact__footer",ref:this.footerRef},this.renderNotify(),He),ke(me.Tooltip,{direction:"top",view:"default",size:"s",state:"warning",anchor:this.footerRef,visible:Boolean(this.notificationController.isVisible),mainOffset:23},void 0,this.notificationController.content),We,Ye))}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"contactsController",get:function(){return this.props.controllers.contacts}},{key:"notificationController",get:function(){return this.props.controllers.notification}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"data",get:function(){return this.props.data}},{key:"topContentInFixedMode",get:function(){return this.props.visual.topContentInFixedMode},set:function(e){this.props.visual.topContentInFixedMode=e}},{key:"isHScrollVisible",get:function(){return this.props.visual.isHScrollVisible},set:function(e){this.props.visual.isHScrollVisible=e}},{key:"areAdditionalAddressesExpanded",get:function(){var e=this.props.visual;return!this.topContentInFixedMode&&e.additionalAddressesAreExpanded}},{key:"headerPanelHeight",get:function(){var e=this.props.visual.additionalAddressesAreExpanded?3*Le:0;return this.topContentCollapsedHeight+e}},{key:"hasLabelsRow",get:function(){return this.props.data.userLabels.length>0}},{key:"topContentCollapsedHeight",get:function(){return De+(this.hasLabelsRow?Le:0)}},{key:"shouldShowAttachments",get:function(){return 0!==this.props.controllers.attachments.validAttachments.length}},{key:"hasExternalEmailAddress",get:function(){if(Object(ye.isPDD)()){var e=[].concat(_e(this.props.data.addresses.to),_e(this.props.data.addresses.bcc),_e(this.props.data.addresses.cc)).map(function(e){return e.email}),t=this.externalEmailBridge.getExternalEmails();return Boolean(e.find(function(e){return t[e]}))}return!1}}]),t}(),k.propTypes=Y.a,s=Re((a=A).prototype,"mainContent",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=Re(a.prototype,"attachesHeaderFixed",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u=Re(a.prototype,"setMainContent",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.mainContent=t||e.mainContent}}}),Re(a.prototype,"composeController",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"composeController"),a.prototype),Re(a.prototype,"contactsController",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"contactsController"),a.prototype),Re(a.prototype,"notificationController",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"notificationController"),a.prototype),Re(a.prototype,"metrikaService",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"metrikaService"),a.prototype),Re(a.prototype,"data",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"data"),a.prototype),Re(a.prototype,"topContentInFixedMode",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"topContentInFixedMode"),a.prototype),Re(a.prototype,"isHScrollVisible",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"isHScrollVisible"),a.prototype),Re(a.prototype,"areAdditionalAddressesExpanded",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"areAdditionalAddressesExpanded"),a.prototype),Re(a.prototype,"headerPanelHeight",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"headerPanelHeight"),a.prototype),Re(a.prototype,"hasLabelsRow",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"hasLabelsRow"),a.prototype),Re(a.prototype,"topContentCollapsedHeight",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"topContentCollapsedHeight"),a.prototype),Re(a.prototype,"shouldShowAttachments",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"shouldShowAttachments"),a.prototype),l=Re(a.prototype,"focusField",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){if(e.props.visual.focusedField="","compose"!==t)if("body"!==t){var n=!1;-1!==["addresses.cc","addresses.bcc"].indexOf(t)&&!e.areAdditionalAddressesExpanded&&(e.topContentInFixedMode&&Object(Q.scrollTo)(e.scrollableContent,{top:0,isSmooth:!1}),e.props.visual.additionalAddressesAreExpanded=!0,n=!0);var r=Object(L.action)(function(){e.composeController.focusComposeField(t)});n?e.afterUpdate(r):r()}else e.focusBody();else e.focus()}}}),p=Re(a.prototype,"saveComposeContainerRef",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.domNode=t,e.props.visual.refs.composeContainer=t}}}),f=Re(a.prototype,"saveTopContentRef",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.topContent=t,e.props.visual.refs.topContent=t}}}),d=Re(a.prototype,"saveScrollableContentRef",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.scrollableContent=t,e.props.visual.refs.composeScrollableContainer=t}}}),y=Re(a.prototype,"onChangeSize",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t===pe.ComposeSizes.SMALL?e.fixedMode=le.FixedModes.SMALL:e.fixedMode=le.FixedModes.NORMAL,e.wasChangedSizeOnce=!0}}}),b=Re(a.prototype,"onDeleteAll",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.attachmentsIntersectionObserver&&e.attachmentsIntersectionObserver.disconnect();var t=e.props.data.attachments.find(Object(L.action)(function(e){return e.info.type===de.d.YADISK&&e.status===de.c.UPLOADING}));t&&(t.status=de.c.ABORTED,t.xhr&&t.xhr.abort()),e.props.data.attachments=[],e.metrikaService.sendAttachmentsMetrika(be.COMPOSE_METRIKA_ATTACHMENTS_REMOVE_ALL),e.attachesHeaderFixed=!1}}}),m=Re(a.prototype,"onAttachmentIntersection",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.find(Object(L.action)(function(t){return t.target===e.attachmentsBodyRef.current})),r=n&&n.isIntersecting;e.attachesHeaderFixed=!r}}}),h=Re(a.prototype,"blockScrollWidth",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),v=Re(a.prototype,"hasScroll",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),g=Re(a.prototype,"fixedMode",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return le.FixedModes.NONE}}),O=Re(a.prototype,"wasChangedSizeOnce",[L.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_=Re(a.prototype,"onEditorInit",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.recalculateFixedContent(),e.observeAttachmentBody(),e.props.controllers.compose.init(),e.props.controllers.saveSend.init(),e.hScrollRef=e.messageBodyRef.current.editorRef.current.editor.container.$.querySelector(".cke_wysiwyg_div"),e.isHScrollVisible=e.hScrollRef.scrollWidth!==e.hScrollRef.clientWidth&&Daria.hasFeature(ge.Features.WEB_NEW_HORIZONTAL_SCROLL),e.isHScrollVisible&&setTimeout(Object(L.action)(function(){return e.handleScrollListeningEvents(!0)}),100);var t=e.props.visual.hasChanges&&e.wasChangedSizeOnce;e.props.visual.hasChanges=t;var n=ke("span",{},void 0,Object(H.default)("compose-react/AutosaveNotification"));e.notificationController.showAutosaveNotification(n)}}}),S=Re(a.prototype,"recalculateFixedContent",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){if(e.scrollableContent){var t=e.recalculateFixedMode();t!==e.fixedMode&&(e.fixedMode=t),e.fixedMode!==le.FixedModes.NONE?(e.blockScrollWidth||(e.blockScrollWidth=e.scrollableContent.offsetWidth-e.scrollableContent.clientWidth),e.hasScroll=e.scrollableContent.scrollHeight>e.scrollableContent.clientHeight,e.recalculateTopFixedContent()):e.topContentInFixedMode=!1}}}}),E=Re(a.prototype,"onToggleRecipients",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.topContentInFixedMode?(Object(Q.scrollTo)(e.scrollableContent,{top:0}),e.props.visual.additionalAddressesAreExpanded=!0):e.props.visual.additionalAddressesAreExpanded=!e.props.visual.additionalAddressesAreExpanded,e.metrikaService.sendHeaderMetrika(be.COMPOSE_METRIKA_HEADER_TOGGLE_ADDRESSES)}}}),P=Re(a.prototype,"onRecipientsFieldFocus",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){"addresses.to"===t&&(e.scrollTopIfFixed(),(e.data.addresses.cc.length||e.data.addresses.bcc.length)&&(e.props.visual.additionalAddressesAreExpanded=!0))}}}),C=Re(a.prototype,"onRecipientsFieldDragStart",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){"addresses.to"===t&&(e.scrollTopIfFixed(),e.props.visual.additionalAddressesAreExpanded=!0)}}}),w=Re(a.prototype,"onWorkModeChanged",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t===le.WorkModes.BACKGROUND?(e.notificationController.hide(),e.updateNotifyVisibility(!1)):e.updateNotifyVisibility(!0)}}}),T=Re(a.prototype,"onSubjectClick",[L.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.data.subject||(e.props.visual.subjectsSuggest.suggestType=le.SmartSubjectType.INPUT)}}}),Re(a.prototype,"hasExternalEmailAddress",[L.computed],Object.getOwnPropertyDescriptor(a.prototype,"hasExternalEmailAddress"),a.prototype),i=a))||i)||i)},function(e,t,n){"use strict";var r=n(149);function o(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.styleSheets;if(!t||!t.length)return null;for(var n=t.length-1;n>=0;n--){var r=t[n],o=null;try{o=r.rules||r.cssRules}catch(e){}if(o)for(var i=o.length-1;i>=0;i--){var a=o[i],s=a&&a.selectorText;if(s&&s.indexOf(e)>=0)return a}}return null};function a(){return(a=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)})}}(regeneratorRuntime.mark(function e(){var t=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.a;case 2:return e.abrupt("return",i.apply(void 0,t));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}t.a=function(){return a.apply(this,arguments)}},function(e,t,n){"use strict";var r=n(2724);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return K});var r,o,i,a,s,c,u,l,p,f,d,y,b=n(135),m=n.n(b),h=n(338),v=n.n(h),g=n(339),O=n.n(g),_=n(341),S=n(342),E=n(353),P=n(2725),C=n(2735),w=n(361),T=n(363),k=n(356),A=n(460),R=n(357),j=n(479),M=n(2759),I=n.n(M);function D(e){"@babel/helpers - typeof";return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e,t,n,r){y||(y="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:y,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function z(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function U(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var K=Object(S.inject)("controllers","data","services","visual")(r=Object(S.observer)((d=f=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),f=0;f<r;f++)o[f]=arguments[f];return(n=function(e,t){return!t||"object"!==D(t)&&"function"!=typeof t?x(e):t}(this,(e=N(t)).call.apply(e,[this].concat(o)))).headerRef=m.a.createRef(),z(x(n),"isHovered",i,x(n)),z(x(n),"isFocused",a,x(n)),z(x(n),"onItemRemoveOrCancel",s,x(n)),z(x(n),"setHovered",c,x(n)),z(x(n),"unsetHovered",u,x(n)),z(x(n),"setFocused",l,x(n)),z(x(n),"unsetFocused",p,x(n)),n.focus=function(e){"attachments"===e&&n.headerRef.current&&n.headerRef.current.focus()},n.renderAttachmentItem=function(e,t){return m.a.createElement("li",{key:e.info.id,className:I.a.item,ref:0===t?n.props.firstAttachmentRef:null},F(C.a,{onClose:n.onItemRemoveOrCancel,onCancelLoading:n.onItemRemoveOrCancel,item:e}))},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(t,m.a.Component),function(e,t,n){t&&L(e.prototype,t),n&&L(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this.props.onMount&&this.props.onMount(),this.dispose=Object(_.reaction)(function(){return e.props.visual.focusedField},this.focus)}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"render",value:function(){return F("div",{className:O()(I.a.wrap,"qa-Compose-Attachments",this.isFocused?"focused":"unfocused"),onMouseEnter:this.setHovered,onMouseLeave:this.unsetHovered,role:"group","aria-label":Object(E.default)("compose-react/attachmentsLabel"),onFocus:this.setFocused,onBlur:this.unsetFocused},void 0,m.a.createElement(P.a,{ref:this.headerRef,cls:I.a.header,count:this.validAttachments.length,onDeleteAll:this.props.onDeleteAll,onExpand:this.props.onExpand,size:this.totalSize,showDeleteAllButton:this.isHovered||this.isFocused,isFixed:this.props.isFixed,innerRef:this.props.attachmentsHeaderRef,uploadedCount:this.uploadedCount,yaDiskCount:this.yaDiskCount}),m.a.createElement("ul",{className:O()(I.a.body,"qa-Compose-Attachments-List"),ref:this.props.attachmentsBodyRef,role:"list"},this.validAttachments.map(this.renderAttachmentItem)))}},{key:"attachmentsController",get:function(){return this.props.controllers.attachments}},{key:"attachments",get:function(){return this.props.data.attachments||[]}},{key:"validAttachments",get:function(){return this.attachmentsController.validAttachments||[]}},{key:"totalSize",get:function(){return this.validAttachments.map(function(e){return Object(j.a)(e.info)||0}).reduce(function(e,t){return e+t},0)}},{key:"uploadedCount",get:function(){return this.attachmentsController.uploadedCount}},{key:"yaDiskCount",get:function(){return this.attachmentsController.yaDiskCount}}]),t}(),f.propTypes={controllers:w.a.isRequired,data:T.a.isRequired,services:k.a.isRequired,visual:A.a.isRequired,isFixed:v.a.bool,onExpand:v.a.func,onMount:v.a.func,onDeleteAll:v.a.func,attachmentsBodyRef:v.a.object,firstAttachmentRef:v.a.object,attachmentsHeaderRef:v.a.object},i=U((o=d).prototype,"isHovered",[_.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=U(o.prototype,"isFocused",[_.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),U(o.prototype,"attachmentsController",[_.computed],Object.getOwnPropertyDescriptor(o.prototype,"attachmentsController"),o.prototype),U(o.prototype,"attachments",[_.computed],Object.getOwnPropertyDescriptor(o.prototype,"attachments"),o.prototype),U(o.prototype,"validAttachments",[_.computed],Object.getOwnPropertyDescriptor(o.prototype,"validAttachments"),o.prototype),U(o.prototype,"totalSize",[_.computed],Object.getOwnPropertyDescriptor(o.prototype,"totalSize"),o.prototype),U(o.prototype,"uploadedCount",[_.computed],Object.getOwnPropertyDescriptor(o.prototype,"uploadedCount"),o.prototype),U(o.prototype,"yaDiskCount",[_.computed],Object.getOwnPropertyDescriptor(o.prototype,"yaDiskCount"),o.prototype),s=U(o.prototype,"onItemRemoveOrCancel",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t.info.type===R.d.YADISK&&t.status===R.c.UPLOADING&&(t.status=R.c.ABORTED,t.xhr&&t.xhr.abort()),e.attachments.remove(t)}}}),c=U(o.prototype,"setHovered",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isHovered=!0}}}),u=U(o.prototype,"unsetHovered",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isHovered=!1}}}),l=U(o.prototype,"setFocused",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.timer&&(clearTimeout(e.timer),e.timer=null),e.isFocused=!0}}}),p=U(o.prototype,"unsetFocused",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.timer=setTimeout(Object(_.action)(function(){Object(_.runInAction)(Object(_.action)(function(){e.isFocused=!1}))}),0)}}}),r=o))||r)||r},function(e,t,n){"use strict";var r=n(2726);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return k});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(482),p=(n.n(l),n(800)),f=(n.n(p),n(344)),d=n(353),y=n(140),b=(n.n(y),n(138)),m=(n.n(b),n(1480)),h=(n.n(m),n(2730)),v=n(2734),g=n.n(v);function O(e){"@babel/helpers - typeof";return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var T=w(b.Text,{typography:"body-long-m"},void 0,w(f.default,{loc:"compose-react/Attachments_Delete_All"})),k=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=E(this,(e=P(t)).call.apply(e,[this].concat(o)))).buttonRef=i.a.createRef(),n.onDeleteAll=function(e){e.stopPropagation(),n.props.onDeleteAll()},n.onExpand=function(){n.props.isFixed&&n.props.onExpand()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&S(e.prototype,t),n&&S(e,n)}(t,[{key:"focus",value:function(){this.buttonRef.current&&this.buttonRef.current.focus()}},{key:"render",value:function(){var e,t=this.props.isFixed?{marginRight:"".concat(m.SmartScroll.scrollbarWidth,"px")}:{};return w("div",{className:u()(g.a.wrapper,"qa-Compose-AttachmentsHeader",(e={},_(e,g.a.fixed,this.props.isFixed),_(e,"qa-Compose-AttachmentsHeader-fixed",this.props.isFixed),e))},void 0,w("div",{className:g.a.stub}),i.a.createElement("div",{className:u()(g.a.header),style:t,ref:this.props.innerRef},w(h.a,{cls:g.a.progress}),i.a.createElement("button",{ref:this.buttonRef,className:g.a.showAttachments,onClick:this.onExpand,"aria-label":this.getButtonAriaLabel()},w(b.Text,{typography:"body-long-m",className:u()(g.a.count,"qa-Compose-AttachmentsHeader-Count"),"aria-hidden":"true"},void 0,this.renderCountWithDiskLabel()),w(b.Text,{typography:"body-long-m",color:"secondary",className:u()(g.a.size,"qa-Compose-AttachmentsHeader-Size"),"aria-hidden":"true"},void 0,w(l.HumanFileSize,{bytes:this.props.size}))),this.maybeRenderActions()))}},{key:"renderCountWithDiskLabel",value:function(){var e=this.props,t=e.count,n=e.yaDiskCount,r=t-n;return w(f.default,r&&n?{loc:"compose-react/attachmentsCountConcat",params:{files:Object(d.default)("compose-react/Attachments_Count",{count:r}),disk:Object(d.default)("compose-react/attachmentsCountDisk",{count:n})}}:r?{loc:"compose-react/Attachments_Count",params:{count:r}}:{loc:"compose-react/attachmentsCountDisk",params:{count:n}})}},{key:"maybeRenderActions",value:function(){return w("div",{className:g.a.actions},void 0,this.maybeRenderDeleteAllButton())}},{key:"maybeRenderDeleteAllButton",value:function(){return this.props.showDeleteAllButton?w(y.Button,{onClick:this.onDeleteAll,cls:u()(g.a.button,"qa-Compose-AttachmentsHeader-DeleteAll"),view:"clear"},void 0,T):null}},{key:"getButtonAriaLabel",value:function(){var e=this.props,t=e.count-e.yaDiskCount,n=Object(p.getSizeAndUnit)(this.props.size),r=n.unit,o=n.value;return Object(d.default)("compose-react/Attachments_Count",{count:t})+" "+Object(d.default)(l.UNIT_LOC_KEYS[r],{value:o})}}]),t}();k.propTypes={count:s.a.number,onDeleteAll:s.a.func,onExpand:s.a.func,isFixed:s.a.bool,size:s.a.number,uploadedCount:s.a.number,showDeleteAllButton:s.a.bool,innerRef:s.a.object,yaDiskCount:s.a.number}},,,,function(e,t,n){"use strict";var r=n(2731);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return k});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(1481),h=(n.n(m),n(361)),v=n(357),g=n(2733),O=n.n(g);function _(e){"@babel/helpers - typeof";return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function T(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var k=Object(b.inject)("controllers")(r=Object(b.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,P(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&S(e.prototype,t),n&&S(e,n)}(t,[{key:"render",value:function(){var e=this.props.cls,t=this.progress;return 1===t?null:w("div",{className:d()(O.a.wrap,e)},void 0,w(m.Progress,{progress:100*t}))}},{key:"validAttachments",get:function(){return this.props.controllers.attachments.validAttachments||[]}},{key:"progress",get:function(){return this.validAttachments.map(function(e){return e.status===v.c.COMPLETED?100:e.progress}).reduce(function(e,t){return t+e},0)/this.validAttachments.length/100}}]),t}(),i.propTypes={cls:p.a.string,controllers:h.a.isRequired},T((o=a).prototype,"validAttachments",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"validAttachments"),o.prototype),T(o.prototype,"progress",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"progress"),o.prototype),r=o))||r)||r},function(e,t){e.exports={progress:"LoadingProgress__progress--10oXR",progress_inner:"LoadingProgress__progress_inner--17aDJ"}},function(e,t){e.exports={wrap:"LoadingProgress__wrap--M-LFt"}},function(e,t){e.exports={wrapper:"AttachmentsHeader__wrapper--EkR3p",header:"AttachmentsHeader__header--1eT0o",stub:"AttachmentsHeader__stub--2kUD3",fixed:"AttachmentsHeader__fixed--2dgKo",count:"AttachmentsHeader__count--3VdHy",size:"AttachmentsHeader__size--3N26Q",actions:"AttachmentsHeader__actions--2fkWP",button:"AttachmentsHeader__button--1R9pP",buttonContainer:"AttachmentsHeader__buttonContainer--26bVY",progress:"AttachmentsHeader__progress--1EjE0",showAttachments:"AttachmentsHeader__showAttachments--3IrjP"}},function(e,t,n){"use strict";var r=n(2736);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return T});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(341),d=n(342),y=n(2737),b=(n.n(y),n(2756)),m=n(590),h=n(356),v=n(357),g=n(479),O=n(354);n.n(O);function _(e){"@babel/helpers - typeof";return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=Object(b.a)(y.AttachmentItem),T=Object(d.inject)("services")(r=Object(d.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=function(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?P(e):t}(this,(e=E(t)).call.apply(e,[this].concat(o)))).state={isUsingThumbnail:!1},n.onCloseClick=function(){var e=n.props,t=e.item,r=e.onClose;n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_REMOVE),r&&r(t)},n.onCancelClick=function(){var e=n.props,t=e.item,r=e.onCancelLoading;n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_CANCEL_UPLOAD),r&&r(t)},n.onPreviewClick=function(e){var t=n.props.item,r={mid:t.visual.mid,hid:t.visual.hid};t.info.type!==v.d.YADISK?t.previewSupported?(r.mid||r.hid)&&(n.props.services.attachments.showImagePreview("attachments.image-preview",r,P(n),e),n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_PREVIEW)):n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_DOWNLOAD):n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_PREVIEW)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,u.a.Component),function(e,t,n){t&&S(e.prototype,t),n&&S(e,n)}(t,[{key:"componentDidMount",value:function(){this.loadPreview()}},{key:"componentWillUnmount",value:function(){this.image&&(this.image.onload=null)}},{key:"loadPreview",value:function(){var e=this,t=this.props.item.info.previewSrc;t&&this.previousPreviewSrc!==t&&(this.image=new Image,this.image.onload=function(){return e.setState({isUsingThumbnail:!0})},this.image.src=t,this.previousPreviewSrc=t)}},{key:"componentDidUpdate",value:function(){this.loadPreview()}},{key:"render",value:function(){var e=this.props.services,t=this.props.item,n=t.info,r=t.status,o=t.progress,i=t.visual,a=n.previewHref||i.narodUrl||i.url,c=this.state.isUsingThumbnail;return function(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(w,{onPreviewClick:this.onPreviewClick,fileType:this.mediaType,attachType:n.type,extension:i.fileext,name:i.name,sourceType:n.type,previewSrc:c?n.previewSrc:null,sourceHref:a,onClose:this.onCloseClick,isMobile:e.settings.isMobile,progress:o,onCancelLoading:this.onCancelClick,size:Object(g.a)(n),status:r})}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"mediaType",get:function(){var e=this.props.item,t=e.info,n=e.visual;return Boolean(t.folder)?"folder":".eml"===n.fileext?"mail":n.class}}]),t}(),i.propTypes={item:m.a,onClose:p.a.func,onCancelLoading:p.a.func,services:h.a},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"mediaType",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"mediaType"),o.prototype),r=o))||r)||r},,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{d:"M13.4 3.9l-1.31-1.31a2.11 2.11 0 00-2.93 0l-1.3 1.3c-.76.77-.8 1.97-.13 2.78L8.8 5.59a.57.57 0 01.12-.63l1.3-1.31a.56.56 0 01.8 0l1.32 1.31c.22.22.22.58 0 .8l-1.31 1.31a.58.58 0 01-.63.11L9.32 8.26a2.04 2.04 0 002.77-.12l1.3-1.32c.81-.8.81-2.12 0-2.92zm-3.23 2.98a.75.75 0 00-1.06-1.06l-.07.07-1.06 1.06-1.02 1.02L5.9 9.03l-.07.07a.75.75 0 001.06 1.06l.07-.07 1.06-1.06 1.02-1.02 1.06-1.06.07-.07zm-3.09 4.14c.18-.17.21-.42.12-.63L8.27 9.3c.67.81.63 2.01-.13 2.77l-1.3 1.31a2.05 2.05 0 01-2.93 0l-1.3-1.3a2.07 2.07 0 010-2.93l1.3-1.32a2.11 2.11 0 012.77-.12L5.61 8.79a.56.56 0 00-.64.12l-1.3 1.3a.57.57 0 000 .81l1.3 1.31c.22.21.6.21.8 0l1.31-1.3z",fill:"currentColor"});t.default=function(e){return o.createElement("svg",i({width:16,height:16,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},,function(e,t,n){"use strict";var r=n(2757);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";t.a=function(e){var t,n;return n=t=function(t){function n(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(t=function(e,t){if(t&&("object"===E(t)||"function"==typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,(e=w(n)).call.apply(e,[this].concat(o)))).state={cancelButtonHovered:!1},t.cancelButtonRef=s.a.createRef(),t.onCloseClicked=function(e){if(e.preventDefault(),e.stopPropagation(),t.isUploading){var n=t.props.onCancelLoading;n&&n()}else{var r=t.props.onClose;r&&r()}},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(n,t),function(e,t,n){t&&C(e.prototype,t);n&&C(e,n)}(n,[{key:"renderCloseButton",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"qa-Compose-Attachment-CloseButton";return k(f.Button,{onClick:this.onCloseClicked,pin:"circle-circle",view:"raised",className:u()(_.a.close,e),"aria-label":Object(h.default)("compose-react/deleteLabel")},void 0,k(b.default,{cls:_.a.closeIcon,id:"mail--Compose-Cross"}))}},{key:"renderCancelButton",value:function(){return k(p.TooltipStateful,{view:"default",state:"warning",size:"s",direction:"top",content:this.renderCancelButtonTooltip()},void 0,this.renderCloseButton("qa-Compose-Attachment-CancelButton"))}},{key:"maybeRenderSize",value:function(){var e=this.props.size;return e?k("span",{className:_.a.tooltipSize},void 0,k(m.HumanFileSize,{bytes:e})):null}},{key:"maybeRenderProgress",value:function(){var e=this.props,t=e.status,n=e.progress;return t===v.c.COMPLETED?null:k(g.Progress,{className:_.a.progress,progress:n})}},{key:"render",value:function(){var t,n=this.props,r=n.previewSrc,o=n.sourceHref,i=n.status,a=n.onPreviewClick,c=n.sourceType,l=Boolean(r),f=c!==v.d.YADISK&&!l,d=u()(_.a.wrap,"qa-Compose-Attachment",(P(t={},"qa-Compose-Attachment-loading",i===v.c.UPLOADING),P(t,"qa-Compose-Attachment-new",i!==v.c.COMPLETED),t));return k(p.TooltipStateful,{view:"default",state:"warning",size:"s",direction:"top",content:this.renderContainerTooltip()},void 0,k("a",{className:d,onClick:a,download:f,href:o,target:"_blank",rel:"noopener noreferrer"},void 0,s.a.createElement(e,S({},this.props,{transparent:this.isUploading})),this.isUploading?this.renderCancelButton():this.renderCloseButton(),this.maybeRenderProgress()))}},{key:"renderContainerTooltip",value:function(){var e=this.props.name;return k("div",{className:_.a.tooltip},void 0,k(d.Text,{color:"inverse",typography:"body-long-m"},void 0,e,this.maybeRenderSize()),this.isDisk&&k(d.Text,{color:"secondary",typography:"body-long-m",className:_.a.tooltipDisk},void 0,A))}},{key:"renderCancelButtonTooltip",value:function(){return R}},{key:"isUploading",get:function(){return this.props.status===v.c.NEW||this.props.status===v.c.UPLOADING}},{key:"isDisk",get:function(){return this.props.sourceType===v.d.YADISK}}]),n}(s.a.Component),t.propTypes={status:i.a.oneOf(Object(l.values)(v.c)),progress:i.a.number,onClose:i.a.func,onCancelLoading:i.a.func,previewSrc:i.a.string,size:i.a.number,name:i.a.string,sourceHref:i.a.string,onPreviewClick:i.a.func,sourceType:i.a.oneOf(Object(l.values)(v.d))},n};var r,o=n(338),i=n.n(o),a=n(135),s=n.n(a),c=n(339),u=n.n(c),l=n(136),p=(n.n(l),n(142)),f=(n.n(p),n(140)),d=(n.n(f),n(138)),y=(n.n(d),n(344)),b=n(360),m=n(482),h=(n.n(m),n(353)),v=n(357),g=n(1481),O=(n.n(g),n(2758)),_=n.n(O);function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function E(e){"@babel/helpers - typeof";return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var A=k(y.default,{loc:"compose-react/attachmentsDiskTooltip"}),R=k(y.default,{loc:"compose-react/Attachments_CancelLoading_Tooltip"})},function(e,t){e.exports={close:"withControls__close--3dGMt",closeIcon:"withControls__closeIcon--3-6W0",wrap:"withControls__wrap--ll0S5",progress:"withControls__progress--2-wKp",tooltip:"withControls__tooltip--BNOLo",tooltipDisk:"withControls__tooltipDisk--1KQxK",tooltipSize:"withControls__tooltipSize--3hHjg"}},function(e,t){e.exports={progress:"Attachments__progress--hHexK",body:"Attachments__body--UhETx",item:"Attachments__item--1av-z",item_collapsed:"Attachments__item_collapsed--1oFMG",wrap:"Attachments__wrap--8z8BG"}},function(e,t,n){"use strict";var r=n(420),o=n(2761),i=n(2830);t.a=Object(r.a)(i.a,o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return N});var r,o,i,a,s,c,u,l,p=n(135),f=n.n(p),d=n(339),y=n.n(d),b=n(136),m=(n.n(b),n(341)),h=n(342),v=n(394),g=n.n(v),O=n(458),_=n(801),S=n(1109),E=n(1483),P=n(2821),C=n(1113),w=n(2824),T=n(2829);n.n(T);function k(e){"@babel/helpers - typeof";return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,n,r){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function D(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function L(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var N=Object(h.inject)("controllers")(r=Object(h.observer)((u=c=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=function(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?j(e):t}(this,(e=R(t)).call.apply(e,[this].concat(o)))).innerRef=f.a.createRef(),n.leftPartRef=f.a.createRef(),n.sendButtonRef=f.a.createRef(),n.mainPartRef=f.a.createRef(),n.disposer=new g.a,D(j(n),"maxVisibleButtonsCount",i,j(n)),D(j(n),"closeCompose",a,j(n)),D(j(n),"updateVisibleButtons",s,j(n)),n.renderExtraButton=function(e){var t=E.a[e],n=t.Button,r=t.buttonCls;return I(n,{cls:y()(_.a.Button,r),isMobile:!0},e)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,f.a.Component),function(e,t,n){t&&A(e.prototype,t),n&&A(e,n)}(t,[{key:"getFullWidth",value:function(e){return e?e.offsetWidth+parseInt(window.getComputedStyle(e).marginRight,10):0}},{key:"componentDidMount",value:function(){var e=Object(b.throttle)(this.updateVisibleButtons,50);this.disposer.add(this,[Object(v.addEventListener)({eventName:"resize",listener:e})]),this.updateVisibleButtons()}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"render",value:function(){var e=y()(_.a.Block,"".concat(_.a.Block,"_mobile"),this.props.cls);return f.a.createElement("div",{className:e,ref:this.innerRef},f.a.createElement("div",{className:_.a.Part,ref:this.leftPartRef},I(P.a,{cls:y()(_.a.CloseButton,_.a.Button),onClick:this.closeCompose})),f.a.createElement("div",{className:_.a.Part,ref:this.mainPartRef},this.hasOverflow&&this.renderOverflowButton(),this.visibleExtraButtons.map(this.renderExtraButton),I(C.a,{innerRef:this.sendButtonRef,cls:y()(_.a.SendButton,_.a.Button)})))}},{key:"renderOverflowButton",value:function(){return I(w.a,{cls:_.a.Button,contentOptions:{buttons:this.hiddenExtraButtons}})}},{key:"panelWidth",get:function(){return this.innerRef.current?this.innerRef.current.clientWidth:0}},{key:"sendButtonWidth",get:function(){return this.getFullWidth(this.sendButtonRef.current)}},{key:"leftPartWidth",get:function(){return this.getFullWidth(this.leftPartRef.current)}},{key:"iconButtonWidth",get:function(){var e=this.mainPartRef.current,t=e&&e.querySelector(".".concat(_.a.Button));return this.getFullWidth(t)}},{key:"visibleExtraButtons",get:function(){return this.hasOverflow?this.maxVisibleButtonsCount<=1?[]:t.extraButtons.slice(1-this.maxVisibleButtonsCount):t.extraButtons}},{key:"hiddenExtraButtons",get:function(){return this.hasOverflow?this.maxVisibleButtonsCount<=1?t.extraButtons:t.extraButtons.slice(0,t.extraButtons.length-this.maxVisibleButtonsCount+1):[]}},{key:"hasOverflow",get:function(){return this.maxVisibleButtonsCount<t.extraButtons.length}}]),t}(),c.propTypes=S.b,c.extraButtons=[O.a.LABELS,O.a.DELAYED_SENDING,O.a.NOTIFICATIONS,O.a.ATTACHMENTS],i=L((o=u).prototype,"maxVisibleButtonsCount",[m.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return N.extraButtons.length}}),a=L(o.prototype,"closeCompose",[m.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.controllers.compose.closeCompose()}}}),s=L(o.prototype,"updateVisibleButtons",[m.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=e.panelWidth-e.leftPartWidth-e.sendButtonWidth,n=t>0?Math.floor(t/e.iconButtonWidth):0;n!==e.maxVisibleButtonsCount&&(e.maxVisibleButtonsCount=n)}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r,o=n(135),i=(n.n(o),n(339)),a=n.n(i),s=n(338),c=n.n(s),u=n(360),l=n(427),p=n(461),f=n(2768);n.n(f);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var m={Block:"ComposeAttachFileButton",Popup:"".concat("ComposeAttachFileButton","-Popup")},h=function(e){var t=e.isMobile?"mail--Compose-Clip":"mail--Compose-Clip_new";return b(l.a,{innerRef:e.innerRef,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,className:a()(m.Block,e.cls),iconComponent:b(u.default,{id:t,ariaHidden:!0}),upload:e.upload,focused:e.focused})};t.b=h,h.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},p.a,{focused:c.a.bool})},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var r=n(135),o=n.n(r),i=n(339),a=n.n(i),s=n(338),c=n.n(s),u=n(393),l=n(2764);n.n(l);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function f(e){"@babel/helpers - typeof";return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g="ComposeControlPanelButton",O={Block:g,Button:"".concat(g,"-Button"),Button_action:"".concat(g,"-Button_action"),Button_icon:"".concat(g,"-Button_icon"),Block_sidePadding:"".concat(g,"-Button_sidePadding"),Button_clear:"".concat(g,"-Button_clear"),Block_notification:"".concat(g,"_notification"),Button_upload:"".concat(g,"-Button_upload")},_=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,h(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,o.a.PureComponent),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"render",value:function(){var e,t=this.props,n=t.className,r=t.isAction,i=t.isClear,s=t.hasNotification,c=t.innerRef,l=t.iconComponent,f=t.children,b=t.upload,m=y(t,["className","isAction","isClear","hasNotification","innerRef","iconComponent","children","upload"]),h=a()(O.Block,d({},O.Block_notification,s),n),v=a()(O.Button,(d(e={},O.Button_action,r),d(e,O.Button_icon,Boolean(l)),d(e,O.Button_clear,i),d(e,O.Block_sidePadding,Boolean(f)),d(e,O.Button_upload,Boolean(b)),e)),g=o.a.createElement(o.a.Fragment,null,l,f);return o.a.createElement("div",{className:h,ref:c},o.a.createElement(u.a,p({cls:v,theme:r?"action":"normal",tone:"default",size:"l",pin:"circle-circle",view:"default"},m),g,b&&b()))}}]),t}();_.propTypes={className:c.a.string,isAction:c.a.bool,isClear:c.a.bool,hasNotification:c.a.bool,innerRef:c.a.oneOfType([c.a.object,c.a.func]),iconComponent:c.a.element,upload:c.a.func},_.defaultProps={isAction:!1}},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControlPanelButton=void 0;var r=n(2766);Object.defineProperty(t,"ControlPanelButton",{enumerable:!0,get:function(){return r.ControlPanelButton}})},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ControlPanelButton=void 0;var s=a(n(135)),c=a(n(339)),u=n(140),l=a(n(2767)),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e,t,n=this.props,r=n.className,a=n.hasNotification,p=n.innerRef,f=n.iconComponent,d=n.upload,y=(n.isAction,n.focused),b=i(n,["className","hasNotification","innerRef","iconComponent","upload","isAction","focused"]),m=Boolean(f),h=c.default(l.default.root,"qa-Compose-ControlPanelButton",((e={})[l.default.notification]=a,e["qa-Compose-ControlPanelButton-notification"]=a,e),r),v=m&&!b.children,g=Boolean(d),O=v?function(e){var t;return s.default.createElement("span",{className:c.default(e,l.default.icon,(t={},t[l.default.withUpload]=g,t))},f,d&&d())}:void 0,_=m&&!v?function(e){return s.default.createElement("span",{className:c.default(e,l.default.icon,l.default.icon_withText)},f)}:void 0;return s.default.createElement("div",{className:h,ref:p},s.default.createElement(u.Button,o({className:c.default((t={},t[l.default.focused]=y,t)),view:"clear",size:"l",icon:O,iconLeft:_,as:g?"span":"button"},b)))},t}(s.default.PureComponent);t.ControlPanelButton=p},function(e,t){e.exports={icon:"new__icon--1nFOX",withUpload:"new__withUpload--9cWEz",icon_withText:"new__icon_withText--1O4BW",root:"new__root--3qgLa",notification:"new__notification--2BKKY",focused:"new__focused--3GmWj"}},function(e,t){},function(e,t,n){"use strict";var r=n(420),o=n(2770),i=n(2773);t.a=Object(r.a)(o.a,i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r,o=n(135),i=n.n(o),a=n(1484),s=n(1485),c=n(1111),u=n(2772);n.n(u);function l(e){"@babel/helpers - typeof";return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,d(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(t,[{key:"render",value:function(){return function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(a.a,{cls:"ComposeAttachmentSourcesDesktop",onSelectSource:this.props.onAction,sources:this.sources})}},{key:"sources",get:function(){return[{type:c.a.LOCAL,icon:"mail--Compose-AttachLocal",loc:"compose-react/Attachments_Add_Local"},{type:c.a.DISK,icon:"mail--Compose-AttachDisk",loc:"compose-react/Attachments_Add_Disk"},{type:c.a.MAIL,icon:"mail--Compose-AttachMail",loc:"compose-react/Attachments_Add_Mail"}]}}]),t}();b.propTypes=s.a},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return k});var r,o,i,a,s=n(135),c=n.n(s),u=n(342),l=n(1485),p=n(344),f=n(1484),d=n(1111),y=n(427),b=n(356),m=n(2774);n.n(m);function h(e){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,n,r){a||(a="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var s=new Array(i),c=0;c<i;c++)s[c]=arguments[c+3];t.children=s}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:a,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var C="ComposeAttachmentSourcesMobile",w={Block:C,Menu:"".concat(C,"-Menu"),Footer:"".concat(C,"-Footer"),Button:"".concat(C,"-Button"),ButtonText:"".concat(C,"-ButtonText")},T=P(p.default,{loc:"compose-react/AttachmentsPopup_ActionText"}),k=Object(u.inject)("services")(r=Object(u.observer)((i=o=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),_(this,S(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,c.a.PureComponent),function(e,t,n){t&&O(e.prototype,t),n&&O(e,n)}(t,[{key:"render",value:function(){return P("div",{className:w.Block},void 0,P(f.a,{cls:w.Menu,onSelectSource:this.props.onAction,sources:this.sources}),P("div",{className:w.Footer},void 0,P(y.a,{className:w.Button,onClick:this.props.onAction},void 0,P("div",{className:w.ButtonText},void 0,T))))}},{key:"sources",get:function(){var e=this.props.services;return[{type:d.a.LOCAL,icon:"mail--Compose-Clip",loc:e.settings.isTablet?"compose-react/Attachments_Add_Tablet":"compose-react/Attachments_Add_Phone"},{type:d.a.DISK,icon:"mail--Compose-AttachDisk",loc:"compose-react/Attachments_Add_Disk"},{type:d.a.MAIL,icon:"mail--Compose-AttachMail",loc:"compose-react/Attachments_Add_Mail"}]}}]),t}(),o.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach(function(t){g(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},l.a,{services:b.a.isRequired}),r=i))||r)||r},function(e,t){},function(e,t,n){"use strict";var r=n(135),o=n.n(r),i=n(802);function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}t.a=function(e){return o.a.createElement(i.a,a({icon:"mail--Compose-Clip",loc:"compose-react/AttachmentsPopup_Title"},e))}},function(e,t){},function(e,t,n){"use strict";var r=n(2778);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return C});var r,o=n(135),i=n.n(o),a=n(139),s=n.n(a),c=n(338),u=n.n(c),l=n(339),p=n.n(l),f=n(2779),d=n(2780),y=n(2782),b=n(2783);n.n(b);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var P={Block:"ComposeMobilePopup",Content:"".concat("ComposeMobilePopup","-Content")},C=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=O(this,(e=_(t)).call.apply(e,[this].concat(o)))).contentRef=i.a.createRef(),n.onClick=function(e){if(!n.contentRef.current||!n.contentRef.current.contains(e.target)){var t=n.props.onClose;t&&t(e)}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&g(e.prototype,t),n&&g(e,n)}(t,[{key:"render",value:function(){var e="function"==typeof this.props.scope?this.props.scope():this.props.scope;e&&void 0!==e.current&&(e=e.current),e||(e=document.body);var t=p()(this.props.cls,P.Block,"".concat(P.Block,"_").concat(this.props.type),v({},"".concat(P.Block,"_hidden"),!this.props.visible)),n=this.props.onClose,r="top"===this.props.type?y.a:d.a;return s.a.createPortal(E("div",{className:t,onClick:this.onClick},void 0,E(r,{cls:P.Content,innerRef:this.contentRef,onClose:n,title:this.props.title},void 0,this.props.children)),e)}}]),t}();C.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){v(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},f.a,{title:u.a.string,type:u.a.oneOf(["top","bottom"])}),C.defaultProps={type:"bottom"}},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a={anchor:o.a.object,scope:o.a.oneOfType([o.a.object,o.a.func]),className:o.a.string,onClose:o.a.func,visible:o.a.bool}},function(e,t,n){"use strict";n.d(t,"a",function(){return S});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(360),p=n(502),f=n(2781);n.n(f);function d(e){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var g="ComposeBottomPopup",O={Block:g,Header:"".concat(g,"-Header"),Title:"".concat(g,"-Title"),Close:"".concat(g,"-Close"),Separator:"".concat(g,"-Separator")},_=v(l.default,{id:"mail--Compose-Close-Mobile"}),S=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),b(this,m(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&y(e.prototype,t),n&&y(e,n)}(t,[{key:"render",value:function(){return i.a.createElement("div",{className:u()(O.Block,this.props.cls),ref:this.props.innerRef},v("div",{className:O.Header},void 0,v("span",{className:O.Title},void 0,this.props.title),v(p.a,{cls:O.Close,onClick:this.props.onClose,view:"default",tone:"default",theme:"clear"},void 0,_)),v("div",{className:O.Separator}),this.props.children)}}]),t}();S.propTypes={cls:s.a.string,innerRef:s.a.object,onClose:s.a.func,title:s.a.string}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r=n(135),o=n.n(r),i=n(338),a=n.n(i),s=n(339),c=n.n(s);function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var y="ComposeTopPopup",b=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,f(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,o.a.PureComponent),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(t,[{key:"render",value:function(){return o.a.createElement("div",{className:c()(y,this.props.cls),ref:this.props.innerRef},this.props.children)}}]),t}();b.propTypes={cls:a.a.string,innerRef:a.a.object}},function(e,t){},function(e,t,n){"use strict";t.a=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).label,n=function(n){function r(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);for(var o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];return(n=function(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,(e=b(r)).call.apply(e,[this].concat(i)))).state={focused:!1},n.onClick=function(e){var t=n.props,r=t.onClick,o=t.onFileInputClick;n.props.isUploadDisabled?r&&r(e):o&&o(e)},n.onChangeFile=function(e){e.stopPropagation(),e.preventDefault();var t=Array.from(e.target.files);n.props.onChangeFiles&&n.props.onChangeFiles(t),e.target.value=null},n.onFocus=function(){n.setState({focused:!0})},n.onBlur=function(){n.setState({focused:!1})},n.renderUpload=function(e){return h("div",{className:u()(v.Block,e)},void 0,h("input",{className:u()(v.FileInput,"qa-Compose-FileInput2"),type:"file",multiple:!0,onChange:n.onChangeFile,"aria-label":Object(l.default)(t),onFocus:n.onFocus,onBlur:n.onBlur}))},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(r,n),function(e,t,n){t&&y(e.prototype,t);n&&y(e,n)}(r,[{key:"render",value:function(){var t=this.props,n=t.forwardedRef,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,["forwardedRef"]);return i.a.createElement(e,f({ref:n},r,{onClick:this.onClick,upload:this.props.isUploadDisabled?null:this.renderUpload,focused:this.state.focused}))}}]),r}(i.a.Component);function r(e,t){return i.a.createElement(n,f({},e,{forwardedRef:t}))}n.propTypes={forwardedRef:s.a.object,onClick:s.a.func,isUploadDisabled:s.a.bool,onFileInputClick:s.a.func,onChangeFiles:s.a.func};var o=e.displayName||e.name;return r.displayName=o?"withUpload(".concat(o,")"):"withUpload",i.a.forwardRef(r)};var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(353),p=n(2785);n.n(p);function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function d(e){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var v={Block:"WithUpload",FileInput:"".concat("WithUpload","-FileInput")}},function(e,t){},function(e,t,n){"use strict";t.a=function(e){var t,n,r,i,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shouldCheckUploadDisabled:!0},g=Object(c.inject)("controllers","services")(t=Object(c.observer)((h((i=r=function(t){function n(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(t=function(e,t){if(t&&("object"===d(t)||"function"==typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,(e=b(n)).call.apply(e,[this].concat(o)))).onAttachLocal=function(){t.metrikaService.sendFooterMetrika(p.COMPOSE_METRIKA_FOOTER_ATTACH_LOCAL)},t.onChangeFiles=function(e){t.props.controllers.attachments.attachFilesFromLocal(e),setTimeout(function(){return t.props.controllers.compose.focusAttachments()},100)},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(n,t),function(e,t,n){t&&y(e.prototype,t);n&&y(e,n)}(n,[{key:"render",value:function(){var t=this.props,n=t.forwardedRef,r=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,["forwardedRef"]);return o.a.createElement(e,f({ref:n,isUploadDisabled:this.isUploadDisabled,onFileInputClick:this.onAttachLocal,onChangeFiles:this.onChangeFiles},r))}},{key:"isUploadDisabled",get:function(){return v.shouldCheckUploadDisabled&&this.props.services.attachments.hasDisk}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),n}(o.a.Component),r.propTypes={controllers:u.a.isRequired,forwardedRef:a.a.object,services:l.a.isRequired},n=i).prototype,"isUploadDisabled",[s.computed],Object.getOwnPropertyDescriptor(n.prototype,"isUploadDisabled"),n.prototype),h(n.prototype,"metrikaService",[s.computed],Object.getOwnPropertyDescriptor(n.prototype,"metrikaService"),n.prototype),t=n))||t)||t;function O(e,t){return o.a.createElement(g,f({},e,{forwardedRef:t}))}var _=e.displayName||e.name;return O.displayName=_?"withUploadAdapter(".concat(_,")"):"withUploadAdapter",o.a.forwardRef(O)};var r=n(135),o=n.n(r),i=n(338),a=n.n(i),s=n(341),c=n(342),u=n(361),l=n(356),p=n(354);n.n(p);function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function d(e){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}},function(e,t,n){"use strict";n.d(t,"a",function(){return R}),n.d(t,"b",function(){return j});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(339),p=n.n(l),f=n(341),d=n(342),y=n(363),b=n(461),m=n(511),h=n(458),v=n(353),g=n(427),O=n(415),_=n(2788);n.n(_);function S(e){"@babel/helpers - typeof";return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var R={Block:"ComposeDelayedSendingButton",Popup:"".concat("ComposeDelayedSendingButton","-Popup")},j=Object(d.inject)("data","services","visual")(r=Object(d.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),w(this,T(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,u.a.Component),function(e,t,n){t&&C(e.prototype,t),n&&C(e,n)}(t,[{key:"render",value:function(){var e=this.props.isMobile?"mail--Compose-DelayedSending":"mail--Compose-DelayedSending_new";return A(g.a,{innerRef:this.props.innerRef,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:this.props.onClick,className:p()(R.Block,this.props.cls),hasNotification:this.hasNotification,iconComponent:A(O.a,{id:e}),"aria-label":Object(v.default)("compose-react/ControlPanel_DelayedSending_Tooltip")})}},{key:"hasNotification",get:function(){return m.a[h.a.DELAYED_SENDING]({data:this.props.data})}}]),t}(),i.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},b.a,{data:y.a.isRequired}),function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"hasNotification",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasNotification"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return N});var r,o,i,a,s,c,u,l,p,f,d,y,b=n(135),m=n.n(b),h=n(338),v=n.n(h),g=n(343),O=n.n(g),_=n(341),S=n(342),E=n(2790),P=n(2796),C=n(363),w=n(356),T=n(366),k=n(354);n.n(k);function A(e){"@babel/helpers - typeof";return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function L(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var N=Object(S.inject)("data","services","visual")(r=Object(S.observer)((d=f=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),f=0;f<r;f++)o[f]=arguments[f];return(n=function(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?M(e):t}(this,(e=j(t)).call.apply(e,[this].concat(o)))).datetimePickerRef=m.a.createRef(),D(M(n),"customDateContainerRef",i,M(n)),D(M(n),"isDateTimePickerVisible",a,M(n)),D(M(n),"setCustomDateContainerRef",s,M(n)),D(M(n),"showDateTimePicker",c,M(n)),D(M(n),"onSelectCustomDate",u,M(n)),D(M(n),"closeDatetimePicker",l,M(n)),D(M(n),"onClearCustomDate",p,M(n)),n.onCancelSelectCustomDate=function(){n.closeDatetimePicker(),n.metrikaService.sendFooterMetrika(k.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING,k.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CANCEL_CUSTOM_DATETIME)},n.getInitialDate=function(){var e=n.props.services.date.passportNow;return n.sendTime?O()(n.sendTime):O()(e).add(30,"minutes")},n.getMaxDate=function(){var e=n.props.services.date.passportNow;return O()(e).add(1,"year")},n.getMinDate=function(){var e=n.props.services.date.passportNow;return O()(e).add(5,"minutes")},n.clampDate=function(e){var t=n.props.services.date.passportNow;e=O()(e);var r=O()(t).add(1,"minutes"),o=n.getMaxDate();return o&&e>o&&(e=o),r&&e<r&&(e=r),e.toDate()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,m.a.Component),function(e,t,n){t&&R(e.prototype,t),n&&R(e,n)}(t,[{key:"render",value:function(){return m.a.createElement(m.a.Fragment,null,this.renderDelayedSendingOptions(),this.renderDateTimePicker())}},{key:"renderDelayedSendingOptions",value:function(){return function(e,t,n,r){y||(y="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:y,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(E.a,{onSelectDate:this.props.onAction,onClear:this.props.onAction,onDateTimePickerClick:this.showDateTimePicker,onChange:this.props.onChange,customDateContainer:this.setCustomDateContainerRef})}},{key:"renderDateTimePicker",value:function(){var e=this.isMobile?this.customDateContainerRef:this.props.anchor;return m.a.createElement(P.a,{ref:this.datetimePickerRef,anchor:e,scope:this.props.scope,visible:this.isDateTimePickerVisible,onSelectDate:this.onSelectCustomDate,onCancelSelectDate:this.onCancelSelectCustomDate,onClose:this.closeDatetimePicker,getInitialDate:this.getInitialDate,getMaxDate:this.getMaxDate,getMinDate:this.getMinDate,onClearDate:this.onClearCustomDate,onToggle:this.showDateTimePicker})}},{key:"sendTime",get:function(){return this.props.data.sendTime}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}}]),t}(),f.propTypes={onChange:v.a.func,onAction:v.a.func,anchor:v.a.object,scope:v.a.object,data:C.a.isRequired,services:w.a.isRequired,visual:T.a.isRequired},i=L((o=d).prototype,"customDateContainerRef",[_.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a=L(o.prototype,"isDateTimePickerVisible",[_.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L(o.prototype,"sendTime",[_.computed],Object.getOwnPropertyDescriptor(o.prototype,"sendTime"),o.prototype),L(o.prototype,"metrikaService",[_.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),L(o.prototype,"isMobile",[_.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),s=L(o.prototype,"setCustomDateContainerRef",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.customDateContainerRef=t}}}),c=L(o.prototype,"showDateTimePicker",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isDateTimePickerVisible=!e.isDateTimePickerVisible,e.isDateTimePickerVisible&&e.metrikaService.sendFooterMetrika(k.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING,k.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CUSTOM_DATETIME)}}}),u=L(o.prototype,"onSelectCustomDate",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.data.sendTime=e.clampDate(t),e.metrikaService.sendFooterMetrika(k.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING,k.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_SELECT_CUSTOM_DATETIME)}}}),l=L(o.prototype,"closeDatetimePicker",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isDateTimePickerVisible=!1}}}),p=L(o.prototype,"onClearCustomDate",[_.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.data.sendTime=null,e.closeDatetimePicker()}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return z});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(338),d=n.n(f),y=n(343),b=n.n(y),m=n(339),h=n.n(m),v=n(342),g=n(341),O=n(1487),_=n(344),S=n(1112),E=n(356),P=n(363),C=n(354),w=(n.n(C),n(138)),T=(n.n(w),n(2795)),k=n.n(T);function A(e){"@babel/helpers - typeof";return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function L(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function N(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var x="DelayedSendingOptions",B={Block:x,Presets:"".concat(x,"-Presets"),Separator:"".concat(x,"-Separator"),Item:"".concat(x,"-Item"),Item_selected:"".concat(x,"-Item_selected"),Label:"".concat(x,"-Label"),ClearControl:"".concat(x,"-ClearControl"),CustomDate:"".concat(x,"-CustomDate"),SelectedDate:"".concat(x,"-SelectedDate")},F=D(_.default,{loc:"compose-react/DelayedSending_Clear"}),z=Object(v.inject)("data","services")(r=Object(v.observer)((c=s=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return L(M(n=function(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?M(e):t}(this,(e=j(t)).call.apply(e,[this].concat(o)))),"onSelectDate",i,M(n)),L(M(n),"onClearDate",a,M(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,p.a.PureComponent),function(e,t,n){t&&R(e.prototype,t),n&&R(e,n)}(t,[{key:"render",value:function(){var e=this,t=Boolean(this.sendTime);return this.options=Object(S.b)(function(){return e.props.services.date.passportNow}),D("div",{className:h()(B.Block,k.a.root)},void 0,D(O.a,{cls:B.Presets,selectedDate:this.sendTime,onSelect:this.onSelectDate,options:this.options}),D("div",{className:h()(B.Separator,k.a.separator)}),this.renderDateTimePickerControl(),t&&this.renderClearControl())}},{key:"renderDateTimePickerControl",value:function(){var e=this.sendTime&&this.sendTime.valueOf(),t=this.options.find(function(t){return t.value.valueOf()===e}),n=e&&!t,r=n&&b()(e).format("DD.MM.YYYY HH:mm");return p.a.createElement("div",{ref:this.props.customDateContainer,className:h()(k.a.item,B.Item,B.CustomDate,k.a.customDate,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},"".concat(B.Item_selected," ").concat(k.a.selected),n)),onClick:this.props.onDateTimePickerClick},D(w.Text,{weight:n?"medium":"regular",typography:"body-long-m",className:h()(B.Label,k.a.label)},void 0,D(_.default,{tag:p.a.Fragment,loc:"compose-react/DelayedSending_SelectDateTime"})),n&&D(w.Text,{color:"secondary",className:h()(B.SelectedDate,k.a.selectedDate)},void 0,r))}},{key:"renderClearControl",value:function(){return D(w.Text,{typography:"body-long-m",className:h()(k.a.item,B.Item,B.ClearControl),onClick:this.onClearDate},void 0,F)}},{key:"componentDidUpdate",value:function(){this.props.onChange&&this.props.onChange()}},{key:"sendTime",get:function(){return this.props.data.sendTime}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),t}(),s.propTypes={onSelectDate:d.a.func,onClear:d.a.func,onDateTimePickerClick:d.a.func,onChange:d.a.func,customDateContainer:d.a.oneOfType([d.a.object,d.a.func]),data:P.a.isRequired,services:E.a.isRequired},N((o=c).prototype,"sendTime",[g.computed],Object.getOwnPropertyDescriptor(o.prototype,"sendTime"),o.prototype),N(o.prototype,"metrikaService",[g.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),i=N(o.prototype,"onSelectDate",[g.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.date,r=t.preset;e.props.data.sendTime=n,e.props.onSelectDate&&e.props.onSelectDate(n),e.metrikaService.sendFooterMetrika(C.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING,C.TIME_PRESETS_METRIKA[r])}}}),a=N(o.prototype,"onClearDate",[g.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.data.sendTime=null,e.props.onClear&&e.props.onClear(),e.metrikaService.sendFooterMetrika(C.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING,C.COMPOSE_METRIKA_FOOTER_DELAYED_SENDING_CLEAR)}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return T});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(343),p=n.n(l),f=n(2792),d=n(344),y=n(355),b=(n.n(y),n(353)),m=n(138),h=(n.n(m),n(2793)),v=n.n(h);function g(e){"@babel/helpers - typeof";return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var C="ComposeTimeOptions",w={Block:"".concat(C),Item:"".concat(C,"-Item"),Item_selected:"".concat(C,"-Item_selected"),Label:"".concat(C,"-Label"),Date:"".concat(C,"-Date"),WeekDay:"".concat(C,"-WeekDay"),Time:"".concat(C,"-Time")},T=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),_(this,S(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&O(e.prototype,t),n&&O(e,n)}(t,[{key:"render",value:function(){var e=this;return P("div",{className:u()(w.Block,this.props.cls)},void 0,this.props.options.map(function(t){return e.renderItem(t)}))}},{key:"renderItem",value:function(e){var t=this,n=e.value,r=e.loc,o=e.preset,i=this.props.selectedDate&&this.props.selectedDate.valueOf()===n.valueOf(),a=o!==y.TimePresets.TODAY,s=i?"medium":"regular";return P("div",{className:u()(v.a.item,w.Item,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},"".concat(v.a.selected," ").concat(w.Item_selected),i)),onClick:function(){return t.props.onSelect&&t.props.onSelect({date:n.toDate(),preset:o})}},(n=p()(n)).valueOf(),P(m.Text,{weight:s,typography:"body-long-m",className:u()(v.a.label,w.Label)},void 0,P(d.default,{loc:r})),P(m.Text,{weight:s,typography:"body-long-m",color:"secondary",className:u()(v.a.date,w.Date)},void 0,a&&P("div",{className:u()(v.a.weekday,w.WeekDay)},void 0,n.format("dd"),", "),P("div",{className:w.Time},void 0,n.format(Object(b.default)("compose-react/TimeOptions_TimeFormat")))))}}]),t}();T.propTypes={cls:s.a.string,selectedDate:s.a.instanceOf(Date),onSelect:s.a.func,options:s.a.arrayOf(f.a)}},function(e,t,n){"use strict";var r=n(338),o=n.n(r),i=n(355);n.n(i);t.a=o.a.shape({value:o.a.instanceOf(Date),loc:o.a.string,preset:o.a.oneOf(_.values(i.TimePresets))})},function(e,t){e.exports={variables:'"../../../variables.m.css"',footerItemHeight:"36px",footerItemPadding:"0 var(--space-m)",footerItemBackground:"var(--color-mg-tint-superlight)",item:"TimeOptions__item--3OiIx",selected:"TimeOptions__selected--2SuEM",label:"TimeOptions__label--1O0ZA",date:"TimeOptions__date--ZXdmH",weekday:"TimeOptions__weekday--1od8d"}},function(e,t,n){"use strict";var r,o=n(355),i=(n.n(o),n(343)),a=n.n(i);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=(s(r={},o.TimePresets.TODAY,function(e,t){var n=a()(e).startOf("day").add(t[o.TimePresets.TODAY],"hour");if(e<n)return{value:n.toDate(),loc:"compose-react/TimeOptions_Today",preset:o.TimePresets.TODAY}}),s(r,o.TimePresets.TOMORROW,function(e,t){return{value:a()(e).startOf("day").add(1,"day").add(t[o.TimePresets.TOMORROW],"hour").toDate(),loc:"compose-react/TimeOptions_Tomorrow",preset:o.TimePresets.TOMORROW}}),s(r,o.TimePresets.WEEKEND,function(e,t){var n=a()(e).startOf("day").day(6).add(t[o.TimePresets.WEEKEND],"hour");if(e.day()>0&&e.day()<6)return{value:n.toDate(),loc:"compose-react/TimeOptions_Weekend",preset:o.TimePresets.WEEKEND}}),s(r,o.TimePresets.NEXT_WEEK,function(e,t){return{value:a()(e).startOf("day").add(7,"day").add(t[o.TimePresets.NEXT_WEEK],"hour").toDate(),loc:"compose-react/TimeOptions_NextWeek",preset:o.TimePresets.NEXT_WEEK}}),r)},function(e,t){e.exports={variables:'"../../../../variables.m.css"',footerPopupPadding:"var(--space-xs) 0",footerSeparatorHeight:"1px",footerSeparatorColor:"var(--color-mg-stroke-default-base)",footerSeparatorMargin:"var(--space-2-xs) var(--space-s)",footerItemHeight:"36px",footerItemPadding:"0 var(--space-m)",footerItemBackground:"var(--color-mg-tint-superlight)",root:"DelayedSendingButton__root--1FOfg",separator:"DelayedSendingButton__separator--2Ev4f",item:"DelayedSendingButton__item--3LOzx",selected:"DelayedSendingButton__selected--2uo5B",label:"DelayedSendingButton__label--3IjW5",selectedDate:"DelayedSendingButton__selectedDate--3cqtw",customDate:"DelayedSendingButton__customDate--3CQD-"}},function(e,t,n){"use strict";var r=n(420),o=n(2797),i=n(2802);t.a=Object(r.a)(o.a,i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return R});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(341),d=n(342),y=n(544),b=n(2798),m=n(1489),h=n(363),v=n(356),g=n(366),O=n(349);n.n(O);function _(e){"@babel/helpers - typeof";return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function A(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var R=Object(d.inject)("data","services","visual")(r=Object(d.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=C(this,(e=w(t)).call.apply(e,[this].concat(o)))).popupRef=u.a.createRef(),n.boundaryRef=u.a.createRef(),n.popupDirections=["top"],n.onSelectDate=function(e){var t=n.props,r=t.onSelectDate,o=t.onClose;r&&r(e),o&&o()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,u.a.Component),function(e,t,n){t&&P(e.prototype,t),n&&P(e,n)}(t,[{key:"componentDidMount",value:function(){this.boundaryRef.current=!Object(O.hasFeature)(O.Features.REACT_LAYOUT)&&document.querySelector(".js-mail-App")?document.querySelector(".js-mail-App"):document.documentElement}},{key:"render",value:function(){return k(y.a,{scope:"inplace",innerRef:this.popupRef,anchor:this.props.anchor,visible:this.props.visible,direction:this.popupDirections,onClose:this.props.onClose,boundary:this.boundaryRef,hasTail:!0},void 0,this.renderContents())}},{key:"renderContents",value:function(){return k(b.a,{initialDate:this.props.getInitialDate(),onSelectDate:this.onSelectDate,onCancel:this.props.onCancelSelectDate,maxDate:this.props.getMaxDate(),minDate:this.props.getMinDate(),isVisible:this.props.visible})}},{key:"containerRef",get:function(){return this.props.visual.refs.composeContainer}},{key:"sendTime",get:function(){return this.props.data.sendTime}}]),t}(),i.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach(function(t){E(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},m.a,{scope:p.a.object,onClose:p.a.func,data:h.a.isRequired,services:v.a.isRequired,visual:g.a.isRequired}),A((o=a).prototype,"containerRef",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"containerRef"),o.prototype),A(o.prototype,"sendTime",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"sendTime"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return q});var r,o,i,a,s,c,u,l,p,f,d,y=n(135),b=n.n(y),m=n(338),h=n.n(m),v=n(343),g=n.n(v),O=n(341),_=n(342),S=n(339),E=n.n(S),P=n(502),C=n(140),w=(n.n(C),n(2799)),T=n(2800),k=n(544),A=n(344),R=n(138),j=(n.n(R),n(1085)),M=n.n(j),I=n(356),D=n(2801);n.n(D);function L(){return(L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function N(e){"@babel/helpers - typeof";return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e,t,n,r){d||(d="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:d,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function H(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function W(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var Y="ComposeDateTimePicker",G={Block:Y,Calendar:"".concat(Y,"-Calendar"),Controls:"".concat(Y,"-Controls"),Inputs:{Container:"".concat(Y,"-Inputs"),Input:"".concat(Y,"-Input"),Date:"".concat(Y,"-Input_date"),TimeInput:"".concat(Y,"-Input_time"),Title:"".concat(Y,"-InputTitle"),Field:"".concat(Y,"-InputField")},Buttons:{Container:"".concat(Y,"-Buttons"),Button:"".concat(Y,"-Button"),Save:"".concat(Y,"-Button_save"),Cancel:"".concat(Y,"-Button_cancel")},Picker:"DelayedDatePicker"},q=Object(_.inject)("services")(r=Object(_.observer)((f=p=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),p=0;p<r;p++)o[p]=arguments[p];return H(z(n=function(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?z(e):t}(this,(e=F(t)).call.apply(e,[this].concat(o)))),"selectedDate",i,z(n)),H(z(n),"isTimePickerPopupVisible",a,z(n)),n.inputesRef=b.a.createRef(),n.direction=["right-end"],H(z(n),"onChangeSelectedDate",s,z(n)),H(z(n),"toggleTimerPopupVisibility",c,z(n)),H(z(n),"setTimerPopupVisibility",u,z(n)),H(z(n),"onSelectDateFromCalendar",l,z(n)),n.now=function(){return n.props.services.date.passportNow},n.onTimeSelect=function(e){n.onChangeSelectedDate(e),n.setTimerPopupVisibility(!1)},n.clampDate=function(e){var t=n.props,r=t.maxDate,o=t.services.date.passportNow,i=g()(o).add(1,"minutes");r&&e>r&&(e=g()(r)),i&&e<i&&(e=g()(i)),n.onChangeSelectedDate(e)},n.onOutsideClick=function(e){n.isTimePickerPopupVisible&&!n.inputesRef.current.contains(e.target)&&n.setTimerPopupVisibility(!1)},n.onSave=function(){var e=n.props.onSelectDate;e&&(n.clampDate(n.selectedDate),e(n.selectedDate.toDate()))},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(t,b.a.Component),function(e,t,n){t&&B(e.prototype,t),n&&B(e,n)}(t,[{key:"componentDidUpdate",value:function(e){this.props.isVisible!==e.isVisible&&this.onChangeSelectedDate(this.props.initialDate)}},{key:"render",value:function(){var e=M.a[this.props.services.settings.lang];return K("div",{className:G.Block},void 0,K("div",{className:G.Calendar},void 0,K(P.b,{locale:e,minDate:this.props.minDate,maxDate:this.props.maxDate,selected:this.selectedDate,onChange:this.onSelectDateFromCalendar,inline:!0})),K("div",{className:G.Controls},void 0,this.renderInputs(),this.renderButtons()))}},{key:"renderTimePickerPopup",value:function(){return K(k.a,{scope:"inplace",className:G.Picker,anchor:this.inputesRef,mainOffset:-70,secondaryOffset:-16,hasTail:!1,onClose:this.onOutsideClick,visible:this.isTimePickerPopupVisible,direction:this.direction},void 0,K(T.a,{date:this.selectedDate,maxDate:this.props.maxDate,onChange:this.onTimeSelect,now:this.now}))}},{key:"renderButton",value:function(e){var t=e.key,n=e.className,r=e.onClick,o=e.loc,i=x(e,["key","className","onClick","loc"]);return b.a.createElement(C.Button,L({key:t,className:E()(G.Buttons.Button,n),size:"m",width:"max",onClick:r,view:"default"},i),K(A.default,{loc:o}))}},{key:"renderButtons",value:function(){var e=this,t=[{key:"save",className:G.Buttons.Save,view:"action",onClick:this.onSave,loc:"compose-react/DatetimePicker_Confirm"},{key:"cancel",className:G.Buttons.Cancel,view:"default",onClick:this.props.onCancel,loc:"compose-react/DatetimePicker_Cancel"}];return K("div",{className:G.Buttons.Container},void 0,t.map(function(t){return e.renderButton(t)}))}},{key:"renderInput",value:function(e){var t=e.key,n=e.cls,r=e.loc,o=e.children,i=x(e,["key","cls","loc","children"]);return K("div",{className:E()(G.Inputs.Input,n)},t,K(R.Text,{typography:"body-long-m",color:"secondary",className:G.Inputs.Title},void 0,K(A.default,{loc:r})),b.a.createElement(w.a,L({date:this.selectedDate,cls:G.Inputs.Field,onChange:this.clampDate},i)),o)}},{key:"renderInputs",value:function(){var e=this,t=[{key:"date",cls:G.Inputs.Date,loc:"compose-react/DatetimePicker_Date",onClick:function(){return e.setTimerPopupVisibility(!1)}},{key:"time",cls:G.Inputs.TimeInput,loc:"compose-react/DatetimePicker_Time",format:"HH:mm",onInput:function(){return e.setTimerPopupVisibility(!1)},onClick:this.toggleTimerPopupVisibility,children:this.renderTimePickerPopup()}];return b.a.createElement("div",{ref:this.inputesRef,className:G.Inputs.Container},t.map(function(t){return e.renderInput(t)}))}}]),t}(),p.propTypes={initialDate:h.a.objectOf(g.a),maxDate:h.a.objectOf(g.a),minDate:h.a.objectOf(g.a),onCancel:h.a.func,onSelectDate:h.a.func,isVisible:h.a.bool,services:I.a.isRequired},i=W((o=f).prototype,"selectedDate",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.props.initialDate}}),a=W(o.prototype,"isTimePickerPopupVisible",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s=W(o.prototype,"onChangeSelectedDate",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){return e.selectedDate=t}}}),c=W(o.prototype,"toggleTimerPopupVisibility",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isTimePickerPopupVisible=!e.isTimePickerPopupVisible}}}),u=W(o.prototype,"setTimerPopupVisibility",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.isTimePickerPopupVisible=t}}}),l=W(o.prototype,"onSelectDateFromCalendar",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){n.preventDefault(),n.stopPropagation(),e.clampDate(t)}}}),r=o))||r)||r},,function(e,t,n){"use strict";var r,o=n(135),i=(n.n(o),n(338)),a=n.n(i),s=n(343),c=n.n(s),u=n(339),l=n.n(u),p=n(1488);function f(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var d=function(e){var t=e.date,n=e.maxDate,r=e.minDate,o=e.onChange,i=e.now,a=new p.b(t,"HH:mm");return r||(r=c()(i()).add(1,"minutes")),f("div",{className:"DelayedTimePicker__Container"},void 0,a.getTimeItemsWithThirtyMinutesStep(r,n).map(function(e){var t=l()("DelayedTimePicker__Button",{isDisable:e.isDisable});return function(e,t,n){return f("div",{className:t,onClick:n},e,e)}(e.timeStr,t,function(){return!e.isDisable&&o(e.date)})}))};d.propTypes={date:a.a.objectOf(c.a),maxDate:a.a.objectOf(c.a),minDate:a.a.objectOf(c.a),onChange:a.a.func.isRequired,now:a.a.func.isRequired},t.a=d},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return T});var r,o=n(135),i=n.n(o),a=n(139),s=n.n(a),c=n(343),u=n.n(c),l=n(339),p=n.n(l),f=n(338),d=n.n(f),y=n(1489),b=n(2803);n.n(b);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function h(e){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var P="YYYY-MM-DDTHH:mm",C="ComposeDelayedDateTimePickerMobile",w={Block:C,hidden:"".concat(C,"_hidden"),Label:"".concat(C,"-Label"),Input:"".concat(C,"-Input")},T=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=O(this,(e=_(t)).call.apply(e,[this].concat(o)))).inputRef=i.a.createRef(),n.onChange=function(e){e.target.value?n.props.onSelectDate(u()(e.target.value,P).toDate()):n.props.onClearDate&&n.props.onClearDate()},n.clearDefault=function(e){var t=e.nativeEvent.target;setTimeout(function(){return t.defaultValue=""},0)},n.onClick=function(){n.props.onToggle&&n.props.onToggle(),n.props.onSelectDate(n.props.getInitialDate().toDate())},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,i.a.Component),function(e,t,n){t&&g(e.prototype,t),n&&g(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.anchor,n=e.visible;return t?s.a.createPortal(E("div",{className:p()(w.Block,v({},w.hidden,!n))},void 0,E("label",{className:w.Label},void 0,i.a.createElement("input",{ref:this.inputRef,className:w.Input,type:"datetime-local",value:this.selectedDate,pattern:"[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}",min:this.minDate,max:this.maxDate,onChange:this.onChange,onFocus:this.clearDefault,onClick:this.onClick,onBlur:this.onClose}))),t):null}},{key:"selectedDate",get:function(){return this.props.getInitialDate().format(P)}},{key:"maxDate",get:function(){return this.props.getMaxDate().format(P)}},{key:"minDate",get:function(){return this.props.getMinDate().format(P)}}]),t}();T.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach(function(t){v(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},y.a,{onClearDate:d.a.func,onToggle:d.a.func})},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var r,o,i,a,s=n(135),c=n.n(s),u=n(342),l=n(341),p=n(363),f=n(511),d=n(458),y=n(802);function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function m(e){"@babel/helpers - typeof";return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=Object(u.inject)("data")(r=Object(u.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),v(this,g(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,c.a.Component),function(e,t,n){t&&h(e.prototype,t),n&&h(e,n)}(t,[{key:"render",value:function(){return c.a.createElement(y.a,b({icon:"mail--Compose-DelayedSending",loc:"compose-react/DelayedSending_Title",hasNotification:this.hasNotification},this.props))}},{key:"hasNotification",get:function(){return f.a[d.a.DELAYED_SENDING]({data:this.props.data})}}]),t}(),i.propTypes={data:p.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"hasNotification",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasNotification"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(545),o=n(484),i=n(1490),a=n(2811),s=n(2813),c=n(354),u=(n.n(c),{PopupContent:i.a,cls:a.a.Popup,metrikaArgs:[c.COMPOSE_METRIKA_FOOTER_LABELS,c.COMPOSE_METRIKA_FOOTER_LABELS_CLICK],directions:["top"],title:"compose-react/Header_Labels"}),l=Object(o.a)(u,a.b);t.b=Object(r.a)("compose-react/ControlPanel_Labels_Tooltip",l);var p=Object(o.a)(u,s.a)},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a=o.a.shape({count:o.a.number,lid:o.a.string,name:o.a.string,symbolicName:o.a.string,user:o.a.bool,default:o.a.bool,color:o.a.string})},,,,function(e,t){e.exports={variables:'"../../../../variables.m.css"',footerPopupPadding:"var(--space-xs) 0",footerItemHeight:"36px",footerItemSmallPadding:"0 var(--space-s)",footerItemBackground:"var(--color-mg-tint-superlight)",footerSeparatorHeight:"1px",footerSeparatorColor:"var(--color-mg-stroke-default-base)",footerSeparatorMargin:"var(--space-2-xs) var(--space-s)",root:"LabelButton__root--3ecd3",desktop:"LabelButton__desktop--A6E7y",mobile:"LabelButton__mobile--2QP3U",list:"LabelButton__list--7VFXw",item:"LabelButton__item--1hj_m",separator:"LabelButton__separator---ISRm",actions:"LabelButton__actions--eTQki"}},function(e,t,n){"use strict";n.d(t,"a",function(){return g}),n.d(t,"b",function(){return _});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(415),p=n(427),f=n(2812);n.n(f);function d(e){"@babel/helpers - typeof";return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var g={Block:"ComposeLabelButton",Popup:"".concat("ComposeLabelButton","-Popup")},O=v(l.a,{id:"mail--ComposeReact-Label"}),_=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),b(this,m(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&y(e.prototype,t),n&&y(e,n)}(t,[{key:"render",value:function(){return v(p.a,{innerRef:this.props.innerRef,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:this.props.onClick,className:u()(g.Block,this.props.cls),iconComponent:O})}}]),t}();_.propTypes={cls:s.a.string,innerRef:s.a.object,onMouseEnter:s.a.func,onMouseLeave:s.a.func,onClick:s.a.func}},function(e,t){},function(e,t,n){"use strict";var r=n(135),o=n.n(r),i=n(802);function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}t.a=function(e){return o.a.createElement(i.a,a({icon:"mail--ComposeReact-Label",loc:"compose-react/Header_Labels"},e))}},function(e,t,n){"use strict";n.d(t,"a",function(){return x});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(339),d=n.n(f),y=n(338),b=n.n(y),m=n(342),h=n(341),v=n(138),g=(n.n(v),n(146)),O=(n.n(g),n(344)),_=n(2815),S=n(363),E=n(356),P=n(354),C=(n.n(P),n(2817)),w=n.n(C);function T(e){"@babel/helpers - typeof";return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function I(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function D(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var L="ComposeNotificationsOptions",N={Block:L,Item:"".concat(L,"-Item"),Checkbox:"".concat(L,"-Checkbox"),ReplyOptions:"".concat(L,"-ReplyOptions")},x=Object(m.inject)("data","services")(r=Object(m.observer)((c=s=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(n=function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?R(e):t}(this,(e=A(t)).call.apply(e,[this].concat(o)))).notificationsOptions=p.a.createRef(),I(R(n),"onToggleDelivery",i,R(n)),I(R(n),"onChangeReplyNotifications",a,R(n)),n.renderReplyOptions=function(){return p.a.createElement(_.a,{ref:n.notificationsOptions,cls:d()(N.ReplyOptions,w.a.replyOptions),onChange:n.props.onChange})},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,p.a.Component),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"collapse",value:function(){this.notificationsOptions.current&&this.notificationsOptions.current.collapse()}},{key:"render",value:function(){var e=this,t=[{name:"reply",handler:this.onChangeReplyNotifications,loc:"compose-react/Notifications_Reply",enabled:this.notifications.reply,additional:this.renderReplyOptions},{name:"delivery",handler:this.onToggleDelivery,loc:"compose-react/Notifications_Delivery",enabled:this.notifications.delivery}];return M("div",{className:d()(N.Block,w.a.root)},void 0,t.map(function(t){return e.renderItem(t)}))}},{key:"renderItem",value:function(e){var t=e.name,n=e.handler,r=e.loc,o=e.enabled,i=e.additional;return M("div",{className:d()(N.Item,w.a.item)},t,M(g.Checkbox,{name:t,className:d()(N.Checkbox,w.a.checkbox),size:"s",lines:"one",view:"default",checked:o,onChange:n,label:M(v.Text,{typography:"body-long-m"},void 0,M(O.default,{loc:r}))}),i&&i())}},{key:"notifications",get:function(){return this.props.data.notifications}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),t}(),s.propTypes={onChange:b.a.func,services:E.a.isRequired,data:S.a.isRequired},D((o=c).prototype,"notifications",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"notifications"),o.prototype),D(o.prototype,"metrikaService",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),i=D(o.prototype,"onToggleDelivery",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.notifications.delivery=!e.notifications.delivery;var t=e.notifications.delivery?P.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_DELIVERY_ON:P.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_DELIVERY_OFF;e.metrikaService.sendFooterMetrika(P.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS,t)}}}),a=D(o.prototype,"onChangeReplyNotifications",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.notifications.reply=!e.notifications.reply,e.props.onChange&&e.props.onChange();var t=e.notifications.reply?P.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_ON:P.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_OFF;e.metrikaService.sendFooterMetrika(P.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS,t)}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return U});var r,o,i,a,s,c,u,l,p=n(135),f=n.n(p),d=n(338),y=n.n(d),b=n(341),m=n(342),h=n(717),v=n(355),g=(n.n(v),n(363)),O=n(356),_=n(339),S=n.n(_),E=n(344),P=n(1112),C=n(415),w=n(1487),T=n(138),k=(n.n(T),n(354)),A=(n.n(k),n(2816)),R=(n.n(A),n(367));function j(e){"@babel/helpers - typeof";return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t,n,r){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function x(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function B(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var F="ComposeReplyNotificationOptions",z={Block:F,Block_expanded:"".concat(F,"_expanded"),Header:"".concat(F,"-Header"),ExpandIcon:"".concat(F,"-ExpandIcon"),List:"".concat(F,"-List")},U=Object(m.inject)("data","services")(r=Object(m.observer)((u=c=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?D(e):t}(this,I(t).call(this,e))).disposer=new R.a,x(D(n),"isExpanded",i,D(n)),x(D(n),"onSelectTime",a,D(n)),x(D(n),"onToggleExpanded",s,D(n));return n.timeOptions=Object(P.b)(function(){return n.props.services.date.passportNow}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,f.a.Component),function(e,t,n){t&&M(e.prototype,t),n&&M(e,n)}(t,[{key:"collapse",value:function(){this.isExpanded=!1}},{key:"componentDidMount",value:function(){var e=this;this.replyReaction=new h.a(function(){return e.notifications.reply},function(){return e.initTimeOptions()}),this.disposer.add(this,[function(){return e.replyReaction.cancel()}])}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"componentDidUpdate",value:function(){this.props.onChange&&this.props.onChange()}},{key:"initTimeOptions",value:function(){var e=this;if(this.timeOptions=Object(P.b)(function(){return e.props.services.date.passportNow}),this.notifications.reply){var t=this.getOption(v.TimePresets.TOMORROW);this.notifications.replyTime=t.value}else this.notifications.replyTime=null;this.isExpanded=this.notifications.reply}},{key:"getOption",value:function(e){return this.timeOptions.find(function(t){return t.preset===e})}},{key:"render",value:function(){var e=this.notifications.replyTime,t=S()(z.Block,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},z.Block_expanded,this.isExpanded),this.props.cls),n=e&&f.a.createElement(f.a.Fragment,null,N(E.default,{loc:"compose-react/Notifications_ReplyTime",params:Object(P.a)(e)}),N(C.a,{id:"mail--Compose-SmallDropdown",cls:z.ExpandIcon}));return N("div",{className:t},void 0,N(T.Text,{typography:"body-long-m",weight:"medium",className:z.Header,onClick:this.onToggleExpanded},void 0,n),N(w.a,{cls:z.List,options:this.timeOptions,selectedDate:e,onSelect:this.onSelectTime}))}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"notifications",get:function(){return this.props.data.notifications}}]),t}(),c.propTypes={cls:y.a.string,onChange:y.a.func,data:g.a.isRequired,services:O.a.isRequired},i=B((o=u).prototype,"isExpanded",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),B(o.prototype,"metrikaService",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),B(o.prototype,"notifications",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"notifications"),o.prototype),a=B(o.prototype,"onSelectTime",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.date,r=t.preset;e.notifications.replyTime=n,e.metrikaService.sendFooterMetrika(k.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS,k.TIME_PRESETS_METRIKA[r])}}}),s=B(o.prototype,"onToggleExpanded",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isExpanded=!e.isExpanded,e.metrikaService.sendFooterMetrika(k.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS,e.isExpanded?k.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_EXPAND:k.COMPOSE_METRIKA_FOOTER_NOTIFICATIONS_REPLY_COLLAPSE)}}}),B(o.prototype,"collapse",[b.action],Object.getOwnPropertyDescriptor(o.prototype,"collapse"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t){e.exports={variables:'"../../../../variables.m.css"',footerPopupPadding:"var(--space-xs) 0",footerItemSmallPadding:"0 var(--space-s)",footerItemHeight:"36px",footerItemBackground:"var(--color-mg-tint-superlight)",root:"NotificationsButton__root--Ri05W",item:"NotificationsButton__item--ExtEt",checkbox:"NotificationsButton__checkbox--5K-e7",replyOptions:"NotificationsButton__replyOptions--2zmAP"}},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var r,o,i,a,s=n(135),c=n.n(s),u=n(342),l=n(341),p=n(802),f=n(363),d=n(511),y=n(458);function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function m(e){"@babel/helpers - typeof";return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=Object(u.inject)("data")(r=Object(u.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),v(this,g(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,c.a.Component),function(e,t,n){t&&h(e.prototype,t),n&&h(e,n)}(t,[{key:"render",value:function(){return c.a.createElement(p.a,b({icon:"mail--Compose-Notification",loc:"compose-react/Notifications_Title",hasNotification:this.hasNotification},this.props))}},{key:"hasNotification",get:function(){return d.a[y.a.NOTIFICATIONS]({data:this.props.data})}}]),t}(),i.propTypes={data:f.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"hasNotification",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasNotification"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return j}),n.d(t,"b",function(){return M});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(339),p=n.n(l),f=n(342),d=n(341),y=n(363),b=n(461),m=n(511),h=n(458),v=n(353),g=n(427),O=n(415),_=n(2820),S=(n.n(_),n(349));n.n(S);function E(e){"@babel/helpers - typeof";return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var j={Block:"ComposeNotificationsButton",Popup:"".concat("ComposeNotificationsButton","-Popup")},M=Object(f.inject)("data")(r=Object(f.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),T(this,k(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(t,[{key:"render",value:function(){var e=Object(S.hasFeature)(S.Features.WEB_MOBILE_COMPOSE)?"mail--Compose-Notification":"mail--Compose-Notification_new";return R(g.a,{innerRef:this.props.innerRef,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:this.props.onClick,className:p()(j.Block,this.props.cls),hasNotification:this.hasNotification,iconComponent:R(O.a,{id:e}),"aria-label":Object(v.default)("compose-react/ControlPanel_Notifications_Tooltip")})}},{key:"hasNotification",get:function(){return m.a[h.a.NOTIFICATIONS]({data:this.props.data})}}]),t}(),i.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach(function(t){C(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},b.a,{data:y.a.isRequired}),function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"hasNotification",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasNotification"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r,o=n(135),i=n.n(o),a=n(415),s=n(427),c=n(461);function u(e){"@babel/helpers - typeof";return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var b=y(a.a,{id:"mail--Compose-Close-Mobile"}),m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,f(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&l(e.prototype,t),n&&l(e,n)}(t,[{key:"render",value:function(){return y(s.a,{innerRef:this.props.innerRef,className:this.props.cls,onClick:this.props.onClick,iconComponent:b,isClear:!0})}}]),t}();m.propTypes=c.a},function(e,t,n){"use strict";var r=n(338),o=n.n(r);t.a=o.a.shape({fieldName:o.a.string,additionalFieldNames:o.a.arrayOf(o.a.string),errorKey:o.a.string.isRequired,additionalText:o.a.string})},function(e,t){},function(e,t,n){"use strict";var r=n(484),o=n(2825),i=n(2827),a=n(354);n.n(a);t.a=Object(r.a)({PopupContent:i.a,cls:o.a.Popup,metrikaArgs:[a.COMPOSE_METRIKA_FOOTER_OVERFLOW,a.COMPOSE_METRIKA_FOOTER_OVERFLOW_CLICK],directions:["top"],options:{type:"top"}},o.b)},function(e,t,n){"use strict";n.d(t,"a",function(){return j}),n.d(t,"b",function(){return I});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(339),p=n.n(l),f=n(338),d=n.n(f),y=n(342),b=n(341),m=n(461),h=n(511),v=n(363),g=n(360),O=n(427),_=n(2826);n.n(_);function S(e){"@babel/helpers - typeof";return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var R="ComposeOverflowButton",j={Block:R,Popup:"".concat(R,"-Popup")},M=A(g.default,{id:"mail--Compose-More"}),I=Object(y.inject)("data")(r=Object(y.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),w(this,T(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&C(e.prototype,t),n&&C(e,n)}(t,[{key:"render",value:function(){var e=this.props.cls;return A("div",{className:p()(j.Block,e)},void 0,A(O.a,{innerRef:this.props.innerRef,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:this.props.onClick,hasNotification:this.hasNotifications,iconComponent:M}))}},{key:"hasNotifications",get:function(){var e=this.props,t=e.contentOptions.buttons,n=e.data;return t.some(function(e){return h.a[e]&&h.a[e]({data:n})})}}]),t}(),i.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){P(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},m.a,{contentOptions:d.a.shape({buttons:d.a.array}),data:v.a.isRequired}),function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"hasNotifications",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasNotifications"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(1483),u=n(2828);n.n(u);function l(e){"@babel/helpers - typeof";return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var m={Block:"OverflowOptions",Item:"".concat("OverflowOptions","-Item")},h=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,d(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,i.a.Component),function(e,t,n){t&&p(e.prototype,t),n&&p(e,n)}(t,[{key:"render",value:function(){var e=this;return b("div",{className:m.Block},void 0,this.props.buttons.map(function(t){return e.renderButtonAsMenuItem(t)}))}},{key:"renderButtonAsMenuItem",value:function(e){return b(c.a[e].MenuItem,{onClick:this.props.onAction,cls:m.Item},e)}}]),t}();h.propTypes={buttons:s.a.array,onAction:s.a.func}},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return F});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(339),p=n.n(l),f=n(341),d=n(342),y=n(1113),b=n(545),m=n(1110),h=n(1486),v=n(1492),g=n(1493),O=n(2832),_=n(2838),S=n(2840),E=n(801),P=n(1109),C=n(380),w=(n.n(C),n(353)),T=n(350),k=n(1499);n.n(k);function A(e){"@babel/helpers - typeof";return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function L(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var N=p()(E.a.Button,E.a.ButtonNew),x=Object(b.a)("compose-react/MoreOptions_AttachmentsDisk",g.a),B=Object(b.a)("compose-react/MoreOptions_AttachmentsMail",g.a),F=Object(d.inject)("services","visual")(r=Object(d.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),j(this,M(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,u.a.Component),function(e,t,n){t&&R(e.prototype,t),n&&R(e,n)}(t,[{key:"render",value:function(){return D("div",{className:p()(E.a.Block,"".concat(E.a.Block,"_desktop"),this.props.cls,this.isSmall&&"".concat(E.a.Block,"_small"))},void 0,this.renderMainPart(),this.renderAdditionalPart())}},{key:"renderMainPart",value:function(){return D("div",{className:E.a.Part},void 0,D(y.a,{cls:p()(N,E.a.SendButton,"qa-Compose-SendButton")}),D(h.b,{cls:p()(N,E.a.DelayedSendingButton,"qa-Compose-DelayedSendingButton")}),D(v.b,{cls:p()(N,E.a.NotificationsButton,"qa-Compose-NotificationsButton")}),D(O.a,{cls:p()(N,E.a.TemplatesButton,"qa-Compose-TemplatesButton"),isIconOnly:!0}),D(m.b,{cls:p()(N,"qa-Compose-AttachFileButton")}),this.hasDisk&&D(x,{type:"disk",cls:p()(N,"qa-Compose-AttachDiskButton"),"aria-label":Object(w.default)("compose-react/MoreOptions_AttachmentsDisk")}),this.hasMailAttachments&&D(B,{type:"mail",cls:p()(N,"qa-Compose-AttachMailButton"),"aria-label":Object(w.default)("compose-react/MoreOptions_AttachmentsMail")}),D(S.a,{cls:p()(N,E.a.MoreButton,"qa-Compose-MoreButton"),isHorizontal:!0,withIconActiveState:!1,"aria-label":Object(w.default)("compose-react/MoreOptions_More")}))}},{key:"renderAdditionalPart",value:function(){return D("div",{className:E.a.Part},void 0,!this.isSmall&&D(_.a,{cls:p()(N,E.a.TranslatorButton,"qa-Compose-TranslatorButton"),isIconOnly:this.size===C.ComposeSizes.SMALL}))}},{key:"size",get:function(){return this.props.visual.size}},{key:"isSmall",get:function(){return this.size===C.ComposeSizes.SMALL}},{key:"hasDisk",get:function(){return this.props.services.attachments.hasDisk&&Object(T.hasSid)("59")}},{key:"hasMailAttachments",get:function(){return this.props.services.attachments.hasDisk}},{key:"isCorp",get:function(){return this.props.services.attachments.isCorp}},{key:"isTranslated",get:function(){return this.props.visual.translate.isEnabled}}]),t}(),i.propTypes=P.a,L((o=a).prototype,"size",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"size"),o.prototype),L(o.prototype,"isSmall",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"isSmall"),o.prototype),L(o.prototype,"hasDisk",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasDisk"),o.prototype),L(o.prototype,"hasMailAttachments",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasMailAttachments"),o.prototype),L(o.prototype,"isCorp",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"isCorp"),o.prototype),L(o.prototype,"isTranslated",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"isTranslated"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return D});var r,o,i,a,s,c,u=n(135),l=n.n(u),p=n(338),f=n.n(p),d=n(339),y=n.n(d),b=n(341),m=n(342),h=n(360),v=n(427),g=n(461),O=n(483),_=n(355),S=(n.n(_),n(354)),E=(n.n(S),n(356)),P=n(366);function C(e){"@babel/helpers - typeof";return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n,r){c||(c="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:c,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function I(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var D=Object(m.inject)("services","visual")(r=Object(m.observer)((s=a=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(R(n=function(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?R(e):t}(this,(e=A(t)).call.apply(e,[this].concat(o)))),"onClick",i,R(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,l.a.Component),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"render",value:function(){return M(v.a,{innerRef:this.props.innerRef,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:this.onClick,className:y()("ComposeAttachmentsButton",this.props.cls),iconComponent:M(h.default,{id:this.iconName}),"aria-label":this.props["aria-label"]})}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"isDiskAttachments",get:function(){return"disk"===this.props.type}},{key:"iconName",get:function(){return"mail--Compose-Attachments-".concat(this.isDiskAttachments?"Disk":"Mail")}}]),t}(),a.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach(function(t){T(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},g.a,{type:f.a.oneOf(["disk","mail"]),services:E.a.isRequired,visual:P.a.isRequired}),I((o=s).prototype,"metrikaService",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),I(o.prototype,"isDiskAttachments",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"isDiskAttachments"),o.prototype),I(o.prototype,"iconName",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"iconName"),o.prototype),i=I(o.prototype,"onClick",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.diskResourcesPath=e.isDiskAttachments?O.a:O.b,e.props.visual.currentPopup=_.Popups.DISK_RESOURCES;var t=e.isDiskAttachments?S.COMPOSE_METRIKA_FOOTER_ATTACH_DISK:S.COMPOSE_METRIKA_FOOTER_ATTACH_MAIL;e.metrikaService.sendFooterMetrika(t)}}}),r=o))||r)||r},function(e,t,n){"use strict";var r=n(2833),o=n(484),i=n(1494),a=n(354),s=(n.n(a),n(545)),c={PopupContent:i.a,cls:r.a.Popup,metrikaArgs:[a.COMPOSE_METRIKA_FOOTER_TEMPLATES,a.COMPOSE_METRIKA_FOOTER_TEMPLATES_CLICK],directions:["top","top-end","top-start"],title:"compose-react/Templates_Title"},u=Object(o.a)(c,r.b),l=Object(s.a)("compose-react/Templates_Title",u);t.a=l},function(e,t,n){"use strict";n.d(t,"a",function(){return L}),n.d(t,"b",function(){return x});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(342),b=n(341),m=n(427),h=n(360),v=n(344),g=n(353),O=n(363),_=n(366),S=n(461),E=n(511),P=n(458),C=n(2834);n.n(C);function w(e){"@babel/helpers - typeof";return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var D="ComposeTemplatesButton",L={Block:D,Button:"".concat(D,"-Button"),Popup:"".concat(D,"-Popup"),Text:"".concat(D,"-Text"),OnlyIcon:"".concat(D,"_onlyIcon")},N=I(h.default,{id:"mail--Compose-Templates"}),x=Object(y.inject)("data","visual")(r=Object(y.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),R(this,j(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&A(e.prototype,t),n&&A(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.cls,n=e.isIconOnly,r=d()(L.Block,t,k({},L.OnlyIcon,n));return I(m.a,{innerRef:this.props.innerRef,className:r,onClick:this.props.onClick,hasNotification:this.hasNotification,iconComponent:N,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,"aria-label":Object(g.default)("compose-react/Templates_Title")},void 0,!n&&I(v.default,{className:L.Text,loc:"compose-react/Templates_Title"}))}},{key:"hasNotification",get:function(){return E.a[P.a.TEMPLATES]({data:this.props.data,visual:this.props.visual})}}]),t}(),i.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach(function(t){k(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},S.a,{isIconOnly:p.a.bool,data:O.a.isRequired,visual:_.a.isRequired}),function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"hasNotification",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasNotification"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return U});var r,o,i,a,s,c,u,l,p,f=n(135),d=n.n(f),y=n(338),b=n.n(y),m=n(339),h=n.n(m),v=n(136),g=(n.n(v),n(342)),O=n(341),_=n(356),S=n(503),E=n(138),P=(n.n(E),n(2836)),C=n.n(P);function w(e){"@babel/helpers - typeof";return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function k(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,n,r){p||(p="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:p,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function D(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function L(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var N="ComposeTemplatesList",x={Block:N,Item:"".concat(N,"-Item"),Text:"".concat(N,"-Text"),Loader:"".concat(N,"-Loader")},B=200,F=32,z=I(S.a,{size:"xs"}),U=Object(g.inject)("services")(r=Object(g.observer)((l=u=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?j(e):t}(this,R(t).call(this,e))).canLoadMore=!0,D(j(n),"templates",i,j(n)),D(j(n),"isLoading",a,j(n)),D(j(n),"setTemplates",s,j(n)),D(j(n),"setIsLoading",c,j(n)),n.loadTemplates=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){k(i,r,o,a,s,"next",e)}function s(e){k(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){var t,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setIsLoading(!0),e.next=3,n.templatesService.loadTemplates({first:n.templates.length});case 3:t=e.sent,r=t.canLoadMore,o=t.items,n.canLoadMore=r,n.setTemplates(o),n.setIsLoading(!1);case 9:case"end":return e.stop()}},e)})),n.scroll=function(e){if(!n.isLoading&&n.canLoadMore){var t=e.target;t.scrollHeight-t.scrollTop-t.clientHeight<F&&n.loadTemplates()}},n.onScroll=function(e){e.persist(),n.throttledScroll(e)},n.throttledScroll=Object(v.throttle)(n.scroll,B),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,d.a.Component),function(e,t,n){t&&A(e.prototype,t),n&&A(e,n)}(t,[{key:"componentDidMount",value:function(){this.loadTemplates()}},{key:"componentDidUpdate",value:function(){this.props.onChange&&this.props.onChange()}},{key:"render",value:function(){var e=this;return I("div",{className:h()(x.Block,this.props.cls),onScroll:this.onScroll},void 0,this.templates.map(function(t){return e.renderItem(t)}),this.maybeRenderLoader())}},{key:"renderItem",value:function(e){var t=this.props.onSelectTemplate;return I("div",{className:h()(x.Item,C.a.item),onClick:function(){return t&&t(e)}},e.key,I(E.Text,{typography:"body-long-m",className:h()(x.Text,C.a.text)},void 0,e.subject))}},{key:"maybeRenderLoader",value:function(){return this.isLoading?I("div",{className:h()(x.Loader,C.a.loader)},void 0,z):null}},{key:"templatesService",get:function(){return this.props.services.templates}}]),t}(),u.propTypes={cls:b.a.string,onChange:b.a.func,onSelectTemplate:b.a.func,services:_.a.isRequired},i=L((o=l).prototype,"templates",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),a=L(o.prototype,"isLoading",[O.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L(o.prototype,"templatesService",[O.computed],Object.getOwnPropertyDescriptor(o.prototype,"templatesService"),o.prototype),s=L(o.prototype,"setTemplates",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.templates=[].concat(T(e.templates),T(t))}}}),c=L(o.prototype,"setIsLoading",[O.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.isLoading=t}}}),r=o))||r)||r},function(e,t){e.exports={variables:'"../../../../variables.m.css"',footerPopupPadding:"var(--space-xs) 0",footerItemPadding:"0 var(--space-m)",footerItemHeight:"36px",footerItemBackground:"var(--color-mg-tint-superlight)",item:"TemplatesButton__item--1a3os",text:"TemplatesButton__text--2Ehe0",loader:"TemplatesButton__loader--3ngNx"}},function(e,t){e.exports={variables:'"../../../../variables.m.css"',footerSeparatorHeight:"1px",footerSeparatorColor:"var(--color-mg-stroke-default-base)",footerSeparatorMargin:"var(--space-2-xs) var(--space-s)",footerItemHeight:"36px",footerItemPadding:"0 var(--space-m)",footerItemBackground:"var(--color-mg-tint-superlight)",root:"TemplatesButton__root--1hklX",list:"TemplatesButton__list--ZkaFx",separator:"TemplatesButton__separator--1VY3R",action:"TemplatesButton__action--17iDj"}},function(e,t,n){"use strict";n.d(t,"a",function(){return N});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(361),h=n(363),v=n(460),g=n(356),O=n(344),_=n(415),S=n(427),E=n(2839);n.n(E);function P(e){"@babel/helpers - typeof";return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function j(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var M="ComposeTranslatorButton",I={Block:M,Selected:"".concat(M,"_selected"),OnlyIcon:"".concat(M,"_onlyIcon")},D=R(_.a,{id:"mail--ComposeReact-Translate"}),L=R(O.default,{loc:"compose-react/Translator_TranslateButton"}),N=Object(b.inject)("controllers","data","services","visual")(r=Object(b.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=T(this,(e=k(t)).call.apply(e,[this].concat(o)))).onClick=function(){n.props.controllers.translate.toggleTranslator()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,u.a.Component),function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(t,[{key:"render",value:function(){var e=this.onClick,t=this.isEnabled,n=this.props,r=n.cls,o=n.isIconOnly;return R("div",{className:d()(I.Block,C({},I.Selected,t),C({},I.OnlyIcon,o),r)},void 0,R(S.a,{onClick:e,iconComponent:D,hasNotification:t},void 0,!o&&L))}},{key:"messageBody",get:function(){return this.props.controllers.messageBody.text}},{key:"service",get:function(){return this.props.services.translate}},{key:"isEnabled",get:function(){return this.props.visual.translate.isEnabled}},{key:"metrika",get:function(){return this.props.services.metrika}}]),t}(),i.propTypes={cls:p.a.string,isIconOnly:p.a.bool,controllers:m.a.isRequired,data:h.a.isRequired,visual:v.a.isRequired,services:g.a.isRequired},j((o=a).prototype,"messageBody",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"messageBody"),o.prototype),j(o.prototype,"service",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"service"),o.prototype),j(o.prototype,"isEnabled",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"isEnabled"),o.prototype),j(o.prototype,"metrika",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrika"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";var r=n(484),o=n(2841),i=n(2858),a=n(354),s=(n.n(a),Object(r.a)({PopupContent:o.a,cls:i.a.Popup,metrikaArgs:[a.COMPOSE_METRIKA_FOOTER_MORE],directions:["top-end"],options:{}},i.b));t.a=s},function(e,t,n){"use strict";var r=n(2842);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return re});var r,o,i,a,s,c,u,l,p,f,d,y=n(135),b=n.n(y),m=n(338),h=n.n(m),v=n(341),g=n(342),O=n(1495),_=n.n(O),S=n(2845),E=n(361),P=n(363),C=n(356),w=n(366),T=n(2846),k=(n.n(T),n(483)),A=n(484),R=n(1490),j=n(355),M=(n.n(j),n(354)),I=(n.n(M),n(380)),D=(n.n(I),n(458)),L=n(511),N=n(1496),x=n(2848),B=n.n(x),F=n(339),z=n.n(F),U=n(2849);function K(){return(K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function H(e){"@babel/helpers - typeof";return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e,t,n,r){d||(d="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:d,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function J(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Z(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var ee=Object(A.a)({PopupContent:R.a,cls:N.a.Popup,metrikaArgs:[M.COMPOSE_METRIKA_FOOTER_MORE_LABELS_CLICK],directions:["left"],title:"compose-react/Header_Labels"},_.a),te=Object(A.a)({PopupContent:U.a,cls:N.a.Popup,metrikaArgs:[M.COMPOSE_METRIKA_FOOTER_MORE_SIGNATURES_CLICK],directions:["left"],title:"compose-react/Header_Labels"},_.a),ne=X(T.Separator,{className:"qa-Compose-MoreOptions-Separator"}),re=Object(g.inject)("controllers","data","services","visual")(r=Object(g.observer)((f=p=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),J($(n=function(e,t){return!t||"object"!==H(t)&&"function"!=typeof t?$(e):t}(this,V(t).call(this,e))),"isAutocompleteEnabled",i,$(n)),J($(n),"isSmartSubjectEnabled",a,$(n)),J($(n),"toggleSmartSubject",s,$(n)),J($(n),"toggleAutocomplete",c,$(n)),n.toggleTranslator=function(){n.props.controllers.translate.toggleTranslator(),n.props.controllers.compose.changeSize(I.ComposeSizes.LARGE)},J($(n),"onAttachMail",u,$(n)),J($(n),"onAttachDisk",l,$(n)),n.onAction=function(){n.props.onAction()},n.renderItem=function(e){var t=e.key,n=e.Component,r=void 0===n?_.a:n,o=G(e,["key","Component"]);return b.a.createElement(r,K({key:t},o))},n.isAutocompleteEnabled=n.settingsController.isAutocompleteEnabled,n.isSmartSubjectEnabled=n.props.services.settings.isSmartSubjectEnabled,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,b.a.PureComponent),function(e,t,n){t&&q(e.prototype,t),n&&q(e,n)}(t,[{key:"render",value:function(){return X("div",{className:z()(B.a.root,N.a.Block,"qa-Compose-MoreOptions")},void 0,this.items.map(this.renderItem))}},{key:"isTemplate",get:function(){return this.props.data.isTemplate}},{key:"hasChanges",get:function(){return this.props.data.hasChanges}},{key:"settingsController",get:function(){return this.props.controllers.settings}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"isTranslatorEnabled",get:function(){return this.props.visual.translate.isEnabled}},{key:"optionsParams",get:function(){var e;return Y(e={},D.a.ATTACHMENTS_DISK,{icon:"mail--Compose-Disk_more",loc:"compose-react/MoreOptions_AttachmentsDisk",onClick:this.onAttachDisk,cls:"qa-Compose-MoreOptions-AttachmentsDisk"}),Y(e,D.a.ATTACHMENTS_MAIL,{icon:"mail--Compose-Mail_more",loc:"compose-react/MoreOptions_AttachmentsMail",onClick:this.onAttachMail,cls:"qa-Compose-MoreOptions-AttachmentsMail"}),Y(e,D.a.SEPARATOR,{Component:function(){return ne}}),Y(e,D.a.LABELS,{icon:"mail--ComposeReact-Label_more",loc:"compose-react/MoreOptions_Labels",Component:ee,onAction:this.onAction,cls:"qa-Compose-MoreOptions-Labels"}),Y(e,D.a.AUTOCOMPLETE,{icon:"mail--ComposeReact-Autocomplete",loc:"compose-react/MoreOptions_AutocompleteLabel",checked:this.isAutocompleteEnabled,onToggle:this.toggleAutocomplete,cls:"qa-Compose-MoreOptions-Autocomplete"}),Y(e,D.a.SMART_SUBJECT,{icon:"mail--ComposeReact-SmartSubject",loc:"compose-react/MoreOptions_SmartSubjectLabel",checked:this.isSmartSubjectEnabled,onToggle:this.toggleSmartSubject,cls:"qa-Compose-MoreOptions-SmartSubject"}),Y(e,D.a.TEMPLATES,{icon:"mail--Compose-Templates",loc:"compose-react/Templates_Title",cls:z()(N.a.TemplatesButton,"qa-Compose-MoreOptions-Templates"),Component:S.a}),Y(e,D.a.TRANSLATOR,{icon:"mail--MainToolbar-Translate",loc:"compose-react/Translator_TranslateButton",checked:this.isTranslatorEnabled,onToggle:this.toggleTranslator,cls:"qa-Compose-MoreOptions-Translator"}),Y(e,D.a.SIGNATURES,{icon:"mail--ComposeReact-Signature",loc:"compose-react/MoreOptions_Signatures",Component:te,onAction:this.onAction,cls:"qa-Compose-MoreOptions-Signatures"}),e}},{key:"items",get:function(){var e=this,t=this.props,n=t.data,r=t.visual,o=this.props.controllers.visual.moreButtonOptions.map(function(t,o){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach(function(t){Y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({key:t===D.a.SEPARATOR?t+o:t,hasNotification:L.a[t]&&L.a[t]({data:n,visual:r})},e.optionsParams[t])});if(this.props.controllers.visual.moreButtonOptions.includes(D.a.TEMPLATES)){var i=40*(o.length-1)+8;o[0].popupProps={secondaryOffset:-1*i,tailOffset:i}}return o}}]),t}(),p.propTypes={onAction:h.a.func.isRequired,controllers:E.a.isRequired,data:P.a.isRequired,services:C.a.isRequired,visual:w.a.isRequired},i=Z((o=f).prototype,"isAutocompleteEnabled",[v.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=Z(o.prototype,"isSmartSubjectEnabled",[v.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Z(o.prototype,"isTemplate",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"isTemplate"),o.prototype),Z(o.prototype,"hasChanges",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasChanges"),o.prototype),Z(o.prototype,"settingsController",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"settingsController"),o.prototype),Z(o.prototype,"metrikaService",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),Z(o.prototype,"isTranslatorEnabled",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"isTranslatorEnabled"),o.prototype),s=Z(o.prototype,"toggleSmartSubject",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isSmartSubjectEnabled=!e.isSmartSubjectEnabled,e.props.services.settings.isSmartSubjectEnabled=e.isSmartSubjectEnabled,e.metrikaService.sendFooterMetrika(e.isSmartSubjectEnabled?M.COMPOSE_METRIKA_FOOTER_MORE_SMARTSUBJECT_ON:M.COMPOSE_METRIKA_FOOTER_MORE_SMARTSUBJECT_OFF)}}}),c=Z(o.prototype,"toggleAutocomplete",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isAutocompleteEnabled=!e.isAutocompleteEnabled,e.settingsController.toggleAutocomplete(),e.metrikaService.sendFooterMetrika(e.isAutocompleteEnabled?M.COMPOSE_METRIKA_FOOTER_MORE_AUTOCOMPLETE_ON:M.COMPOSE_METRIKA_FOOTER_MORE_AUTOCOMPLETE_OFF)}}}),u=Z(o.prototype,"onAttachMail",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.diskResourcesPath=k.b,e.props.visual.currentPopup=j.Popups.DISK_RESOURCES,e.metrikaService.sendFooterMetrika(M.COMPOSE_METRIKA_FOOTER_ATTACH_MAIL),e.props.onAction()}}}),l=Z(o.prototype,"onAttachDisk",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.diskResourcesPath=k.a,e.props.visual.currentPopup=j.Popups.DISK_RESOURCES,e.metrikaService.sendFooterMetrika(M.COMPOSE_METRIKA_FOOTER_ATTACH_DISK),e.props.onAction()}}}),Z(o.prototype,"optionsParams",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"optionsParams"),o.prototype),Z(o.prototype,"items",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"items"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(135)),i=r(n(339)),a=r(n(344)),s=n(202),c=r(n(360)),u=n(138),l=r(n(2844)),p="ComposeOptionItem",f={Block:p,withToggle:p+"_withToggle",checked:p+"_checked",Label:p+"-Label",Icon:p+"-Icon",withNotification:p+"_withNotification"},d=function(e){var t,n=e.checked,r=e.isPopupVisible,p=void 0!==r&&r,d=e.cls,y=e.hasNotification,b=e.icon,m=e.innerRef,h=e.loc,v=e.onClick,g=e.onToggle,O=e.url,_=O?"a":"div",S=o.default.createElement(o.default.Fragment,null,o.default.createElement("div",{className:i.default(l.default.iconWrap,f.Icon)},o.default.createElement(c.default,{cls:l.default.icon,id:b})),o.default.createElement(u.Text,{typography:"body-long-m",className:i.default(l.default.label,f.Label)},o.default.createElement(a.default,{loc:h})));return g?o.default.createElement(s.Tumbler,{className:i.default(l.default.root,d,l.default.withToggle,f.Block,f.withToggle),view:"default",size:"s",checked:n,onChange:g,labelBefore:S}):o.default.createElement(_,{className:i.default(l.default.root,f.Block,d,(t={},t[l.default.withNotification+" "+f.withNotification]=y,t[l.default.checked+" "+f.checked]=p,t)),onClick:v,ref:m,target:O?"_blank":void 0,href:O,rel:O?"noreferrer noopener":void 0},S)};d.propTypes={},t.default=d},function(e,t){e.exports={variables:'"../../../../../../variables.m.css"',footerItemHeight:"36px",footerItemSmallPadding:"0 var(--space-s)",footerItemBackground:"var(--color-mg-tint-superlight)",notificationColor:"var(--button-view-action-fill-color-base)",notificationBadgeSize:"var(--space-xs) var(--space-m)",root:"OptionItem__root--3hAQK",checked:"OptionItem__checked--1WV2K",withToggle:"OptionItem__withToggle--1aGOM",iconWrap:"OptionItem__iconWrap--TxGZ_",icon:"OptionItem__icon--1lbyA",withNotification:"OptionItem__withNotification--1rXYE",label:"OptionItem__label--1mfGg"}},function(e,t,n){"use strict";var r=n(484),o=n(1494),i=n(1495),a=n.n(i),s=n(1496),c=n(354),u=(n.n(c),Object(r.a)({PopupContent:o.a,cls:s.a.TemplatesPopup,metrikaArgs:[c.COMPOSE_METRIKA_FOOTER_TEMPLATES,c.COMPOSE_METRIKA_FOOTER_TEMPLATES_CLICK],directions:["left-end"]},a.a));t.a=u},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Separator=void 0;var o=r(n(135)),i=r(n(339)),a=r(n(2847));t.Separator=function(e){var t=e.className;return o.default.createElement("div",{className:i.default(a.default.separator,t)})}},function(e,t){e.exports={variables:'"../../../../../variables.m.css"',footerSeparatorHeight:"1px",footerSeparatorColor:"var(--color-mg-stroke-default-base)",footerSeparatorMargin:"var(--space-2-xs) var(--space-s)",separator:"MoreOptions__separator--lqGat"}},function(e,t){e.exports={variables:'"../../../../../variables.m.css"',footerPopupPadding:"var(--space-xs) 0",root:"MoreOptions__root--37dHX"}},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var r,o,i,a,s=n(135),c=n.n(s),u=n(338),l=n.n(u),p=n(342),f=n(1497),d=n(361);function y(e){"@babel/helpers - typeof";return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=Object(p.inject)("data","controllers")((i=o=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=m(this,(e=h(t)).call.apply(e,[this].concat(o))))._handleApplySignature=function(e){n.props.controllers.signatures.setSignature(e),n.props.onAction&&n.props.onAction()},n._handleClose=function(){n.props.onAction&&n.props.onAction()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,c.a.Component),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"render",value:function(){return function(e,t,n,r){a||(a="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var s=new Array(i),c=0;c<i;c++)s[c]=arguments[c+3];t.children=s}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:a,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(f.a,{applySignature:this._handleApplySignature,onClose:this._handleClose})}}]),t}(),o.propTypes={onAction:l.a.func,controllers:d.a.isRequired},r=i))||r},function(e,t,n){"use strict";n.d(t,"a",function(){return N});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(363),h=n(366),v=n(356),g=n(361),O=n(353),_=n(367),S=n(354),E=(n.n(S),n(1498)),P=n(2855);n.n(P);function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function w(e){"@babel/helpers - typeof";return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function I(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var D="SignaturesPopupMenu",L={Block:D,BlockDesktop:"".concat(D,"_desktop"),BlockMobile:"".concat(D,"_mobile"),SignaturesList:"".concat(D,"-SignaturesList"),Separator:"".concat(D,"-Separator")},N=Object(b.inject)("data","visual","services","controllers")(r=Object(b.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=A(this,(e=R(t)).call.apply(e,[this].concat(o))))._disposer=new _.a,n._openSettings=function(){n.props.onClose(),n.props.controllers.signatures.openSettings(),n._sendMetrika(S.COMPOSE_SIGNATURES_POPUP_GO_TO_SETTINGS)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,u.a.Component),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"_sendMetrika",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.metrika).sendMetrika.apply(e,[S.COMPOSE_METRIKA,S.COMPOSE_SIGNATURES_POPUP].concat(n))}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"render",value:function(){return M("div",{className:d()(L.Block,this.isMobile?L.BlockMobile:L.BlockDesktop)},void 0,this.renderSignatures(),this.renderMenuItems())}},{key:"renderSignatures",value:function(){var e=[this._createCleanSignatureItem()].concat(T(this._getUserSignatures()));return M("div",{className:L.SignaturesList},void 0,e.map(function(e){return u.a.createElement(E.a,C({key:e.idx},e))}))}},{key:"renderMenuItems",value:function(){if(this.isMobile)return null;var e=this._getMenuItems();return u.a.createElement(u.a.Fragment,null,M("div",{className:L.Separator}),e.map(function(e){return u.a.createElement(E.a,C({key:e.idx},e))}))}},{key:"_applySignature",value:function(e){this.props.applySignature(e),this.props.onClose(),this._sendMetrika(e.html?S.COMPOSE_SIGNATURES_POPUP_CHANGE_SIGNATURE:S.COMPOSE_SIGNATURES_POPUP_WITHOUT_SIGNATURE),this.props.controllers.compose.complexityLogger.setSignatureWasChanged(!0)}},{key:"_createCleanSignatureItem",value:function(){var e=this;return{idx:-1,handler:function(){return e._applySignature({})},name:Object(O.default)("compose-react/SignaturesPopup_Empty")}}},{key:"_getUserSignatures",value:function(){var e=this;return this.props.controllers.signatures.signatures.map(function(t){return{idx:t.idx,name:t.name,handler:function(){return e._applySignature(t)}}})}},{key:"_getMenuItems",value:function(){return[{idx:"settings",handler:this._openSettings,name:Object(O.default)("compose-react/SignaturesPopup_Manage")}]}},{key:"emailFrom",get:function(){return this.props.data.addresses.from.email}},{key:"lang",get:function(){return this.props.services.settings.lang}},{key:"metrika",get:function(){return this.props.services.metrika}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}}]),t}(),i.propTypes={data:m.a.isRequired,visual:h.a.isRequired,services:v.a.isRequired,controllers:g.a.isRequired,onClose:p.a.func.isRequired,applySignature:p.a.func.isRequired},I((o=a).prototype,"emailFrom",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"emailFrom"),o.prototype),I(o.prototype,"lang",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"lang"),o.prototype),I(o.prototype,"metrika",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrika"),o.prototype),I(o.prototype,"isMobile",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(135)),i=r(n(2852));t.default=function(e){var t=e.handler,n=e.name;return o.default.createElement("div",{className:i.default.item,onClick:t},o.default.createElement("div",{className:i.default.text},n))}},function(e,t){e.exports={item:"SignatureOptionItem__item--1WWRo",text:"SignatureOptionItem__text--1epW_"}},function(e,t,n){"use strict";var r,o=n(135),i=(n.n(o),n(338)),a=n.n(i),s=n(339),c=n.n(s),u=n(138),l=(n.n(u),n(2854)),p=n.n(l);function f(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var d=function(e){var t=e.handler,n=e.name,r=Object(o.useMemo)(function(){return n.replace(/\n/g," ").trim()},[n]);return f("div",{className:c()(p.a.item,"qa-Compose-SignaturesPopup-Item"),onClick:t},void 0,f(u.Text,{typography:"body-long-m",className:p.a.text},void 0,r))};d.propTypes={name:a.a.string.isRequired,handler:a.a.func.isRequired},t.a=d},function(e,t){e.exports={variables:'"../../../variables.m.css"',footerItemHeight:"36px",footerItemHorizontalPadding:"var(--space-m)",footerItemBackground:"var(--color-mg-tint-superlight)",item:"SignatureOptionItem__item--1z5Nd",text:"SignatureOptionItem__text--3a-T8"}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return N});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(363),h=n(366),v=n(356),g=n(361),O=n(353),_=n(354),S=(n.n(_),n(2857)),E=n.n(S),P=n(1498);function C(){return(C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function w(e){"@babel/helpers - typeof";return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function I(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var D="SignaturesPopupMenuNew",L={Block:D,SignaturesList:"".concat(D,"-SignaturesList"),Separator:"".concat(D,"-Separator")},N=Object(b.inject)("data","visual","services","controllers")(r=Object(b.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=A(this,(e=R(t)).call.apply(e,[this].concat(o))))._openSettings=function(){n.props.onClose(),n.props.controllers.signatures.openSettings(),n._sendMetrika(_.COMPOSE_SIGNATURES_POPUP_GO_TO_SETTINGS)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,u.a.Component),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"_sendMetrika",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.metrika).sendMetrika.apply(e,[_.COMPOSE_METRIKA,_.COMPOSE_SIGNATURES_POPUP].concat(n))}},{key:"render",value:function(){return M("div",{className:d()(E.a.root,L.Block,"qa-Compose-SignaturesPopup")},void 0,this.renderSignatures(),this.renderMenuItems())}},{key:"renderSignatures",value:function(){var e=[this._createCleanSignatureItem()].concat(T(this._getUserSignatures()));return M("div",{className:d()(E.a.list,L.SignaturesList,"qa-Compose-SignaturesPopup-List")},void 0,e.map(function(e){return u.a.createElement(P.a,C({key:e.idx},e))}))}},{key:"renderMenuItems",value:function(){if(this.isMobile)return null;var e=this._getMenuItems();return u.a.createElement(u.a.Fragment,null,M("div",{className:d()(E.a.separator,L.Separator,"qa-Compose-SignaturesPopup-Separator")}),e.map(function(e){return u.a.createElement(P.a,C({key:e.idx},e))}))}},{key:"_applySignature",value:function(e){this.props.applySignature(e),this.props.onClose(),this._sendMetrika(e.html?_.COMPOSE_SIGNATURES_POPUP_CHANGE_SIGNATURE:_.COMPOSE_SIGNATURES_POPUP_WITHOUT_SIGNATURE),this.props.controllers.compose.complexityLogger.setSignatureWasChanged(!0)}},{key:"_createCleanSignatureItem",value:function(){var e=this;return{idx:-1,handler:function(){return e._applySignature({})},name:Object(O.default)("compose-react/SignaturesPopup_Empty")}}},{key:"_getUserSignatures",value:function(){var e=this;return this.props.controllers.signatures.signatures.map(function(t){return{idx:t.idx,name:t.name,handler:function(){return e._applySignature(t)}}})}},{key:"_getMenuItems",value:function(){return[{idx:"settings",handler:this._openSettings,name:Object(O.default)("compose-react/SignaturesPopup_Manage")}]}},{key:"emailFrom",get:function(){return this.props.data.addresses.from.email}},{key:"lang",get:function(){return this.props.services.settings.lang}},{key:"metrika",get:function(){return this.props.services.metrika}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}}]),t}(),i.propTypes={data:m.a.isRequired,visual:h.a.isRequired,services:v.a.isRequired,controllers:g.a.isRequired,onClose:p.a.func.isRequired,applySignature:p.a.func.isRequired},I((o=a).prototype,"emailFrom",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"emailFrom"),o.prototype),I(o.prototype,"lang",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"lang"),o.prototype),I(o.prototype,"metrika",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrika"),o.prototype),I(o.prototype,"isMobile",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),r=o))||r)||r},function(e,t){e.exports={variables:'"../../../../variables.m.css"',footerPopupPadding:"var(--space-xs) 0",footerSeparatorHeight:"1px",footerSeparatorColor:"var(--color-mg-stroke-default-base)",footerSeparatorMargin:"var(--space-2-xs) var(--space-s)",root:"new__root--3X3wW",list:"new__list--23YqG",separator:"new__separator--1GSSu"}},function(e,t,n){"use strict";n.d(t,"a",function(){return I}),n.d(t,"b",function(){return D});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(342),b=n(341),m=n(461),h=n(363),v=n(361),g=n(366),O=n(511),_=n(360),S=n(427),E=n(2859);n.n(E);function P(e){"@babel/helpers - typeof";return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var M="ComposeMoreButton",I={Block:M,Popup:"".concat(M,"-Popup"),Promo:"".concat(M,"-Promo"),Icon:"".concat(M,"-Icon")},D=Object(y.inject)("controllers","data","visual")(r=Object(y.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),k(this,A(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,u.a.Component),function(e,t,n){t&&T(e.prototype,t),n&&T(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.cls,n=e.isPopupVisible,r=e.withIconActiveState,o=n&&r?"mail--Compose-More_expanded":"mail--Compose-More";return j("div",{className:d()(I.Block,t)},void 0,j(S.a,{innerRef:this.props.innerRef,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,onClick:this.props.onClick,hasNotification:this.hasNotification,iconComponent:j(_.default,{id:o,cls:d()(I.Icon,w({},I.Icon+"_horizontal",this.props.isHorizontal))}),"aria-label":this.props["aria-label"]}))}},{key:"hasNotification",get:function(){var e=this.props,t=e.data,n=e.visual;return this.props.controllers.visual.moreButtonOptions.some(function(e){return O.a[e]&&O.a[e]({data:t,visual:n})})}}]),t}(),i.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach(function(t){w(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},m.a,{controllers:v.a.isRequired,data:h.a.isRequired,visual:g.a.isRequired,isHorizontal:p.a.bool,withIconActiveState:p.a.bool}),i.defaultProps={withIconActiveState:!0},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"hasNotification",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasNotification"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return I});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(339),p=n.n(l),f=n(341),d=n(342),y=n(1113),b=n(545),m=n(1110),h=n(1493),v=n(801),g=n(1109),O=n(353),_=n(350),S=n(1499);n.n(S);function E(e){"@babel/helpers - typeof";return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function A(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var R=p()(v.a.Button,v.a.ButtonNew),j=Object(b.a)("compose-react/MoreOptions_AttachmentsDisk",h.a),M=Object(b.a)("compose-react/MoreOptions_AttachmentsMail",h.a),I=Object(d.inject)("services","visual")(r=Object(d.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),C(this,w(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,u.a.Component),function(e,t,n){t&&P(e.prototype,t),n&&P(e,n)}(t,[{key:"render",value:function(){return k("div",{className:p()(v.a.Block,"".concat(v.a.Block,"_desktop"))},void 0,k("div",{className:v.a.Part},void 0,k(y.a,{cls:p()("qa-QuickReply-SendButton",R,v.a.SendButton)}),k(m.b,{cls:p()("qa-QuickReply-AttachLocalFileButton",R)}),this.hasDisk&&k(j,{type:"disk",cls:p()("qa-QuickReply-AttachDiskFileButton",R),"aria-label":Object(O.default)("compose-react/MoreOptions_AttachmentsDisk")}),this.hasMailAttachments&&k(M,{type:"mail",cls:p()("qa-QuickReply-AttachMailFileButton",R),"aria-label":Object(O.default)("compose-react/MoreOptions_AttachmentsMail")})))}},{key:"hasDisk",get:function(){return this.props.services.attachments.hasDisk&&Object(_.hasSid)("59")}},{key:"hasMailAttachments",get:function(){return this.props.services.attachments.hasDisk}},{key:"isCorp",get:function(){return this.props.services.attachments.isCorp}}]),t}(),i.propTypes=g.a,A((o=a).prototype,"hasDisk",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasDisk"),o.prototype),A(o.prototype,"hasMailAttachments",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasMailAttachments"),o.prototype),A(o.prototype,"isCorp",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"isCorp"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r,o=n(135),i=n.n(o),a=n(590),s=n(2863),c=n(482),u=(n.n(c),n(804)),l=n(806),p=n(2895);n.n(p);function f(e){"@babel/helpers - typeof";return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var v=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),y(this,b(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&d(e.prototype,t),n&&d(e,n)}(t,[{key:"render",value:function(){var e=this.props.attachment,t=e.info,n=e.previewSupported,r=t.class,o=Object(l.a)(t),i=t.folder,a=n?t.previewSrc:null,c=i?Object(u.b)():Object(u.a)(o,r),p=!i&&!Object(u.c)(l.a,r);return h("div",{className:"compose-AttachmentListItem"},void 0,h(s.a,{className:"compose-AttachmentListItem-Thumbnail",previewUrl:a,iconUrl:c,isDefaultIcon:p,extension:o}),h("div",{className:"compose-AttachmentListItem-Title"},void 0,h("div",{className:"compose-AttachmentListItem-Name"},void 0,t.name),this.maybeRenderFileSize()))}},{key:"maybeRenderFileSize",value:function(){var e=this.props.attachment.info;return e.folder?null:h("div",{className:"compose-AttachmentListItem-Size"},void 0,h(c.HumanFileSize,{bytes:e.size}))}}]),t}();v.propTypes={attachment:a.a.isRequired}},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r,o=n(135),i=n.n(o),a=n(339),s=n.n(a),c=n(338),u=n.n(c),l=n(2864);n.n(l);function p(e){"@babel/helpers - typeof";return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var h=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),d(this,y(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.previewUrl,n=e.iconUrl,r=e.className,o=e.isDefaultIcon,i=e.extension,a="compose-AttachmentThumbnail";return m("div",{className:s()(r,a)},void 0,m("img",{className:s()("".concat(a,"-Img"),function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},"".concat(a,"-Img_preview"),Boolean(t))),src:t||n,"data-fallback-src":n,"data-role":"js-browse-disk-thumbnail","data-clear-class":"".concat(a,"-Img_preview")}),o&&m("div",{className:"".concat(a,"-CustomExtension")},void 0,i))}}]),t}();h.propTypes={previewUrl:u.a.string,iconUrl:u.a.string,className:u.a.string,isDefaultIcon:u.a.bool,extension:u.a.string}},function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var r,o=n(135),i=n.n(o),a=n(339),s=n.n(a),c=n(338),u=n.n(c),l=n(480),p=n(590),f=n(1508),d=n(2897);n.n(d);function y(e){"@babel/helpers - typeof";return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var O=u.a.shape({errorCode:u.a.number,title:u.a.oneOfType([u.a.element,u.a.string]),description:u.a.oneOfType([u.a.element,u.a.string]),items:l.a.arrayOf(p.a).isRequired}),_=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,h(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"render",value:function(){var e=this,t=this.props.errorGroups,n=1===t.length;return g("div",{className:s()("compose-AttachmentsErrors",{"compose-AttachmentsErrors_single":n})},void 0,t.map(function(t){return e.renderErrorGroup(t)}))}},{key:"renderErrorGroup",value:function(e){return g("div",{className:"compose-AttachmentsErrors-Group","data-key":e.errorCode},e.errorCode,g("div",{className:"compose-AttachmentsErrors-GroupHeader"},void 0,e.description),g(f.a,{attachments:e.items}))}}]),t}();_.propTypes={errorGroups:l.a.arrayOf(O).isRequired}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(135),o=n.n(r),i=n(338),a=n.n(i),s=n(1106);n.n(s);function c(e){"@babel/helpers - typeof";return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=l(this,(e=p(t)).call.apply(e,[this].concat(i)))).listRef=o.a.createRef(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,o.a.Component),function(e,t,n){t&&u(e.prototype,t),n&&u(e,n)}(t,[{key:"componentDidUpdate",value:function(e){var t=e&&e.selectedIndex,n=this.props.selectedIndex;n!==t&&this._scrollToIndex(n)}},{key:"_scrollToIndex",value:function(e){var t=this.listRef.current;if(t){var n=this.props.itemHeight,r=Math.floor(t.scrollTop/n),o=t.offsetHeight/n;e>=r&&e<r+o||Object(s.scrollTo)(t,{top:e*n})}}},{key:"render",value:function(){var e=this.props,t=e.cls,n=e.children;return o.a.createElement("div",{ref:this.listRef,className:t,role:"listbox",id:this.props.suggestId},n)}}]),t}();d.propTypes={cls:a.a.string,itemHeight:a.a.number.isRequired,selectedIndex:a.a.number.isRequired,children:a.a.oneOfType([a.a.element,a.a.arrayOf(a.a.element)]).isRequired,suggestId:a.a.string}},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r,o=n(135),i=n.n(o),a=n(2900);n.n(a);function s(e){"@babel/helpers - typeof";return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("div",{className:"lockScreen"}),d=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,l(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,i.a.Component),function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(t,[{key:"componentDidMount",value:function(){document&&document.activeElement&&document.activeElement.blur()}},{key:"render",value:function(){return f}}]),t}()},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return I});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(338),d=n.n(f),y=n(341),b=n(342),m=n(367),h=n(2903),v=n(361),g=n(363),O=n(356),_=n(460),S=n(354),E=(n.n(S),n(355)),P=(n.n(E),n(2909)),C=n(471);n.n(C);function w(e){"@babel/helpers - typeof";return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function M(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var I=Object(b.inject)("data","controllers","services","visual")(r=Object(b.observer)((u=c=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=function(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?A(e):t}(this,(e=k(t)).call.apply(e,[this].concat(o)))).editorRef=p.a.createRef(),n.signaturesPopupRef=p.a.createRef(),n.disposer=new m.a,n.mailAutocomplete={getDraftId:function(){return n.props.data.overwriteIds||""},getMessageId:function(){return n.props.data.messageId},getThreadId:function(){return n.props.services.composeParams.relatedThreadId},toggleAutocomplete:function(){return null},getDebounceDelay:function(){return n.props.services.settings.autocompleteDelay}},n.focus=function(){var e=n.editorRef.current;e&&e.focus()},n.onEditorContentChange=function(e){var t=e.boundingRect;n.props.controllers.messageBody.dumpText({withRaw:n.props.visual.translate.isEnabled}),n.props.onChange&&t&&n.props.onChange(t)},n.onEditorInit=function(e){var t=e.dataProcessor,r=e.postTranslation;if(t){var o=n.htmlProcessorService;o.initDataProcessor(t),n.disposer.add(A(n),function(){return o.resetDataProcessor()})}n._initPostTranslation(r),n.props.onEditorInit&&n.props.onEditorInit()},n.onEditorDestroy=function(){n.htmlProcessorService.resetDataProcessor()},j(A(n),"_initPostTranslation",i,A(n)),n.onEditorToolbarCommandClick=function(e){n.metrikaService.sendWysiwigMetrika(S.EDITOR_TOOLBAR_COMMANDS_METRIKA[e])},j(A(n),"onEditorPopupStateChanged",a,A(n)),n.bootstrapSignaturesPopup=function(){if(n.signaturesPopupRef.current&&n.signaturesData){var e=n.signaturesPopupRef.current,t=n.signaturesData,r=t.isOpen,o=t.anchor,i=t.applySignature;e.applySignature=i,e.anchor=r?o:null}},n.onEditorFocus=function(){n.metrikaService.sendWysiwigMetrika(S.COMPOSE_METRIKA_WYSIWIG_BODY)},j(A(n),"onPasteFiles",s,A(n)),n.onToggleAutocomplete=function(e){e.previousValue!==n.settingsService.disableAutocompleteReact&&n.editorRef.current&&n.editorRef.current.toggleAutocomplete&&n.editorRef.current.toggleAutocomplete()},n.onInput=function(e){var t=e.inputType;e.selectionLength>0||(t!==E.InputTypes.INSERT_TEXT&&t!==E.InputTypes.INSERT_LINE_BREAK||n.complexityLogger.increaseBodyInsertCount(),t===E.InputTypes.DELETE_CONTENT_BACKWARD&&n.complexityLogger.increaseBodyDeleteCount())},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(t,p.a.Component),function(e,t,n){t&&T(e.prototype,t),n&&T(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this.disposer.add(this,[this.settingsService.registerChangeSettingsHandler(this.onToggleAutocomplete,E.Settings.DISABLE_AUTOCOMPLETE_REACT),Object(y.reaction)(function(){return e.signaturesPopupRef.current},this.bootstrapSignaturesPopup,{fireImmediately:!0}),Object(y.reaction)(function(){return e.props.data.signature},function(t){return e.signaturesData.applySignature(t)})])}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this),this.props.services.signatures.reset()}},{key:"render",value:function(){var e=this;return p.a.createElement(p.a.Fragment,null,p.a.createElement(h.a,{ref:this.editorRef,cls:this.props.cls,placeholder:this.props.placeholder,toolbarNodeId:this.props.toolbarNodeId,getComposeContainerRef:function(){return e.composeContainerRef},getScrollableRef:function(){return e.composeScrollableRef},mailAutocomplete:this.mailAutocomplete,signatureMatches:this.signatureMatches,onEditorInit:this.onEditorInit,onEditorDestroy:this.onEditorDestroy,onChange:this.onEditorContentChange,onFocus:this.onEditorFocus,onKeyboardMove:this.props.onKeyboardMove,onPasteFiles:this.onPasteFiles,getInlineDropZone:this.props.getInlineDropZone,onToolbarCommandClick:this.onEditorToolbarCommandClick,onChildPopupStateChanged:this.onEditorPopupStateChanged,complexityLogger:this.complexityLogger,onInput:this.onInput,isCorp:this.props.services.attachments.isCorp,isMobile:this.props.services.settings.isMobile,isQuickReply:this.props.services.composeParams.params.isQuickReply,size:this.props.visual.size,messageBodyController:this.props.controllers.messageBody}),p.a.createElement(P.a,{ref:this.signaturesPopupRef}))}},{key:"messageBody",get:function(){return this.props.controllers.messageBody.text}},{key:"attachments",get:function(){return this.props.data.attachments}},{key:"composeContainerRef",get:function(){return this.props.visual.refs.composeContainer}},{key:"composeScrollableRef",get:function(){return this.props.visual.refs.composeScrollableContainer}},{key:"htmlProcessorService",get:function(){return this.props.services.htmlProcessor}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"attachmentsController",get:function(){return this.props.controllers.attachments}},{key:"hotkeysController",get:function(){return this.props.controllers.hotkeys}},{key:"settingsService",get:function(){return this.props.services.settings}},{key:"complexityLogger",get:function(){return this.props.controllers.compose.complexityLogger}},{key:"signatureMatches",get:function(){return this.props.controllers.signatures.matches}}]),t}(),c.propTypes={placeholder:d.a.string,cls:d.a.string,data:g.a.isRequired,toolbarNodeId:d.a.string,controllers:v.a.isRequired,services:O.a.isRequired,visual:_.a.isRequired,onChange:d.a.func,onEditorInit:d.a.func,onKeyboardMove:d.a.func,getInlineDropZone:d.a.func},M((o=u).prototype,"messageBody",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"messageBody"),o.prototype),M(o.prototype,"attachments",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"attachments"),o.prototype),M(o.prototype,"composeContainerRef",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeContainerRef"),o.prototype),M(o.prototype,"composeScrollableRef",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeScrollableRef"),o.prototype),M(o.prototype,"htmlProcessorService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"htmlProcessorService"),o.prototype),M(o.prototype,"metrikaService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),M(o.prototype,"attachmentsController",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"attachmentsController"),o.prototype),M(o.prototype,"hotkeysController",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"hotkeysController"),o.prototype),M(o.prototype,"settingsService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"settingsService"),o.prototype),M(o.prototype,"complexityLogger",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"complexityLogger"),o.prototype),M(o.prototype,"signatureMatches",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"signatureMatches"),o.prototype),i=M(o.prototype,"_initPostTranslation",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.visual.translate.postTranslation=t}}}),a=M(o.prototype,"onEditorPopupStateChanged",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.name,r=t.isOpen,o=t.anchor,i=t.applySignature;r?e.hotkeysController.suspend():e.hotkeysController.resume(),n===C.Popups.SIGNATURES&&(e.signaturesData={isOpen:r,anchor:o,applySignature:i},e.bootstrapSignaturesPopup())}}}),s=M(o.prototype,"onPasteFiles",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.visual.workMode===E.WorkModes.FOREGROUND&&e.attachmentsController.attachFilesFromLocal(t)}}}),r=o))||r)||r},function(e,t,n){"use strict";var r=n(2904),o=n(2906),i=n(420);r.a.mode="ckeditor",o.a.mode="simple",t.a=Object(i.a)(r.a,o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return C});var r,o=n(136),i=(n.n(o),n(135)),a=n.n(i),s=n(339),c=n.n(s),u=n(471),l=(n.n(u),n(1510)),p=n(376),f=n.n(p),d=n(380),y=(n.n(d),n(355)),b=(n.n(y),n(349)),m=(n.n(b),n(2905));n.n(m);function h(e){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P="ComposeMbodyCKEditor",C=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=_(this,(e=S(t)).call.apply(e,[this].concat(i)))).editorId=Object(o.uniqueId)("editor"),n._tryInitCKEditor=function(){n.editor||setTimeout(n._tryInitCKEditor,10)},n.focus=function(e){n.editor&&(e&&n.editor.container.$.contains(e.nativeEvent.target)||setTimeout(function(){return n.editor.focus()},0))},n.onEditorInit=function(){var e=n.props.onEditorInit;Object(b.hasFeature)(b.Features.WEB_EDITOR_SORT_ATTRIBUTES)&&(n.editor.dataProcessor.writer.sortAttributes=!0),n.onChange(),e&&e({dataProcessor:n.editor.dataProcessor,postTranslation:n.editor.plugins.collapsedQuotes.collapsedQuotes.processPostTranslation})},n.onEditorKey=function(e){var t=e.data.keyCode;if([f.a.UP,f.a.DOWN].includes(t)){var r=n.getNativeRect();n.props.onKeyboardMove&&n.props.onKeyboardMove({boundingRect:r,keyCode:t})}},n.onEditorFocused=function(){var e=n.props.onFocus;e&&e()},n.afterCommandExec=function(e){var t=n.props,r=t.onChildPopupStateChanged,o=t.onToolbarCommandClick,i=e.data.name;i===u.ToolbarCommands.ADD_LINK?r&&r({name:u.Popups.ADD_LINK,isOpen:!0}):-1!==u.ToolbarCommandsList.indexOf(i)&&o&&o(i)},n._onSignaturesPopupStateChange=function(e){var t=e.anchor,r=e.isOpen,o=e.applySignature,i=n.props.onChildPopupStateChanged;i&&i({name:u.Popups.SIGNATURES,isOpen:r,anchor:t,applySignature:o})},n.onLinkClosed=function(){var e=n.props.onChildPopupStateChanged;e&&e({name:u.Popups.ADD_LINK,isOpen:!1})},n.onInlineImagePopupStateChanged=function(e){var t=e.isOpen,r=n.props.onChildPopupStateChanged;r&&r({name:u.Popups.INLINE_IMAGE,isOpen:t})},n.onChange=function(){var e=n.props.onChange;e&&e({boundingRect:n.getNativeRect()})},n.onPasteFiles=function(e){var t=e.data.files,r=n.props.onPasteFiles;r&&r(t)},n.onInput=function(e){var t=e.data,r=t.inputType,o=t.selectionLength,i=t.target,a=n.props.onInput;a&&a({inputType:r,selectionLength:o}),r===y.InputTypes.INSERT_REPLACEMENT_TEXT&&(i&&(i.innerHTML=i.innerHTML.replace(/\n/g,"<br>")),n.onChange())},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,a.a.Component),function(e,t,n){t&&O(e.prototype,t),n&&O(e,n)}(t,[{key:"_getEventHandlers",value:function(){return{instanceReady:this.onEditorInit,change:this.onChange,afterCommandExec:this.afterCommandExec,"link:closed":this.onLinkClosed,focus:this.onEditorFocused,"pastefile:dropfile":this.onPasteFiles,"inputLogger:input":this.onInput,key:this.onEditorKey}}},{key:"_getCustomConfig",value:function(){var e=this,t={toolbar:"Max",toolbarStartupExpanded:!1,getComplexityLogger:function(){return e.props.complexityLogger},isMobile:this.props.isMobile};return this.props.toolbarNodeId&&(t.sharedSpaces={top:this.props.toolbarNodeId}),this.props.getInlineDropZone&&(t.getPasteFileInlineDropZone=this.props.getInlineDropZone),this.props.isQuickReply&&(t.pastefileDisableFile=!0,t.pastefileGetDropContext=function(e){return e.container.$},t.removePlugins="autogrow,resize,translate,mailAutocomplete"),t.composeContainer={getRef:this.props.getComposeContainerRef,getScrollableRef:this.props.getScrollableRef},t.mailAutocomplete=this.props.mailAutocomplete,t.signatures={popup:{stateChange:this._onSignaturesPopupStateChange},matches:this.props.signatureMatches},t.inlineImages={popup:{stateChange:this.onInlineImagePopupStateChanged,isEnabled:!this.props.isCorp}},t}},{key:"_getConfig",value:function(){var e={};CKEDITOR.editorConfig(e);var t=this._getEventHandlers(),n=this._getCustomConfig(),r=this.props.size===d.ComposeSizes.SMALL?CKEDITOR.ConfigFactory.COMPOSE_REACT_MIN:CKEDITOR.ConfigFactory.COMPOSE_REACT_MAX;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach(function(t){g(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{},CKEDITOR.ConfigFactory.getConfig(r,t,n,this),{title:this.props.placeholder})}},{key:"componentDidMount",value:function(){var e=this;this._tryInitCKEditor(),this.updateValue(this.messageBodyController.text),this.messageBodyController.connect({text:function(){return e.editor.getData()},raw:function(){return e.editor.fire("getRawData"),e.editor.getData()},onReplace:function(t){return e.updateValue(t)}})}},{key:"componentDidUpdate",value:function(e){this.props.size!==e.size&&(this.editor&&(this.editor.destroy(),this.props.onEditorDestroy()),CKEDITOR.replace(this.editorId,this._getConfig()))}},{key:"componentWillUnmount",value:function(){this.editor&&this.editor.destroy()}},{key:"getNativeRect",value:function(){var e=document.getSelection(),t=e&&e.rangeCount>0&&e.getRangeAt(0);if(t){if(0===t.getClientRects().length&&t.collapsed){var n=this.getClosestElement(t.commonAncestorContainer);return n&&n.getBoundingClientRect()}return t.getBoundingClientRect()}}},{key:"getClosestElement",value:function(e){return!e||e instanceof HTMLElement?e:e.parentElement}},{key:"toggleAutocomplete",value:function(){this.editor.execCommand("mailAutocomplete:toggle")}},{key:"render",value:function(){var e=this.props,t=e.placeholder,n=e.cls;return function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("div",{className:c()(P,n),onClick:this.focus,id:this.editorId,placeholder:t})}},{key:"updateValue",value:function(e){this.editor.setData(e)}},{key:"editor",get:function(){if(!CKEDITOR.instances[this.editorId])try{CKEDITOR.replace(this.editorId,this._getConfig())}catch(e){}return CKEDITOR.instances[this.editorId]}},{key:"messageBodyController",get:function(){return this.props.messageBodyController}}]),t}();C.propTypes=l.b,C.defaultProps=l.a},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var r=n(135),o=n.n(r),i=n(339),a=n.n(i),s=n(136),c=(n.n(s),n(367)),u=n(471),l=(n.n(u),n(1510)),p=n(2907),f=n(1027),d=n(2908);n.n(d);function y(e){"@babel/helpers - typeof";return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g={Block:"ComposeMbodySimpleEditor",Contents:"".concat("ComposeMbodySimpleEditor","-Contents")};var O=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=m(this,(e=h(t)).call.apply(e,[this].concat(i)))).disposer=new c.a,n.editorNode=o.a.createRef(),n.editorContainer=o.a.createRef(),n.state={isEmptyText:!1},n._onSignaturesPopupStateChange=function(e){var t=e.anchor,r=e.isOpen,o=e.applySignature,i=n.props.onChildPopupStateChanged;i&&i({name:u.Popups.SIGNATURES,isOpen:r,anchor:t,applySignature:o})},n.config={isMobile:n.props.isMobile,signatures:{popup:{stateChange:n._onSignaturesPopupStateChange},matches:n.props.signatureMatches}},n._onResize=function(){n.editor.emit("resize")},n.checkTextIsEmpty=function(){var e=n.editorNode.current.innerText,t=-1!==["","\r","\n","\r\n"].indexOf(e);n.state.isEmptyText!==t&&n.setState({isEmptyText:t})},n.focus=function(){n.editorNode.current&&n.editorNode.current.focus()},n.onChange=function(){n.checkTextIsEmpty(),n.props.onChange({boundingRect:null})},n.onInput=function(){n.editor.onInput()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,o.a.Component),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=Object(s.isEqual)(this.props,e),r=Object(s.isEqual)(this.state,t);return n||r}},{key:"initPlugins",value:function(){this.signaturesPlugin=new f.a(this.editor)}},{key:"componentDidMount",value:function(){var e=this,t=this.editorNode.current;if(this.editor=new p.a(this),this.disposer.add(this,function(){return e.editor.destroy()}),this.initPlugins(),this.editor.setData(this.props.messageBodyController.text),this.editor.updateElement(),function(e){var t={contenteditable:!1,target:"_blank"};e.querySelectorAll("a").forEach(function(e){Object.keys(t).forEach(function(n){return e.setAttribute(n,t[n])})})}(t),Modernizr.msie){var n=new MutationObserver(this.onChange);n.observe(t,{childList:!0,subtree:!0,characterData:!0}),this.disposer.add(this,function(){return n.disconnect()})}else t.addEventListener("input",this.onChange),this.disposer.add(this,function(){return t.removeEventListener("input",e.onChange)});this.props.onEditorInit&&this.props.onEditorInit({dataProcessor:{toHtml:function(e){return e}}}),this.checkTextIsEmpty(),this.props.messageBodyController.connect({text:function(){return e.editor.getData()},raw:function(){return e.editor.getData()},onReplace:function(t){return e.editor.setData(t)}}),this.disposer.addEventListener(this,{eventName:"resize",element:window,listener:this._onResize})}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"render",value:function(){var e=this,t=this.props,n=t.placeholder,r=t.cls,i=t.onFocus,s=this.state.isEmptyText;return o.a.createElement("div",{ref:this.editorContainer,className:a()(g.Block,r)},o.a.createElement("div",{ref:this.editorNode,className:g.Contents,contentEditable:!0,onInput:this.onInput,onFocus:i,onKeyDown:function(t){return e.editor.onKeyDown(t)},placeholder:s?n:""}))}}]),t}();O.propTypes=l.b,O.defaultProps=l.a},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(1026),o=n(376),i=n.n(o);function a(e){"@babel/helpers - typeof";return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}(this,c(t).call(this))).onKeyDown=function(e){if(e.keyCode===i.a.BACKSPACE){var t={canceled:!1};n.emit("backspace",t),t.canceled&&e.preventDefault()}},n.editor=e;var r=n.on;return n.on=function(e,t){return r.call(u(n),e,t),function(){return n.off(e,t)}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,r["a"]),function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(t,[{key:"beforeUpdateElement",value:function(e){this.updateElement=e}},{key:"getConfig",value:function(){return this.editor.config}},{key:"getContainer",value:function(){return this.editor.editorContainer&&this.editor.editorContainer.current}},{key:"getContents",value:function(){return this.editor.editorNode&&this.editor.editorNode.current}},{key:"getData",value:function(){var e={data:{dataValue:this.getContents().innerHTML}};return this.emit("getData",e),e.data.dataValue}},{key:"setData",value:function(e){var t={data:{dataValue:e}};this.emit("setData",t),this.getContents().innerHTML=t.data.dataValue,this.previousData&&this.previousData!==t.data.dataValue&&this.editor.onChange(),this.emit("change"),this.previousData=t.data.dataValue}},{key:"destroy",value:function(){this.emit("destroy")}},{key:"onInput",value:function(){this.emit("change"),this.editor.onChange()}}]),t}()},function(e,t){},function(e,t,n){"use strict";var r=n(2910);t.a=r.a},function(e,t,n){"use strict";n.d(t,"a",function(){return x});var r,o,i,a,s,c,u,l,p,f=n(135),d=n.n(f),y=n(338),b=n.n(y),m=n(341),h=n(342),v=n(353),g=n(366),O=n(363),_=n(356),S=n(361),E=n(367),P=n(544),C=n(354),w=(n.n(C),n(1497)),T=n(16),k=n(400);n.n(k);function A(){return(A=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function R(e){"@babel/helpers - typeof";return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function N(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var x=(r=Object(h.inject)("data","visual","services","controllers"),o=m.observable.ref,r(i=Object(h.observer)((l=u=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return L(I(n=function(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?I(e):t}(this,(e=M(t)).call.apply(e,[this].concat(o)))),"anchor",s,I(n)),n._disposer=new E.a,n.applySignature=n.props.onApplySignature,L(I(n),"onClose",c,I(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,d.a.Component),function(e,t,n){t&&j(e.prototype,t),n&&j(e,n)}(t,[{key:"_sendMetrika",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.metrika).sendMetrika.apply(e,[C.COMPOSE_METRIKA,C.COMPOSE_SIGNATURES_POPUP].concat(n))}},{key:"componentDidMount",value:function(){var e=this;this._disposer.add(this,[Object(m.reaction)(function(){return e.anchor},function(t){t&&e._sendMetrika(C.COMPOSE_SIGNATURES_POPUP_OPEN)}),Object(m.reaction)(function(){return e.emailFrom},function(){return e._onFromChanged()})])}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"_onFromChanged",value:function(){var e=this.props.controllers.signatures.signatures;e.length&&this.applySignature(e[0])}},{key:"render",value:function(){var e=this.onClose,t=this.isMobile?{direction:["bottom","top"]}:{direction:["top","right","left"]};return d.a.createElement(P.a,A({scope:this.props.visual.composeContainerRef,anchor:this.anchorRef,onClose:e,visible:this.visible,className:"SignaturesPopup",title:Object(v.default)("compose-react/SignaturesPopup_Title"),boundary:this.boundaryRef,hasTail:!0},t),function(e,t,n,r){p||(p="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:p,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(w.a,{onClose:e,applySignature:this.applySignature}))}},{key:"anchorRef",get:function(){return{current:this.anchor}}},{key:"boundaryRef",get:function(){return{current:!Object(T.hasFeature)(k.Features.REACT_LAYOUT)&&document.querySelector(".js-mail-App")?document.querySelector(".js-mail-App"):document.documentElement}}},{key:"visible",get:function(){return Boolean(this.anchor)}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}},{key:"composeContainerRef",get:function(){return this.props.visual.refs.composeContainer}},{key:"metrika",get:function(){return this.props.services.metrika}},{key:"emailFrom",get:function(){return this.props.data.addresses.from.email}}]),t}(),u.propTypes={data:O.a.isRequired,visual:g.a.isRequired,services:_.a.isRequired,controllers:S.a.isRequired,onApplySignature:b.a.func},u.defaultProps={onApplySignature:function(){}},s=N((a=l).prototype,"anchor",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N(a.prototype,"anchorRef",[m.computed],Object.getOwnPropertyDescriptor(a.prototype,"anchorRef"),a.prototype),N(a.prototype,"boundaryRef",[m.computed],Object.getOwnPropertyDescriptor(a.prototype,"boundaryRef"),a.prototype),N(a.prototype,"visible",[m.computed],Object.getOwnPropertyDescriptor(a.prototype,"visible"),a.prototype),N(a.prototype,"isMobile",[m.computed],Object.getOwnPropertyDescriptor(a.prototype,"isMobile"),a.prototype),N(a.prototype,"composeContainerRef",[m.computed],Object.getOwnPropertyDescriptor(a.prototype,"composeContainerRef"),a.prototype),N(a.prototype,"metrika",[m.computed],Object.getOwnPropertyDescriptor(a.prototype,"metrika"),a.prototype),N(a.prototype,"emailFrom",[m.computed],Object.getOwnPropertyDescriptor(a.prototype,"emailFrom"),a.prototype),c=N(a.prototype,"onClose",[m.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.anchor=null}}}),i=a))||i)||i)},function(e,t,n){"use strict";n.d(t,"a",function(){return z});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(338),d=n.n(f),y=n(341),b=n(342),m=n(339),h=n.n(m),v=n(361),g=n(356),O=n(1115),_=n(366),S=n(367),E=n(1512),P=n(2915),C=n(2935),w=n(354),T=(n.n(w),n(2936)),k=n(2937);n.n(k);function A(e){"@babel/helpers - typeof";return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function N(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function x(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var B="ComposeRecipients",F={Block:B,TopRow:"".concat(B,"-TopRow"),TopRowWithMailBox:"".concat(B,"-TopRowWithMailBox"),ToField:"".concat(B,"-ToField"),Expander:"".concat(B,"-Expander"),MultipleAddressField:"".concat(B,"-MultipleAddressField"),MultipleAddressFieldWithMailBox:"".concat(B,"-MultipleAddressFieldWithMailBox"),AdditionalAddresses:"".concat(B,"-AdditionalAddresses"),AdditionalAddresses_hidden:"".concat(B,"-AdditionalAddresses_hidden")},z=Object(b.inject)("controllers","services","stores","visual")(r=Object(b.observer)((c=s=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?I(e):t}(this,M(t).call(this,e)))._disposer=new S.a,n._afterUpdateQueue=[],N(I(n),"onToggleAdditionalAddresses",i,I(n)),N(I(n),"onModeChanged",a,I(n)),n.onFieldFocus=function(e,t){var r=e.fullName,o=e.metrika,i=e.ref;n.props.onFieldFocus&&n.props.onFieldFocus(r,i,t),o&&n.metrikaService.sendHeaderMetrika(o)},n.onFieldDragStart=function(e){n.props.onFieldDragStart&&n.props.onFieldDragStart(e)},n._fields=["to","cc","bcc","from"].reduce(function(e,t){return e[t]={field:t,fullName:"addresses.".concat(t),ref:p.a.createRef(),title:T.a[t],metrika:w.COMPOSE_HEADER_FIELDS_METRIKA[t]},e},{}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,p.a.Component),function(e,t,n){t&&j(e.prototype,t),n&&j(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this._disposer.add(this,[Object(y.reaction)(function(){return e.props.isShowAdditionalAddresses},this.onToggleAdditionalAddresses),Object(y.reaction)(function(){return e.props.isAddressesCollapsed},this.onModeChanged)])}},{key:"componentDidUpdate",value:function(){this._afterUpdateQueue.forEach(function(e){return e()}),this._afterUpdateQueue=[];var e=this._fields.cc.ref.current.querySelector('[role="textbox"]');e&&e.focus()}},{key:"_afterUpdate",value:function(e){this._afterUpdateQueue.push(e)}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"collapseField",value:function(e){this.props.visual.expandedFields[e]=!1}},{key:"render",value:function(){var e,t=this.props.isShowAdditionalAddresses,n=h()((R(e={},F.AdditionalAddresses,!0),R(e,F.AdditionalAddresses_hidden,!t),e));return L("div",{className:F.Block},void 0,this.renderTopRow(),L("div",{className:n},void 0,this.renderMultipleAddressField(this._fields.cc),this.renderMultipleAddressField(this._fields.bcc),!this.props.mailboxUid&&this.renderFromField(this._fields.from)),this.props.children)}},{key:"renderTopRow",value:function(){var e;return L("div",{className:h()((e={},R(e,F.TopRow,!this.props.mailboxUid),R(e,F.TopRowWithMailBox,this.props.mailboxUid),e))},void 0,this.renderMultipleAddressField(this._fields.to,F.ToField),this.props.mailboxUid&&this.renderFromField(this._fields.from),this.isMobile&&this.renderExpander())}},{key:"renderMultipleAddressField",value:function(e,t){var n,r=e.ref,o=e.field,i=e.title,a=e.fullName,s=e.isYabblesExpanded,c=this.onFieldFocus,u=this.onFieldDragStart;return L(P.a,{innerRef:r,cls:h()((n={},R(n,F.MultipleAddressField,!this.props.mailboxUid),R(n,F.MultipleAddressFieldWithMailBox,this.props.mailboxUid),n),t),title:i,field:o,onDragStart:function(){return u(a)},onFocus:function(t){return c(e,t)},isYabblesExpanded:s,mailboxUid:this.props.mailboxUid},o)}},{key:"renderFromField",value:function(e){var t=e.ref,n=e.field,r=e.title,o=this.onFieldFocus;return L(C.a,{innerRef:t,title:r,onShow:function(){return o(e)},mailboxUid:this.props.mailboxUid},n)}},{key:"renderExpander",value:function(){var e=this.props,t=e.isShowAdditionalAddresses,n=e.onToggleExpandedState;return L(E.a,{cls:F.Expander,isExpanded:t,onToggleExpanded:n})}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"contactsController",get:function(){return this.props.controllers.contacts}},{key:"composeParamsService",get:function(){return this.props.services.composeParams}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}},{key:"contactsStore",get:function(){return this.props.stores.contacts}}]),t}(),s.propTypes={isShowAdditionalAddresses:d.a.bool,isAddressesCollapsed:d.a.bool,mailboxUid:d.a.string,PropTypes:d.a,controllers:v.a.isRequired,services:g.a.isRequired,stores:O.a.isRequired,visual:_.a.isRequired,onToggleExpandedState:d.a.func,onFieldFocus:d.a.func,onFieldDragStart:d.a.func},s.defaultProps={isShowAdditionalAddresses:!1,onToggleExpandedState:function(){return null}},x((o=c).prototype,"metrikaService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),x(o.prototype,"contactsController",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsController"),o.prototype),x(o.prototype,"composeParamsService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeParamsService"),o.prototype),x(o.prototype,"isMobile",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),i=x(o.prototype,"onToggleAdditionalAddresses",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=!e.props.isShowAdditionalAddresses;e._afterUpdate(Object(y.action)(function(){t?e.collapseField("to"):(e.collapseField("cc"),e.collapseField("bcc"))}))}}}),x(o.prototype,"collapseField",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"collapseField"),o.prototype),a=x(o.prototype,"onModeChanged",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=e.props.isAddressesCollapsed;e._afterUpdate(Object(y.action)(function(){t&&e.collapseField("to")}))}}}),x(o.prototype,"contactsStore",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsStore"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return j});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(342),b=n(341),m=n(356),h=n(1513),v=n.n(h),g=n(344),O=n(2914);n.n(O);function _(e){"@babel/helpers - typeof";return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var T="ComposeRecipientsExpander",k={Block:T,Block_mobile:"".concat(T,"_mobile"),Block_desktop:"".concat(T,"_desktop")},A=w(g.default,{loc:"compose-react/Header_Addresses_Cc"}),R=w(g.default,{loc:"compose-react/Header_Extra_Fields"}),j=Object(y.inject)("services")(r=Object(y.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,P(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,u.a.Component),function(e,t,n){t&&S(e.prototype,t),n&&S(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.cls,n=e.isExpanded,r=e.onToggleExpanded,o=d()(t,k.Block,this.isMobile?k.Block_mobile:k.Block_desktop),i=this.props.mailboxUid?A:R;return w(v.a,{cls:o,isExpanded:n,onClick:r},void 0,!this.isMobile&&i)}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}}]),t}(),i.propTypes={cls:p.a.string,isExpanded:p.a.bool,onToggleExpanded:p.a.func.isRequired,mailboxUid:p.a.string,services:m.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"isMobile",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),r=o))||r)||r},function(e,t){e.exports={icon:"components__icon--kVzwQ",expanded:"components__expanded--WwTIC"}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var r,o,i,a,s=n(135),c=n.n(s),u=n(341),l=n(342),p=n(136),f=(n.n(p),n(1116)),d=n(2916),y=n(2933),b=n(420);function m(){return(m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function h(e){"@babel/helpers - typeof";return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var E=Object(b.a)(d.a,y.a),P=Object(l.inject)("data","visual","services")(r=Object(l.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=g(this,(e=O(t)).call.apply(e,[this].concat(o)))).onSelectSuggestContact=function(e){var t=n.props,r=t.field,o=t.mailboxUid,i=n.suggestState,a=(i.contacts||[]).indexOf(e)+1||0;n.logSuggestService.logSuggestUsage({field:r,usedPosition:a,usedText:e.email,mailboxUid:o},i)},n.onYabblesChanged=function(e){var t=n.props,r=t.field,o=t.mailboxUid,i=(e||[]).map(function(e){return e.email}),a=(n.addresses||[]).map(function(e){return e.email}),s=Object(p.difference)(i,a);if(s.length){var c=s.join(",");n.logSuggestService.logSuggestUsage({field:r,usedText:c,mailboxUid:o},n.suggestState)}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,c.a.Component),function(e,t,n){t&&v(e.prototype,t),n&&v(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=this.onSelectSuggestContact,n=this.onYabblesChanged;return c.a.createElement(E,m({},e,{onYabblesChanged:n,onSelectSuggestContact:t}))}},{key:"addresses",get:function(){var e=this.props,t=e.data,n=e.field;return t.addresses[n]}},{key:"logSuggestService",get:function(){return this.props.services.logSuggest}},{key:"suggestState",get:function(){return this.props.visual.contactsSuggest}}]),t}(),i.propTypes=f.b,S((o=a).prototype,"addresses",[u.computed],Object.getOwnPropertyDescriptor(o.prototype,"addresses"),o.prototype),S(o.prototype,"logSuggestService",[u.computed],Object.getOwnPropertyDescriptor(o.prototype,"logSuggestService"),o.prototype),S(o.prototype,"suggestState",[u.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggestState"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return oe});var r,o,i,a,s,c,u,l,p,f,d,y,b,m,h,v,g,O,_,S,E=n(135),P=n.n(E),C=n(339),w=n.n(C),T=n(1514),k=n.n(T),A=n(341),R=n(342),j=n(1116),M=n(419),I=n(1115),D=n(1476),L=n(710),N=n.n(L),x=n(1474),B=n(1515),F=n(1518),z=n(353),U=n(376),K=n.n(U),H=n(354),W=(n.n(H),n(367)),Y=n(2932);n.n(Y);function G(e){"@babel/helpers - typeof";return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(e,t,n,r){S||(S="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:S,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function ee(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function te(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var ne={Block:"MultipleAddressesDesktop",Field:"".concat("MultipleAddressesDesktop","-Field")},re=function(){return":".concat(Date.now(),"-a11y-").concat(parseInt(1e4*Math.random()))},oe=Object(R.inject)("data","visual","stores","services","controllers")(r=Object(R.observer)((_=O=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),O=0;O<r;O++)o[O]=arguments[O];return(n=function(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?X(e):t}(this,(e=Q(t)).call.apply(e,[this].concat(o))))._disposer=new W.a,n.fieldRef=P.a.createRef(),n.fieldControlRef=P.a.createRef(),n.fieldId=k()("compose-field-"),ee(X(n),"suggestPosition",i,X(n)),ee(X(n),"selectedYabbleRef",a,X(n)),ee(X(n),"selectedContact",s,X(n)),ee(X(n),"a11yFirstSuggestItem",c,X(n)),ee(X(n),"changeContactEmail",u,X(n)),n.onYabblesChanged=function(){var e;n.props.onYabblesChanged&&(e=n.props).onYabblesChanged.apply(e,arguments),n.closeSuggest(),n.closeYabblePopup()},ee(X(n),"closeSuggest",l,X(n)),ee(X(n),"closeYabblePopup",p,X(n)),n.convertContactToText=function(e){return{text:n.contactsFormatterService.contactToString(e),startOffset:1,endOffset:(e.name?e.name.length:e.email.length)+1}},ee(X(n),"onClick",f,X(n)),ee(X(n),"onInput",d,X(n)),ee(X(n),"onSpecialKey",y,X(n)),ee(X(n),"onSelectSuggestContact",b,X(n)),n.onSelectYabbleAddress=function(e,t){t.isGroup()||n.changeContactEmail(e,t.email),n.closeYabblePopup()},n.onTitleClick=function(){n.props.mailboxUid||(n.abookSource=H.ABOOK_POPUP_SHOW_FIELD_TITLE,n.showAbookPopup())},n.showAbookPopup=function(){n.composeController.showAbookPopup({field:n.props.field,contacts:n.addresses,onAction:n.onAbookContactsSelected,onCancel:n.onAbookPopupClosed}),n.sendAbookMetrika(H.ABOOK_POPUP_SHOW)},n.showAllContacts=function(){n.abookSource=H.ABOOK_POPUP_SHOW_SUGGEST,n.closeSuggest(),n.showAbookPopup()},ee(X(n),"onAbookContactsSelected",m,X(n)),n.onAbookPopupClosed=function(){n.focus()},ee(X(n),"onYabbleClick",h,X(n)),n.onYabbleCopy=function(){n.closeYabblePopup(),n.metrikaService.sendHeaderMetrika(H.COMPOSE_METRIKA_HEADER_YABBLE_POPUP,H.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_COPY)},n.onYabbleEdit=function(e){n.fieldControlRef.current&&n.fieldControlRef.current.editBubble({field:n.props.field,event:e,yabble:n.selectedYabbleRef}),n.closeYabblePopup(),n.metrikaService.sendHeaderMetrika(H.COMPOSE_METRIKA_HEADER_YABBLE_POPUP,H.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_EDIT)},ee(X(n),"onYabbleWriteOnly",v,X(n)),ee(X(n),"onTopContentInFixedModeChanged",g,X(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(t,P.a.Component),function(e,t,n){t&&$(e.prototype,t),n&&$(e,n)}(t,[{key:"focus",value:function(){this.composeController.focusComposeField(this.props.field)}},{key:"sendAbookMetrika",value:function(e){this.metrikaService.sendMetrika(H.COMPOSE_METRIKA,H.ABOOK_POPUP,e,this.abookSource,this.props.field)}},{key:"componentDidMount",value:function(){var e=this;this._disposer.add(this,[Object(A.reaction)(function(){return e.props.visual.topContentInFixedMode},this.onTopContentInFixedModeChanged),Object(A.reaction)(function(){return e.selectedYabbleRef},function(t){e.props.visual.yabbleMenuPopup.field=t?e.props.field:""})])}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"render",value:function(){var e=w()(ne.Block,this.props.cls,"tst-field-".concat(this.props.field));return P.a.createElement("div",{className:e,ref:this.props.innerRef},Z(N.a,{title:this.props.title,onTitleClick:this.onTitleClick,fieldId:this.fieldId},void 0,this.renderField()),this.renderYabblePopup())}},{key:"renderField",value:function(){var e=this;return P.a.createElement(F.a,{ref:this.fieldControlRef,cls:ne.Field,convertContactToText:this.convertContactToText,field:this.props.field,fieldId:this.fieldId,innerRef:this.fieldRef,onClick:this.onClick,onFocus:this.props.onFocus,onInput:this.onInput,onSpecialKey:this.onSpecialKey,onYabbleClick:this.onYabbleClick,onDragStart:this.props.onDragStart,isDraggable:!0,onYabblesChanged:this.onYabblesChanged,onYabbleRemove:function(){return e.closeYabblePopup()},title:Object(z.default)(this.props.title),a11yFirstSuggestItem:this.a11yFirstSuggestItem},Z(B.a,{field:this.props.field,anchor:this.fieldRef.current,position:this.suggestPosition,onClose:this.closeSuggest,onSelectContact:this.onSelectSuggestContact,onShowAllContacts:this.showAllContacts,suggestId:":a11y-compose-listbox",a11yFirstSuggestItem:this.a11yFirstSuggestItem,mailboxUid:this.props.mailboxUid}))}},{key:"renderYabblePopup",value:function(){return this.selectedYabbleRef?Z(D.a,{anchor:this.selectedYabbleRef,onClose:this.closeYabblePopup},void 0,Z(x.a,{contact:this.selectedContact,availableAddresses:this.availableAddresses,onSelectAddress:this.onSelectYabbleAddress,onCopy:this.onYabbleCopy,onEdit:this.onYabbleEdit,onWriteOnly:this.onYabbleWriteOnly})):null}},{key:"contactsFormatterService",get:function(){return this.props.services.contactsFormatter}},{key:"contactsController",get:function(){return this.props.controllers.contacts}},{key:"abookPopupController",get:function(){return this.props.controllers.abookPopup}},{key:"contactsStore",get:function(){return this.props.stores.contacts}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"suggestController",get:function(){return this.props.controllers.contactsSuggest}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"composeContainerRef",get:function(){return this.props.visual.refs.composeContainer}},{key:"addresses",get:function(){var e=this.props,t=e.data,n=e.field;return t.addresses[n]}},{key:"allAddresses",get:function(){return this.props.data.addresses}},{key:"availableAddresses",get:function(){var e=this.selectedContact;return e?e.isLocal()?e.isValid()?[e]:[]:M.default.isGroupContact(e)?e.group.map(function(e){return{email:e.email,name:e.name}}):e.emailList?e.emailList.map(function(t){return{email:t,name:e.name}}):[e]:[]}}]),t}(),O.propTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach(function(t){V(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},j.a,{stores:I.a.isRequired}),i=te((o=_).prototype,"suggestPosition",[A.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),a=te(o.prototype,"selectedYabbleRef",[A.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),s=te(o.prototype,"selectedContact",[A.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),c=te(o.prototype,"a11yFirstSuggestItem",[A.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return re()}}),te(o.prototype,"contactsFormatterService",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsFormatterService"),o.prototype),te(o.prototype,"contactsController",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsController"),o.prototype),te(o.prototype,"abookPopupController",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"abookPopupController"),o.prototype),te(o.prototype,"contactsStore",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsStore"),o.prototype),te(o.prototype,"metrikaService",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),te(o.prototype,"suggestController",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggestController"),o.prototype),te(o.prototype,"composeController",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),te(o.prototype,"composeContainerRef",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeContainerRef"),o.prototype),te(o.prototype,"addresses",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"addresses"),o.prototype),te(o.prototype,"allAddresses",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"allAddresses"),o.prototype),te(o.prototype,"availableAddresses",[A.computed],Object.getOwnPropertyDescriptor(o.prototype,"availableAddresses"),o.prototype),u=te(o.prototype,"changeContactEmail",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){if(t!==n){var r=null,o=!1;e.addresses.forEach(Object(A.action)(function(e,i){e.email===n?r=i:e.email===t&&(o=!0)})),o?e.addresses.splice(r,1):e.addresses[r]=e.contactsStore.findContactByEmail(t),e.metrikaService.sendHeaderMetrika(H.COMPOSE_METRIKA_HEADER_YABBLE_POPUP,H.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_EMAIL)}}}}),l=te(o.prototype,"closeSuggest",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.suggestController.closeSuggest(e.props.field)}}}),p=te(o.prototype,"closeYabblePopup",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.selectedYabbleRef=null,e.composeContainerRef.contains(document.activeElement)||e.composeContainerRef.focus()}}}),f=te(o.prototype,"onClick",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.suggestPosition=t,e.suggestController.searchPopular(e.props.field)}}}),d=te(o.prototype,"onInput",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){e.suggestPosition=n,e.suggestController.searchContacts(t,e.props.field),e.a11yFirstSuggestItem=re()}}}),y=te(o.prototype,"onSpecialKey",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){t.keyCode!==K.a.DOWN||e.suggestController.isSuggestOpened(e.props.field)||(t.preventDefault(),t.stopPropagation(),e.onClick(n))}}}),b=te(o.prototype,"onSelectSuggestContact",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.onSelectSuggestContact&&e.props.onSelectSuggestContact(t),e.fieldControlRef.current&&e.fieldControlRef.current.addYabble({field:e.props.field,contact:t}),e.closeSuggest()}}}),m=te(o.prototype,"onAbookContactsSelected",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.data.addresses[e.props.field]=t.map(Object(A.action)(function(e){return M.default.of(e)})),e.focus()}}}),h=te(o.prototype,"onYabbleClick",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n,r){e.selectedYabbleRef&&e.selectedYabbleRef.current===n.current?e.closeYabblePopup():(e.selectedYabbleRef=n,e.selectedContact=r)}}}),v=te(o.prototype,"onYabbleWriteOnly",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.contactsController.setSingleRecipient({email:e.selectedContact.email}),e.closeYabblePopup(),e.metrikaService.sendHeaderMetrika(H.COMPOSE_METRIKA_HEADER_YABBLE_POPUP,H.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_WRITE_ONLY)}}}),g=te(o.prototype,"onTopContentInFixedModeChanged",[A.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t&&(e.selectedYabbleRef=null,e.closeSuggest())}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return K});var r,o,i,a,s,c,u,l,p,f=n(135),d=n.n(f),y=n(339),b=n.n(y),m=n(342),h=n(341),v=n(1117),g=n.n(v),O=n(380),_=(n.n(O),n(521)),S=(n.n(_),n(376)),E=n.n(S),P=n(2918),C=n(1516),w=n(544),T=n(1517),k=n(344),A=n(138),R=(n.n(A),n(2923));n.n(R);function j(e){"@babel/helpers - typeof";return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t,n,r){p||(p="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:p,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function x(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function B(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var F="ComposeContactsSuggestDesktop",z={Block:F,Block_small:"".concat(F,"_small"),Content:"".concat(F,"-Content"),List:"".concat(F,"-List"),Separator:"".concat(F,"-Separator"),Action:"".concat(F,"-Action"),IconMore:"".concat(F,"-IconMore")},U=N(k.default,{loc:"compose-react/searchAllContacts"}),K=Object(m.inject)("controllers","visual")(r=Object(m.observer)((l=u=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return(n=function(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?D(e):t}(this,(e=I(t)).call.apply(e,[this].concat(o))))._popupDirections=["bottom-start","bottom","bottom-end"],n._disposer=new _.Disposer,x(D(n),"position",i,D(n)),x(D(n),"selectedContactIndex",a,D(n)),x(D(n),"onHoverContact",s,D(n)),n.onKeyDown=function(e){if(n.visible)switch(e.keyCode){case E.a.UP:n.switchSelectedContactIndex(-1,e);break;case E.a.DOWN:n.switchSelectedContactIndex(1,e);break;case E.a.ENTER:case E.a.TAB:n.selectCurrentContact()}},n.onVisibilityChanged=function(){n.visible?n._disposer.add("active",[Object(_.addEventListener)({eventName:"keydown",listener:n.onKeyDown,isCapture:!0}),Object(_.addEventListener)({eventName:"resize",listener:n.onResize})]):n._disposer.dispose("active")},n.onResize=g()(function(){return n.updateSuggestPosition()},200),x(D(n),"updateSuggestPosition",c,D(n)),n._onMouseDown=function(e){e.preventDefault(),e.stopPropagation()},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,d.a.Component),function(e,t,n){t&&M(e.prototype,t),n&&M(e,n)}(t,[{key:"selectCurrentContact",value:function(){var e=this.props.onSelectContact;e&&this.selectedContact&&e(this.selectedContact)}},{key:"switchSelectedContactIndex",value:function(e,t){t.preventDefault(),t.stopPropagation(),this.selectedContactIndex=(this.selectedContactIndex+e+this.suggestContacts.length)%this.suggestContacts.length}},{key:"componentDidMount",value:function(){var e=this;this._disposer.add(this,[Object(h.reaction)(function(){return e.visible},this.onVisibilityChanged),Object(h.reaction)(function(){return e.props.position},this.updateSuggestPosition,{fireImmediately:!0,equals:h.comparer.structural})])}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"getSuggestPosition",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{left:0}).left,t=this.props.anchor.getBoundingClientRect();return{top:t.bottom,left:e+t.left}}},{key:"render",value:function(){var e=this;return this.visible&&this.position?N(w.a,{scope:this.composeContainerRef,className:b()(z.Block,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},z.Block_small,this.isSmall)),direction:this._popupDirections,onClose:this.props.onClose,position:this.position,visible:!0,enableFocusTrap:!0},void 0,N("div",{className:z.Content,onMouseDown:this._onMouseDown},void 0,N(T.a,{cls:z.List,query:this.suggest.query,selectedContactIndex:this.selectedContactIndex,contacts:this.suggestContacts,onSelectContact:this.props.onSelectContact,onHoverContact:this.onHoverContact,suggestId:this.props.suggestId,a11yFirstSuggestItem:this.props.a11yFirstSuggestItem}),!this.props.visual.isInIframe&&!this.props.mailboxUid&&d.a.createElement(d.a.Fragment,null,N("div",{"aria-hidden":"true",className:z.Separator}),N(A.Text,{typography:"body-long-m",className:z.Action,onMouseDown:function(e){return e.preventDefault()},onMouseEnter:function(){return e.onHoverContact(null)},onClick:this.props.onShowAllContacts,"aria-hidden":"true"},void 0,N(P.a,{className:z.IconMore}),U)))):null}},{key:"suggestController",get:function(){return this.props.controllers.contactsSuggest}},{key:"suggest",get:function(){return this.props.visual.contactsSuggest}},{key:"suggestContacts",get:function(){var e=this.props.field;return this.suggestController.getSuggestContacts(e)}},{key:"visible",get:function(){return Boolean(this.suggestContacts.length)}},{key:"composeContainerRef",get:function(){return this.props.visual.composeContainerRef}},{key:"selectedContact",get:function(){return this.selectedContactIndex>=0&&this.selectedContactIndex<this.suggestContacts.length?this.suggestContacts[this.selectedContactIndex]:null}},{key:"isSmall",get:function(){return this.props.visual.size===O.ComposeSizes.SMALL}}]),t}(),u.propTypes=C.a,i=B((o=l).prototype,"position",[h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a=B(o.prototype,"selectedContactIndex",[h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B(o.prototype,"suggestController",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggestController"),o.prototype),B(o.prototype,"suggest",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggest"),o.prototype),B(o.prototype,"suggestContacts",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggestContacts"),o.prototype),B(o.prototype,"visible",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"visible"),o.prototype),B(o.prototype,"composeContainerRef",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeContainerRef"),o.prototype),B(o.prototype,"selectedContact",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"selectedContact"),o.prototype),B(o.prototype,"isSmall",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"isSmall"),o.prototype),s=B(o.prototype,"onHoverContact",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.selectedContactIndex=e.suggestContacts.indexOf(t)}}}),B(o.prototype,"switchSelectedContactIndex",[h.action],Object.getOwnPropertyDescriptor(o.prototype,"switchSelectedContactIndex"),o.prototype),c=B(o.prototype,"updateSuggestPosition",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.position&&e.props.anchor&&(e.position=e.getSuggestPosition(e.props.position))}}}),r=o))||r)||r},function(e,t,n){"use strict";var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.25 12.5a6.25 6.25 0 115.07-2.594l3.887 3.887a1 1 0 01-1.414 1.414L9.906 11.32A6.222 6.222 0 016.25 12.5zm0-2a4.25 4.25 0 100-8.5 4.25 4.25 0 000 8.5z",fill:"currentColor"});t.a=function(e){return o.createElement("svg",i({width:16,height:16,viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2920);t.default=r.SuggestItem},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(t,"__esModule",{value:!0}),t.SuggestItem=void 0;var c=a(n(135)),u=n(1475),l=n(2921),p=n(794);t.SuggestItem=function(e){var t=e.contact,n=e.query,o=e.isActive,i=s(e,["contact","query","isActive"]),a=t.isSelf||t.isGroup()||t.name!==t.email,f=l.useHighlight(t,n),d=f.email,y=f.name,b=c.useCallback(function(e){return e.preventDefault()},[]),m=c.useCallback(function(e){return c.default.createElement("div",null,c.default.createElement(p.ContactAvatarWithTooltip,{className:e,contact:t,size:"m"}))},[t]);return c.default.createElement(u.ContactItem,r({onMouseDown:b,renderAvatar:m,name:y,description:a?d:void 0,isActive:o,isExternal:t.isExternalContact()},i))}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.useHighlight=t.useTextHighlight=t.applyHighlight=void 0;var i=o(n(135)),a=n(136),s=o(n(344)),c=n(138),u=o(n(419));t.applyHighlight=function(e,t,n){if(void 0===n&&(n={weight:"bold"}),!t)return e;var o=new RegExp(a.escapeRegExp(t),"gi"),s=e.split(o),u=[];e.replace(o,function(e){return u.push(e),e});var l=[s[0]];return s.slice(1).forEach(function(e,t){var o=u[t];l.push(i.default.createElement(c.Text,r({key:t},n),o)),l.push(e)}),i.default.createElement(i.default.Fragment,null,l)};t.useTextHighlight=function(e,n){return t.applyHighlight(e,n)};t.useHighlight=function(e,n){return{name:e.isSelf?i.default.createElement(s.default,{loc:"compose-react/Send_it_to_me"}):t.applyHighlight(e.name,n),email:u.default.isGroupContact(e)?i.default.createElement(s.default,{loc:"compose-react/GroupYabble_N_Recipients",params:{count:e.group.length}}):t.applyHighlight(e.email,n,{weight:"bold",color:"secondary"})}}},function(e,t){e.exports={contactItemHeight:"52px"}},function(e,t){},function(e,t,n){"use strict";var r,o,i,a,s,c=n(135),u=n.n(c),l=n(139),p=n.n(l),f=n(342),d=n(341),y=n(1516),b=n(1517),m=n(1478),h=n(2925);n.n(h);function v(e){"@babel/helpers - typeof";return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var P="ComposeContactsSuggestMobile",C=Object(f.inject)("controllers","visual")(r=Object(f.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=O(this,(e=_(t)).call.apply(e,[this].concat(o)))).containerRef=u.a.createRef(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,u.a.Component),function(e,t,n){t&&g(e.prototype,t),n&&g(e,n)}(t,[{key:"render",value:function(){if(!this.visible)return null;var e=this.props,t=e.scope,n=e.position,r=n&&n.top,o=r?{top:r}:null;return p.a.createPortal(u.a.createElement("div",{ref:this.containerRef,className:P,style:o},function(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(b.a,{query:this.suggest.query,contacts:this.suggestContacts,onSelectContact:this.props.onSelectContact,onClose:this.props.onClose,isMobile:!0})),t)}},{key:"suggestController",get:function(){return this.props.controllers.contactsSuggest}},{key:"suggest",get:function(){return this.props.visual.contactsSuggest}},{key:"suggestContacts",get:function(){var e=this.props.field;return this.suggestController.getSuggestContacts(e)}},{key:"visible",get:function(){return this.suggestContacts.length}}]),t}(),i.propTypes=y.a,E((o=a).prototype,"suggestController",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggestController"),o.prototype),E(o.prototype,"suggest",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggest"),o.prototype),E(o.prototype,"suggestContacts",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggestContacts"),o.prototype),E(o.prototype,"visible",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"visible"),o.prototype),r=o))||r)||r;t.a=Object(m.a)(C)},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var r=n(136),o=(n.n(r),n(139)),i=n.n(o),a=n(376),s=n.n(a),c=n(367),u=n(419),l=n(2927),p=n(349),f=(n.n(p),n(1501)),d=n(373),y=(n.n(d),n(379));function b(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h="yabble-removed",v=Object(y.cnTheme)(d.PS_LIGHT).split(" "),g=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onYabbleEdit=function(e,t){n.element.focus(),setTimeout(function(){n.element.editBubble(t.current.parentNode),Object(l.a)(n.element)},0)},this.onYabbleRemove=function(e){var t=n._getParentBubble(e.target);setTimeout(function(){return n.element.removeBubble(t)},50)},this.onWindowResize=function(){n.previousWidth&&n.node.clientWidth!==n.previousWidth&&(n.node.clientWidth>n.previousWidth&&n.showYabbles(!0),n.hideYabbles())},this.initializeBubbles=function(){var e=n.element=document.createElement("div",{is:"x-bubbles"});n.node.firstElementChild?n.node.insertBefore(e,n.node.firstElementChild):n.node.appendChild(e),e.className="composeYabbles",e.options("bubbleCopy",n.onBubbleCopy),e.options("bubbleFormation",n.onBubbleFormation),e.options("bubbleDeformation",n.onBubbleDeformation),e.options("checkBubblePaste",function(){return!1}),e.options("lineBreakReplacer","; "),e.setAttribute("is","x-bubbles"),e.setAttribute("data-selection","true"),e.setAttribute("data-class-bubble","yabble-compose js-yabble"),e.setAttribute("data-separator",""),e.setAttribute("contenteditable","true"),e.setAttribute("id",n.id),e.setAttribute("title",n.title),e.setAttribute("aria-label",n.title),e.setAttribute("role","textbox"),e.setAttribute("aria-controls",":a11y-compose-listbox"),e.setAttribute("aria-expanded","false"),n.addNodeEvent(e,"focus",n.onFocus),n.addNodeEvent(e,"blur",n.onBlur),n.addNodeEvent(e,"keyup",n.onKeyUp),n.addNodeEvent(e,"change",n.onBubblesChanged),n.addNodeEvent(e,"before-remove",n.onBubbleRemove),n.addNodeEvent(e,"mousedown",n.onMouseDownCapture,!0),n.addNodeEvent(e,"click",n.onClick),n.draggable&&(n.addNodeEvent(e,"dragstart",n.onDragStart),n.addNodeEvent(e,"dragend",n.onDragEnd)),n.addNodeEvent(window,"resize",n.onWindowResize)},this.addNodeEvent=function(e,t,r){for(var o=arguments.length,i=new Array(o>3?o-3:0),a=3;a<o;a++)i[a-3]=arguments[a];e.addEventListener.apply(e,[t,r].concat(i)),n.disposer.add(n,[function(){return e.removeEventListener.apply(e,[t,r].concat(i))}])},this.onDragStart=function(e){if(1===n.getBubbles().filter(function(e){return e.hasAttribute("selected")}).length&&e.dataTransfer&&e.dataTransfer.setDragImage){var t;if(n.dragElement=e.target.cloneNode(!0),n.dragElement.classList.add("compose-yabble-drag-image"),!Object(p.hasFeature)(p.Features.WEB_DARK_COMPOSE))(t=n.dragElement.classList).add.apply(t,b(v));document.body.appendChild(n.dragElement),e.dataTransfer.setDragImage(n.dragElement,20,20)}n.events.onDragStart&&n.events.onDragStart()},this.onDragEnd=function(){n.dragElement&&(document.body.removeChild(n.dragElement),n.dragElement=null)},this.moveCursorToEnd=function(){var e=document.createRange();e.selectNodeContents(n.element),e.collapse(!1);var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},this.onMoreYabbleClick=function(){n.element.bubbling(),n.element.blur(),setTimeout(function(){return n.element.focus()})},this.onBubbleCopy=function(e){return e.map(function(e){var t=n.contactsStore.findContactByEmail(e.getAttribute("data-email"));return n.formatterService.contactToString(t)}).join(", ")},this.onBubbleFormation=function(e){n.isEditing=!1,n.isEditContactAllowed||e.setAttribute("readonly",!0),n.formatterService.parseContacts(e.textContent.trim()).forEach(function(t,r){var o=0===r?e:document.createElement("span");0!==r&&(o.setAttribute("bubble",""),o.setAttribute("contenteditable",!1),o.setAttribute("draggable",!0),o.className="js-yabble yabble-compose",n.element.appendChild(o)),n._processUserInput(t,o)})},this.onYabbleMounted=function(){n.yabblesToMount-=1,n.isYabblesExpanded||0!==n.yabblesToMount||n.hideYabbles()},this.onBubbleDeformation=function(e){n.isEditing=!0,i.a.unmountComponentAtNode(e);var t=e.getAttribute("data-email"),r=n.contactsStore.findContactByEmail(t),o=n.convertContactToText(r);return r.isLocal()&&n.contactsStore.deleteContactByEmail(t),n.element.focus(),o},this.onBubbleRemove=function(e){e.detail.data.forEach(function(e){i.a.unmountComponentAtNode(e);var t=n.contactsStore.findContactByEmail(e.getAttribute("data-email"));e.innerText=n.formatterService.contactToString(t),e.classList.add(h,"is-hidden"),t&&t.isLocal()&&n.contactsStore.deleteContactByEmail(t.email)}),document.activeElement===n.element&&setTimeout(function(){return n.reFocus()}),n.refreshHiddenYabbles(),n.clearDrag(),n.events.onInternalYabbleRemove&&n.events.onInternalYabbleRemove()},this.onBlur=function(e){n.events.onBlur&&n.events.onBlur(e)},this.onFocus=function(e){n.yabbleClicked||(n.showYabbles(),n.events.onFocus(e))},this.onMouseDownCapture=function(e){document.activeElement!==n.element&&(e.target===n.element||n.showMoreYabblesNode&&n.showMoreYabblesNode.contains(e.target)||(n.yabbleClicked=!0))},this.onClick=function(e){if(e.target===n.element){var t=n.element.editor.inputValue().trim();t?n.events.onInput(t):n.events.onClick()}n.yabbleClicked&&(n.element.blur(),n.yabbleClicked=!1)},this.onBubblesChanged=function(){n.isEditing=!1;var e=n.getBubbles();e.filter(function(e){return e.classList.contains(h)}).forEach(function(e){n.onBubbleFormation(e),e.classList.remove(h,"is-hidden")});for(var t=n.getContacts(),r=e.length-1;r>=0;r--)for(var o=t[r],a=0;a<r;a++){if(t[a].email===o.email){var s=e[r];i.a.unmountComponentAtNode(s),s.parentNode===n.element&&n.element.removeChild(s)}}n.events.onBubblesChanged(n.getContacts()),n.clearDrag()},this.onKeyUp=function(e){[s.a.UP,s.a.DOWN,s.a.TAB,s.a.SHIFT,s.a.ESC,s.a.ENTER,s.a.CTRL].concat(b(s.a.META)).indexOf(e.keyCode)>=0?n.events.onSpecialKey(e):n.events.onInput(n.element.editor.inputValue().trim())},this.node=t.node,this.name=t.name,this.canHideYabbles=t.canHideYabbles,this.contactsStore=t.contactsStore,this.convertContactToText=t.convertContactToText,this.formatterService=t.formatterService,this.renderYabble=t.renderYabble,this.renderShowMoreYabble=t.renderShowMoreYabble,this.isEditing=!1,this.disposer=new c.a,this.isYabblesExpanded=t.isYabblesExpanded||!1,this.draggable=t.draggable||!1,this.id=t.id,this.title=t.title,this.isEditContactAllowed=t.isEditContactAllowed,this.events={onFocus:t.onFocus,onBlur:t.onBlur,onClick:t.onClick,onInput:t.onInput,onSpecialKey:t.onSpecialKey,onBubblesChanged:t.onBubblesChanged,onDragStart:t.onDragStart,onInternalYabbleRemove:t.onInternalYabbleRemove,onBubblesExpanded:t.onBubblesExpanded},this.initializeBubbles()}return function(e,t,n){t&&m(e.prototype,t),n&&m(e,n)}(e,[{key:"setA11Y",value:function(e){var t=this;setTimeout(function(){t.element&&(t.element.setAttribute("aria-expanded",e?"true":"false"),t.element.setAttribute("aria-activedescendant",e))},500)}},{key:"destroyBubbles",value:function(){var e=this.element;this.disposer.dispose(this),this._cleanupBubbles(this.getBubbles()),this.node.removeChild(e)}},{key:"syncYabbles",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this.getBubbles();if(this._haveBubblesChanges(n,t)){this.destroyShowMoreYabbles(),this.yabblesToMount=t.length;var o=this._createBubblesHash(n);t.forEach(function(t){return e._tryAttachBubbleFromHash(t,o)}),this._cleanupBubbles(Object(r.values)(o)),this.refreshHiddenYabbles()}}},{key:"_haveBubblesChanges",value:function(e,t){var n=e.map(function(e){return e.getAttribute("data-email")}),o=t.map(function(e){return e.email});return!Object(r.isEqual)(n,o)}},{key:"_createBubblesHash",value:function(e){var t={};return e.forEach(function(e){t[e.getAttribute("data-email")]=e}),t}},{key:"_tryAttachBubbleFromHash",value:function(e,t){var n=e.email,r=t[n];r?(this.element.appendChild(r),delete t[n],this.yabblesToMount-=1):this.addYabbleSilently(e)}},{key:"_cleanupBubbles",value:function(e){var t=this;e.forEach(function(e){i.a.unmountComponentAtNode(e),t.element.removeChild(e)})}},{key:"createShowMoreYabbles",value:function(e,t){var n=!this.getBubbles().filter(function(e){return e.classList.contains("is-hidden")}).find(function(e){return e.children[0]&&e.children[0].classList.contains("ComposeYabble_invalid")}),r=this.showMoreYabblesNode=document.createElement("span");r.setAttribute("bubble",""),r.setAttribute("contenteditable","false"),r.className="yabble-compose yabble-compose_more js-yabble-more",this.changeShowMoreYabblesVisibility(!1),this.element.appendChild(r),i.a.render(this.renderShowMoreYabble({count:e,onClick:this.onMoreYabbleClick,setTargetRef:this.setTargetRef,isValid:n}),r,t)}},{key:"changeShowMoreYabblesVisibility",value:function(e){this.showMoreYabblesNode&&(this.showMoreYabblesNode.style.opacity=e?"1":"0")}},{key:"destroyShowMoreYabbles",value:function(){this.showMoreYabblesNode&&(i.a.unmountComponentAtNode(this.showMoreYabblesNode),this.element.removeChild(this.showMoreYabblesNode),this.showMoreYabblesNode=null)}},{key:"calculateAndAddShowMoreYabblesCount",value:function(e){var t=this,n=this.getActualBubbles().reduce(function(e,t){return t.classList.contains("is-hidden")?++e:e},0);this.destroyShowMoreYabbles(),n>0&&this.createShowMoreYabbles(n,function(){t.changeShowMoreYabblesVisibility(!0),e&&e()})}},{key:"showYabbles",value:function(e){var t=this.getActualBubbles();this.destroyShowMoreYabbles(),this.clearYabbleOverflow(),t.length>0&&(t.forEach(function(e){return e.classList.remove("is-hidden")}),t[0].removeAttribute("style")),e||this.moveCursorToEnd(),this.isYabblesExpanded=!0,e||this.events.onBubblesExpanded&&this.events.onBubblesExpanded()}},{key:"reFocus",value:function(){document.activeElement===this.element&&this.element.blur(),this.element.focus()}},{key:"hideYabbles",value:function(){var e=this;!function t(){var n=e.getActualBubbles();if(n.length){var r=n[0],o=Object(f.a)({elements:n,hiddenClass:"is-hidden",summary:e.showMoreYabblesNode});if(-1!==o.indexOf(r)&&(o.splice(0,1),e.hasYabbleOverflow=!0),o.length)o.forEach(function(e){return e.classList.add("is-hidden")}),e.calculateAndAddShowMoreYabblesCount(t);else if(e.previousWidth=e.node.clientWidth,e.isYabblesExpanded=!1,document.activeElement===e.element&&document.activeElement.blur(),e.hasYabbleOverflow){var i=e.showMoreYabblesNode.offsetWidth;r.classList.add("js-yabble-overflow");var a=r.firstChild;a&&(a.style.maxWidth="calc(100% - ".concat(16,"px - ").concat(i,"px)")),e.hasYabbleOverflow=!1}}}()}},{key:"clearYabbleOverflow",value:function(){var e=this.getActualBubbles();if(e.length){var t=e[0];t.classList.contains("js-yabble-overflow")&&(t.classList.remove("js-yabble-overflow"),t.firstChild&&(t.firstChild.style.maxWidth=null))}}},{key:"addYabble",value:function(e){this.element.addBubble(this.formatterService.contactToString(e),{email:e.email})}},{key:"addYabbleSilently",value:function(e){var t=document.createElement("span");this.contactsStore.writeContact(e),t.setAttribute("data-email",e.email),t.setAttribute("bubble",""),t.setAttribute("contenteditable",!1),t.setAttribute("draggable",this.draggable),t.className="js-yabble yabble-compose",t.innerText=this.formatterService.contactToString(e),this.element.appendChild(t),this.onBubbleFormation(t)}},{key:"_updateContactForEmail",value:function(e){var t=e.email,n=this.contactsStore.findContactByEmail(t);return n||(n=u.default.of(e),this.contactsStore.writeContact(n)),e.name&&e.name!==n.name&&(n.name=e.name),n}},{key:"_processUserInput",value:function(e,t){var n=this._updateContactForEmail(e);return t.setAttribute("data-email",n.email),i.a.render(this.renderYabble({contact:n}),t,this.onYabbleMounted),t}},{key:"_getParentBubble",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=0,r=e;++n<=t;){if(r.hasAttribute("bubble"))return r;r=r.parentNode}return null}},{key:"refreshHiddenYabbles",value:function(){this.isYabblesExpanded||(this.showYabbles(!0),this.hideYabbles())}},{key:"clearDrag",value:function(){this.element.classList.remove("dropzone"),this.element.classList.remove("drag"),this.yabbleClicked=!1,this.onDragEnd()}},{key:"getBubbles",value:function(){return Array.prototype.slice.call(this.element.childNodes).filter(function(e){return e.nodeType===Node.ELEMENT_NODE&&!e.classList.contains("js-yabble-more")})}},{key:"getActualBubbles",value:function(){return this.getBubbles().filter(function(e){return!e.classList.contains(h)})}},{key:"getContacts",value:function(){var e=this;return this.getBubbles().map(function(t){return e._updateContactForEmail({email:t.getAttribute("data-email")})})}},{key:"getText",value:function(){return this.element.textContent.trim().replace(/\u200B/g,"")}},{key:"isEmpty",value:function(){return 0===this.getText().length}}]),e}()},function(e,t,n){"use strict";t.a=function(e){var t=e.firstChild;t&&t.nodeType===Node.TEXT_NODE&&8203===t.data.charCodeAt(0)&&t.remove()}},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(342),u=n(375),l=n(794),p=(n.n(l),n(1519)),f=n(360),d=n(711);function y(e){"@babel/helpers - typeof";return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var O=g(f.default,{id:"mail--Compose-RemoveYabble",focusable:!1}),_=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,h(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.avatars,n=e.contact,r=e.lang,o=e.onClick,i=e.onRemove;return g(c.Provider,{controllers:{avatars:t}},void 0,g(u.default,{lang:r},void 0,g(d.a,{nodeRef:this.props.innerRef,AvatarComponent:l.ContactAvatarWithTooltip,ContentComponent:p.a,getContact:function(){return n},removeIcon:O,isEditable:!0,onClick:o,onRemove:i})))}}]),t}();_.propTypes={avatars:s.a.object,contact:s.a.object,innerRef:s.a.object,lang:s.a.string,onClick:s.a.func,onRemove:s.a.func}},function(e,t,n){"use strict";n.d(t,"a",function(){return S});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(375),u=n(711),l=n(344),p=n(415),f=n(2930);n.n(f);function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function y(e){"@babel/helpers - typeof";return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var _={Block:"ComposeShowMoreYabble",Icon:"".concat("ComposeShowMoreYabble","-Icon")},S=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,v(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&m(e.prototype,t),n&&m(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.count,n=e.lang,r=b(e,["count","lang"]);return O(c.default,{lang:n},void 0,i.a.createElement(u.a,d({ContentComponent:function(){return O("div",{className:_.Block},void 0,O(l.default,{loc:"compose-react/More_N",params:{count:t}}),O(p.a,{cls:_.Icon,id:"mail--ComposeReact-Expand"}))},isEditable:!1},r)))}}]),t}();S.propTypes={count:s.a.number,lang:s.a.string}},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return x});var r,o,i,a,s,c,u,l,p,f,d,y=n(135),b=n.n(y),m=n(339),h=n.n(m),v=n(341),g=n(342),O=n(1116),_=n(710),S=n.n(_),E=n(1515),P=n(1518),C=n(354),w=(n.n(C),n(2934));n.n(w);function T(e){"@babel/helpers - typeof";return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n,r){d||(d="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:d,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function I(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function D(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var L="MultipleAddressesMobile",N={Block:L,Field:"".concat(L,"-Field"),SuggestContainer:"".concat(L,"-SuggestContainer")},x=Object(g.inject)("data","services","controllers","visual")(r=Object(g.observer)((f=p=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),p=0;p<r;p++)o[p]=arguments[p];return(n=function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?R(e):t}(this,(e=A(t)).call.apply(e,[this].concat(o)))).fieldRef=b.a.createRef(),I(R(n),"suggestPosition",i,R(n)),I(R(n),"closeSuggest",a,R(n)),n.onYabblesChanged=function(){var e;n.suggestPosition=n.getSuggestPosition(),n.props.onYabblesChanged&&(e=n.props).onYabblesChanged.apply(e,arguments),n.closeSuggest()},n.convertContactToText=function(e){var t=e.email;return{text:t,startOffset:t.length,endOffset:t.length}},I(R(n),"onClick",s,R(n)),I(R(n),"onInput",c,R(n)),I(R(n),"onSelectSuggestContact",u,R(n)),n.onTitleClick=function(){n.composeController.focusComposeField(n.props.field)},I(R(n),"onYabbleClick",l,R(n)),n.getSuggestPosition=function(){var e=n.props.innerRef.current;return e?{top:e.offsetTop+e.clientHeight}:null},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,b.a.Component),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"render",value:function(){var e=h()(N.Block,this.props.cls);return b.a.createElement("div",{className:e,ref:this.props.innerRef},M(S.a,{title:this.props.title,onTitleClick:this.onTitleClick},void 0,b.a.createElement(P.a,{ref:this.fieldRef,cls:N.Field,convertContactToText:this.convertContactToText,field:this.props.field,onClick:this.onClick,onFocus:this.props.onFocus,onInput:this.onInput,onYabbleClick:this.onYabbleClick,onYabblesChanged:this.onYabblesChanged})),M(E.a,{field:this.props.field,onClose:this.closeSuggest,onSelectContact:this.onSelectSuggestContact,scope:this.props.visual.refs.topContent,position:this.suggestPosition}))}},{key:"contactsController",get:function(){return this.props.controllers.contacts}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"suggestController",get:function(){return this.props.controllers.contactsSuggest}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"addresses",get:function(){var e=this.props,t=e.data,n=e.field;return t.addresses[n]}},{key:"allAddresses",get:function(){return this.props.data.addresses}},{key:"contacts",get:function(){var e=this;return this.addresses.map(function(t){return e.contactsController.replaceLoadedContact(t)})}}]),t}(),p.propTypes=O.a,i=D((o=f).prototype,"suggestPosition",[v.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),D(o.prototype,"contactsController",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsController"),o.prototype),D(o.prototype,"metrikaService",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),D(o.prototype,"suggestController",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggestController"),o.prototype),D(o.prototype,"composeController",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),D(o.prototype,"addresses",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"addresses"),o.prototype),D(o.prototype,"allAddresses",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"allAddresses"),o.prototype),D(o.prototype,"contacts",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"contacts"),o.prototype),a=D(o.prototype,"closeSuggest",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.suggestController.closeSuggest(e.props.field)}}}),s=D(o.prototype,"onClick",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){setTimeout(Object(v.action)(function(){e.suggestPosition=e.getSuggestPosition(),e.suggestController.searchPopular(e.props.field)}),0)}}}),c=D(o.prototype,"onInput",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.suggestPosition=e.getSuggestPosition(),e.suggestController.searchContacts(t,e.props.field)}}}),u=D(o.prototype,"onSelectSuggestContact",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.onSelectSuggestContact&&e.props.onSelectSuggestContact(t),e.fieldRef.current&&e.fieldRef.current.addYabble({field:e.props.field,contact:t}),e.closeSuggest()}}}),l=D(o.prototype,"onYabbleClick",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){e.fieldRef.current&&e.fieldRef.current.editBubble({field:e.props.field,event:t,yabble:n}),e.metrikaService.sendHeaderMetrika(C.COMPOSE_METRIKA_HEADER_YABBLE_POPUP,C.COMPOSE_METRIKA_HEADER_YABBLE_POPUP_EDIT)}}}),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";var r=n(1471);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={to:"compose-react/Header_Addresses_To",cc:"compose-react/Header_Addresses_Cc",bcc:"compose-react/Header_Addresses_Bcc",from:"compose-react/Header_Addresses_From"}},function(e,t){},function(e,t,n){"use strict";var r=n(2939);t.a=r.a},function(e,t,n){"use strict";n.d(t,"a",function(){return D});var r,o,i,a,s,c,u,l,p,f=n(135),d=n.n(f),y=n(342),b=n(341),m=n(367),h=n(376),v=n.n(h),g=n(2940),O=n(544),_=n(2941),S=n(355),E=(n.n(S),n(2943));n.n(E);function P(e){"@babel/helpers - typeof";return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n,r){p||(p="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:p,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function R(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function j(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var M="ComposeSmartSubjectSuggestDesktop",I={Block:M,Content:"".concat(M,"-Content"),List:"".concat(M,"-List"),Separator:"".concat(M,"-Separator"),Action:"".concat(M,"-Action"),IconMore:"".concat(M,"-IconMore")},D=Object(y.inject)("controllers","data","visual")(r=Object(y.observer)((l=u=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return(n=function(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?T(e):t}(this,(e=w(t)).call.apply(e,[this].concat(o))))._disposer=new m.a,n.direction=["bottom-start","bottom","bottom-end"],R(T(n),"selectedIndex",i,T(n)),n.onClickItem=function(e){n.selectItem(e),n.focusComposeBody()},R(T(n),"onHoverItem",a,T(n)),n.onKeyDown=function(e){if(n.visible)switch(e.keyCode){case v.a.UP:n.switchSelectedIndex(-1===n.selectedIndex?0:-1,e);break;case v.a.DOWN:n.switchSelectedIndex(1,e);break;case v.a.ENTER:n.selectCurrent(),n.focusComposeBody();break;case v.a.TAB:n.selectCurrent()}},R(T(n),"selectItem",s,T(n)),n.focusComposeBody=function(){n.props.controllers.compose.focusComposeField("body")},n._onOutsideClick=function(e,t){"click"===t&&e.target===n.props.anchor||n.closeSuggest()},R(T(n),"closeSuggest",c,T(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,d.a.Component),function(e,t,n){t&&C(e.prototype,t),n&&C(e,n)}(t,[{key:"selectCurrent",value:function(){this.selectItem(this.selectedItem)}},{key:"switchSelectedIndex",value:function(e,t){t.preventDefault(),t.stopPropagation(),this.selectedIndex=(this.selectedIndex+e+this.items.length)%this.items.length}},{key:"resetSelectedIndex",value:function(){this.selectedIndex=-1}},{key:"componentDidMount",value:function(){var e=this;this._disposer.addEventListener(this,{element:document,eventName:"keydown",listener:this.onKeyDown,isCapture:!0}),this._disposer.add(this,[Object(b.reaction)(function(){return e.subject},function(t){e.props.anchor!==document.activeElement||t||e.props.controllers.smartSubject.getSmartSubjectsForInput()}),Object(b.reaction)(function(){return e.visible},function(t){t&&e.resetSelectedIndex()})])}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"_getSuggestPosition",value:function(){var e=this.props.anchor.getBoundingClientRect();return{top:e.bottom,left:e.left}}},{key:"render",value:function(){var e=this.props,t=e.scope,n=e.anchor;if(!t||!this.visible)return null;var r=n?this._getSuggestPosition():{};return A(O.a,{className:I.Block,direction:this.direction,onClose:this._onOutsideClick,position:r,visible:!0,scope:this.props.visual.composeContainerRef},void 0,A("div",{className:I.Content},void 0,A(_.a,{cls:I.List,highlight:this.subject,selectedIndex:this.selectedIndex,items:this.items,onClickItem:this.onClickItem,onHoverItem:this.onHoverItem})))}},{key:"subject",get:function(){return this.props.data.subject}},{key:"suggest",get:function(){return this.props.visual.subjectsSuggest}},{key:"items",get:function(){var e=this;return this.subject?this.suggest.suggestItems.filter(function(t){return(t.text||"").indexOf(e.subject)>=0}):this.suggest.suggestItems}},{key:"visible",get:function(){return Boolean(this.suggest.suggestType===S.SmartSubjectType.INPUT&&this.items.length)}},{key:"composeContainerRef",get:function(){return this.props.visual.refs.composeContainer}},{key:"selectedItem",get:function(){return this.selectedIndex>=0&&this.selectedIndex<this.items.length?this.items[this.selectedIndex]:null}}]),t}(),u.propTypes=g.a,i=j((o=l).prototype,"selectedIndex",[b.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),j(o.prototype,"subject",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"subject"),o.prototype),j(o.prototype,"suggest",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"suggest"),o.prototype),j(o.prototype,"items",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"items"),o.prototype),j(o.prototype,"visible",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"visible"),o.prototype),j(o.prototype,"composeContainerRef",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeContainerRef"),o.prototype),j(o.prototype,"selectedItem",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"selectedItem"),o.prototype),a=j(o.prototype,"onHoverItem",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.selectedIndex=e.items.indexOf(t)}}}),s=j(o.prototype,"selectItem",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t&&(e.props.data.subject=t.text,e.props.anchor.value=t.text,e.props.controllers.smartSubject.logSuggestSelect(t)),e.closeSuggest()}}}),c=j(o.prototype,"closeSuggest",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.subjectsSuggest.suggestType=""}}}),j(o.prototype,"switchSelectedIndex",[b.action],Object.getOwnPropertyDescriptor(o.prototype,"switchSelectedIndex"),o.prototype),j(o.prototype,"resetSelectedIndex",[b.action],Object.getOwnPropertyDescriptor(o.prototype,"resetSelectedIndex"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";var r=n(338),o=n.n(r),i=n(361),a=n(363),s=n(366);t.a={scope:o.a.object,anchor:o.a.object,controllers:i.a.isRequired,data:a.a.isRequired,visual:s.a.isRequired}},function(e,t,n){"use strict";n.d(t,"a",function(){return M});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(136),d=(n.n(f),n(339)),y=n.n(d),b=n(341),m=n(480),h=n(367),v=n(594),g=n(1472),O=n(420),_=n(138),S=(n.n(_),n(2942));n.n(S);function E(e){"@babel/helpers - typeof";return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var A=Object(O.a)(v.c,"div"),R="ComposeSmartSubjectsList",j={Block:R,Item:"".concat(R,"-Item"),ItemActive:"".concat(R,"-Item_active"),Text:"".concat(R,"-Text"),HighlightedText:"".concat(R,"-HighlightedText")},M=(a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=function(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?w(e):t}(this,(e=C(t)).call.apply(e,[this].concat(i))))._disposer=new h.a,function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(w(n),"onClickItem",o,w(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,u.a.Component),function(e,t,n){t&&P(e.prototype,t),n&&P(e,n)}(t,[{key:"render",value:function(){var e=this;return k(A,{className:y()(j.Block,this.props.cls),cls:y()(j.Block,this.props.cls),selectedIndex:this.props.selectedIndex,itemHeight:40},void 0,this.props.items.map(function(t,n){return e.renderItem(t,n)}))}},{key:"renderItem",value:function(e,t){var n=this,r=this.props,o=r.onHoverItem,i=t===r.selectedIndex;return k("div",{className:y()(j.Item,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},j.ItemActive,i)),onClick:function(){return n.onClickItem(e)},onMouseEnter:function(){return o(e)}},"SuggestItem-".concat(t),k(_.Text,{typography:"body-long-m",className:j.Text},void 0,this._applyHighlight(e.text)))}},{key:"_applyHighlight",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.props.highlight;if(!t)return e;var n=new RegExp(Object(f.escapeRegExp)(t),"gi"),r=e.split(n),o=[];e.replace(n,function(e){return o.push(e)});var i=[r[0]];return r.slice(1).forEach(function(e,t){var n=o[t];i.push(k("span",{className:j.HighlightedText},t,n)),i.push(e)}),u.a.createElement(u.a.Fragment,null,i)}}]),t}(),i.propTypes={cls:p.a.string,highlight:p.a.string,selectedIndex:p.a.number,items:m.a.arrayOf(g.a),onClickItem:p.a.func,onHoverItem:p.a.func},o=function(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}((r=a).prototype,"onClickItem",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.onClickItem&&e.props.onClickItem(t)}}}),r)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return K});var r,o,i,a,s,c,u,l,p,f,d,y,b=n(135),m=n.n(b),h=n(341),v=n(342),g=n(361),O=n(363),_=n(356),S=n(460),E=n(344),P=n(151),C=(n.n(P),n(138)),w=(n.n(C),n(353)),T=n(544),k=n(2946),A=n(354),R=(n.n(A),n(2948));n.n(R);function j(e){"@babel/helpers - typeof";return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t,n,r){y||(y="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:y,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function x(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function B(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var F="ComposeReact-TranslateLanguagesPanel",z={Container:F,Block:"".concat(F,"-Block"),LanguageBubble:"".concat(F,"-LanguageBubble"),LanguagePrefix:"".concat(F,"-LanguagePrefix"),Popup:"".concat(F,"-Popup"),HelpButton:"".concat(F,"-HelpButton"),EditButton:"".concat(F,"-EditButton")},U=N(C.Text,{typography:"body-short-m"},void 0,N(E.default,{loc:"compose-react/Translate_Edit_Button"})),K=Object(v.inject)("data","visual","services","controllers")(r=Object(v.observer)((d=f=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),f=0;f<r;f++)o[f]=arguments[f];return x(D(n=function(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?D(e):t}(this,(e=I(t)).call.apply(e,[this].concat(o)))),"langFromDefinition",i,D(n)),x(D(n),"langToDefinition",a,D(n)),x(D(n),"updateRef",s,D(n)),x(D(n),"togglePopupVisibility",c,D(n)),x(D(n),"setLangFrom",u,D(n)),x(D(n),"setLangTo",l,D(n)),n.editTranslation=function(){n.props.controllers.translate.doAfterTranslate(function(e){n.props.controllers.messageBody.replaceText(e),n.props.visual.translate.isEnabled=!1,n._sendMetrika(A.COMPOSE_METRIKA_TRANSLATION_EDIT_BUTTON)})},x(D(n),"onOutsideClick",p,D(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,m.a.Component),function(e,t,n){t&&M(e.prototype,t),n&&M(e,n)}(t,[{key:"_sendMetrika",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.props.services.metrika).sendMetrika.apply(e,[A.COMPOSE_METRIKA,A.COMPOSE_METRIKA_TRANSLATION_PANE].concat(n))}},{key:"closePopups",value:function(){this.langFromDefinition.popupIsVisible=!1,this.langToDefinition.popupIsVisible=!1}},{key:"render",value:function(){var e=this.isEnabled,t=this.langFromDefinition,n=this.langToDefinition;return e?N("div",{className:z.Container},void 0,N("div",{className:z.Block},void 0,this._renderLanguage(t)),N("div",{className:z.Block},void 0,this._renderLanguage(n),this._renderEditButton(),this._renderHelpButton()),this._renderPopup(t),this._renderPopup(n)):null}},{key:"_renderEditButton",value:function(){var e=this.editTranslation;return N("div",{className:z.EditButton,onClick:e},void 0,U)}},{key:"_renderHelpButton",value:function(){var e=this.service.getHelpUrl();return N(P.Link,{className:z.HelpButton,view:"default",href:e,target:"_blank;",rel:"noopener noreferer"},void 0,"?")}},{key:"_renderLanguage",value:function(e){var t=this.service,n=this.updateRef,r=this.togglePopupVisibility,o=e.langCode,i=e.prefixKey,a=i&&Object(w.default)(i).trim();return m.a.createElement("div",{ref:function(t){return n(t,e)},className:z.LanguageBubble,onClick:function(){return r(e)}},a&&N(C.Text,{color:"secondary",typography:"body-short-m",className:z.LanguagePrefix},void 0,a),N(C.Text,{typography:"body-short-m"},void 0,t.getLanguageName(o())))}},{key:"_renderPopup",value:function(e){var t=e.popupIsVisible,n=e.ref,r=e.langCode,o=e.directions,i=e.updateLang;return n&&N(T.a,{className:z.Popup,anchor:{current:n},onClose:this.onOutsideClick,visible:t,direction:Object(h.toJS)(o),hasTail:!0},void 0,N(k.a,{lang:r(),onSelect:i}))}},{key:"service",get:function(){return this.props.services.translate}},{key:"isEnabled",get:function(){return this.props.visual.translate.isEnabled}},{key:"langFrom",get:function(){return this.props.visual.translate.translateFrom}},{key:"langTo",get:function(){return this.props.visual.translate.translateTo}},{key:"containerRef",get:function(){return{current:this.props.visual.refs.composeScrollableContainer}}}]),t}(),f.propTypes={data:O.a.isRequired,services:_.a.isRequired,visual:S.a.isRequired,controllers:g.a.isRequired},i=B((o=d).prototype,"langFromDefinition",[h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return{langCode:function(){return e.langFrom},prefixKey:null,ref:null,popupIsVisible:!1,directions:["bottom-start"],offset:0,updateLang:this.setLangFrom,metrika:A.COMPOSE_METRIKA_TRANSLATION_FROM}}}),a=B(o.prototype,"langToDefinition",[h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return{langCode:function(){return e.langTo},prefixKey:"compose-react/Translator_TranslateTo_Prefix",ref:null,popupIsVisible:!1,directions:["bottom"],offset:35,updateLang:this.setLangTo,metrika:A.COMPOSE_METRIKA_TRANSLATION_TO}}}),B(o.prototype,"service",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"service"),o.prototype),B(o.prototype,"isEnabled",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"isEnabled"),o.prototype),B(o.prototype,"langFrom",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"langFrom"),o.prototype),B(o.prototype,"langTo",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"langTo"),o.prototype),B(o.prototype,"containerRef",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"containerRef"),o.prototype),s=B(o.prototype,"updateRef",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(e,t){t.ref=e||t.ref}}}),c=B(o.prototype,"togglePopupVisibility",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=!t.popupIsVisible;e.closePopups(),t.popupIsVisible=n,e._sendMetrika(t.metrika,A.COMPOSE_METRIKA_TRANSLATION_OPEN_LANGUAGE_SELECTOR)}}}),u=B(o.prototype,"setLangFrom",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.closePopups(),e.props.visual.translate.translateFrom=t,e._sendMetrika(A.COMPOSE_METRIKA_TRANSLATION_FROM,A.COMPOSE_METRIKA_TRANSLATION_CHOOSE_LANGUAGE)}}}),l=B(o.prototype,"setLangTo",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.closePopups(),e.props.visual.translate.translateTo=t,e._sendMetrika(A.COMPOSE_METRIKA_TRANSLATION_TO,A.COMPOSE_METRIKA_TRANSLATION_CHOOSE_LANGUAGE)}}}),p=B(o.prototype,"onOutsideClick",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t.target!==e.langFromDefinition.ref&&t.target!==e.langToDefinition.ref&&e.closePopups()}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return A});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(356),h=n(344),v=n(138),g=(n.n(v),n(2947));n.n(g);function O(e){"@babel/helpers - typeof";return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var w="ComposeReact-ChooseLanguage",T={Container:w,Recents:"".concat(w,"-Recents"),RecentsHeader:"".concat(w,"-RecentsHeader"),Languages:"".concat(w,"-Languages"),Item:"".concat(w,"-Item"),SelectedItem:"".concat(w,"_selected")},k=C(h.default,{loc:"compose-react/Translator_LanguagesRecent"}),A=Object(b.inject)("services")(r=Object(b.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=function(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?E(e):t}(this,(e=S(t)).call.apply(e,[this].concat(o))))._renderLang=function(e){var t=e.name,r=e.lang,o=E(n)._onSelect,i=r===n.props.lang,a=d()(T.Item,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},T.SelectedItem,i));return C(v.Text,{typography:"body-long-m",as:"div",className:a,onClick:function(){return o(r)},color:i?"disable":"primary"},r,t)},n._onSelect=function(e){n.service.setRecent(e),n.props.onSelect&&n.props.onSelect(e)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,u.a.Component),function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(t,[{key:"render",value:function(){return C("div",{className:T.Container},void 0,this._renderRecents(),this._renderLanguages())}},{key:"_renderRecents",value:function(){var e=this.service.getRecents();return e&&e.length?C("div",{className:T.Recents},void 0,C(v.Text,{as:"div",typography:"body-long-m",className:T.RecentsHeader,color:"secondary"},void 0,k),e.map(this._renderLang)):null}},{key:"_renderLanguages",value:function(){var e=this.service.getLangs();return e&&e.length?C("div",{className:T.Languages},void 0,e.map(this._renderLang)):null}},{key:"service",get:function(){return this.props.services.translate}}]),t}(),i.propTypes={lang:p.a.string,onSelect:p.a.func.isRequired,services:m.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"service",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"service"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return E});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(341),p=n(342),f=n(460),d=n(503),y=n(2950);n.n(y);function b(e){"@babel/helpers - typeof";return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function _(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var S={Block:"ComposeReact-TranslationLoader",Spin:"".concat("ComposeReact-TranslationLoader","-Spin")},E=Object(p.inject)("visual")(r=Object(p.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,v(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,u.a.Component),function(e,t,n){t&&m(e.prototype,t),n&&m(e,n)}(t,[{key:"render",value:function(){var e=this.isEnabled,t=this.isLoaderVisible;return e&&t?O("div",{className:S.Block},void 0,O(d.a,{cls:S.Spin,size:"l"})):null}},{key:"isLoaderVisible",get:function(){return this.props.visual.translate.translationsInProgress>0}},{key:"isEnabled",get:function(){return this.props.visual.translate.isEnabled}}]),t}(),i.propTypes={visual:f.a.isRequired},_((o=a).prototype,"isLoaderVisible",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"isLoaderVisible"),o.prototype),_(o.prototype,"isEnabled",[l.computed],Object.getOwnPropertyDescriptor(o.prototype,"isEnabled"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return D});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(136),d=(n.n(f),n(341)),y=n(342),b=n(367),m=n(363),h=n(356),v=n(361),g=n(460),O=n(2952);n.n(O);function _(e){"@babel/helpers - typeof";return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function k(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function A(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var R="ComposeReact-TranslationPanel",j="mail-Editor",M="cke_editable",I=500,D=Object(y.inject)("data","services","controllers","visual")(r=Object(y.observer)((c=s=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(n=function(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?C(e):t}(this,(e=P(t)).call.apply(e,[this].concat(o)))).disposer=new b.a,n.translate=Object(f.debounce)(function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){S(i,r,o,a,s,"next",e)}function s(e){S(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){var t,r,o,i,a,s,c,u,l,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=C(n),r=t.isEnabled,o=t.langFrom,i=t.langTo,a=t.messageBody,s=t.service,c=t._startTranslating,u=t._applyTranslation,r){e.next=3;break}return e.abrupt("return");case 3:return c(),e.next=6,s.translate(a,o,i);case 6:l=e.sent,p=l.translation,u(p);case 9:case"end":return e.stop()}},e)})),I),k(C(n),"_startTranslating",i,C(n)),k(C(n),"_applyTranslation",a,C(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,p.a.Component),function(e,t,n){t&&E(e.prototype,t),n&&E(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this.disposer.add(this,[Object(d.reaction)(function(){return{isEnabled:e.isEnabled,langFrom:e.langFrom,langTo:e.langTo,messageBody:e.messageBody}},this.translate)])}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"render",value:function(){var e=this.isEnabled,t=this.translation;return e?T("div",{className:R},void 0,T("div",{className:j},void 0,T("div",{className:M,dangerouslySetInnerHTML:{__html:t}}))):null}},{key:"messageBody",get:function(){return this.props.controllers.messageBody.rawText||this.props.controllers.messageBody.text}},{key:"isEnabled",get:function(){return this.props.visual.translate.isEnabled}},{key:"langFrom",get:function(){return this.props.visual.translate.translateFrom}},{key:"langTo",get:function(){return this.props.visual.translate.translateTo}},{key:"translation",get:function(){return this.props.visual.translate.translation}},{key:"service",get:function(){return this.props.services.translate}}]),t}(),s.propTypes={data:m.a.isRequired,services:h.a.isRequired,controllers:v.a.isRequired,visual:g.a.isRequired},A((o=c).prototype,"messageBody",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"messageBody"),o.prototype),A(o.prototype,"isEnabled",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"isEnabled"),o.prototype),A(o.prototype,"langFrom",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"langFrom"),o.prototype),A(o.prototype,"langTo",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"langTo"),o.prototype),A(o.prototype,"translation",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"translation"),o.prototype),A(o.prototype,"service",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"service"),o.prototype),i=A(o.prototype,"_startTranslating",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.translate.translationsInProgress++}}}),a=A(o.prototype,"_applyTranslation",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.visual.translate.translationsInProgress--,e.props.visual.translate.translation=t}}}),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return k});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(342),b=n(341),m=n(2954),h=n(2959),v=n(460),g=n(2964);n.n(g);function O(e){"@babel/helpers - typeof";return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var w="ComposeBodyHeader",T={Block:w,withTranslate:"".concat(w,"_withTranslate"),ForwardPanel:"".concat(w,"-ForwardPanel")},k=Object(y.inject)("visual")(r=Object(y.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),S(this,E(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(t,[{key:"render",value:function(){return u.a.createElement("div",{className:d()(T.Block,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},T.withTranslate,this.hasTranslation)),ref:this.props.innerRef},C(m.a,{containerRef:this.props.containerRef}),C(h.a,{cls:T.ForwardPanel}))}},{key:"hasTranslation",get:function(){return this.props.visual.translate.isEnabled}}]),t}(),i.propTypes={innerRef:p.a.shape({current:p.a.object}),containerRef:p.a.object,visual:v.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"hasTranslation",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasTranslation"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";var r=n(2955);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return B});var r,o,i,a,s,c,u=n(135),l=n.n(u),p=n(338),f=n.n(p),d=n(341),y=n(342),b=n(339),m=n.n(b),h=n(344),v=n(353),g=n(361),O=n(363),_=n(356),S=n(460),E=n(354),P=(n.n(E),n(2956)),C=n(138),w=(n.n(C),n(2958));n.n(w);function T(e){"@babel/helpers - typeof";return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n,r){c||(c="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:c,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function I(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var D="ComposeRecipientsDiff",L={Panes:"".concat(D,"-Panes"),Container:D,Wrapper:"".concat(D,"-Wrapper"),Main:"".concat(D,"-Main"),Shadow:"".concat(D,"-Shadow"),SectionsContainer:"".concat(D,"-SectionsContainer"),CollapseControl:"".concat(D,"-CollapseControl"),Section:"".concat(D,"-Section"),CollapsedSection:"".concat(D,"-CollapsedSection"),SectionPrefix:"".concat(D,"-SectionPrefix"),SectionItems:"".concat(D,"-SectionItems"),Login:"".concat(D,"-Login"),ExpandSign:"".concat(D,"-ExpandSign")},N=M(h.default,{loc:"compose-react/RecipientsDiff_Hide"}),x=M(h.default,{loc:"compose-react/RecipientsDiff_Show"}),B=Object(y.inject)("data","visual","services","controllers")(r=Object(y.observer)((s=a=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(R(n=function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?R(e):t}(this,(e=A(t)).call.apply(e,[this].concat(o)))),"nodeRef",i,R(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,l.a.Component),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"setNodeRef",value:function(e){this.nodeRef=e||this.nodeRef}},{key:"setCollapsed",value:function(e){this.controller.setIsRecipientsDiffEnabled(!e),this.metrika.sendRecipientsDiffMetrika(e?E.COMPOSE_METRIKA_RECIPIENTS_DIFF_COLLAPSED:E.COMPOSE_METRIKA_RECIPIENTS_DIFF_EXPANDED)}},{key:"render",value:function(){var e=this;if(!this.controller.isRecipientsDiffAvailable)return null;var t=this.recipientsDiff,n=this.hasTranslation;return this.controller.isEmptyDiff(t)?null:(this._notifyRender(),M("div",{className:L.Panes},void 0,this._renderDiffPane(t,n&&L.Main,function(t){return e.setNodeRef(t)}),n&&this._renderDiffPane(t,L.Shadow)))}},{key:"_renderDiffPane",value:function(e,t,n){var r=m()(L.Container,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},t,Boolean(t))),o=this.isCollapsed;return M("div",{className:r},void 0,l.a.createElement("div",{className:L.Wrapper,ref:n},M("div",{className:L.SectionsContainer},void 0,o?this._renderCollapsedState():this._renderExpandedState(e)),!o&&this._renderCollapseControl()))}},{key:"_notifyRender",value:function(){this.wasRendered||this.metrika.sendRecipientsDiffMetrika(E.COMPOSE_METRIKA_RECIPIENTS_DIFF_SHOWN),this.wasRendered=!0}},{key:"_renderCollapseControl",value:function(){var e=this;return M(C.Text,{color:"secondary",typography:"body-long-m",className:L.CollapseControl,onClick:function(){return e.setCollapsed(!0)}},void 0,N)}},{key:"_renderExpandedState",value:function(e){var t=this.nodeRef,n=this.props.containerRef;return l.a.createElement(l.a.Fragment,null,this._maybeRenderAddedSection(e),this._maybeRenderRemovedSection(e),this._maybeRenderRemovedAllSection(e),t&&M(P.a,{nodeRef:t,containerRef:n}))}},{key:"_renderCollapsedState",value:function(){var e=this;return M(C.Text,{color:"secondary",typography:"body-long-m",className:L.CollapsedSection,onClick:function(){return e.setCollapsed(!1)}},void 0,M("span",{className:L.ExpandSign},void 0,"+"),x)}},{key:"_maybeRenderAddedSection",value:function(e){return this._maybeRenderRecipients(e.added,"+")}},{key:"_maybeRenderRemovedSection",value:function(e){return!e.removeAll&&this._maybeRenderRecipients(e.removed,"-")}},{key:"_maybeRenderRemovedAllSection",value:function(e){return e.removeAll&&this._maybeRenderRecipients([{login:Object(v.default)("compose-react/RecipientsAll")}],"-")}},{key:"_maybeRenderRecipients",value:function(e,t){return e.length?M(C.Text,{typography:"body-long-m",as:"div",color:"secondary",className:L.Section},void 0,M("div",{className:L.SectionPrefix},void 0,t),M("div",{className:L.SectionItems},void 0,e.map(function(e,t){var n=e.login;return M("div",{},t,M("div",{className:L.Login},void 0,n))}))):null}},{key:"addresses",get:function(){return this.props.data.addresses}},{key:"controller",get:function(){return this.props.controllers.recipientsDiff}},{key:"recipientsDiff",get:function(){return this.controller.getRecipientsDiff()}},{key:"isCollapsed",get:function(){return!this.controller.isRecipientsDiffEnabled}},{key:"metrika",get:function(){return this.props.services.metrika}},{key:"hasTranslation",get:function(){return this.props.visual.translate.isEnabled}}]),t}(),a.propTypes={containerRef:f.a.object,data:O.a.isRequired,visual:S.a.isRequired,services:_.a.isRequired,controllers:g.a.isRequired},i=I((o=s).prototype,"nodeRef",[d.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I(o.prototype,"setNodeRef",[d.action],Object.getOwnPropertyDescriptor(o.prototype,"setNodeRef"),o.prototype),I(o.prototype,"addresses",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"addresses"),o.prototype),I(o.prototype,"controller",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"controller"),o.prototype),I(o.prototype,"recipientsDiff",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"recipientsDiff"),o.prototype),I(o.prototype,"isCollapsed",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"isCollapsed"),o.prototype),I(o.prototype,"metrika",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrika"),o.prototype),I(o.prototype,"hasTranslation",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasTranslation"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return k});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(341),d=n(342),y=n(569),b=n(344),m=n(356),h=n(354),v=(n.n(h),n(2957));n.n(v);function g(e){"@babel/helpers - typeof";return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var C="ComposeRecipientsDiffPromo",w={Block:C,Description:"".concat(C,"-Description"),Close:"".concat(C,"-Close")},T=P(b.default,{loc:"compose-react/RecipientsDiff_Description"}),k=Object(d.inject)("services")(r=Object(d.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=_(this,(e=S(t)).call.apply(e,[this].concat(o)))).close=function(){n.props.services.settings.isRecipientsDiffPromoClosed=!0,n.forceUpdate(),n.metrika.sendRecipientsDiffMetrika(h.COMPOSE_METRIKA_RECIPIENTS_DIFF_PROMO_CLOSED)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&O(e.prototype,t),n&&O(e,n)}(t,[{key:"_notifyRender",value:function(){this.wasRendered||this.metrika.sendRecipientsDiffMetrika(h.COMPOSE_METRIKA_RECIPIENTS_DIFF_PROMO_SHOWN),this.wasRendered=!0}},{key:"render",value:function(){var e=this.props,t=e.containerRef,n=e.nodeRef,r=this.isVisible,o=this.close;if(!this.wasRendered&&!r)return null;this._notifyRender();return n&&r&&P(y.a,{cls:w.Block,anchor:n,scope:t,theme:"promo",tone:"default",size:"m",visible:r,to:["bottom-left"],popupProps:{hiding:!0,mainOffset:-5,secondaryOffset:25,style:{position:"absolute"},tailOffset:-100}},void 0,P(y.a.Close,{cls:w.Close,onClick:o}),P(y.a.Description,{},void 0,P("div",{className:w.Description},void 0,T)))}},{key:"isVisible",get:function(){return!this.props.services.settings.isRecipientsDiffPromoClosed}},{key:"metrika",get:function(){return this.props.services.metrika}}]),t}(),i.propTypes={nodeRef:p.a.object,containerRef:p.a.object,services:m.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"metrika",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrika"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t){},function(e,t,n){"use strict";var r=n(2960);n.d(t,"a",function(){return r.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return D});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(338),d=n.n(f),y=n(339),b=n.n(y),m=n(342),h=n(341),v=n(361),g=n(356),O=n(2961),_=(n.n(O),n(344)),S=n(2963);n.n(S);function E(e){"@babel/helpers - typeof";return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function R(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function j(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var M="ComposeForwardPanel",I={Block:M,Message:"".concat(M,"-Message"),Subject:"".concat(M,"-Subject")},D=Object(m.inject)("controllers","services")(r=Object(m.observer)((c=s=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return R(T(n=function(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?T(e):t}(this,(e=w(t)).call.apply(e,[this].concat(o)))),"isClosed",i,T(n)),R(T(n),"close",a,T(n)),n.attach=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){P(i,r,o,a,s,"next",e)}function s(e){P(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.controllers.attachments.addForwardAsAttachment();case 2:case"end":return e.stop()}},e)})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,p.a.Component),function(e,t,n){t&&C(e.prototype,t),n&&C(e,n)}(t,[{key:"render",value:function(){return this.isVisible?A(O.NotificationPanel,{className:b()(I.Block,this.props.cls),actionLocKey:"compose-react/Body_Header_Forward_Action",closeButtonLocKey:"compose-react/Body_Header_Forward_Cancel",onAction:this.attach,onClose:this.close},void 0,A(_.default,{className:I.Message,loc:"compose-react/Body_Header_Forward_Message"},void 0,A("span",{"data-ref":"name",className:I.Subject},void 0,this.subject))):null}},{key:"isForward",get:function(){return this.props.services.composeParams.isForward()}},{key:"forwardedMessages",get:function(){return this.props.controllers.attachments.forwardedMessages}},{key:"forwardMailAttachments",get:function(){return this.props.controllers.attachments.forwardMailAttachments}},{key:"isVisible",get:function(){return!this.isClosed&&this.isForward&&1===this.forwardedMessages.length&&!this.forwardMailAttachments.length}},{key:"subject",get:function(){return this.props.services.composeParams.messageSubject}}]),t}(),s.propTypes={cls:d.a.string,controllers:v.a.isRequired,services:g.a.isRequired},i=j((o=c).prototype,"isClosed",[h.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),j(o.prototype,"isForward",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"isForward"),o.prototype),j(o.prototype,"forwardedMessages",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"forwardedMessages"),o.prototype),j(o.prototype,"forwardMailAttachments",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"forwardMailAttachments"),o.prototype),j(o.prototype,"isVisible",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"isVisible"),o.prototype),j(o.prototype,"subject",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"subject"),o.prototype),a=j(o.prototype,"close",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isClosed=!0}}}),r=o))||r)||r},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationPanel=void 0;var o=r(n(135)),i=r(n(339)),a=r(n(344)),s=r(n(353)),c=n(140),u=n(138),l=r(n(464)),p=r(n(2962)),f=function(e){return o.default.createElement("span",{"aria-hidden":"true",className:i.default(e,p.default.icon)},o.default.createElement(l.default,null))};t.NotificationPanel=function(e){var t=e.className,n=e.onAction,r=e.children,l=e.actionLocKey,d=e.closeButtonLocKey,y=e.onClose;return o.default.createElement("div",{className:i.default("ComposeNotification",p.default.root,t)},o.default.createElement(u.Text,{typography:"body-long-m",as:"div",className:i.default("ComposeNotification-Content",p.default.content)},r),n&&o.default.createElement(c.Button,{view:"default",size:"s",className:i.default("ComposeNotification-Action",p.default.action),onClick:n},o.default.createElement(a.default,{loc:l})),y&&o.default.createElement(c.Button,{view:"clear",size:"s",className:i.default("ComposeNotification-Close",p.default.close),onClick:y,icon:f,"aria-label":d?s.default(d):void 0}))}},function(e,t){e.exports={root:"BodyHeader__root--12lgF",content:"BodyHeader__content--3RN-4",action:"BodyHeader__action--1mEK-",close:"BodyHeader__close--2SH6T",icon:"BodyHeader__icon--DdBfd"}},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderButtons=void 0;var r=n(2966);Object.defineProperty(t,"HeaderButtons",{enumerable:!0,get:function(){return r.HeaderButtons}})},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderButtons=void 0;var u=a(n(135)),l=c(n(339)),p=n(342),f=n(380),d=n(1520),y=n(142),b=c(n(464)),m=c(n(1521)),h=c(n(1522)),v=c(n(1523)),g=a(n(496)),O=n(354),_=n(397),S=c(n(353)),E=c(n(2969));t.HeaderButtons=p.observer(function(){var e=_.useStores(),t=e.controllers.compose,n=e.visual.size,o=e.services.metrika,i=u.useCallback(function(e){e.stopPropagation(),t.closeCompose({leaveType:g.COLLAPSE}),o.sendHeaderMetrika(O.COMPOSE_METRIKA_HEADER_COLLAPSE)},[t,o]),a=u.useCallback(function(e){e.stopPropagation();var r=n===f.ComposeSizes.SMALL?f.ComposeSizes.LARGE:f.ComposeSizes.SMALL;t.changeSize(r,!0),o.sendHeaderMetrika(O.COMPOSE_METRIKA_HEADER_EXPAND)},[t,o,n]),c=u.useCallback(function(e){e.stopPropagation(),t.closeCompose({leaveType:g.CLOSE}),o.sendHeaderMetrika(O.COMPOSE_METRIKA_HEADER_CLOSE)},[t,o]),p=u.useMemo(function(){return[{name:f.HeaderButtons.MINIMIZE,svg:m.default,onClick:i,tooltipLocKey:"compose-react/PopupActions_MinimizeWindow"},{name:n===f.ComposeSizes.SMALL?f.HeaderButtons.MAXIMIZE:f.HeaderButtons.MAXIMIZE_SMALL,svg:n===f.ComposeSizes.SMALL?h.default:v.default,onClick:a,tooltipLocKey:n===f.ComposeSizes.SMALL?"compose-react/PopupActions_EnlargeWindowSize":"compose-react/PopupActions_ReduceWindowSize"},{name:f.HeaderButtons.CLOSE,svg:b.default,onClick:c,tooltipLocKey:"compose-react/PopupActions_CloseWindow"}]},[a,c,i,n]);return u.default.createElement("div",{className:E.default.root},p.map(function(e){var t=e.tooltipLocKey,n=e.name,o=s(e,["tooltipLocKey","name"]);return u.default.createElement(y.TooltipStateful,{key:n,size:"s",view:"default",state:"warning",content:S.default(t)},u.default.createElement(d.ButtonWithIcon,r({view:"clear",size:"s"},o,{className:l.default("qa-ControlButton","qa-ControlButton_button_"+n),"aria-label":S.default(t)})))}))})},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonWithIcon=void 0;var u=a(n(135)),l=c(n(339)),p=n(140),f=c(n(2968)),d={xs:"16px",s:"16px",m:"16px",l:"24px"};t.ButtonWithIcon=function(e){var t=e.size,n=e.svg,o=e.iconSize,i=e.iconClass,a=s(e,["size","svg","iconSize","iconClass"]),c=function(e,t,n){var r=d[e||"m"],o=u.useCallback(function(e){return u.default.createElement("div",{className:l.default(f.default.iconWrap,e,n)},t&&u.default.createElement(t,{width:r,height:r}))},[t,r,n]);if(t)return o}(o||t,n,i);return u.default.createElement(p.Button,r({},a,{size:t,icon:c}))}},function(e,t){e.exports={iconWrap:"ButtonWithIcon__iconWrap--2QE4l"}},function(e,t){e.exports={root:"HeaderButtons__root--WwDCZ"}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return X});var r,o,i,a,s,c,u,l,p,f,d,y=n(136),b=(n.n(y),n(135)),m=n.n(b),h=n(341),v=n(342),g=n(339),O=n.n(g),_=n(353),S=n(1479),E=n(716),P=n(367),C=n(1106),w=(n.n(C),n(2972)),T=n(1108),k=n(803),A=n(807),R=n(1511),j=n(1118),M=n(350),I=n(354),D=(n.n(I),n(2992)),L=(n.n(D),n(1500));function N(e){"@babel/helpers - typeof";return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e,t){return(K=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function H(e,t,n,r){d||(d="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:d,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function W(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function Y(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var G="composeReact",q={Block:G,Block_mobile:"".concat(G,"_mobile"),Content:"".concat(G,"-Content"),ScrollableContainer:"".concat(G,"-ScrollableContainer"),ScrollableContent:"".concat(G,"-ScrollableContent"),TopContent:"".concat(G,"-TopContent"),Toolbar:"".concat(G,"-Toolbar"),MainContent:"".concat(G,"-MainContent"),BottomContent:"".concat(G,"-BottomContent"),Header:"".concat(G,"-Header"),ControlPanel:"".concat(G,"-ControlPanel")},V=H(L.a,{}),$=H(S.a,{className:"composeReact__externalBadgeIcon"}),Q=H(k.a,{}),X=Object(v.inject)("data","visual","services","controllers")(r=Object(v.observer)((f=p=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),p=0;p<r;p++)o[p]=arguments[p];return(n=function(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?U(e):t}(this,(e=z(t)).call.apply(e,[this].concat(o)))).domNode=null,n.toolbarNodeId=Object(y.uniqueId)("ComposeReact-Toolbar"),n.disposer=new P.a,n.messageBodyRef=m.a.createRef(),n.subjectFieldRef=m.a.createRef(),n.focusBody=function(){var e=n.messageBodyRef.current;e&&e.focus()},n.focus=function(){n.domNode&&(n.domNode.focus(),n.domNode.tabIndex=-1)},W(U(n),"focusField",i,U(n)),W(U(n),"saveComposeContainerRef",a,U(n)),W(U(n),"saveScrollableContainerRef",s,U(n)),W(U(n),"saveTopContentRef",c,U(n)),W(U(n),"onToggleRecipients",u,U(n)),W(U(n),"onRecipientsFieldFocus",l,U(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}(t,m.a.Component),function(e,t,n){t&&F(e.prototype,t),n&&F(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this.disposer.add(this,[Object(h.reaction)(function(){return e.props.visual.focusedField},this.focusField)])}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"render",value:function(){var e,t=this,n=this.areAdditionalAddressesExpanded,r=this.isShowingAttachmentsOverflowButton,o=this.toolbarNodeId,i=this.onToggleRecipients,a=this.onRecipientsFieldFocus,s=this.hasExternalEmail,c=O()((B(e={},q.Block,!0),B(e,q.Block_mobile,!0),e));return m.a.createElement("div",{className:c,ref:this.saveComposeContainerRef,tabIndex:"0"},H("div",{className:q.Content},void 0,H("div",{className:q.Header},void 0,H(T.b,{cls:q.ControlPanel})),H("div",{className:q.ScrollableContainer},void 0,m.a.createElement("div",{className:q.ScrollableContent,ref:this.saveScrollableContainerRef},m.a.createElement("div",{className:q.TopContent,ref:this.saveTopContentRef},H(R.a,{isShowAdditionalAddresses:n,onToggleExpandedState:i,onFieldFocus:a},void 0,H(j.a,{innerRef:this.subjectFieldRef,onFocus:function(){return a("subject",t.subjectFieldRef)},title:"compose-react/Header_Subject"}),V),H("div",{id:o,className:q.Toolbar})),s&&H("div",{className:"composeReact__externalBadge"},void 0,$,H("span",{},void 0,Object(_.default)("compose-react/toExternalContactMessage"))),H("div",{className:q.MainContent},void 0,m.a.createElement(A.a,{ref:this.messageBodyRef,placeholder:Object(_.default)("compose-react/Editor_Placeholder"),toolbarNodeId:o})),H("div",{className:q.BottomContent},void 0,H(w.a,{isShowingOverflowButton:r})))),Q))}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"contactsController",get:function(){return this.props.controllers.contacts}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"data",get:function(){return this.props.data}},{key:"areAdditionalAddressesExpanded",get:function(){return this.props.visual.additionalAddressesAreExpanded}},{key:"hasExternalEmail",get:function(){var e=this.props.data.externalEmails;if(Object(M.isB2BUser)()&&!Object(M.isCorp)()){var t=[].concat(x(this.props.data.addresses.to),x(this.props.data.addresses.bcc),x(this.props.data.addresses.cc)).map(function(e){return e.email});return Boolean(t.find(function(t){return e[t]}))}return!1}}]),t}(),p.propTypes=E.a,Y((o=f).prototype,"composeController",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),Y(o.prototype,"contactsController",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"contactsController"),o.prototype),Y(o.prototype,"metrikaService",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),Y(o.prototype,"data",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"data"),o.prototype),Y(o.prototype,"areAdditionalAddressesExpanded",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"areAdditionalAddressesExpanded"),o.prototype),Y(o.prototype,"hasExternalEmail",[h.computed],Object.getOwnPropertyDescriptor(o.prototype,"hasExternalEmail"),o.prototype),i=Y(o.prototype,"focusField",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){(e.props.visual.focusedField="","compose"===t&&e.focus(),"body"!==t)&&(-1!==["addresses.cc","addresses.bcc"].indexOf(t)&&!e.areAdditionalAddressesExpanded&&(e.props.visual.additionalAddressesAreExpanded=!0))}}}),a=Y(o.prototype,"saveComposeContainerRef",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.domNode=t,e.props.visual.refs.composeContainer=t}}}),s=Y(o.prototype,"saveScrollableContainerRef",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.scrollableContainer=t,e.props.visual.refs.composeScrollableContainer=t}}}),c=Y(o.prototype,"saveTopContentRef",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.visual.refs.topContent=t}}}),u=Y(o.prototype,"onToggleRecipients",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.additionalAddressesAreExpanded=!e.props.visual.additionalAddressesAreExpanded,e.metrikaService.sendHeaderMetrika(I.COMPOSE_METRIKA_HEADER_TOGGLE_ADDRESSES)}}}),l=Y(o.prototype,"onRecipientsFieldFocus",[h.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){"addresses.to"===t&&(e.data.addresses.cc.length||e.data.addresses.bcc.length)&&(e.props.visual.additionalAddressesAreExpanded=!0),n.current&&Object(C.scrollTo)(e.scrollableContainer,{top:n.current.offsetTop})}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return G});var r,o,i,a,s,c,u,l,p,f=n(135),d=n.n(f),y=n(338),b=n.n(y),m=n(341),h=n(342),v=n(339),g=n.n(v),O=n(2973),S=n(2976),E=n(2989),P=n(361),C=n(363),w=n(356),T=n(460),k=n(357),A=n(479),R=n(354),j=(n.n(R),n(355)),M=(n.n(j),n(394)),I=n.n(M),D=n(2991);n.n(D);function L(e){"@babel/helpers - typeof";return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function U(e,t,n,r){p||(p="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:p,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function K(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function H(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var W="ComposeAttachments",Y={Block:W,Header:"".concat(W,"-Header"),Body:"".concat(W,"-Body"),Item:"".concat(W,"-Item"),Item_collapsed:"".concat(W,"-Item_collapsed"),Progress:"".concat(W,"-Progress")},G=Object(h.inject)("controllers","data","services","visual")(r=Object(h.observer)((l=u=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return(n=function(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?F(e):t}(this,(e=B(t)).call.apply(e,[this].concat(o)))).disposer=new I.a,K(F(n),"itemsPerRow",i,F(n)),K(F(n),"onItemRemoveOrCancel",a,F(n)),K(F(n),"onDeleteAll",s,F(n)),K(F(n),"setItemsPerRow",c,F(n)),n.onContainerRef=function(e){n.containerRef=e,n.updateWidth()},n.updateWidth=function(){if(n.containerRef&&!n.isBackground){var e=n.containerRef.getBoundingClientRect().width+t.ITEM_X_MARGIN,r=t.ITEM_WIDTH+t.ITEM_X_MARGIN,o=Math.floor(e/r);n.itemsPerRow!==o&&n.setItemsPerRow(o)}},n.toggleHiddenItems=function(){var e=n.props,t=e.isExpanded,r=e.onExpand,o=e.onCollapse;t?o&&o():r&&r(),n.metrikaService.sendAttachmentsMetrika(R.COMPOSE_METRIKA_ATTACHMENTS_TOGGLE)},n.renderAttachmentItem=function(e,t){var r,o=F(n).visibleAttachmentsCount;return U("div",{className:g()((N(r={},Y.Item,!0),N(r,Y.Item_collapsed,t>=o),r))},e.info.id,U(S.a,{onClose:n.onItemRemoveOrCancel,onCancelLoading:n.onItemRemoveOrCancel,item:e}))},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,d.a.Component),function(e,t,n){t&&x(e.prototype,t),n&&x(e,n)}(t,[{key:"componentDidMount",value:function(){this.disposer.add(this,[Object(M.addEventListener)({element:window,eventName:"resize",listener:this.updateWidth})]),this.updateWidth()}},{key:"componentWillUnmount",value:function(){this.disposer.dispose(this)}},{key:"render",value:function(){return 0===this.validAttachments.length?null:d.a.createElement("div",{ref:this.onContainerRef,className:Y.Block},U(O.a,{cls:Y.Header,count:this.validAttachments.length,hiddenCount:this.hiddenAttachments.length,isExpanded:this.props.isExpanded,onDeleteAll:this.onDeleteAll,onToggle:this.toggleHiddenItems,size:this.totalSize,uploadedCount:this.uploadedCount}),U(E.a,{cls:Y.Progress}),this.renderBody())}},{key:"renderBody",value:function(){return 0===this.visibleAttachmentsCount?null:U("div",{className:Y.Body},void 0,this.validAttachments.map(this.renderAttachmentItem))}},{key:"attachmentsController",get:function(){return this.props.controllers.attachments}},{key:"attachments",get:function(){return this.props.data.attachments||[]}},{key:"validAttachments",get:function(){return this.attachmentsController.validAttachments||[]}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"isBackground",get:function(){return this.props.visual.workMode===j.WorkModes.BACKGROUND}},{key:"hiddenAttachments",get:function(){return this.props.fixedMode===j.FixedModes.SMALL?this.validAttachments:this.validAttachments.slice(this.itemsPerRow)}},{key:"visibleAttachmentsCount",get:function(){var e=this.props,t=e.isExpanded,n=e.fixedMode;return t?this.validAttachments.length:n===j.FixedModes.SMALL?0:this.itemsPerRow}},{key:"totalSize",get:function(){return this.validAttachments.map(function(e){return Object(A.a)(e.info)||0}).reduce(function(e,t){return e+t},0)}},{key:"uploadedCount",get:function(){return this.validAttachments.filter(function(e){return e.status===k.c.COMPLETED}).length}}]),t}(),u.propTypes={controllers:P.a.isRequired,data:C.a.isRequired,services:w.a.isRequired,visual:T.a.isRequired,fixedMode:b.a.oneOf(_.values(j.FixedModes)),isExpanded:b.a.bool,onExpand:b.a.func,onCollapse:b.a.func,onItemsPerRowChanged:b.a.func},u.defaultProps={isExpanded:!0,onItemsPerRowChanged:function(){return null}},u.ITEM_WIDTH=102,u.ITEM_X_MARGIN=12,i=H((o=l).prototype,"itemsPerRow",[m.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),H(o.prototype,"attachmentsController",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"attachmentsController"),o.prototype),H(o.prototype,"attachments",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"attachments"),o.prototype),H(o.prototype,"validAttachments",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"validAttachments"),o.prototype),H(o.prototype,"metrikaService",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),H(o.prototype,"isBackground",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"isBackground"),o.prototype),H(o.prototype,"hiddenAttachments",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"hiddenAttachments"),o.prototype),H(o.prototype,"visibleAttachmentsCount",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"visibleAttachmentsCount"),o.prototype),H(o.prototype,"totalSize",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"totalSize"),o.prototype),H(o.prototype,"uploadedCount",[m.computed],Object.getOwnPropertyDescriptor(o.prototype,"uploadedCount"),o.prototype),a=H(o.prototype,"onItemRemoveOrCancel",[m.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t.status=k.c.ABORTED,e.attachments.remove(t)}}}),s=H(o.prototype,"onDeleteAll",[m.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.data.attachments=[],e.metrikaService.sendAttachmentsMetrika(R.COMPOSE_METRIKA_ATTACHMENTS_REMOVE_ALL)}}}),c=H(o.prototype,"setItemsPerRow",[m.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.itemsPerRow=t,e.props.onItemsPerRowChanged(t)}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return L});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(342),b=n(341),m=n(344),h=n(393),v=n(1513),g=n.n(v),O=n(482),_=(n.n(O),n(2974)),S=n(356),E=n(2975);n.n(E);function P(e){"@babel/helpers - typeof";return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var R=Object(_.a)(h.a),j=Object(_.a)(g.a),M="ComposeAttachmentsHeader",I={Block:M,Progress:"".concat(M,"-Progress"),Message:"".concat(M,"-Message"),Count:"".concat(M,"-Count"),Size:"".concat(M,"-Size"),Actions:"".concat(M,"-Actions"),Button:"".concat(M,"-Button"),DeleteAllButton:"".concat(M,"-DeleteAllButton"),ToggleButton:"".concat(M,"-ToggleButton"),ExpandIcon:"".concat(M,"-ExpandIcon"),CollapseIcon:"".concat(M,"-CollapseIcon"),Space:"".concat(M,"-Space")},D=A(m.default,{loc:"compose-react/Attachments_WasAttached"}),L=Object(y.inject)("services")(r=Object(y.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),w(this,T(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&C(e.prototype,t),n&&C(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.cls,n=e.size;return A("div",{className:d()(I.Block,t)},void 0,!this.isMobile&&A("div",{className:I.Message},void 0,D),this.renderCount(),A("div",{className:I.Size},void 0,A(O.HumanFileSize,{bytes:n})),this.maybeRenderActions())}},{key:"renderCount",value:function(){var e=this.props,t=e.count,n=e.uploadedCount,r=n<t?"compose-react/Attachments_UnloadedN":"compose-react/Attachments_Count";return A("div",{className:I.Count},void 0,A(m.default,{loc:r,params:{count:t,uploaded:n}}))}},{key:"maybeRenderActions",value:function(){return A("div",{className:I.Actions},void 0,this.renderDeleteAllButton(),!this.isMobile&&this.renderToggleButton())}},{key:"renderDeleteAllButton",value:function(){var e=this.props,t=e.count,n=e.onDeleteAll;return t<=1?A("div",{className:I.Space}):A(R,{onClick:n,containerCls:I.DeleteAllButton,cls:I.Button,theme:"normal",view:"default",tone:"default"},void 0,A(m.default,{loc:"compose-react/Attachments_Delete_All",params:{count:t}}))}},{key:"renderToggleButton",value:function(){var e=this.props,t=e.count,n=e.hiddenCount,r=e.isExpanded,o=e.onToggle;if(!n)return null;var i=r?"compose-react/Attachments_Collapse":n<t?"compose-react/Attachments_ShowMoreN":"compose-react/Attachments_Show",a={count:n};return A(j,{cls:I.Button,containerCls:I.ToggleButton,isExpanded:r,onClick:o},"toggle",A(m.default,{loc:i,params:a}))}},{key:"isMobile",get:function(){return this.props.services.settings.isMobile}}]),t}(),i.propTypes={cls:p.a.string,count:p.a.number,hiddenCount:p.a.number,isExpanded:p.a.bool,onDeleteAll:p.a.func,onToggle:p.a.func,services:S.a.isRequired,size:p.a.number,uploadedCount:p.a.number},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"isMobile",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"isMobile"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";t.a=function(e){var t=Object(r.forwardRef)(function(t,n){var r=t.containerCls,i=t.innerRef,a=t.children,c=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(t,["containerCls","innerRef","children"]);return o.a.createElement("div",{className:r,ref:i},o.a.createElement(e,s({ref:n},c),a))}),n=e.displayName||e.name;return t.displayName=n?"withTooltipAdapter(".concat(n,")"):"withTooltipAdapter",t.propTypes={containerCls:a.a.string,innerRef:a.a.oneOfType([a.a.object,a.a.func])},t};var r=n(135),o=n.n(r),i=n(338),a=n.n(i);function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return T});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(341),d=n(342),y=n(2977),b=n(2983),m=n(590),h=n(356),v=n(357),g=n(479),O=n(354);n.n(O);function _(e){"@babel/helpers - typeof";return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=Object(b.a)(y.a),T=Object(d.inject)("services")(r=Object(d.observer)((a=i=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(n=function(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?P(e):t}(this,(e=E(t)).call.apply(e,[this].concat(o)))).state={isUsingThumbnail:!1},n.onCloseClick=function(){var e=n.props,t=e.item,r=e.onClose;n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_REMOVE),r&&r(t)},n.onCancelClick=function(){var e=n.props,t=e.item,r=e.onCancelLoading;n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_CANCEL_UPLOAD),r&&r(t)},n.onPreviewClick=function(e){var t=n.props.item;if(t.info.type!==v.d.YADISK)if(t.previewSupported){var r={mid:t.visual.mid,hid:t.visual.hid};(r.mid||r.hid)&&(n.props.services.attachments.showImagePreview("attachments.image-preview",r,P(n),e),n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_PREVIEW))}else n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_DOWNLOAD);else n.metrikaService.sendAttachmentsMetrika(O.COMPOSE_METRIKA_ATTACHMENTS_PREVIEW)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,u.a.Component),function(e,t,n){t&&S(e.prototype,t),n&&S(e,n)}(t,[{key:"componentDidMount",value:function(){this.loadPreview()}},{key:"componentWillUnmount",value:function(){this.image&&(this.image.onload=null)}},{key:"loadPreview",value:function(){var e=this,t=this.props.item.info.previewSrc;t&&this.previousPreviewSrc!==t&&(this.image=new Image,this.image.onload=function(){return e.setState({isUsingThumbnail:!0})},this.image.src=t,this.previousPreviewSrc=t)}},{key:"componentDidUpdate",value:function(){this.loadPreview()}},{key:"render",value:function(){var e=this.props.services,t=this.props.item,n=t.info,r=t.status,o=t.progress,i=t.visual,a=n.previewHref||i.narodUrl||i.url,c=this.state.isUsingThumbnail,u=Boolean(n.folder)?"folder":i.icon||i.class;return function(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(w,{onPreviewClick:this.onPreviewClick,fileType:u,extension:i.fileext,name:i.name,sourceType:n.type,previewSrc:c?n.previewSrc:null,sourceHref:a,onClose:this.onCloseClick,isMobile:e.settings.isMobile,progress:o,onCancelLoading:this.onCancelClick,size:Object(g.a)(n),status:r})}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),t}(),i.propTypes={item:m.a,onClose:p.a.func,onCancelLoading:p.a.func,services:h.a},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"metrikaService",[f.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),r=o))||r)||r},,,,,,,function(e,t,n){"use strict";t.a=function(e){var t,n;return n=t=function(t){function n(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return(t=function(e,t){if(t&&("object"===g(t)||"function"==typeof t))return t;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,(e=S(n)).call.apply(e,[this].concat(o)))).state={containerHovered:!1,cancelButtonHovered:!1},t.onCancelLoadingClick=function(e){e.preventDefault(),e.stopPropagation();var n=t.props.onCancelLoading;"function"==typeof n&&n()},t.onCloseClicked=function(e){e.preventDefault(),e.stopPropagation();var n=t.props.onClose;n&&n()},t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(n,t),function(e,t,n){t&&_(e.prototype,t);n&&_(e,n)}(n,[{key:"maybeRenderCloseButton",value:function(){var e=this.props.onClose;return e?P(y.a,{onClick:this.onCloseClicked,pin:"circle-circle",theme:"normal",cls:w.Close}):null}},{key:"maybeRenderProgress",value:function(){var e=this,t=this.props,n=t.status,r=t.progress;if(n===h.c.COMPLETED)return null;var o=n===h.c.UPLOADING;return P("div",{className:w.Loader},void 0,o?P(d.a,{cls:w.ProgressIndicator,progress:r}):P(b.a,{cls:w.Spin,size:"m"}),P(y.a,{cls:w.CancelLoading,pin:"circle-circle",theme:"normal",onClick:this.onCancelLoadingClick,innerRef:function(t){return e.cancelButtonRef=t},onMouseEnter:function(){return e.setState({cancelButtonHovered:!0})},onMouseLeave:function(){return e.setState({cancelButtonHovered:!1})}}))}},{key:"maybeRenderSize",value:function(){var e=this.props.size;return e?P("span",{className:w.TooltipSize},void 0,P(p.HumanFileSize,{bytes:e})):null}},{key:"render",value:function(){var t,n=this,r=this.props,o=r.previewSrc,i=r.sourceHref,a=r.status,c=r.onPreviewClick,l=r.sourceType,p=r.isMobile,f=Boolean(o),d=l!==h.d.YADISK&&!f,y=u()(w.Block,(O(t={},w.loading,a===h.c.UPLOADING),O(t,w.new,a!==h.c.COMPLETED),O(t,w.with_thumbnail,f),t));return s.a.createElement("a",{onClick:c,download:d,href:i,target:"_blank",rel:"noopener noreferrer",onMouseEnter:function(){return n.setState({containerHovered:!0})},onMouseLeave:function(){return n.setState({containerHovered:!1})},ref:function(e){return n.containerRef=e},className:y},s.a.createElement(e,this.props),this.maybeRenderCloseButton(),this.maybeRenderProgress(),!p&&this.renderTooltip())}},{key:"renderTooltip",value:function(){var e=this.state,t=e.containerHovered,n=e.cancelButtonHovered,r=n?this.cancelButtonRef:this.containerRef;return P(f.a,{visible:t||n,to:"top-left",anchor:r},void 0,n?this.renderCancelButtonTooltip():this.renderContainerTooltip())}},{key:"renderContainerTooltip",value:function(){var e=this.props.name;return s.a.createElement(s.a.Fragment,null,e,this.maybeRenderSize())}},{key:"renderCancelButtonTooltip",value:function(){return T}}]),n}(s.a.Component),t.propTypes={isMobile:i.a.bool,status:i.a.oneOf(Object(l.values)(h.c)),progress:i.a.number,onClose:i.a.func,onCancelLoading:i.a.func,previewSrc:i.a.string,size:i.a.number,name:i.a.string,sourceHref:i.a.string,onPreviewClick:i.a.func,sourceType:i.a.oneOf(Object(l.values)(h.d))},n};var r,o=n(338),i=n.n(o),a=n(135),s=n.n(a),c=n(339),u=n.n(c),l=n(136),p=(n.n(l),n(482)),f=(n.n(p),n(1509)),d=n(2984),y=n(2986),b=n(503),m=n(344),h=n(357),v=n(2988);n.n(v);function g(e){"@babel/helpers - typeof";return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var C="compose-AttachmentItem",w={Block:C,loading:"".concat(C,"_loading"),new:"".concat(C,"_new"),with_thumbnail:"".concat(C,"_with_thumbnail"),Loader:"".concat(C,"-Loader"),CancelLoading:"".concat(C,"-CancelLoading"),Close:"".concat(C,"-Close"),TooltipSize:"".concat(C,"-TooltipSize"),Spin:"".concat(C,"-Spin"),ProgressIndicator:"".concat(C,"-ProgressIndicator")},T=P(m.default,{loc:"compose-react/Attachments_CancelLoading_Tooltip"})},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(2985);n.n(l);function p(e){"@babel/helpers - typeof";return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var h={m:{side:34,strokeWidth:2}},v="compose-ProgressIndicator",g={Block:v,indeterminate:"".concat(v,"_indeterminate"),Background:"".concat(v,"-Background"),Progress:"".concat(v,"-Progress")},O=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),d(this,y(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.progress,n=e.size,r=e.cls,o=h[n],i=o.side,a=o.strokeWidth,s=i/2,c=s-a,l=c*Math.PI*2,p=l-l*(t/100);return m("svg",{width:i,height:i,className:u()(g.Block,r),viewBox:"0 0 ".concat(i," ").concat(i)},void 0,m("circle",{className:g.Background,cx:s,cy:s,r:c,strokeWidth:a}),m("circle",{className:g.Progress,cx:s,cy:s,r:c,transform:"rotate(-90 ".concat(s," ").concat(s,")"),strokeWidth:a,style:{strokeDasharray:l,strokeDashoffset:p}}))}}]),t}();O.propTypes={progress:s.a.number,size:s.a.oneOf(["m"]),cls:s.a.string},O.defaultProps={size:"m"}},function(e,t){},function(e,t,n){"use strict";var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(393),p=n(360),f=n(2987);n.n(f);function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function y(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var b=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(p.default,{id:"mail--Compose-Cross"}),m=function(e){var t=e.cls,n=y(e,["cls"]);return i.a.createElement(l.a,d({cls:u()(t,"ComposeClearButton"),theme:"clear",view:"default",tone:"default"},n),b)};t.a=m,m.propTypes={cls:s.a.string}},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return A});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(502),h=n(361),v=n(357),g=n(2990);n.n(g);function O(e){"@babel/helpers - typeof";return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function w(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var T="ComposeAttachmentsLoadingProgress",k=T,A=("".concat(T,"-Progress"),Object(b.inject)("controllers")(r=Object(b.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),S(this,E(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(t,[{key:"render",value:function(){var e=this.props.cls;return 1===this.progress?null:C("div",{className:d()(k,e)},void 0,C(m.d,{timing:"linear",value:this.progress}))}},{key:"validAttachments",get:function(){return this.props.controllers.attachments.validAttachments||[]}},{key:"progress",get:function(){return this.validAttachments.map(function(e){return e.status===v.c.COMPLETED?100:e.progress}).reduce(function(e,t){return t+e},0)/this.validAttachments.length/100}}]),t}(),i.propTypes={cls:p.a.string,controllers:h.a.isRequired},w((o=a).prototype,"validAttachments",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"validAttachments"),o.prototype),w(o.prototype,"progress",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"progress"),o.prototype),r=o))||r)||r)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r,o,i,a=n(135),s=n.n(a),c=n(342),u=n(716),l=n(2995),p=function(e){return s.a.createElement(l.a,e)};p=Object(c.inject)("controllers","data","services","visual")(r=Object(c.observer)((i=o=p,o.propTypes=u.a,r=i))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return M});var r,o,i,a,s,c,u=n(135),l=n.n(u),p=n(341),f=n(342),d=n(353),y=n(716),b=n(350),m=n(1108),h=n(803),v=n(807),g=n(2996),O=(n.n(g),n(3008)),_=n.n(O),S=n(354);n.n(S);function E(e){"@babel/helpers - typeof";return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,n,r){c||(c="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:c,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function A(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var R=k(m.a,{}),j=k(h.a,{}),M=Object(f.inject)("data","visual","services","controllers","environmentAdapter")(r=Object(f.observer)((s=a=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(n=function(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?w(e):t}(this,(e=C(t)).call.apply(e,[this].concat(o))))._messageBodyRef=l.a.createRef(),function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(w(n),"saveComposeContainerRef",i,w(n)),n._focusBody=function(){var e=n._messageBodyRef.current;e&&e.focus()},n._onRecipientsClick=function(){n.props.controllers.quickReply.goToFullCompose(),n.metrikaService.sendMetrika(S.QUICK_REPLY_CLICK_ON_RECIPIENTS)},n._onFullComposeClick=function(){n.props.controllers.quickReply.goToFullCompose(),n.metrikaService.sendMetrika(S.QUICK_REPLY_CLICK_ON_COMPOSE)},n._onCloseClick=function(){n.props.controllers.compose.closeCompose(),n.metrikaService.sendMetrika(S.QUICK_REPLY_CLICK_ON_CLOSE)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(t,l.a.Component),function(e,t,n){t&&P(e.prototype,t),n&&P(e,n)}(t,[{key:"componentDidMount",value:function(){this.hotkeysController.attachNode(this.composeContainerRef),this._placeInViewport(),this.props.environmentAdapter.apdexSend(["Performance_openCompose"])}},{key:"_placeInViewport",value:function(){var e=ns.Model.get(Object(b.is3Pane)()?"scroller-message":"scroller-messages"),t=Object(b.is3Pane)()?0:-ns.Model.get("app-state").get(".timelineHeight");e.init(),e.scrollIntoView(this.composeContainerRef,{alignToTop:!1,relative:e.isRelativeOffset(),viewBottomOffset:t}),Object(b.changeRightColumSize)()}},{key:"render",value:function(){return l.a.createElement("div",{className:_.a.container,ref:this.saveComposeContainerRef},k("div",{className:_.a.content},void 0,k(g.Header,{onRecipientsClick:this._onRecipientsClick,onFullComposeClick:this._onFullComposeClick,onCloseClick:this._onCloseClick}),l.a.createElement(v.a,{cls:_.a.editor,placeholder:Object(d.default)("compose-react/Editor_Placeholder"),onEditorInit:this._focusBody,ref:this._messageBodyRef}),k("div",{className:_.a.footer},void 0,R)),j)}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"hotkeysController",get:function(){return this.props.controllers.hotkeys}},{key:"composeContainerRef",get:function(){return this.props.visual.refs.composeContainer}}]),t}(),a.propTypes=y.a,A((o=s).prototype,"metrikaService",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),A(o.prototype,"hotkeysController",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"hotkeysController"),o.prototype),A(o.prototype,"composeContainerRef",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeContainerRef"),o.prototype),i=A(o.prototype,"saveComposeContainerRef",[p.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.props.visual.refs.composeContainer=t}}}),r=o))||r)||r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;var r=n(2997);Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return r.Header}})},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;var o=r(n(135)),i=r(n(339)),a=n(2998),s=n(3001),c=n(3004),u=r(n(3007));t.Header=function(e){var t=e.onRecipientsClick,n=e.onFullComposeClick,r=e.onCloseClick;return o.default.createElement("div",{className:u.default.container},o.default.createElement("div",{className:i.default("qa-QuickReply-Recipients",u.default.recipients)},o.default.createElement(c.Recipients,{onClick:t})),o.default.createElement("div",{className:u.default.buttons},o.default.createElement(a.FullComposeButton,{className:i.default("qa-QuickReply-FullComposeButton",u.default.icon),onClick:n}),o.default.createElement(s.CloseButton,{className:i.default("qa-QuickReply-CloseButton",u.default.icon),onClick:r})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullComposeButton=void 0;var r=n(2999);Object.defineProperty(t,"FullComposeButton",{enumerable:!0,get:function(){return r.FullComposeButton}})},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FullComposeButton=void 0;var o=r(n(135)),i=r(n(344)),a=r(n(353)),s=n(142),c=n(140),u=r(n(3e3));t.FullComposeButton=function(e){var t=e.className,n=e.onClick;return o.default.createElement(s.TooltipStateful,{view:"default",state:"warning",size:"s",direction:"top",content:o.default.createElement(i.default,{loc:"compose-react/QuickReply_FullCompose"})},o.default.createElement(c.Button,{view:"clear",size:"s",className:t,icon:function(e){return o.default.createElement(u.default,{className:e})},onClick:n,role:"button","aria-label":a.default("compose-react/QuickReply_FullCompose")}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{d:"M20.3 10.786v-.323l-1.15.314a6.26 6.26 0 01-1.65.221c-.6 0-1-.447-1-1a1 1 0 011-1H22a1 1 0 011 1v4.504a1 1 0 01-1 1c-.552 0-1-.403-1-1 0-.56.075-1.116.222-1.656l.313-1.147h-.32l-1.078 1.437a9.996 9.996 0 01-.93 1.072l-1.003 1.002a1 1 0 11-1.414-1.414l1.004-1.004a9.997 9.997 0 011.064-.923l1.442-1.083zm-8.6 10.418v.324l1.15-.314a6.26 6.26 0 011.65-.222c.6 0 1 .448 1 1.001a1 1 0 01-1 1H10a1 1 0 01-1-1V17.49a1 1 0 011-1c.552 0 1 .402 1 1 0 .559-.075 1.116-.222 1.655l-.313 1.147h.32l1.078-1.437c.285-.379.596-.737.93-1.072l1.003-1.002a1 1 0 111.414 1.415l-1.004 1.003a9.997 9.997 0 01-1.064.924L11.7 21.204z",fill:"currentColor"});t.default=function(e){return o.createElement("svg",i({width:32,height:32,viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloseButton=void 0;var r=n(3002);Object.defineProperty(t,"CloseButton",{enumerable:!0,get:function(){return r.CloseButton}})},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloseButton=void 0;var o=r(n(135)),i=r(n(344)),a=r(n(353)),s=n(142),c=n(140),u=r(n(3003));t.CloseButton=function(e){var t=e.className,n=e.onClick;return o.default.createElement(s.TooltipStateful,{view:"default",state:"warning",size:"s",direction:"top",content:o.default.createElement(i.default,{loc:"compose-react/QuickReply_Close"})},o.default.createElement(c.Button,{view:"clear",size:"s",className:t,icon:function(e){return o.default.createElement(u.default,{className:e})},onClick:n,role:"button","aria-label":a.default("compose-react/QuickReply_Close")}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.793 9.793a1 1 0 000 1.414L14.586 16l-4.793 4.793a1 1 0 101.414 1.414L16 17.414l4.793 4.793a1 1 0 001.414-1.414L17.414 16l4.793-4.793a1 1 0 00-1.414-1.414L16 14.586l-4.793-4.793a1 1 0 00-1.414 0z",fill:"currentColor"});t.default=function(e){return o.createElement("svg",i({width:32,height:32,viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Recipients=void 0;var r=n(3005);Object.defineProperty(t,"Recipients",{enumerable:!0,get:function(){return r.Recipients}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"Recipients",function(){return j});var r,o,i,a,s,c=n(135),u=n.n(c),l=n(338),p=n.n(l),f=n(339),d=n.n(f),y=n(341),b=n(342),m=n(344),h=n(711),v=n(419),g=n(794),O=(n.n(g),n(1519)),_=n(363),S=n(3006),E=n.n(S);function P(e){"@babel/helpers - typeof";return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t,n,r){s||(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),c=0;c<i;c++)a[c]=arguments[c+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:s,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var j=Object(b.inject)("data")(r=Object(b.observer)((a=i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),T(this,k(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,u.a.PureComponent),function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(t,[{key:"render",value:function(){var e=this,t=this.props.onClick;return u.a.createElement(u.a.Fragment,null,R(h.a,{className:d()("qa-QuickReply-Recipients-Main",E.a.yabble),AvatarComponent:g.ContactAvatarWithTooltip,ContentComponent:O.a,getContact:function(){return v.default.of(e._recipients[0])},onClick:t}),this._maybeRenderMoreRecipients())}},{key:"_maybeRenderMoreRecipients",value:function(){if(1===this._recipients.length)return null;var e=this.props.onClick,t={count:this._recipients.length-1},n=R(m.default,{loc:"compose-react/QuickReply_RecipientCount",params:t});return R(h.a,{className:d()("qa-QuickReply-Recipients-More",E.a.yabble),ContentComponent:function(){return n},onClick:e,isValid:!0})}},{key:"_recipients",get:function(){var e=this.props.data.addresses,t=e.to,n=e.cc,r=e.bcc;return[].concat(C(t),C(n),C(r))}}]),t}(),i.propTypes={onClick:p.a.func.isRequired,data:_.a.isRequired},function(e,t,n,r,o){var i={};Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null)}((o=a).prototype,"_recipients",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"_recipients"),o.prototype),r=o))||r)||r},function(e,t){e.exports={yabble:"Recipients__yabble--29-sN"}},function(e,t){e.exports={container:"Header__container--Lwu6N",recipients:"Header__recipients--1DrTI",buttons:"Header__buttons--2t96j",icon:"Header__icon--1GQbI"}},function(e,t){e.exports={container:"Compose__container--35cdD",content:"Compose__content--2unBB",editor:"Compose__editor--2D5Y-",footer:"Compose__footer--353NM"}},function(e,t,n){"use strict";var r=n(3010);n.d(t,"a",function(){return r.a});var o=n(3013);n.d(t,"b",function(){return o.a});var i=n(3015);n.d(t,"c",function(){return i.a});var a=n(3016);n.d(t,"d",function(){return a.a});var s=n(3017);n.n(s);n.o(s,"EmptySubject")&&n.d(t,"e",function(){return s.EmptySubject});var c=n(3024);n.d(t,"f",function(){return c.a});var u=n(3026);n.d(t,"g",function(){return u.a});var l=n(3027);n.d(t,"h",function(){return l.a});var p=n(3028);n.d(t,"j",function(){return p.a});var f=n(3029);n.n(f);n.o(f,"TooManySubscribers")&&n.d(t,"i",function(){return f.TooManySubscribers})},function(e,t,n){"use strict";n.d(t,"a",function(){return x});var r,o,i,a,s,c,u=n(135),l=n.n(u),p=n(341),f=n(342),d=n(450),y=(n.n(d),n(1458)),b=(n.n(y),n(357)),m=n(1465),h=n(361),v=n(356),g=n(366),O=n(594),_=n(1119),S=n(546),E=n(344),P=n(502),C=n(354),w=(n.n(C),n(3012));n.n(w);function T(e){"@babel/helpers - typeof";return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n,r){c||(c="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var u in o)void 0===t[u]&&(t[u]=o[u]);else t||(t=o||{});return{$$typeof:c,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function I(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var D=Object(_.a)(O.b),L=M(E.default,{loc:"compose-react/AttachmentsErrors_Dialog_Title"}),N=M(E.default,{loc:"compose-react/AttachmentsErrors_Confirm_Button_Title"}),x=Object(f.inject)("controllers","services","visual")(r=Object(f.observer)((s=a=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return function(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}(R(n=function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?R(e):t}(this,(e=A(t)).call.apply(e,[this].concat(o)))),"closePopup",i,R(n)),n.onActionClick=function(){n.closePopup(),n.metrikaService.sendPopupsMetrika(C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS,C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_ACTION)},n.onCloseClick=function(){n.closePopup(),n.metrikaService.sendPopupsMetrika(C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS,C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_CLOSE)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,l.a.Component),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"groupAttachmentsByErrorCodes",value:function(){var e=this,t=this.notValidAttachments.reduce(function(e,t){var n=t.errorCode===b.e.YADISK_ERROR?b.e.UNKNOWN:t.errorCode;return e[n]?e[n].items.push(t):e[n]={errorCode:n,items:[t]},e},{});return Object.keys(t).map(function(n){var r=t[n],o=r.errorCode,i=r.items,a=m.b[o].key,s=e.getDescriptionForErrorCode(o);return{errorCode:o,title:M(E.default,{loc:a}),description:s,items:i}})}},{key:"getDescriptionForErrorCode",value:function(e){var t=m.a[e],n=t.key;return e===b.e.FILE_LIMIT||e===b.e.TOTAL_LIMIT?this.renderSizeLimitDescription(t):e===b.e.DISK_FULL?this.renderDiskFullDescription(n):e===b.e.DISK_TRAFFIC_LIMIT?(this.metrikaService.sendPopupsMetrika(C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS,C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_SHOW,C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_DISK_TRAFFIC_LIMIT),this.renderDiskTrafficLimitDescription(n)):(e===b.e.DISK_TECHNICAL_WORK&&this.metrikaService.sendPopupsMetrika(C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS,C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_SHOW,C.COMPOSE_METRIKA_POPUPS_ATTACHMENTS_ERRORS_DISK_TECHNICAL_WORK),M(E.default,{loc:n}))}},{key:"renderSizeLimitDescription",value:function(e){var t=e.key,n=e.extraKeyCorp,r=e.extraKeyProd;if(this.attachmentsService.hasDisk)return M(E.default,{loc:t});var o=this.limitsService.getMaxSizeForSingleFile(this.isDiskAvailable)/y.MB_SIZE;return this.attachmentsService.isCorp?M(E.default,{loc:n,params:{size:o}}):M(E.default,{loc:r,params:{size:o}},void 0,M(P.c,{"data-ref":"disk",theme:"normal",url:this.attachmentsService.signUpDiskUrl(),target:"_blank",rel:"noopener",cls:"compose-AttachmentsErrors-Link"}))}},{key:"renderDiskTrafficLimitDescription",value:function(e){return M(E.default,{loc:e},void 0,M(P.c,{"data-ref":"help-link",theme:"normal",url:"".concat(this.attachmentsService.diskHelpUrl()),target:"_blank",rel:"noopener"}))}},{key:"renderDiskFullDescription",value:function(e){return M(E.default,{loc:e},void 0,M(P.c,{"data-ref":"clean",theme:"normal",url:this.attachmentsService.cleanUpYaDiskUrl(),target:"_blank",rel:"noopener",cls:"compose-AttachmentsErrors-Link"}),M(P.c,{"data-ref":"buy",theme:"normal",url:this.attachmentsService.increaseYaDiskSizeUrl(),target:"_blank",rel:"noopener",cls:"compose-AttachmentsErrors-Link"}))}},{key:"render",value:function(){var e=1===this.errorGroups.length,t=e&&this.errorGroups[0],n=e?t.title:L;return M(S.a,{cls:"ComposeAttachmentsErrors",visible:this.currentPopup===d.ATTACHMENTS_ERROR,Title:n,Description:M(D,{errorGroups:this.errorGroups}),ActionText:N,onAction:this.onActionClick,onClose:this.onCloseClick})}},{key:"attachmentsController",get:function(){return this.props.controllers.attachments}},{key:"attachmentsService",get:function(){return this.props.services.attachments}},{key:"limitsService",get:function(){return this.props.services.limits}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"isDiskAvailable",get:function(){return this.attachmentsService.hasDisk}},{key:"currentPopup",get:function(){return this.props.visual.currentPopup}},{key:"notValidAttachments",get:function(){return this.attachmentsController.notValidAttachments||[]}},{key:"errorGroups",get:function(){return this.groupAttachmentsByErrorCodes()}}]),t}(),a.propTypes={controllers:h.a.isRequired,services:v.a.isRequired,visual:g.a.isRequired},I((o=s).prototype,"attachmentsController",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"attachmentsController"),o.prototype),I(o.prototype,"attachmentsService",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"attachmentsService"),o.prototype),I(o.prototype,"limitsService",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"limitsService"),o.prototype),I(o.prototype,"metrikaService",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),I(o.prototype,"isDiskAvailable",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"isDiskAvailable"),o.prototype),I(o.prototype,"currentPopup",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"currentPopup"),o.prototype),I(o.prototype,"notValidAttachments",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"notValidAttachments"),o.prototype),i=I(o.prototype,"closePopup",[p.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.currentPopup="",setTimeout(Object(p.action)(function(){e.attachmentsController.removeNotValidAttachments()}),200)}}}),I(o.prototype,"errorGroups",[p.computed],Object.getOwnPropertyDescriptor(o.prototype,"errorGroups"),o.prototype),r=o))||r)||r},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return Y});var r,o,i,a,s,c,u,l,p=n(135),f=n.n(p),d=n(342),y=n(341),b=n(363),m=n(361),h=n(356),v=n(718),g=n(366),O=n(344),_=n(1395),S=n(354),E=(n.n(S),n(367)),P=n(355),C=(n.n(P),n(546)),w=n(354),T=(n.n(w),n(3014));n.n(T);function k(e){"@babel/helpers - typeof";return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t,n,r){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function L(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function N(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var x="ComposeReactCaptcha",B={Block:x,Captcha:"".concat(x,"-Captcha"),Section:"".concat(x,"-Section"),ImageContainer:"".concat(x,"-ImageContainer"),Image:"".concat(x,"-Image"),Link:"".concat(x,"-Link"),Label:"".concat(x,"-Label"),Input:"".concat(x,"-Input")},F=D(O.default,{loc:"compose-react/Captcha_Title"}),z=D(O.default,{loc:"compose-react/Send"}),U=D(O.default,{loc:"compose-react/Captcha_Message"}),K=D("br",{}),H=D("br",{}),W=D(O.default,{loc:"compose-react/Captcha_Refresh"}),Y=Object(d.inject)("data","services","controllers","visual","validation")(r=Object(d.observer)((u=c=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=function(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?M(e):t}(this,(e=j(t)).call.apply(e,[this].concat(o))))._afterUpdateQueue=[],n._disposer=new E.a,n._inputRef=f.a.createRef(),n.showPopup=function(e){var t=e.error,r=e.captchaKey,o=e.captchaUrl;t===P.SendError.CAPTCHA&&(n.updateCaptcha({captchaKey:r,captchaUrl:o}),n.metrikaService.sendPopupsMetrika(S.COMPOSE_METRIKA_POPUPS_CAPTCHA,S.COMPOSE_METRIKA_POPUPS_CAPTCHA_SHOW))},L(M(n),"closePopup",i,M(n)),L(M(n),"onActionClick",a,M(n)),n.onCloseClick=function(){n.closePopup(),n.metrikaService.sendPopupsMetrika(S.COMPOSE_METRIKA_POPUPS_CAPTCHA,w.COMPOSE_METRIKA_POPUPS_CAPTCHA_CANCEL),n.composeController.focusComposeField("body")},n._onRefreshCaptchaClick=function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){A(i,r,o,a,s,"next",e)}function s(e){A(i,r,o,a,s,"throw",e)}a(void 0)})}}(regeneratorRuntime.mark(function e(t){var r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n.metrikaService.sendPopupsMetrika(S.COMPOSE_METRIKA_POPUPS_CAPTCHA,S.COMPOSE_METRIKA_POPUPS_CAPTCHA_REFRESH),e.next=4,n.captchaService.refreshCaptcha();case 4:r=e.sent,o=r.captchaKey,i=r.captchaUrl,n.updateCaptcha({captchaKey:o,captchaUrl:i});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.afterUpdate=function(e){n._afterUpdateQueue.push(e)},L(M(n),"_onChangeCaptchaValue",s,M(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,f.a.Component),function(e,t,n){t&&R(e.prototype,t),n&&R(e,n)}(t,[{key:"updateCaptcha",value:function(e){var t=e.captchaKey,n=e.captchaUrl;this.props.visual.currentPopup=P.Popups.CAPTCHA,this.captcha.key=t,this.captcha.imgUrl=n,this.captcha.value=""}},{key:"componentDidMount",value:function(){var e=this;this._disposer.add(this,[Object(y.reaction)(function(){return e.props.validation.sendError},function(t){return t&&e.showPopup(t)}),Object(y.reaction)(function(){return e.isVisible},function(t){var n=e._inputRef.current;t&&n&&e.afterUpdate(function(){return n.focus()})})])}},{key:"componentDidUpdate",value:function(){this._afterUpdateQueue.forEach(function(e){return e()}),this._afterUpdateQueue=[]}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"render",value:function(){return D(C.a,{visible:this.isVisible,Title:F,Description:this._renderContent(),ActionText:z,onAction:this.onActionClick,onClose:this.onCloseClick})}},{key:"_renderContent",value:function(){var e=this.captcha,t=e.imgUrl,n=e.value;return D("div",{className:B.Block},void 0,U,K,H,D(O.default,{loc:"compose-react/Captcha_Description"},void 0,D(_.a,{cls:B.Link,"data-ref":"help-link",rel:"noreferrer noopener",url:"https://yandex.".concat(this.topLevelDomain,"/support/mail/web/spam.html#sending-limits"),target:"_blank"})),D("div",{className:B.Captcha},void 0,D("div",{className:B.Section},void 0,D("div",{className:B.ImageContainer},void 0,D("img",{className:B.Image,src:t})),D(_.a,{cls:B.Link,onClick:this._onRefreshCaptchaClick},void 0,W)),D("div",{className:B.Section},void 0,D(O.default,{className:B.Label,loc:"compose-react/Captcha_AnswerLabel"}),f.a.createElement("input",{autoFocus:!0,ref:this._inputRef,className:B.Input,onChange:this._onChangeCaptchaValue,value:n}))))}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"captchaService",get:function(){return this.props.services.captcha}},{key:"captcha",get:function(){return this.props.data.captcha}},{key:"isVisible",get:function(){return this.props.visual.currentPopup===P.Popups.CAPTCHA}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"topLevelDomain",get:function(){return this.props.services.settings.topLevelDomain}}]),t}(),c.propTypes={data:b.a.isRequired,controllers:m.a.isRequired,services:h.a.isRequired,validation:v.a.isRequired,visual:g.a.isRequired},N((o=u).prototype,"composeController",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),N(o.prototype,"captchaService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"captchaService"),o.prototype),N(o.prototype,"captcha",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"captcha"),o.prototype),N(o.prototype,"isVisible",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"isVisible"),o.prototype),N(o.prototype,"metrikaService",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),N(o.prototype,"topLevelDomain",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"topLevelDomain"),o.prototype),N(o.prototype,"updateCaptcha",[y.action],Object.getOwnPropertyDescriptor(o.prototype,"updateCaptcha"),o.prototype),i=N(o.prototype,"closePopup",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.currentPopup="",e.props.visual.isLocked=!1,e.props.validation.sendError=null}}}),a=N(o.prototype,"onActionClick",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.controllers.saveSend.sendMessage(),e.metrikaService.sendPopupsMetrika(S.COMPOSE_METRIKA_POPUPS_CAPTCHA,S.COMPOSE_METRIKA_POPUPS_CAPTCHA_SEND)}}}),s=N(o.prototype,"_onChangeCaptchaValue",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.captcha.value=t.target.value}}}),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return I});var r,o,i,a,s,c,u,l,p=n(135),f=n.n(p),d=n(342),y=n(341),b=n(344),m=n(546),h=n(361),v=n(366),g=n(355);n.n(g);function O(e){"@babel/helpers - typeof";return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t,n,r){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function w(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function T(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var k=g.Popups.CONFIRM_REMOVE,A=C(b.default,{loc:"compose-react/Confirm_remove_title"}),R=C(b.default,{loc:"compose-react/Confirm_remove_desc"}),j=C(b.default,{loc:"compose-react/Confirm_remove_action"}),M=C(b.default,{loc:"compose-react/Confirm_remove_cancel"}),I=Object(d.inject)("controllers")(r=Object(d.inject)("visual")(r=Object(d.observer)((u=c=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return w(E(n=function(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?E(e):t}(this,(e=S(t)).call.apply(e,[this].concat(o)))),"closePopup",i,E(n)),w(E(n),"removeAndClose",a,E(n)),w(E(n),"closeWithoutSaving",s,E(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,f.a.Component),function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(t,[{key:"render",value:function(){return C(m.a,{visible:this.currentPopup===k,Title:A,Description:R,ActionText:j,CancelText:M,onAction:this.removeAndClose,onCancel:this.closeWithoutSaving,onClose:this.closePopup})}},{key:"checkUnsavedChangesController",get:function(){return this.props.controllers.checkUnsavedChanges}},{key:"currentPopup",get:function(){return this.props.visual.currentPopup}}]),t}(),c.propTypes={controllers:h.a.isRequired,visual:v.a.isRequired},T((o=u).prototype,"checkUnsavedChangesController",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"checkUnsavedChangesController"),o.prototype),T(o.prototype,"currentPopup",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"currentPopup"),o.prototype),i=T(o.prototype,"closePopup",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.checkUnsavedChangesController.cancelRemoveDraft()}}}),a=T(o.prototype,"removeAndClose",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.checkUnsavedChangesController.confirmRemoveDraft()}}}),s=T(o.prototype,"closeWithoutSaving",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.checkUnsavedChangesController.rejectRemoveDraft()}}}),r=o))||r)||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return T});var r,o,i,a,s,c,u,l,p=n(135),f=n.n(p),d=n(341),y=n(342),b=n(1121),m=n(361),h=n(363),v=n(366),g=n(355);n.n(g);function O(e){"@babel/helpers - typeof";return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function w(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var T=Object(y.inject)("controllers","data","visual")(r=Object(y.observer)((u=c=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return C(E(n=function(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?E(e):t}(this,(e=S(t)).call.apply(e,[this].concat(o)))),"onCancelDiskResources",i,E(n)),C(E(n),"onAttachDiskResources",a,E(n)),C(E(n),"onClose",s,E(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,f.a.Component),function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(t,[{key:"render",value:function(){var e=this.props.visual.currentPopup===g.Popups.DISK_RESOURCES;return this.diskResourcesPopup||e?(this.diskResourcesPopup||(this.diskResourcesPopup=!0),function(e,t,n,r){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(b.a,{onClose:this.onClose,isVisible:e,path:this.props.visual.diskResourcesPath,onCancel:this.onCancelDiskResources,onAttach:this.onAttachDiskResources})):null}}]),t}(),c.propTypes={controllers:m.a.isRequired,data:h.a.isRequired,visual:v.a.isRequired},i=w((o=u).prototype,"onCancelDiskResources",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.currentPopup=""}}}),a=w(o.prototype,"onAttachDiskResources",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.selectedItems;e.props.visual.currentPopup="",e.props.controllers.attachments.attachFilesFromDisk(n)}}}),s=w(o.prototype,"onClose",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){"esc"===n&&(e.props.visual.currentPopup="")}}}),r=o))||r)||r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmptySubject=void 0;var r=n(3018);Object.defineProperty(t,"EmptySubject",{enumerable:!0,get:function(){return r.EmptySubject}})},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.EmptySubject=void 0;var u=i(n(135)),l=n(342),p=n(341),f=c(n(519)),d=n(355),y=n(397),b=n(3019);t.EmptySubject=l.observer(function(){var e=y.useStores(),t=e.visual,n=t.currentPopup,r=t.subjectsSuggest.suggestItems,o=e.data,i=e.validation.sendError,a=e.controllers,c=a.visual,l=a.compose,m=a.smartSubject,h=a.saveSend,v=e.services,g=v.settings,O=v.metrika,_=n===d.Popups.EMPTY_SUBJECT,S=u.useCallback(function(e){e&&(g.isSmartSubjectEnabled=!1)},[g]),E=u.useCallback(function(e){c.closeCurrentPopup(),S(e),l.focusComposeField("subject")},[l,S,c]),P=u.useCallback(function(e){p.runInAction(function(){return o.allowEmptySubject=!0}),h.sendMessage(),S(e)},[o,S,h]),C=u.useCallback(function(){c.closeCurrentPopup(),l.focusComposeField("subject")},[l,c]),w=u.useCallback(function(e){p.runInAction(function(){o.subject=e.text}),m.logSuggestSelect(e)},[o,m]),T=u.useCallback(function(e){p.runInAction(function(){o.subject=e.target.value})},[o]),k=u.useCallback(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return O.sendPopupsMetrika.apply(O,s(e))},[O]);return u.useEffect(function(){(null===i||void 0===i?void 0:i.error)===d.SendError.EMPTY_SUBJECT&&m.getSmartSubjectForPopup().catch(f.default).then(function(){return c.openPopup(d.Popups.EMPTY_SUBJECT)})},[m,c,i]),u.default.createElement(b.EmptySubjectContent,{subject:o.subject,onChangeSubject:T,suggestItems:r||[],visible:_,onClose:E,onAction:P,onCancel:C,onSelectSubject:w,onSendMetric:k})})},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SuggestItem=t.EmptySubjectContent=void 0;var u=i(n(135)),l=c(n(339)),p=n(497),f=n(138),d=n(140),y=n(176),b=c(n(353)),m=n(720),h=c(n(344)),v=n(354),g=n(349),O=n(373),_=n(379),S=c(n(3023)),E="ComposeReactEmptySubjectPopup",P={Block:E,Section:E+"-Section",Label:E+"-Label",Input:E+"-Input",WithEmptySubject:E+"_withEmptySubject",SuggestSection:E+"-SuggestSection",SuggestContainer:E+"-SuggestContainer",SuggestItem:E+"-SuggestItem",SuggestItemHighlighted:E+"-SuggestItem_highlighted"};t.EmptySubjectContent=function(e){var n,r=e.subject,o=e.onAction,i=e.onCancel,c=e.onChangeSubject,d=e.onClose,E=e.onSelectSubject,C=e.onSendMetric,w=e.suggestItems,T=e.visible,k=Boolean(r),A=l.default(P.Block,S.default.root,((n={})[P.WithEmptySubject]=!k,n[S.default.withEmptySubject]=!k,n),g.hasFeature(g.Features.WEB_DARK_COMPOSE)?"":_.cnTheme(O.PS_LIGHT)),R=k?"compose-react/EmptySubjectPopup_Send":"compose-react/EmptySubjectPopup_SendEmpty",j=w.length?"compose-react/EmptySuggestPopup_SmartSubjectDescription":"compose-react/EmptySuggestPopup_NoSuggestDescription",M=u.useCallback(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];C.apply(void 0,s([v.COMPOSE_METRIKA_POPUPS_SMART_SUBJECT],e))},[C]),I=a(u.useState(!1),2),D=I[0],L=I[1],N=u.useCallback(function(e){L(e.target.checked),M(v.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_CLICK_DO_NOT_SHOW)},[M,L]),x=u.useCallback(function(){o(D),M(r?v.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_SEND:v.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_SEND_EMPTY)},[D,o,M,r]),B=u.useCallback(function(){d(D),M(v.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_CLOSE)},[D,d,M]),F=u.useCallback(function(){i(),M(v.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_CANCEL)},[i,M]),z=u.useMemo(function(){return w.slice(0,p.MAX_SUGGEST_ITEMS_FOR_POPUP)},[w]);return u.useEffect(function(){T&&M(v.COMPOSE_METRIKA_POPUPS_EMPTY_SUBJECT_SHOW)},[M,T]),u.default.createElement(m.ConfirmPopup,{className:A,visible:T,onClose:B},u.default.createElement(m.PopupTitle,null,u.default.createElement(h.default,{loc:"compose-react/EmptySubjectPopup_Title"})),u.default.createElement(m.PopupBody,null,u.default.createElement(f.Text,{as:"div",typography:"body-long-m"},u.default.createElement(h.default,{loc:j})),u.default.createElement("div",{className:S.default.suggest},z.map(function(e,n){return u.default.createElement(t.SuggestItem,{key:"SuggestItem-"+n,onSelectSubject:E,item:e,subject:r,onSendMetric:M})})),u.default.createElement(y.Textinput,{view:"default",size:"l",autoFocus:!0,className:l.default(P.Input,S.default.input),placeholder:b.default("compose-react/EmptySuggestPopup_SubjectPlaceholder"),value:r,onChange:c})),u.default.createElement(m.PopupButtons,null,u.default.createElement(m.PopupConfirmButton,{view:"default",onClick:x},u.default.createElement(h.default,{loc:R})),u.default.createElement(m.PopupCancelButton,{view:"clear",onClick:F},u.default.createElement(h.default,{loc:"compose-react/EmptySubjectPopup_Return"}))),u.default.createElement(m.PopupCheckbox,{checked:D,onChange:N,label:u.default.createElement(h.default,{loc:"compose-react/EmptySuggestPopup_DontShow"})}))};t.SuggestItem=function(e){var t,n=e.item,r=e.subject,o=e.onSelectSubject,i=e.onSendMetric,a=u.useCallback(function(){o(n),i(v.COMPOSE_METRIKA_POPUPS_SMART_SUBJECT_SELECT_FROM_SUGGEST)},[n,o,i]);return u.default.createElement(d.Button,{className:l.default(P.SuggestItem,S.default.suggestItem,(t={},t[P.SuggestItemHighlighted]=n.text===r,t[S.default.highlighted]=n.text===r,t)),view:"default",size:"l",onClick:a},n.text)}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PopupCheckbox=t.PopupCancelButton=t.PopupConfirmButton=t.PopupButtons=t.PopupDescription=t.PopupBody=t.PopupTitle=t.ConfirmPopup=t.PopupCloseButton=void 0;var u=a(n(135)),l=c(n(339)),p=c(n(719)),f=n(140),d=n(138),y=n(146),b=c(n(3021)),m=c(n(3022)),h=n(397),v="qa-ComposeConfirmPopup",g={Block:v,Content:v+"-Content",Title:v+"-Title",Description:v+"-Description",Toolbar:v+"-Toolbar",Button:v+"-Button",Button_action:v+"-Button_action",Button_cancel:v+"-Button_cancel",Close:v+"-Close",CheckmarkSection:v+"-CheckmarkSection"},O=function(e){return u.default.createElement("span",{className:l.default(e,b.default.icon)},u.default.createElement(m.default,null))};t.PopupCloseButton=function(e){return u.default.createElement("div",{className:b.default.close},u.default.createElement(f.Button,r({className:g.Close,view:"clear",size:"l",icon:O},e)))};t.ConfirmPopup=function(e){var n,o=e.className,i=e.children,a=e.onClose,c=e.contentClassName,f=s(e,["className","children","onClose","contentClassName"]),d=h.useStores().services.settings,y=d.isMobile,m=d.isTablet,v=l.default(o,b.default.root,g.Block,y?b.default.mobile:b.default.desktop,((n={})[b.default.tablet]=m,n)),O=u.useCallback(function(e){return null===a||void 0===a?void 0:a(e,"click")},[a]);return u.default.createElement(p.default,r({},f,{className:v}),u.default.createElement("div",{className:l.default(b.default.content,g.Content,c)},a&&u.default.createElement(t.PopupCloseButton,{onClick:O}),i))};t.PopupTitle=function(e){var t=e.className,n=s(e,["className"]);return u.default.createElement(d.Text,r({typography:"subheader-m",as:"h2",className:l.default(g.Title,b.default.title,t),weight:"bold"},n))};t.PopupBody=function(e){var t=e.className,n=s(e,["className"]);return u.default.createElement("div",r({className:l.default(b.default.body,t)},n))};t.PopupDescription=function(e){var t=e.className,n=s(e,["className"]);return u.default.createElement(d.Text,r({as:"div",typography:"body-long-m",className:l.default(g.Description,b.default.description,t)},n))};t.PopupButtons=function(e){var t=e.className,n=s(e,["className"]);return u.default.createElement("div",r({className:l.default(g.Toolbar,b.default.toolbar,t)},n))};t.PopupConfirmButton=function(e){var t=e.className,n=s(e,["className"]);return u.default.createElement(f.Button,r({className:l.default(g.Button,g.Button_action,b.default.button,t),view:"action",size:"m"},n))};t.PopupCancelButton=function(e){var t=e.className,n=s(e,["className"]);return u.default.createElement(f.Button,r({className:l.default(g.Button,g.Button_action,b.default.button,t),view:"default",size:"m"},n))};t.PopupCheckbox=function(e){var t=e.className,n=s(e,["className"]);return u.default.createElement("div",{className:b.default.checkmarkSection},u.default.createElement(y.Checkbox,r({className:l.default(g.CheckmarkSection,t),size:"s",view:"default"},n)))}},function(e,t){e.exports={root:"ConfirmPopup__root--2EoZ0",desktop:"ConfirmPopup__desktop--37vMZ",content:"ConfirmPopup__content--2n4Zq",title:"ConfirmPopup__title--3XU8M",description:"ConfirmPopup__description--1hcEN",body:"ConfirmPopup__body--24NZg",toolbar:"ConfirmPopup__toolbar--2DMIe",button:"ConfirmPopup__button--_Z6O_",mobile:"ConfirmPopup__mobile--Idpr8",tablet:"ConfirmPopup__tablet--1AFyC",close:"ConfirmPopup__close--KEuX_",checkmarkSection:"ConfirmPopup__checkmarkSection--PWus-",icon:"ConfirmPopup__icon--3jv9V"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(135);n.n(o);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.207 6.207a1 1 0 00-1.414-1.414L12 10.586 6.207 4.793a1 1 0 00-1.414 1.414L10.586 12l-5.793 5.793a1 1 0 101.414 1.414L12 13.414l5.793 5.793a1 1 0 001.414-1.414L13.414 12l5.793-5.793z",fill:"currentColor"});t.default=function(e){return o.createElement("svg",i({width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a)}},function(e,t){e.exports={root:"EmptySubject__root--2oSpR",suggest:"EmptySubject__suggest--x4PpG",suggestItem:"EmptySubject__suggestItem--2hCGL",input:"EmptySubject__input--102Gc"}},function(e,t,n){"use strict";n.d(t,"a",function(){return N});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(342),d=n(341),y=n(344),b=n(361),m=n(356),h=n(718),v=n(366),g=n(354),O=(n.n(g),n(367)),_=n(355),S=(n.n(_),n(546)),E=n(3025),P=(n.n(E),n(355));n.n(P);function C(e){"@babel/helpers - typeof";return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function j(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function M(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var I=_.Popups.LIMITED_RECIPIENTS,D=R(y.default,{loc:"compose-react/LimitedRecipients_Title"}),L=R(y.default,{loc:"compose-react/LimitedRecipients_ConfirmButton"}),N=Object(f.inject)("services","controllers","validation","visual")(r=Object(f.observer)((c=s=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(n=function(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?k(e):t}(this,(e=T(t)).call.apply(e,[this].concat(o))))._disposer=new O.a,j(k(n),"showPopup",i,k(n)),j(k(n),"closePopup",a,k(n)),n.onCloseClick=function(){n.closePopup(),n.metrikaService.sendPopupsMetrika(g.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS,g.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS_CLOSE)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,p.a.Component),function(e,t,n){t&&w(e.prototype,t),n&&w(e,n)}(t,[{key:"componentDidMount",value:function(){var e=this;this._disposer.add(this,[Object(d.reaction)(function(){return e.props.validation.limitedRecipients},this.showPopup)])}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"render",value:function(){return R(S.a,{cls:"ComposeLimitedRecipientsPopup",visible:this.currentPopup===I,Title:D,Description:R("div",{},void 0,this._renderErrorMessage()),ActionText:L,onAction:this.onCloseClick,onClose:this.onCloseClick})}},{key:"_renderErrorMessage",value:function(){return R(y.default,{loc:"compose-react/LimitedRecipients_Message",params:{emails:(this.limitedEmails||[]).join(", ")}})}},{key:"limitedEmails",get:function(){return this.props.validation.limitedRecipients}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"currentPopup",get:function(){return this.props.visual.currentPopup}},{key:"metrikaService",get:function(){return this.props.services.metrika}}]),t}(),s.propTypes={controllers:b.a.isRequired,services:m.a.isRequired,validation:h.a.isRequired,visual:v.a.isRequired},M((o=c).prototype,"limitedEmails",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"limitedEmails"),o.prototype),M(o.prototype,"composeController",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),M(o.prototype,"currentPopup",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"currentPopup"),o.prototype),M(o.prototype,"metrikaService",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),i=M(o.prototype,"showPopup",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){t.length&&(e.props.visual.currentPopup=I,e.metrikaService.sendPopupsMetrika(g.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS,g.COMPOSE_METRIKA_POPUPS_LIMITED_RECIPIENTS_SHOW))}}}),a=M(o.prototype,"closePopup",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.currentPopup="",e.props.visual.isLocked=!1,e.props.validation.limitedRecipients=[],e.composeController.closeCompose({leaveType:P.LeaveTypes.SENT})}}}),r=o))||r)||r},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return M});var r,o,i,a,s,c,u,l,p=n(135),f=n.n(p),d=n(342),y=n(341),b=n(344),m=n(546),h=n(361),v=n(366),g=n(355);n.n(g);function O(e){"@babel/helpers - typeof";return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function C(e,t,n,r){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function w(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function T(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var k=g.Popups.REMOVE_DRAFT,A=C(b.default,{loc:"compose-react/DeleteDraft_Popup_Content"}),R=C(b.default,{loc:"compose-react/DeleteDraft_Popup_ConfirmButton"}),j=C(b.default,{loc:"compose-react/Confirm_remove_cancel"}),M=Object(d.inject)("controllers")(r=Object(d.inject)("visual")(r=Object(d.observer)((u=c=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return w(E(n=function(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?E(e):t}(this,(e=S(t)).call.apply(e,[this].concat(o)))),"closePopup",i,E(n)),w(E(n),"removeAndClose",a,E(n)),w(E(n),"cancel",s,E(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,f.a.Component),function(e,t,n){t&&_(e.prototype,t),n&&_(e,n)}(t,[{key:"render",value:function(){return C(m.a,{visible:this.currentPopup===k,Description:A,ActionText:R,CancelText:j,onAction:this.removeAndClose,onCancel:this.cancel,onClose:this.closePopup})}},{key:"currentPopup",get:function(){return this.props.visual.currentPopup}}]),t}(),c.propTypes={controllers:h.a.isRequired,visual:v.a.isRequired},T((o=u).prototype,"currentPopup",[y.computed],Object.getOwnPropertyDescriptor(o.prototype,"currentPopup"),o.prototype),i=T(o.prototype,"closePopup",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.controllers.deleteDraft.cancelRemoveDraft({isClose:!0})}}}),a=T(o.prototype,"removeAndClose",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.controllers.deleteDraft.removeDraftAndClose()}}}),s=T(o.prototype,"cancel",[y.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.controllers.deleteDraft.cancelRemoveDraft()}}}),r=o))||r)||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return ue});var r,o,i,a,s,c,u,l,p=n(136),f=(n.n(p),n(135)),d=n.n(f),y=n(342),b=n(341),m=n(344),h=n(361),v=n(363),g=n(356),O=n(718),_=n(366),S=n(1056),E=(n.n(S),n(354)),P=(n.n(E),n(367)),C=n(355),w=(n.n(C),n(546));function T(e){"@babel/helpers - typeof";return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n,r){l||(l="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:l,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function I(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function D(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var L=C.Popups.SEND_FAILED,N=M(m.default,{loc:"compose-react/SendFailed_Title"}),x=M(m.default,{loc:"compose-react/SendFailed_ConfirmButton_Title"}),B=M(m.default,{loc:"compose-react/SendFailed_RetryNowButton_Title"}),F=M(m.default,{loc:"compose-react/SendFailed_RetryButton_Title"}),z=M(m.default,{loc:"compose-react/SendFailed_ConfirmButton"}),U=M(m.default,{loc:"compose-react/SendFailed_Spam_UrlRbl"}),K=M(m.default,{loc:"compose-react/SendFailed_Spam_BadKarma"}),H=M(m.default,{loc:"compose-react/SendFailed_Spam_Bounces"}),W=M(m.default,{loc:"compose-react/SendFailed_Spam_SpamCompl"}),Y=M(m.default,{loc:"compose-react/SendFailed_Virus"}),G=M(m.default,{loc:"compose-react/SendFailed_IncorrectTo"}),q=M(m.default,{loc:"compose-react/SendFailed_IncorrectCc"}),V=M(m.default,{loc:"compose-react/SendFailed_IncorrectBcc"}),$=M(m.default,{loc:"compose-react/SendFailed_MsgTooBig"}),Q=M(m.default,{loc:"compose-react/SendFailed_NoRecipients"}),X=M(m.default,{loc:"compose-react/SendFailed_FailLimit"}),J=M(m.default,{loc:"compose-react/SendFailed_TooManyEmails"}),Z=M(m.default,{loc:"compose-react/SendFailed_NoData"}),ee=M(m.default,{loc:"compose-react/SendFailed_NoNetwork"}),te=M(m.default,{loc:"compose-react/SendFailed_NoAccess"}),ne=M(m.default,{loc:"compose-react/SendFailed_IllegalParams"}),re=M(m.default,{loc:"compose-react/SendFailed_UndoCannotSave"}),oe=M(m.default,{loc:"compose-react/SendFailed_UndoMessageSaved"}),ie=M(m.default,{loc:"compose-react/SendFailed_UndoCannotSave"}),ae=M(m.default,{loc:"compose-react/SendFailed_DelayedCannotSave"}),se=M(m.default,{loc:"compose-react/SendFailed_DelayedMessageSaved"}),ce=M(m.default,{loc:"compose-react/SendFailed_InternalError"}),ue=Object(y.inject)("services","controllers","data","validation","visual")(r=Object(y.observer)((u=c=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return(n=function(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?R(e):t}(this,(e=A(t)).call.apply(e,[this].concat(o))))._disposer=new P.a,I(R(n),"retryToSend",i,R(n)),I(R(n),"showPopup",a,R(n)),I(R(n),"closePopup",s,R(n)),n.onRetry=function(){n.retryToSend(),n.closePopup(),n.metrikaService.sendPopupsMetrika(E.COMPOSE_METRIKA_POPUPS_SEND_FAILED,E.COMPOSE_METRIKA_POPUPS_SEND_FAILED_RETRY)},n.onCancel=function(){n.closePopup(),n.metrikaService.sendPopupsMetrika(E.COMPOSE_METRIKA_POPUPS_SEND_FAILED,E.COMPOSE_METRIKA_POPUPS_SEND_FAILED_CANCEL)},n.onClose=function(){n.closePopup(),n.metrikaService.sendPopupsMetrika(E.COMPOSE_METRIKA_POPUPS_SEND_FAILED,E.COMPOSE_METRIKA_POPUPS_SEND_FAILED_CLOSE)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(t,d.a.Component),function(e,t,n){t&&k(e.prototype,t),n&&k(e,n)}(t,[{key:"openPhoneConfirm",value:function(){this.props.controllers.compose.checkAuthConfirmed(!0)}},{key:"componentDidMount",value:function(){var e=this;this._disposer.add(this,[Object(b.reaction)(function(){return e.props.validation.sendError},function(t){return t&&e.showPopup(t)})])}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"render",value:function(){var e=this.currentPopup===L,t=N,n=M("div",{},void 0,this._renderErrorMessage()),r=x;if(this.isRetryable){var o=this.isDelayed?B:F;return M(w.a,{visible:e,Title:t,Description:n,ActionText:o,CancelText:r,onAction:this.onRetry,onCancel:this.onCancel,onClose:this.onClose})}var i=this.banReason===C.BanReason.BadKarma?z:r,a=this.banReason===C.BanReason.BadKarma?this.openPhoneConfirm:this.onCancel;return M(w.a,{visible:e,Title:t,Description:n,ActionText:i,onAction:a.bind(this),onClose:this.onClose})}},{key:"_renderBanReason",value:function(){var e="https://yandex.".concat(this.topLevelDomain,"/support/mail/web");switch(this.banReason){case C.BanReason.UrlRbl:return U;case C.BanReason.BadKarma:return K;case C.BanReason.MailLimits:return M(m.default,{loc:"compose-react/SendFailed_Spam_MailLimits"},void 0,M("a",{"data-ref":"help-link",rel:"noreferrer noopener",href:"".concat(e,"/spam.html#sending-limits"),target:"_blank"}));case C.BanReason.PddAdminKarma:return M(m.default,{loc:"compose-react/SendFailed_Spam_PddAdminKarma"},void 0,M("a",{"data-ref":"help-link",rel:"noreferrer noopener",href:"".concat(e,"/letter/create/troubleshooting.html#account-suspicious"),target:"_blank"}));case C.BanReason.Bounces:return H;case C.BanReason.SpamCompl:return W;default:return M(m.default,{loc:"compose-react/SendFailed_Spam_Default"},void 0,M("a",{"data-ref":"help-link",rel:"noreferrer noopener",href:"".concat(e,"/letter/create/troubleshooting.html#troubleshooting__sending-limits"),target:"_blank"}))}}},{key:"_renderErrorMessage",value:function(){switch(this.sendError){case C.SendError.VIRUS:return Y;case C.SendError.SPAM:return this._renderBanReason();case C.SendError.INCORRECT_TO:return G;case C.SendError.INCORRECT_CC:return q;case C.SendError.INCORRECT_BCC:return V;case C.SendError.TOO_BIG:return $;case C.SendError.NO_RECIPIENTS:return Q;case C.SendError.LIMIT_FAIL:return X;case C.SendError.TOO_MANY_EMAILS:return J;case C.SendError.NO_DATA:return Z;case C.SendError.NO_NETWORK:return ee;case C.SendError.TOO_BIG_ATTACHMENTS:return M(m.default,{loc:"compose-react/SendFailed_TooManyAttachments",params:{forwardedCount:S.MAX_MESSAGES_TO_FORWARD,capacity:ns.Model.get("system-status").getAttachmentsMaxSize()}});case C.SendError.ACCESS_DENIED:return te;case C.SendError.ILLEGAL_PARAMS:return ne;case C.SendError.UNDO_CANNOT_SAVE:return re;case C.SendError.UNDO_MESSAGE_SAVED:return oe;case C.SendError.UNDO_PAUSED:return ie;case C.SendError.DELAYED_CANNOT_SAVE:return ae;case C.SendError.DELAYED_MESSAGE_SAVED:return se;case C.SendError.INTERNAL_ERROR:return ce;default:return null}}},{key:"sendError",get:function(){return this.props.validation.sendError&&this.props.validation.sendError.error}},{key:"banReason",get:function(){return this.props.validation.sendError&&this.props.validation.sendError.banReason}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"currentPopup",get:function(){return this.props.visual.currentPopup}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"topLevelDomain",get:function(){return this.props.services.settings.topLevelDomain}},{key:"isRetryable",get:function(){return C.SendError.RETRYABLE_ERRORS.includes(this.sendError)}},{key:"isDelayed",get:function(){return[C.SendError.DELAYED_CANNOT_SAVE,C.SendError.DELAYED_MESSAGE_SAVED].includes(this.sendError)}}]),t}(),c.propTypes={controllers:h.a.isRequired,data:v.a.isRequired,services:g.a.isRequired,validation:O.a.isRequired,visual:_.a.isRequired},D((o=u).prototype,"sendError",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"sendError"),o.prototype),D(o.prototype,"banReason",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"banReason"),o.prototype),D(o.prototype,"composeController",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),D(o.prototype,"currentPopup",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"currentPopup"),o.prototype),D(o.prototype,"metrikaService",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),D(o.prototype,"topLevelDomain",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"topLevelDomain"),o.prototype),D(o.prototype,"isRetryable",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"isRetryable"),o.prototype),D(o.prototype,"isDelayed",[b.computed],Object.getOwnPropertyDescriptor(o.prototype,"isDelayed"),o.prototype),i=D(o.prototype,"retryToSend",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.controllers.saveSend.retryToSendMessageWithoutUndoAndDelayed()}}}),a=D(o.prototype,"showPopup",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){var n=t.error;if(!Object(p.includes)([C.SendError.CAPTCHA,C.SendError.EMPTY_SUBJECT,C.SendError.MAX_EMAIL_ADDRESS_REACHED,C.SendError.TOO_MANY_SUBSCRIBERS],n)){if(Object(p.includes)([C.SendError.INCORRECT_BCC,C.SendError.INCORRECT_CC,C.SendError.INCORRECT_TO],n))if(!e.props.controllers.validation.validateData(!0))return;e.props.visual.currentPopup=L,e.metrikaService.sendPopupsMetrika(E.COMPOSE_METRIKA_POPUPS_SEND_FAILED,E.COMPOSE_METRIKA_POPUPS_SEND_FAILED_SHOW)}}}}),s=D(o.prototype,"closePopup",[b.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.currentPopup="",e.props.visual.isLocked=!1,e.props.validation.sendError=null}}}),r=o))||r)||r},function(e,t,n){"use strict";n.d(t,"a",function(){return D});var r,o,i,a,s,c,u,l=n(135),p=n.n(l),f=n(342),d=n(341),y=n(344),b=n(546),m=n(361),h=n(363),v=n(356),g=n(718),O=n(366),_=n(354),S=(n.n(_),n(367)),E=n(355);n.n(E);function P(e){"@babel/helpers - typeof";return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e,t,n,r){u||(u="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:u,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function R(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function j(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var M=E.Popups.VALIDATION_ERROR,I=A(y.default,{loc:"compose-react/Validation_errors_ConfirmButton_Title"}),D=Object(f.inject)("controllers")(r=Object(f.inject)("data")(r=Object(f.inject)("services")(r=Object(f.inject)("validation")(r=Object(f.inject)("visual")(r=Object(f.observer)((c=s=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(n=function(e,t){return!t||"object"!==P(t)&&"function"!=typeof t?T(e):t}(this,(e=w(t)).call.apply(e,[this].concat(o))))._disposer=new S.a,R(T(n),"showPopup",i,T(n)),R(T(n),"closePopup",a,T(n)),n._focusOnErrorField=function(){var e=T(n),t=e.errors,r=e.composeData;if(t.length){n.validationController.processValidationErrors(t,r);var o=n._getFocusFieldName(t[0]);n.composeController.focusComposeField(o)}},n.onActionClick=function(){n.closePopup(),n.metrikaService.sendPopupsMetrika(_.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS,_.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS_ACTION)},n.onCloseClick=function(){n.closePopup(),n.metrikaService.sendPopupsMetrika(_.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS,_.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS_CLOSE)},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(t,p.a.Component),function(e,t,n){t&&C(e.prototype,t),n&&C(e,n)}(t,[{key:"_getFocusFieldName",value:function(e){return e.additionalFieldNames&&e.additionalFieldNames.length?"".concat(e.fieldName,".").concat(e.additionalFieldNames[0]):e.fieldName}},{key:"componentDidMount",value:function(){var e=this;this._disposer.add(this,[Object(d.reaction)(function(){return e.props.validation.errors},function(){return e.showPopup()})])}},{key:"componentWillUnmount",value:function(){this._disposer.dispose(this)}},{key:"render",value:function(){var e=this.errors.length?this.errors[0]:{},t=e.errorTitleKey||"compose-react/Validation_errors_title",n=e.errorTitleKeyParams||{};return A(b.a,{visible:this.currentPopup===M,Title:A(y.default,{loc:t,params:n}),Description:A("div",{},void 0,this.errors.map(function(e,t){var n=e.errorKey,r=e.errorKeyParams;return A("div",{},"validationError_".concat(t),A(y.default,{loc:n,params:r}))})),ActionText:I,onAction:this.onActionClick,onClose:this.onCloseClick})}},{key:"composeController",get:function(){return this.props.controllers.compose}},{key:"validationController",get:function(){return this.props.controllers.validation}},{key:"currentPopup",get:function(){return this.props.visual.currentPopup}},{key:"errors",get:function(){return this.props.validation.errors}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"composeData",get:function(){return this.props.data}}]),t}(),s.propTypes={controllers:m.a.isRequired,data:h.a.isRequired,services:v.a.isRequired,visual:O.a.isRequired,validation:g.a.isRequired},j((o=c).prototype,"composeController",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeController"),o.prototype),j(o.prototype,"validationController",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"validationController"),o.prototype),j(o.prototype,"currentPopup",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"currentPopup"),o.prototype),j(o.prototype,"errors",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"errors"),o.prototype),j(o.prototype,"metrikaService",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),j(o.prototype,"composeData",[d.computed],Object.getOwnPropertyDescriptor(o.prototype,"composeData"),o.prototype),i=j(o.prototype,"showPopup",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.errors.length&&(e.props.visual.currentPopup=M,e._focusOnErrorField(),setTimeout(Object(d.action)(function(){return e.props.visual.refs.composeContainer.focus()})),e.metrikaService.sendPopupsMetrika(_.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS,_.COMPOSE_METRIKA_POPUPS_VALIDATION_ERRORS_SHOW))}}}),a=j(o.prototype,"closePopup",[d.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.props.visual.currentPopup="",e.props.visual.isLocked=!1,e._focusOnErrorField()}}}),r=o))||r)||r)||r)||r)||r)||r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TooManySubscribers=void 0;var r=n(3030);Object.defineProperty(t,"TooManySubscribers",{enumerable:!0,get:function(){return r.TooManySubscribers}})},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TooManySubscribers=void 0;var s=i(n(135)),c=n(342),u=n(355),l=a(n(353)),p=n(397),f=n(720),d=n(3031),y=n(547),b=a(n(3042)),m=n(354);t.TooManySubscribers=c.observer(function(){var e=p.useStores(),t=e.visual.currentPopup,n=e.validation.sendError,r=e.controllers,o=r.visual,i=r.compose,a=e.services.metrika,c=t===u.Popups.TOO_MANY_SUBSCRIBERS;s.useEffect(function(){!c&&(null===n||void 0===n?void 0:n.error)&&y.ERRORS_TO_SHOW.includes(n.error)&&o.openPopup(u.Popups.TOO_MANY_SUBSCRIBERS)},[n,c,a,o]),s.useEffect(function(){c&&a.sendPopupsMetrika(m.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS,m.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS_SHOW)},[a,c]);var h=s.useCallback(function(){o.closeCurrentPopup(),i.focusComposeField("to"),a.sendPopupsMetrika(m.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS,m.COMPOSE_METRIKA_POPUPS_TOO_MANY_SUBSCRIBERS_BACK_TO_EDIT)},[i,a,o]);return s.default.createElement(f.ConfirmPopup,{visible:c,className:b.default.popup,contentClassName:b.default.content,onClose:h},s.default.createElement(f.PopupTitle,null,l.default("compose-react/TooManySubscribers_Title")),s.default.createElement(d.Content,{onCancel:h}))})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Content=void 0;var r=n(3032);Object.defineProperty(t,"Content",{enumerable:!0,get:function(){return r.Content}})},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Content=void 0;var o=r(n(135)),i=n(397),a=n(355),s=n(547),c=n(3034),u=n(3038),l=n(3041);t.Content=function(e){var t=e.onCancel,n=i.useStores(),r=n.services.limits,p=n.validation.sendError,f=s.useRecipients().all;return(null===p||void 0===p?void 0:p.error)===a.SendError.MAX_EMAIL_ADDRESS_REACHED||f.length>r.maxDestinations?o.default.createElement(c.SimpleContent,{onCancel:t}):(null===p||void 0===p?void 0:p.error)===a.SendError.MAILING_LIST_NOT_ALLOWED||f.length>r.maxDestinationsWithMailingLists?o.default.createElement(u.RemoveAllContent,{onCancel:t}):o.default.createElement(l.RemoveSelectedContent,{onCancel:t})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecipientType=void 0,function(e){e.Regular="rg",e.MailingList="ml"}(t.RecipientType||(t.RecipientType={}))},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleContent=void 0;var u=i(n(135)),l=c(n(339)),p=c(n(1525)),f=n(138),d=c(n(353)),y=n(397),b=n(355),m=n(720),h=n(547),v=c(n(1129));t.SimpleContent=function(e){var t,n=e.onCancel,r=y.useStores(),o=r.services,i=o.limits,a=o.settings,c=a.isMobile,g=a.isTablet,O=r.validation.sendError,_=r.data.addresses,S=h.useRecipients().all,E=u.useMemo(function(){return(null===O||void 0===O?void 0:O.error)===b.SendError.MAX_EMAIL_ADDRESS_REACHED?p.default(s(_.to,_.cc,_.bcc).map(function(e){return e.email})).length:S.length},[_.bcc,_.cc,_.to,S.length,null===O||void 0===O?void 0:O.error]);return u.default.createElement(u.default.Fragment,null,u.default.createElement(m.PopupBody,{className:l.default(v.default.body,(t={},t[v.default.mobile]=c,t[v.default.tablet]=g,t))},u.default.createElement(f.Text,{typography:"body-long-m"},d.default("compose-react/TooManySubscribers_Description_AddressesLimit",{limit:h.getAddressesCountLocalString(i.maxDestinations),count:h.getRecipientsCountLocalString(E)}))),u.default.createElement(m.PopupButtons,null,u.default.createElement(m.PopupConfirmButton,{onClick:n},d.default("compose-react/TooManySubscribers_Button_BackToEdit"))))}},,,,function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveAllContent=void 0;var s=i(n(135)),c=a(n(339)),u=n(138),l=a(n(353)),p=n(720),f=n(397),d=n(547),y=n(1526),b=a(n(1129));t.RemoveAllContent=function(e){var t,n=e.onCancel,r=f.useStores().services,o=r.limits,i=r.settings,a=i.isMobile,m=i.isTablet,h=d.useRecipients().mailingLists,v=d.useRemoveAddressesAndSend(),g=s.useCallback(function(){return v(h.map(function(e){return e.email}))},[h,v]);return s.default.createElement(s.default.Fragment,null,s.default.createElement(p.PopupBody,{className:c.default(b.default.body,(t={},t[b.default.mobile]=a,t[b.default.tablet]=m,t))},s.default.createElement(u.Text,{typography:"body-long-m",className:b.default.text},l.default("compose-react/TooManySubscribers_Description_WithMailLists_EmailLimit",{limit:d.getAddressesCountLocalString(o.maxDestinationsWithMailingLists)})),s.default.createElement(u.Text,{typography:"body-long-m",className:b.default.text},l.default("compose-react/TooManySubscribers_Description_WithMailLists_LimitWithoutMailLists",{limit:d.getAddressesCountLocalString(o.maxDestinations)})),s.default.createElement(y.MailingLists,null)),s.default.createElement(p.PopupButtons,{className:b.default.buttons},s.default.createElement(p.PopupConfirmButton,{onClick:g,className:b.default.button},l.default("compose-react/TooManySubscribers_Button_RemoveAll")),s.default.createElement(p.PopupCancelButton,{onClick:n,className:b.default.button},l.default("compose-react/TooManySubscribers_Button_Cancel"))))}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MailingLists=void 0;var u=i(n(135)),l=c(n(339)),p=c(n(344)),f=n(397),d=n(547),y=n(3040),b=n(1527),m=c(n(1130));t.MailingLists=function(e){var t,n=e.selected,r=e.setSelected,o=f.useStores().services,i=o.limits,a=o.settings,c=a.isMobile,h=a.isTablet,v=d.useRecipients(),g=v.all,O=v.mailingLists,_=(null===n||void 0===n?void 0:n.length)===O.length,S=u.useCallback(function(e){if(r&&n)return n.includes(e)?void r(n.filter(function(t){return t!==e})):r(s(n,[e]))},[n,r]),E=u.useCallback(function(){r&&r(_?[]:O.map(function(e){return e.email}))},[_,O,r]),P=g.length>i.maxDestinationsWithMailingLists;return u.default.createElement("div",{className:l.default(m.default.root,(t={},t[m.default.hideCheckboxes]=P,t[m.default.mobile]=c,t[m.default.tablet]=h,t))},u.default.createElement(b.MailingListRow,{className:m.default.header,checked:_,onCheck:E},u.default.createElement(p.default,{tag:"div",className:m.default.email,loc:"compose-react/TooManySubscribers_MailListsCount",params:{count:O.length}},u.default.createElement("span",{"data-ref":"label",className:m.default.label})),!P&&u.default.createElement("div",{className:m.default.count},"> ",u.default.createElement(p.default,{tag:u.default.Fragment,loc:"compose-react/TooManySubscribers_RecipientsCount_Title",params:{count:i.maxUsers,formatted:d.formatNumber(i.maxUsers)}},u.default.createElement("span",{"data-ref":"label",className:m.default.label})))),u.default.createElement("div",{className:m.default.list},O.map(function(e){return u.default.createElement(y.MailingListItem,{item:e,key:e.email,checked:Boolean(null===n||void 0===n?void 0:n.includes(e.email)),onCheck:S})})))}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MailingListItem=void 0;var s=i(n(135)),c=a(n(339)),u=n(547),l=n(397),p=n(1527),f=a(n(1130));t.MailingListItem=function(e){var t,n=e.item,r=e.checked,o=e.onCheck,i=l.useStores().services.limits,a=s.useCallback(function(){return o(n.email)},[n.email,o]),d=Boolean(n.count&&n.count>=i.maxUsers),y="";return n.count&&(y=n.count?"> "+u.formatNumber(n.count):"< 100"),s.default.createElement(p.MailingListRow,{checked:r,onCheck:a},s.default.createElement("div",{className:f.default.email},n.email),s.default.createElement("div",{className:c.default(f.default.count,(t={},t[f.default.exceeded]=d,t))},y))}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveSelectedContent=void 0;var c=i(n(135)),u=s(n(339)),l=n(138),p=s(n(353)),f=n(720),d=n(397),y=n(547),b=n(1526),m=s(n(1129));t.RemoveSelectedContent=function(e){var t,n=e.onCancel,r=d.useStores(),o=r.services,i=o.limits,s=o.settings,h=s.isMobile,v=s.isTablet,g=r.visual.currentPopup,O=y.useRemoveAddressesAndSend(),_=a(c.useState([]),2),S=_[0],E=_[1];c.useEffect(function(){g&&E([])},[g]);var P=c.useCallback(function(){return O(S)},[O,S]);return c.default.createElement(c.default.Fragment,null,c.default.createElement(f.PopupBody,{className:u.default(m.default.body,(t={},t[m.default.mobile]=h,t[m.default.tablet]=v,t))},c.default.createElement(l.Text,{typography:"body-long-m",className:m.default.text},p.default("compose-react/TooManySubscribers_Description_WithMailLists_SubscribersLimit",{limit:y.formatNumber(i.maxUsers)})),c.default.createElement(b.MailingLists,{selected:S,setSelected:E})),c.default.createElement(f.PopupButtons,{className:m.default.buttons},c.default.createElement(f.PopupConfirmButton,{onClick:P,disabled:!S.length,className:m.default.button},p.default("compose-react/TooManySubscribers_Button_RemoveSelected")),c.default.createElement(f.PopupCancelButton,{onClick:n,className:m.default.button},p.default("compose-react/TooManySubscribers_Button_Cancel"))))}},function(e,t){e.exports={popup:"TooManySubscribers__popup--25tX8",content:"TooManySubscribers__content--3kxRX"}},function(e,t,n){"use strict";t.a=function(e,t){return Jane.Date.format(t,e)}},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var r=n(1467),o=n(347);function i(e){"@babel/helpers - typeof";return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,c,"next",e)}function c(e){a(i,r,o,s,c,"throw",e)}s(void 0)})}}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function t(e){var n,r=e.controllers;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=u(this,l(t).call(this))).controllers=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(t,r["a"]),function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(t,[{key:"onSendSuccess",value:function(){var e=s(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.responseData,r=t.withUndo,ns.events.trigger("daria:reactQuickReply:close"),ns.events.trigger("daria:reactQuickReply:sent"),this.controllers.leaveCompose.showMessageSentNotification({sentMid:n.storedmid,wasSendCancelled:!1,withUndo:r});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"goToFullCompose",value:function(e){return Daria.React.QuickReply.saveDraft().then(function(){return Daria.composeGo(e).then(function(){ns.events.trigger("daria:reactQuickReply:close",{shouldSaveDraft:!1})})})}},{key:"onClose",value:function(){var e=s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:ns.events.trigger("daria:reactQuickReply:close",{shouldSaveDraft:!0});case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"showPddRestrictPopup",value:function(){var e=s(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Object(o.getPddRestrictNotificationsModel)().showPopup();case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"apdexStart",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return window.Apdex.start.apply(window.Apdex,t)}},{key:"apdexSendDelta",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return window.Apdex.sendDelta.apply(window.Apdex,t)}},{key:"apdexSend",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return window.Apdex.send.apply(window.Apdex,t)}}]),t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var r,o,i,a,s,c=n(341);function u(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function p(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){l(i,r,o,a,s,"next",e)}function s(e){l(i,r,o,a,s,"throw",e)}a(void 0)})}}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function y(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var b=n(1464).b.avatars,m=(o=y((r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"subject",o,this),d(this,"avatar",i,this),d(this,"lastSaved",a,this),d(this,"recipients",s,this);var r=t||{},c=r.subject,u=void 0===c?"":c,l=r.avatar,p=void 0===l?{}:l,f=r.lastSaved,y=void 0===f?0:f,b=r.recipients,m=void 0===b?0:b;this.subject=u,this.avatar=p,this.lastSaved=Number(y),this.recipients=Number(m),this.mailboxUid=n}return function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(e,[{key:"update",value:function(){var e=p(regeneratorRuntime.mark(function e(t){var n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.subject?t.subject.substring(0,150):"",e.next=3,this._getAvatar(t);case 3:r=e.sent,o=(t.addresses&&t.addresses.to||[]).length,this._update(n,r,t.lastSaved||0,o);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_getAvatar",value:function(){var e=p(regeneratorRuntime.mark(function e(t){var n,r,o,i,a,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.addresses){e.next=2;break}return e.abrupt("return",null);case 2:if(!this.mailboxUid){e.next=12;break}if(!(n=t.addresses.from)){e.next=10;break}return e.next=7,b.getAvatarForContact(n);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=null;case 11:return e.abrupt("return",e.t0);case 12:if(r=t.addresses,o=r.to,i=r.cc,a=r.bcc,s=[].concat(u(o),u(i),u(a)),!(c=s[0])){e.next=20;break}return e.next=17,b.getAvatarForContact(c);case 17:e.t1=e.sent,e.next=21;break;case 20:e.t1=null;case 21:return e.abrupt("return",e.t1);case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_update",value:function(e,t,n,r){this.subject=e,this.avatar=t,this.lastSaved=Number(n),this.recipients=r}}]),e}()).prototype,"subject",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i=y(r.prototype,"avatar",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a=y(r.prototype,"lastSaved",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s=y(r.prototype,"recipients",[c.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),y(r.prototype,"_update",[c.action],Object.getOwnPropertyDescriptor(r.prototype,"_update"),r.prototype),r)},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",function(){return o});var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.logger=Daria.SendMail.getUndoSendLogger(t.ids)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"logSendMail",value:function(){this.logger.logActionOnceAfterCancel("Клик в Отправить"),this.logger.cancelled=!1,this.logger.resetStartTime()}},{key:"_logAddressFieldChanged",value:function(e){this.logger.logActionOnceAfterCancel("редактирование письма/получатель (".concat(e,":)"))}},{key:"logRecipientsChanged",value:function(e){var t={to:"To",cc:"Cc",bcc:"Bcc"},n=t[e]||t.to;this._logAddressFieldChanged(n)}},{key:"logSubjectChanged",value:function(){this.logger.logActionOnceAfterCancel("редактирование письма/тема")}},{key:"logBodyChanged",value:function(){this.logger.logActionOnceAfterCancel("редактирование письма/текст")}},{key:"logAttachesChanged",value:function(){this.logger.logActionOnceAfterCancel("редактирование письма/аттачи")}},{key:"composeLoaded",get:function(){return this.logger.composeLoaded},set:function(e){this.logger.composeLoaded=e}},{key:"hasUndo",get:function(){return Daria.SendMail.shouldShowUndoSend()}},{key:"undoTime",get:function(){return Daria.SendMail.getUndoSendTime()}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(136),o=n.n(r),i=n(347);function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._current=null,this.notify=o.a.debounce(function(e){ns.events.trigger(e)},300)}return function(e,t,n){t&&a(e.prototype,t),n&&a(e,n)}(e,[{key:"reportExpand",value:function(e){this._current=e,Daria.reactiveComposeExpanded=!0,this.notify("daria:composeReact:expanded"),Object(i.setComposeExpanded)(!0)}},{key:"reportCollapse",value:function(e){this._current===e&&(this._current=null,Daria.reactiveComposeExpanded=!1,this.notify("daria:composeReact:collapsed"),Object(i.setComposeExpanded)(!1))}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var r,o,i,a=n(136),s=(n.n(a),n(341)),c=n(1077),u=n(380);n.n(u);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function y(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var b=20;function m(e){return{params:Object(a.pick)(e.params,["ids","tids","oper","mailboxUid"]),miniData:Object(a.pick)(e.miniData,["avatar","subject","lastSaved","recipients"]),mailboxUid:e.mailboxUid}}function h(e){return!e.hasEmptyParams}function v(e,t){var n=e.params.ids&&e.miniData?e.miniData.lastSaved:1/0;return(t.params.ids&&e.miniData?t.miniData.lastSaved:1/0)-n}function g(e){return e.miniData.lastSaved}var O=(o=y((r=function(){function e(t){var n=this,r=t.services,a=t.controllers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),d(this,"composeMetaStates",o,this),d(this,"onDraftRemoved",i,this),this.services=r,this.controllers=a,this.composeMetaStates=r.settings.storedComposeStates.sort(v).slice(0,b).map(function(e){return new c.a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){p(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{services:r,controllers:a}),n.metaStateOptions)})}return function(e,t,n){t&&f(e.prototype,t),n&&f(e,n)}(e,[{key:"connect",value:function(){var e=this;Object(s.reaction)(function(){var t=e.composeMetaStates.filter(h).sort(v).map(m);return t.length?JSON.stringify(t):""},function(t){e.services.settings.storedComposeStates=t}),Object(s.reaction)(function(){return JSON.stringify(e.composeMetaStates.sort(v).map(g))},function(){e.composeMetaStates=e.composeMetaStates.sort(v)}),ns.events.on("daria:MOPS:action-complete",this.onDraftRemoved)}},{key:"get",value:function(e,t,n){var r=new c.a({params:e,predefinedData:t,services:this.services,controllers:this.controllers},this.metaStateOptions);return t&&!Object(a.isEqual)(t,{})?r:this.composeMetaStates.find(function(e){return r.isEqual(e)&&(!n||e.isEmpty)})||r}},{key:"add",value:function(e){this.composeMetaStates.indexOf(e)>-1||(this.composeMetaStates.unshift(e),this.composeMetaStates.length=Math.min(this.composeMetaStates.length,b))}},{key:"remove",value:function(e){-1!==this.composeMetaStates.indexOf(e)&&(e.disconnect(),this.composeMetaStates.remove(e))}},{key:"metaStateOptions",get:function(){return{size:this.services.settings.lastUsedComposeSize||u.ComposeSizes.LARGE}}}]),e}()).prototype,"composeMetaStates",[s.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y(r.prototype,"add",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"add"),r.prototype),y(r.prototype,"remove",[s.action],Object.getOwnPropertyDescriptor(r.prototype,"remove"),r.prototype),i=y(r.prototype,"onDraftRemoved",[s.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){"delete"===n.action&&e.composeMetaStates.filter(Object(s.action)(function(e){return n.ids.ids.indexOf(e.params.ids)>-1})).forEach(Object(s.action)(function(t){return e.remove(t)}))}}}),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return U});var r,o,i,a,s,c,u,l,p,f=n(135),d=n.n(f),y=n(338),b=n.n(y),m=n(136),h=(n.n(m),n(342)),v=n(341),g=n(344),O=n(150),_=(n.n(O),n(3050)),S=n(380),E=(n.n(S),n(1077)),P=n(3052),C=n(354),w=(n.n(C),n(1530)),T=n(407),k=n(16),A=n(400);n.n(A);function R(e){"@babel/helpers - typeof";return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t,n,r){p||(p="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var o=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),1===i)t.children=r;else if(i>1){for(var a=new Array(i),s=0;s<i;s++)a[s]=arguments[s+3];t.children=a}if(t&&o)for(var c in o)void 0===t[c]&&(t[c]=o[c]);else t||(t=o||{});return{$$typeof:p,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function x(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function B(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var F=function(e){return function(t){t.stopPropagation(),e&&e()}},z=N(g.default,{loc:"compose-react/Без_темы"}),U=Object(h.inject)("controllers","services","state")(r=Object(h.observer)((l=u=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return(n=function(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?D(e):t}(this,(e=I(t)).call.apply(e,[this].concat(o))))._containerNode=d.a.createRef(),n._boundary=d.a.createRef(),x(D(n),"controlButtonsTooltipIsShowing",i,D(n)),x(D(n),"isHovered",a,D(n)),n.onMaximiseLarge=function(){n.expandCompose(S.ComposeSizes.LARGE),n.metrikaService.sendHeaderMetrika(C.COMPOSE_METRIKA_HEADER_EXPAND)},n.onMaximiseSmall=function(){n.expandCompose(S.ComposeSizes.SMALL),n.metrikaService.sendHeaderMetrika(C.COMPOSE_METRIKA_HEADER_EXPAND)},n.onHeaderClick=function(){n.setIsHovered(!1),n.expandCompose(n.defaultSize),n.metrikaService.sendHeaderMetrika(C.COMPOSE_METRIKA_HEADER_THUMB_CLICK)},n.onHide=function(){(0,n.props.collapseCompose)(),n.metrikaService.sendHeaderMetrika(C.COMPOSE_METRIKA_HEADER_COLLAPSE)},n.onClose=function(){(0,n.props.closeCompose)(),n.metrikaService.sendHeaderMetrika(C.COMPOSE_METRIKA_HEADER_CLOSE)},n.onChangeSize=function(){var e=n.props.metaState,t=e.size===S.ComposeSizes.SMALL?S.ComposeSizes.LARGE:S.ComposeSizes.SMALL;e.changeSize(t,!0)},x(D(n),"setIsHovered",s,D(n)),x(D(n),"onControlButtonsTooltipVisibilityChanged",c,D(n)),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,d.a.Component),function(e,t,n){t&&M(e.prototype,t),n&&M(e,n)}(t,[{key:"expandCompose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.ComposeSizes.LARGE,t=this.props,n=t.expandCompose;t.metaState.changeSize(e,!0),Object(w.a)(T.f,{usedSmall:e===S.ComposeSizes.SMALL}),n()}},{key:"render",value:function(){return this.props.mode===S.ComposeMode.COLLAPSED?this._renderCollapsedState():this._renderExpandedState()}},{key:"_renderCollapsedState",value:function(){var e=this.props,t=e.className,n=e.metaState,r=n.miniData,o=this.isTooltipShowing,i=this.onControlButtonsTooltipVisibilityChanged,a=this.setIsHovered,s=r.subject?N("span",{},void 0,r.subject):z,c=r.recipients>1&&!n.mailboxUid?N("span",{},void 0,"+",r.recipients-1):null,u=this.collapsedStateButtons;return d.a.createElement(d.a.Fragment,null,N(P.a,{innerRef:this._containerNode,mode:S.ComposeMode.COLLAPSED,className:t,onClick:this.onHeaderClick,onMouseEnter:function(){return a(!0)},onMouseLeave:function(){return a(!1)},AvatarComponent:d.a.createElement(_.a,this.avatar),TitleComponent:s,RecipientsComponent:c,ButtonsComponent:N(P.b,{defaultExpandSize:this.defaultSize,onTooltipVisibilityChange:i,buttons:u,boundary:this._boundary})}),N(O.Tooltip,{visible:o,direction:"top",anchor:this._containerNode,view:"default",size:"s",state:"warning",boundary:this._boundary},void 0,s))}},{key:"_renderExpandedState",value:function(){var e=this.props,t=e.metaState,n=e.className,r=t.miniData,o=t.isDraft,i=t.isTemplate,a=t.isNewTemplate,s=t.size,c=o||i&&!a?"compose-react/Без_темы":"compose-react/PopupTitle_New",u=r.subject,l=u?N("span",{},void 0,u):N(g.default,{loc:c}),p=r&&r.lastSaved,f=p?N(P.c,{timestamp:p}):null;return N(P.a,{mode:S.ComposeMode.EXPANDED,className:n,onClick:this.onHide,ButtonsComponent:N(P.b,{tooltipPosition:"bottom",currentSize:s,buttons:this.expandedStateButtons[s],boundary:this._boundary}),TitleComponent:l,SavedAtComponent:f})}},{key:"componentDidMount",value:function(){this._boundary.current=!Object(k.hasFeature)(A.Features.REACT_LAYOUT)&&document.querySelector(".js-mail-App")?document.querySelector(".js-mail-App"):document.documentElement}},{key:"componentWillUnmount",value:function(){this.setIsHovered(!1)}},{key:"data",get:function(){return this.props.metaState.miniData}},{key:"avatar",get:function(){return this.data&&this.data.avatar}},{key:"metrikaService",get:function(){return this.props.services.metrika}},{key:"settingsController",get:function(){return this.props.controllers.settings}},{key:"isTooltipShowing",get:function(){var e=this.isHovered;return!this.controlButtonsTooltipIsShowing&&e}},{key:"defaultSize",get:function(){return this.settingsController.lastUsedComposeSize||S.ComposeSizes.LARGE}},{key:"expandedStateButtons",get:function(){var e,t={buttonName:S.HeaderButtons.MINIMIZE,handler:F(this.onHide),tooltipLocKey:"compose-react/PopupActions_MinimizeWindow"},n={buttonName:S.HeaderButtons.MAXIMIZE,handler:F(this.onChangeSize),tooltipLocKey:"compose-react/PopupActions_EnlargeWindowSize"},r={buttonName:S.HeaderButtons.MAXIMIZE_SMALL,handler:F(this.onChangeSize),tooltipLocKey:"compose-react/PopupActions_ReduceWindowSize"},o={buttonName:S.HeaderButtons.CLOSE,handler:F(this.onClose),tooltipLocKey:"compose-react/PopupActions_CloseWindow"};return j(e={},S.ComposeSizes.SMALL,[t,n,o]),j(e,S.ComposeSizes.LARGE,[t,r,o]),e}},{key:"collapsedStateButtons",get:function(){return[{buttonName:S.HeaderButtons.MAXIMIZE_SMALL,handler:F(this.onMaximiseSmall),tooltipLocKey:"compose-react/PopupActions_ExpandSmallWindow"},{buttonName:S.HeaderButtons.MAXIMIZE,handler:F(this.onMaximiseLarge),tooltipLocKey:"compose-react/PopupActions_ExpandLargeWindow"},{buttonName:S.HeaderButtons.CLOSE,handler:F(this.onClose),tooltipLocKey:"compose-react/PopupActions_CloseWindow"}]}}]),t}(),u.propTypes={controllers:b.a.object.isRequired,mode:b.a.oneOf(Object(m.values)(S.ComposeMode)),services:b.a.object.isRequired,metaState:b.a.instanceOf(E.a).isRequired,expandCompose:b.a.func.isRequired,collapseCompose:b.a.func.isRequired,closeCompose:b.a.func.isRequired,className:b.a.string},i=B((o=l).prototype,"controlButtonsTooltipIsShowing",[v.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),a=B(o.prototype,"isHovered",[v.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),B(o.prototype,"data",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"data"),o.prototype),B(o.prototype,"avatar",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"avatar"),o.prototype),B(o.prototype,"metrikaService",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"metrikaService"),o.prototype),B(o.prototype,"settingsController",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"settingsController"),o.prototype),B(o.prototype,"isTooltipShowing",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"isTooltipShowing"),o.prototype),s=B(o.prototype,"setIsHovered",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.isHovered=t}}}),c=B(o.prototype,"onControlButtonsTooltipVisibilityChanged",[v.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.controlButtonsTooltipIsShowing=t}}}),B(o.prototype,"expandedStateButtons",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"expandedStateButtons"),o.prototype),B(o.prototype,"collapsedStateButtons",[v.computed],Object.getOwnPropertyDescriptor(o.prototype,"collapsedStateButtons"),o.prototype),r=o))||r)||r},function(e,t,n){"use strict";var r,o=n(135),i=n.n(o),a=n(338),s=(n.n(a),n(339)),c=n.n(s),u=n(795),l=n.n(u),p=n(3051);n.n(p);var f="ComposeMetaAvatar",d={Block:f,Block_monogram:"".concat(f,"_monogram")},y=function(e){var t=e.url;return function(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}("div",{className:c()(d.Block,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},d.Block_monogram,!t))},void 0,i.a.createElement(l.a,e))};t.a=y,y.propTypes={url:a.PropTypes.string}},function(e,t){},function(e,t,n){"use strict";var r=n(1529),o=(n.n(r),n(3055));n.d(t,"a",function(){return o.a});var i=n(3057);n.n(i);n.o(i,"ControlButtons")&&n.d(t,"b",function(){return i.ControlButtons});var a=n(1528);n.d(t,"c",function(){return a.a})},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ComposePopup=void 0;var c=i(n(135)),u=s(n(339)),l=n(143),p=n(380);n(3054);var f={Block:"ComposePopup",Wrapper:"ComposePopup-Wrapper",WindowWrapper:"ComposePopup-WindowWrapper",Content:"ComposePopup-Content",Body:"ComposePopup-Body",BodyContent:"ComposePopup-BodyContent"};t.ComposePopup=function(e){var t=e.cls,n=e.Body,r=e.right,o=e.size,i=e.width,s=e.onClose,d=e.enableFocusTrap,y=e.visible,b=a(c.useState(!0),2),m=b[0],h=b[1],v=c.useRef(null),g=c.useCallback(function(e,t){"click"===t&&o!==p.ComposeSizes.SMALL?s(e):"esc"===t&&s(e)},[s,o]),O=c.useMemo(function(){var e={};return o===p.ComposeSizes.SMALL?e.marginRight=r-13+"px":(e.width=i+"px",e.right=r+"px"),e},[i,r,o]),_=c.useCallback(function(e){var t;(null===(t=v.current)||void 0===t?void 0:t.contains(e.target))?h(!0):h(!1)},[]);c.useEffect(function(){return document.addEventListener("mousedown",_,{capture:!0}),function(){return document.removeEventListener("mousedown",_,{capture:!0})}},[_]),c.useEffect(function(){var e,t;y?null===(e=null===window||void 0===window?void 0:window.Apdex)||void 0===e||e.send(["Performance_openCompose"]):null===(t=null===window||void 0===window?void 0:window.Apdex)||void 0===t||t.send(["Performance_sendMessage"])},[y]);var S=o===p.ComposeSizes.SMALL?m&&d:d;return c.default.createElement(l.Popup,{innerRef:v,className:u.default(f.Block,t,f.Block+"_size_"+o),view:"default",style:O,direction:"top",scope:"inplace",onClose:g,visible:y,enableFocusTrap:S,role:"dialog"},c.default.createElement("div",{className:f.Content},c.default.createElement("div",{className:f.Body},c.default.createElement("div",{className:f.BodyContent},n()))))}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return S});var r,o=n(135),i=n.n(o),a=n(338),s=n.n(a),c=n(339),u=n.n(c),l=n(136),p=n.n(l),f=n(380),d=(n.n(f),n(3056));n.n(d);function y(e){"@babel/helpers - typeof";return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var O="composeHeader",_={Block:O,Block_collapsed:"".concat(O,"_collapsed"),Block_expanded:"".concat(O,"_expanded"),Block_activable:"".concat(O,"_activable"),Avatar:"".concat(O,"-Avatar"),Text:"".concat(O,"-Text"),Title:"".concat(O,"-Title"),SavedAt:"".concat(O,"-SavedAt"),Buttons:"".concat(O,"-Buttons"),Recipients:"".concat(O,"-Recipients")},S=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,h(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,i.a.PureComponent),function(e,t,n){t&&b(e.prototype,t),n&&b(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.innerRef,n=e.mode,r=e.className,o=e.onClick,a=e.onMouseEnter,s=e.onMouseLeave,c=this.props,l=c.AvatarComponent,p=c.TitleComponent,f=c.SavedAtComponent,d=c.ButtonsComponent,y=c.RecipientsComponent,b=u()(_.Block,r,"".concat(O,"_").concat(n),function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},_.Block_activable,"function"==typeof o));return i.a.createElement("div",{ref:t,className:b,onClick:o,onMouseEnter:a,onMouseLeave:s},l&&g("div",{className:_.Avatar},void 0,l),y&&g("div",{className:_.Recipients},void 0,y),g("div",{className:_.Text},void 0,p&&g("span",{className:_.Title},void 0,p),f&&this.renderSavedAt()),d&&g("div",{className:_.Buttons},void 0,d))}},{key:"renderSavedAt",value:function(){var e=this.props.SavedAtComponent;return g("span",{className:_.SavedAt},void 0,e)}}]),t}();S.propTypes={innerRef:s.a.shape({current:s.a.instanceOf(Element)}),mode:s.a.oneOf(p.a.values(f.ComposeMode)).isRequired,className:s.a.string,onClick:s.a.func,onMouseEnter:s.a.func,onMouseLeave:s.a.func,AvatarComponent:s.a.element,TitleComponent:s.a.element,ButtonsComponent:s.a.element,SavedAtComponent:s.a.element,RecipientsComponent:s.a.element},S.defaultProps={mode:f.ComposeMode.EXPANDED}},function(e,t){},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ControlButtons=void 0;var u=a(n(135)),l=c(n(339)),p=n(380),f=n(3058),d=c(n(3060));t.ControlButtons=function(e){var t=e.defaultExpandSize,n=e.tooltipPosition,o=void 0===n?"top":n,i=e.buttons,a=e.className,c=e.onTooltipVisibilityChange,y=e.boundary,b=u.useRef({}),m=t===p.ComposeSizes.SMALL?p.HeaderButtons.MAXIMIZE_SMALL:p.HeaderButtons.MAXIMIZE,h=u.useCallback(function(e,t){b.current[e]=t;var n=Object.values(b.current).filter(function(e){return e}).length;t&&1===n?null===c||void 0===c||c(!0):t||0!==n||null===c||void 0===c||c(!1)},[c]);return u.default.createElement("div",{className:l.default(a,d.default.root,"ControlButtons")},i.map(function(e){var t=e.buttonName,n=s(e,["buttonName"]);return u.default.createElement(f.ControlButton,r({key:"button-"+t,buttonName:t},n,{isDefault:t===m,tooltipPosition:o,onTooltipVisibilityChanged:h,boundary:y}))}))}},function(e,t,n){"use strict";var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ControlButton=void 0;var c=a(n(135)),u=s(n(339)),l=n(1520),p=n(142),f=s(n(353)),d=n(380),y=s(n(464)),b=s(n(1521)),m=s(n(1522)),h=s(n(1523)),v=s(n(3059)),g=((r={})[d.HeaderButtons.CLOSE]=y.default,r[d.HeaderButtons.MINIMIZE]=b.default,r[d.HeaderButtons.MAXIMIZE_SMALL]=h.default,r[d.HeaderButtons.MAXIMIZE]=m.default,r);t.ControlButton=function(e){var t,n=e.handler,r=e.buttonName,o=e.isDefault,i=e.tooltipLocKey,a=e.tooltipPosition,s=e.onTooltipVisibilityChanged,d=e.boundary,y=c.useCallback(function(){null===s||void 0===s||s(r,!0)},[r,s]),b=c.useCallback(function(){null===s||void 0===s||s(r,!1)},[r,s]);if(!n)return null;var m=u.default(v.default.root,"qa-ControlButton","qa-ControlButton_button_"+r,((t={})[v.default.default]=o,t));return c.default.createElement(p.TooltipStateful,{view:"default",size:"s",state:"warning",direction:[a+"-end",a,a+"-start"],content:f.default(i),boundary:d},c.default.createElement(l.ButtonWithIcon,{className:m,key:"button-"+r,onMouseEnter:y,onMouseLeave:b,onClick:n,view:"clear",size:"s",svg:g[r],"aria-label":f.default(i),iconClass:v.default.icon}))}},function(e,t){e.exports={root:"ControlButtons__root--3tqjs"}},function(e,t){e.exports={root:"ControlButtons__root--3Bvny"}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r,o,i,a=n(341);function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function l(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var p=(o=l((r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"isAbookPopupOpened",o,this),u(this,"onClosePopup",i,this),this.abookPopupService=t}return function(e,t,n){t&&c(e.prototype,t),n&&c(e,n)}(e,[{key:"showAbookPopup",value:function(e){var t=e.onAction,n=e.onCancel,r=s(e,["onAction","onCancel"]);return this.isAbookPopupOpened=!0,this.abookPopupService.showAbookPopup(r).then(t,n).then(this.onClosePopup)}}]),e}()).prototype,"isAbookPopupOpened",[a.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),i=l(r.prototype,"onClosePopup",[a.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.isAbookPopupOpened=!1}}}),l(r.prototype,"showAbookPopup",[a.action],Object.getOwnPropertyDescriptor(r.prototype,"showAbookPopup"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r,o,i,a=n(341);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function u(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var l=(o=u((r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"_settings",o,this),c(this,"_update",i,this),this._service=t,this._update()}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,[{key:"subscribe",value:function(){this._service.data.on("ns-model-changed",this._update)}},{key:"unsubscribe",value:function(){this._service.data.off("ns-model-changed",this._update)}},{key:"registerChangeSettingsHandler",value:function(e,t){return this._service.registerChangeSettingsHandler(e,t)}},{key:"unregisterChangeSettingsHandler",value:function(e,t){this._service.unregisterChangeSettingsHandler(e,t)}},{key:"timelineEnabled",get:function(){return Boolean(this._settings.timelineEnabled)}},{key:"timelineExpanded",get:function(){return Boolean(this._settings.timelineExpanded)}},{key:"todoEnabled",get:function(){return Boolean(this._settings.todoEnabled)}},{key:"lastUsedComposeSize",get:function(){return this._settings.lastUsedComposeSize},set:function(e){this._service.lastUsedComposeSize=e}}]),e}()).prototype,"_settings",[a.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{timelineEnabled:!1,timelineExpanded:!1,todoEnabled:!1,lastUsedComposeSize:!1}}}),i=u(r.prototype,"_update",[a.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){Object.keys(e._settings).forEach(Object(a.action)(function(t){e._settings[t]=e._service[t]}))}}}),u(r.prototype,"timelineEnabled",[a.computed],Object.getOwnPropertyDescriptor(r.prototype,"timelineEnabled"),r.prototype),u(r.prototype,"timelineExpanded",[a.computed],Object.getOwnPropertyDescriptor(r.prototype,"timelineExpanded"),r.prototype),u(r.prototype,"todoEnabled",[a.computed],Object.getOwnPropertyDescriptor(r.prototype,"todoEnabled"),r.prototype),u(r.prototype,"lastUsedComposeSize",[a.computed],Object.getOwnPropertyDescriptor(r.prototype,"lastUsedComposeSize"),r.prototype),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var r,o,i,a,s,c,u,l,p,f=n(341),d=n(136),y=(n.n(d),n(349)),b=(n.n(y),n(394)),m=n.n(b);function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}function g(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function O(e,t,n,r,o){var i={};return Object.keys(r).forEach(function(e){i[e]=r[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}var _=50,S=Daria.is3pane()?20:14,E=20+S,P=(o=O((r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.disposer=new m.a,g(this,"windowWidth",o,this),g(this,"windowHeight",i,this),g(this,"_layoutWidth",a,this),g(this,"_layoutLeftPad",s,this),g(this,"_layoutRightPad",c,this),g(this,"_layoutRight",u,this),g(this,"_layoutLeftWidth",l,this),g(this,"recalcDimensions",p,this),this._settings=t,this._onResize=Object(d.throttle)(this.recalcDimensions,_),this.recalcDimensions()}return v(e,[{key:"layoutWidth",get:function(){return this._layoutWidth||Math.min(this.windowWidth-E,this._settings.sizeLayout)}},{key:"layoutLeftPad",get:function(){return this._layoutLeftPad||20}},{key:"layoutRightPad",get:function(){return this._layoutRightPad||S}},{key:"layoutRight",get:function(){return this._layoutRight||this.layoutLeftPad+this.layoutWidth}},{key:"layoutLeftWidth",get:function(){return this._layoutLeftWidth||this._settings.sizeLayoutLeft||Daria.Constants.LEFT_COLUMN.LAYOUT_DEFAULT_WIDTH}},{key:"rightSpace",get:function(){return Math.ceil(this.windowWidth-this.layoutLeftPad-this.layoutLeftWidth)}},{key:"rightContentWidth",get:function(){return this.layoutRight-this.layoutLeftPad-this.layoutLeftWidth}},{key:"hasRightColumnAds",get:function(){return Daria.Config.mayHaveAdv&&Object(y.hasFeature)(y.Features.WEB_RIGHT_COLUMN_ADS)&&Object(y.hasFeature)(y.Features.REACT_LAYOUT)&&Object(y.hasFeature)(y.Features.WEB_RIGHT_COLUMN_ADS_COMPOSE)}},{key:"rightPad",get:function(){return this.layoutRight&&this.windowWidth-this.layoutRight-4}},{key:"rightColumnAds",get:function(){return this.windowWidth<1280?187:228}},{key:"composeMinWidth",get:function(){return this.hasRightColumnAds?746:912}},{key:"composeWidth",get:function(){var e=Math.max(this.rightContentWidth+8,this.composeMinWidth),t=this.hasRightColumnAds?this.windowWidth<1028?this.composeMinWidth:this.windowWidth-this.composeRight-this.layoutLeftWidth-this.layoutLeftPad:this.windowWidth-this.composeRight;return Math.min(e,t)}},{key:"composeRight",get:function(){var e=this.layoutRight+this._layoutLeftPad-this.windowWidth;return Math.max(this.hasRightColumnAds?this.windowWidth<1028?this.rightColumnAds-e:this.rightColumnAds:this.rightPad,0)}}]),v(e,[{key:"subscribe",value:function(){var e=this;this.disposer.addEventListener(this,{element:window,eventName:"resize",listener:this._onResize}),ns.events.on("react:dimensions:changeLayout",this._onResize),ns.events.on("react:dimensions:changeLayoutLeft",this._onResize),this.disposer.add(this,[function(){return ns.events.off("react:dimensions:changeLayout",e._onResize)},function(){return ns.events.off("react:dimensions:changeLayoutLeft",e._onResize)},this._settings.registerChangeSettingsHandler(this._onResize,"liza_minified_header")])}},{key:"unsubscribe",value:function(){this.disposer.dispose(this)}}]),e}()).prototype,"windowWidth",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),i=O(r.prototype,"windowHeight",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a=O(r.prototype,"_layoutWidth",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s=O(r.prototype,"_layoutLeftPad",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c=O(r.prototype,"_layoutRightPad",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u=O(r.prototype,"_layoutRight",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),l=O(r.prototype,"_layoutLeftWidth",[f.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),O(r.prototype,"layoutWidth",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"layoutWidth"),r.prototype),O(r.prototype,"layoutLeftPad",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"layoutLeftPad"),r.prototype),O(r.prototype,"layoutRightPad",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"layoutRightPad"),r.prototype),O(r.prototype,"layoutRight",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"layoutRight"),r.prototype),O(r.prototype,"layoutLeftWidth",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"layoutLeftWidth"),r.prototype),O(r.prototype,"rightSpace",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"rightSpace"),r.prototype),O(r.prototype,"rightContentWidth",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"rightContentWidth"),r.prototype),O(r.prototype,"hasRightColumnAds",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"hasRightColumnAds"),r.prototype),O(r.prototype,"rightPad",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"rightPad"),r.prototype),O(r.prototype,"rightColumnAds",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"rightColumnAds"),r.prototype),O(r.prototype,"composeMinWidth",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"composeMinWidth"),r.prototype),O(r.prototype,"composeWidth",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"composeWidth"),r.prototype),O(r.prototype,"composeRight",[f.computed],Object.getOwnPropertyDescriptor(r.prototype,"composeRight"),r.prototype),p=O(r.prototype,"recalcDimensions",[f.action],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){if(e.windowWidth=document.documentElement.clientWidth,e.windowHeight=document.documentElement.clientHeight,Object(y.hasFeature)(y.Features.REACT_LAYOUT)){var t=$(".js-mail-layout"),n=t&&t[0],r=n&&n.getBoundingClientRect(),o=parseInt(t&&t.css("padding-left"),10);e._layoutWidth=(r&&r.width)-o,e._layoutLeftPad=r&&r.left,e._layoutRightPad=r&&e.windowWidth-r.right,e._layoutRight=(r&&r.right)-o;var i=$(".js-mail-layout-left"),a=i&&i[0];e._layoutLeftWidth=a&&a.clientWidth}else{var s=$(".mail-Layout"),c=s&&s[0],u=c&&c.getBoundingClientRect();e._layoutWidth=u&&u.width,e._layoutLeftPad=u&&u.left,e._layoutRightPad=u&&e.windowWidth-u.right,e._layoutRight=u&&u.right;var l=$(".js-layout-left"),p=l&&l[0];e._layoutLeftWidth=p&&p.clientWidth}}}}),r)},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var r=n(1078),o=n(1469),i=n(1461),a=n(3066),s=n(585),c=n(71),u=n(380);n.n(u);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){f(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function y(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){d(i,r,o,a,s,"next",e)}function s(e){d(i,r,o,a,s,"throw",e)}a(void 0)})}}var b=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._composeState=null,this._destroyer=null,this._node=null,this.render=function(){var e=y(regeneratorRuntime.mark(function e(n,a){var l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.mailboxUid=n.mailboxUid||Object(c.a)(),t._node=n.quickReplyNode,t._composeState=new i.a(new r.c({controllers:{leaveCompose:new s.a,messageSent:{onMessageSent:n.onMessageSent}}}),u.ComposeSizes.LARGE),l=new o.a(t._composeState,{onDataLoaded:t._onDataLoaded}),e.next=6,l.loadWithParams({initParams:{params:p({},n,{isQuickReply:!0}),predefinedData:a}});case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),this._onDataLoaded=function(){t._destroyer=Object(a.a)({composeState:t._composeState,node:t._node})},this.saveDraft=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t._composeState&&t._composeState.controllers&&t._composeState.controllers.saveSend)){e.next=3;break}return e.next=3,t._composeState.controllers.saveSend.saveMessage();case 3:case"end":return e.stop()}},e)})),this.saveDraftAndUnmount=function(){t.saveDraft(),t.unmount()},this.unmount=function(){t._destroyer&&t._destroyer(),t._composeState&&t._composeState.disconnect(),t._composeState=null,t._node=null}}},function(e,t,n){"use strict";var r,o=n(135),i=n.n(o),a=n(139),s=n.n(a),c=n(342),u=n(375),l=n(1470),p=n(379),f=n(373),d=(n.n(f),n(349));n.n(d);function y(e,t,n,o){r||(r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,a=arguments.length-3;if(t||0===a||(t={children:void 0}),1===a)t.children=o;else if(a>1){for(var s=new Array(a),c=0;c<a;c++)s[c]=arguments[c+3];t.children=s}if(t&&i)for(var u in i)void 0===t[u]&&(t[u]=i[u]);else t||(t=i||{});return{$$typeof:r,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var b=y(l.c,{}),m=y(l.b,{});t.a=function(e){var t=e.composeState,n=e.onRender,r=e.node,o=Daria.Config.locale;return Object(d.hasFeature)(d.Features.WEB_DARK_MESSAGE_VIEWER)||Object(p.configureRootTheme)({theme:f.PS_LIGHT,root:r}),s.a.render(y(u.default,{lang:o},void 0,i.a.createElement(c.Provider,t.providedState,b,m)),r,n),function(){s.a.unmountComponentAtNode(r)}}}]));