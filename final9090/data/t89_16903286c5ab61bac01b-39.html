/*! For license information please see 16903286c5ab61bac01b-39.js.LICENSE */
webpackJsonp([39],{1174:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return a(t,e),t},r=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DateTimePicker=t.DateTimeFieldGroup=void 0;var l=o(n(135)),d=n(1596),c=n(350),h=u(n(344)),g=n(179),f=n(138),m=n(180),p=n(140),_=u(n(1176)),b={day:"2-digit",month:"2-digit",year:"numeric"},v={hour:"2-digit",minute:"2-digit"};t.DateTimeFieldGroup=function(e){var t=e.label,n=r(e,["label"]);return l.default.createElement(f.Text,{className:_.default.field,typography:"body-short-m",color:"secondary",as:"label"},l.default.createElement(h.default,{className:_.default.label,loc:t}),l.default.createElement(m.DateTimeField,i({view:"default",size:"s"},n)))};t.DateTimePicker=function(e){var n=e.value,i=e.onChange,s=e.onAction,a=e.onCancel,o=e.minDate,r=e.maxDate,u=l.useCallback(function(e){if(e.value)return n?void i(function(e,t){var n=new Date(e);return n.setDate(t.getDate()),n.setMonth(t.getMonth()),n.setFullYear(t.getFullYear()),n}(n,e.value)):i(e.value)},[i,n]),f=l.useCallback(function(e){if(e.value)return n?void i(function(e,t){var n=new Date(e);return n.setTime(t.getTime()),n}(n,e.value)):i(e.value)},[i,n]);return l.default.createElement("div",{className:_.default.root},l.default.createElement(d.LocaleProvider,{locale:c.getLocale()},l.default.createElement(g.Calendar,{view:"default",size:"s",value:n,onChange:u,min:o,max:r,autoFocus:!0}),l.default.createElement("div",{className:_.default.row},l.default.createElement(t.DateTimeFieldGroup,{value:n,onChange:u,formatOptions:b,min:o,max:r,label:"compose-react/DatetimePicker_Date"}),l.default.createElement(t.DateTimeFieldGroup,{value:n,onChange:f,formatOptions:v,label:"compose-react/DatetimePicker_Time"})),l.default.createElement("div",{className:_.default.row},l.default.createElement(p.Button,{className:_.default.button,view:"action",size:"s",onClick:s},l.default.createElement(h.default,{loc:"compose-react/DatetimePicker_Confirm"})),l.default.createElement(p.Button,{className:_.default.button,view:"default",size:"s",onClick:a},l.default.createElement(h.default,{loc:"compose-react/DatetimePicker_Cancel"})))))}},1176:function(e,t){e.exports={root:"DateTimePicker__root--YzyxJ",row:"DateTimePicker__row--2VZkE",field:"DateTimePicker__field--2KQU1",label:"DateTimePicker__label--3h43O",button:"DateTimePicker__button--2mJLo"}},1177:function(e,t){e.exports={meta:{requiredCategoryFields:["title","description","yes","no"],buttons:{hide:{},own_variant:{title:"Classifier_btn_own-variant"}}},default:{frequency:.1,theme:"default",types:[{id:103,category:"people"},{id:100,category:"news"},{id:102,category:"notifications"},{id:101,category:"social"},{id:4,category:"people"},{id:13,category:"news"},{id:64,category:"notifications"},{id:65,category:"notifications"},{id:15,category:"social"},{id:18,category:"social"}],fallback:"news",categories:{people:{title:"Classifier_title_person",description:"Classifier_subtitle_person",yes:"Classifier_btn_yes_person",no:"Classifier_btn_no"},social:{title:"Classifier_title_social",description:"Classifier_subtitle_social",yes:"Classifier_btn_yes_social",no:"Classifier_btn_no"},news:{title:"Classifier_title_subs",description:"Classifier_subtitle_subs",yes:"Classifier_btn_yes_subs",no:"Classifier_btn_no"},notifications:{title:"Classifier_title_notification",description:"Classifier_subtitle_notification",yes:"Classifier_btn_yes_notification",no:"Classifier_btn_no"}}}}},1593:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return a(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReactMessageViewer=void 0;var u=o(n(135)),l=n(347),d=n(543),c=n(145),h=r(n(4954)),g=function(){return u.default.createElement("div",{className:h.default.placeholder},u.default.createElement(c.Spin,{view:"default",size:"s",progress:!0}))};t.ReactMessageViewer=function(e){var t=l.getMessageViewerLoader(),n=u.useCallback(function(){return t().then(function(t){var n=t.MessageViewer;return u.default.createElement(n,i({},e.params))})},[t,e]);return u.default.createElement(d.ModuleLoader,{component:n,placeholder:g})}},1595:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DateTimePicker=void 0;var i=n(1174);Object.defineProperty(t,"DateTimePicker",{enumerable:!0,get:function(){return i.DateTimePicker}})},1598:function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,s,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){s={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(s)throw s.error}}return o};Object.defineProperty(t,"__esModule",{value:!0}),t.useElement=void 0;var s=n(135);t.useElement=function(e){var t=i(s.useState(null),2),n=t[0],a=t[1];return{setElement:s.useCallback(function(t){a(t),null===e||void 0===e||e(t)},[e]),elementRef:s.useMemo(function(){return{current:n}},[n]),element:n}}},1599:function(e,t,n){"use strict";t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown_error",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Jane.ErrorLog.send(Object.assign({},t,{errorType:"email_classification.".concat(e),eexp:Daria.Config["eexp-boxes"]}))}},212:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4878);n.n(i);Jane.module("message.js",function(){n(4879),n(4880),n(4887),n(4891),n(4919),n(4943),n(5027)})},487:function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"a",function(){return s}),n.d(t,"d",function(){return a}),n.d(t,"b",function(){return o});var i="close-and-open-another-message",s="close-and-go-to-another-messages-list",a="close-expanded",o="close-and-go-to-another-page"},4878:function(e,t){},4879:function(e,t){function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,s=!1,a=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(s)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}Daria.MessageWidget={},Daria.MessageWidget._widgets=[["message-widget-spam","_checkShowSpam"],["message-widget-translate","_checkShowTranslate"],["message-widget-noreply","_checkShowNoreply"],["message-widget-imap-deleted","_checkShowImapDeleted"],["message-widget-download-full","_checkShowDownloadFull"],["message-widget-confirm-classification","_checkShowClassificationConfirmationRequest"]],Daria.MessageWidget.creatingListOfWidgets=function(e){var t=_.clone(e.params),i=ns.Model.get("message-widget-state",t),s=!0,a=!1,o=void 0;try{for(var r,u=Daria.MessageWidget._widgets[Symbol.iterator]();!(s=(r=u.next()).done);s=!0){var l=n(r.value,2),d=l[0],c=l[1];i.isViewUserClose(d)||(i.isShow(d)||Daria.MessageWidget[c](t))&&(i.show(d,{silent:!0}),e.insertWidget(d))}}catch(e){a=!0,o=e}finally{try{s||null==u.return||u.return()}finally{if(a)throw o}}},Daria.MessageWidget._checkShowDownloadFull=function(e){var t=ns.Model.get("message-body",e).getFirstBody();return!(!t||!t.trimmed)},Daria.MessageWidget._checkShowIgnoreThread=function(e){var t=ns.Model.get("message",e),n=ns.Model.get("labels").getMuteThreadLabel();return!(!n||!t.hasLabel(n.lid))},Daria.MessageWidget._checkShowImapDeleted=function(e){if(ns.Model.get("settings").isSet("hide-imap-deleted"))return!1;var t=ns.Model.get("message",e);return!(!t.hasLabelWithSymbolicName("deleted_label")&&!t.get(".flags.imap-deleted"))},Daria.MessageWidget._checkShowNoreply=function(e){var t=ns.Model.get("message",e),n=ns.Model.get("labels").getWaitingForReplyLabel();return!(!n||!t.hasLabel(n.lid))},Daria.MessageWidget._checkShowTranslate=function(e){if(!ns.Model.get("settings").isSet("translate"))return!1;var t=Daria.Translate.getLangByMid(e.ids),n=Daria.Config.locale;if(!t||t===n)return!1;var i=ns.Model.get("message-body",e).getHTML();if(i.innerHTML.length>2e5)return Jane.ErrorLog.send({type:"widget-translate-too-big-message",text:"length=".concat(i.innerHTML.length)}),!1;var s=$(i).text();return!!$.trim(s)},Daria.MessageWidget._checkShowSpam=function(e){var t=ns.Model.get("message",e);if(t.isYaSupport())return!1;var n=ns.Model.get("message-body",e),i=n.hasPhishingBody()||t.isPhishing();if(!t.isSpam()&&!i)return!1;var s=n.getData();return s.hasOwnProperty("has-links")&&s.hasOwnProperty("has-img")||n.getHTML(),!(!s["has-links"]&&!s["has-img"])},Daria.MessageWidget._checkShowEvent=function(){return"RUS"===Daria.Config.product&&!Daria.IS_CORP},Daria.MessageWidget._checkShowClassificationConfirmationRequest=function(e){var t=ns.Model.get("message",e),n=ns.Model.get("message-widget-state",e),i=ns.Model.get("message-body",e),s=t.getFromEmail();if(ns.Model.get("account-information").isMyEmail(s))return!1;var a="confirm-classification"===Daria.urlParams["message-widget"],o=i.get(".classification")||a,r=t.get(".type"),u=!_.isEmpty(r)&&!_.contains(r,8),l=_.omit(n.get(".show"),"message-widget-confirm-classification"),d=!_.some(l,Boolean);return o&&u&&d}},4880:function(e,t,n){n(4881),n(4882),n(4883),n(4884),n(4885),n(4886)},4881:function(e,t){function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,s=!1,a=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(s)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}!function(){var e=null;ns.events.on("b-mail-dropdown-closed",function(){e&&(e.removeClass("b-yabble b-yabble_contact b-yabble_selected"),e=null)}),ns.action.define("message-head.dropdown",function(t,n,i,s){n=n||{};var a=$(s.currentTarget);if(function(e){var t=e.parent();return e.offset().left+e.innerWidth()-11<t.offset().left+t.width()}(a)&&!a.hasClass("b-message-head__contact_readonly")){var o=e&&e[0]===a[0],r=a.find(".b-message-head__contact__arrow"),u={id:n.id,value:{name:n.name,email:n.email},root:a,arrow:r,fromMessage:!0,delay:-1,my:n.my?"yes":"",cid:n.cid||a.data("cid")||""};Daria.YabbleDropdown.toggle(u),o||(a.addClass("b-yabble_selected"),e=a)}}),ns.action.define("message.add-contact",function(e,t){t=t||{};var i=ns.request("abook-contact",{email:t.email}).then(function(e){var t=n(e,1)[0];return t&&t.data&&t.data.cid?t:null},function(){return null});Jane.Services.runModules(["abook.js"],function(){i.then(function(e){var n=Boolean(e),i=n&&(e.isShared()||e.isSharedLocal()),s={mail_addr:t.email,first_name:t.name,shared:i};return n?ns.Model.get("abook-person-manager").updatePerson(e,s):ns.Model.get("abook-person-manager").addPerson(s)}).then(function(e){ns.Model.invalidateAll("abook-contacts");var n=e[0].get(".cid");$(".b-message-head__contact").each(function(e,i){var s=ns.action.getParams(i);s.email!==t.email||s.cid||$(i).data("cid",n)})})}),$(document).trigger("b-mail-dropdown-closeall")})}(),ns.action.define("message.counter-filters-create",function(){return!0}),ns.action.define("message.counter-properties",function(){return!0})},4882:function(e,t){function n(e){Jane.c("Просмотрщик вложений",e)}ns.action.define("attachments.attach-preview-next",function(e,t,i,s){s.preventDefault(),s.stopPropagation(),n("Показ стрелок"),n("Клик по стрелкам"),Daria.AttachViewer.next()}),ns.action.define("attachments.attach-preview-prev",function(e,t,i,s){s.preventDefault(),s.stopPropagation(),n("Показ стрелок"),n("Клик по стрелкам"),Daria.AttachViewer.prev()}),ns.action.define("attachments.attach-preview-print",function(e,t,i,s){s.preventDefault(),s.stopPropagation(),n("Печать");var a=window.open();a.document.open(),a.document.write('<!doctype html><html><body><img src="'+t.src+'"></body></html>'),a.document.close(),a.onload=function(){try{a.focus(),a.print(),a.close()}catch(e){}}}),ns.action.define("attachments.attach-preview-gallery",function(e,t,i,s){s.preventDefault(),s.stopPropagation(),n(t.closer?"Клик по крестику галереи":"Показать всё"),Daria.AttachViewer.toggleGallery()}),ns.action.define("attachments.attach-preview-select",function(e,t,n,i){i.preventDefault(),i.stopPropagation(),Daria.AttachViewer.select(Number(t.index)),Daria.AttachViewer.hideGallery()}),ns.action.define("attachments.attach-preview-scroll",function(e,t,n,i){i.preventDefault(),i.stopPropagation(),Daria.AttachViewer.scrollGallery(Number(t.to))}),ns.action.define("attachments.attach-preview-subject",function(e,t,i,s){s.preventDefault(),s.stopPropagation(),n("Клик по теме"),Daria.Layer.close(),ns.page.go(i.hash)}),ns.action.define("attachments.attach-preview-download",function(e,t,i,s){return s.stopPropagation(),n(t.count),!0})},4883:function(e,t){ns.action.define("attachments.image-preview-next",function(e,t,n,i){i.preventDefault(),i.stopPropagation(),Jane.c("Images viewer","Arrows show"),Jane.c("Images viewer","Click on arrows"),Daria.ImageViewer.next()}),ns.action.define("attachments.image-preview-prev",function(e,t,n,i){i.preventDefault(),i.stopPropagation(),Jane.c("Images viewer","Arrows show"),Jane.c("Images viewer","Click on arrows"),Daria.ImageViewer.prev()}),ns.action.define("attachments.image-preview-print",function(e,t,n,i){i.preventDefault(),i.stopPropagation(),Jane.c("Images viewer","Print"),Daria.Printer.printImage(t)}),ns.action.define("attachments.image-preview-gallery",function(e,t,n,i){i.preventDefault(),i.stopPropagation(),Jane.c("Images viewer",t.closer?"Click on gallery cross":"Show all"),Daria.ImageViewer.toggleGallery()}),ns.action.define("attachments.image-preview-select",function(e,t,n,i){i.preventDefault(),i.stopPropagation(),Daria.ImageViewer.select(Number(t.index)),Daria.ImageViewer.hideGallery()}),ns.action.define("attachments.image-preview-scroll",function(e,t,n,i){i.preventDefault(),i.stopPropagation(),Daria.ImageViewer.scrollGallery(Number(t.to))}),ns.action.define("attachments.image-preview-subject",function(e,t,n,i){i.preventDefault(),i.stopPropagation(),Jane.c("Images viewer","Click on subject"),Daria.Layer.close(),ns.page.go(n.hash)}),ns.action.define("attachments.image-preview-download",function(e,t,n,i){return i.stopPropagation(),Jane.c("Images viewer",t.count),!0})},4884:function(e,t){ns.action.define("layer.close",function(){Daria.Layer.close()})},4885:function(e,t){ns.action.define("message.video-player-open",function(e,t){return Daria.VideoPlayer.open(t)}),ns.action.define("message.video-player-close",function(){return Daria.VideoPlayer.close()})},4886:function(e,t){ns.action.define("message.lists-add-from-message",function(e,t){Jane.Services.runModules(["setup.js"],function(){ns.action.run("filters.lists-add-from-message",t)})})},4887:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),s=n(400);n.n(s);!function(){var e={"thread-sidebar-wrap&":{},"message-head":function(){var e={"message-head-subject":{},"message-head-folder":{},"message-head-sender-name&":{},"message-head-recipient&":{},"message-head-recipient-count&":{},"message-head-dkim&":{},"message-head-sender-wrap":{},"message-head-labels":{},"message-head-date":{}};return Daria.showPriorityLabel()&&(e["priority-toggleable-head"]={}),e["important-toggleable-head"]={},e},"message-widget&":{},"message-body&":{},"attachments-widget-body&":{}};ns.layout.define("layout-message",{message:e});var t={"app right-box@":function(){return ns.View.infoLite("message-headline").methods.checkShow()?{"message-headline":{},"message-react":{}}:{"message-react":{}}}};ns.layout.define("message",t,"common+left+toolbar");ns.layout.define("attached-message-preview",{"attached-message":{"message-head-eml":{"message-head-subject-eml":{"message-head-date-eml":{}},"message-head-sender-name-eml&":{},"message-head-recipient&":{},"message-head-recipient-count&":{}},"message-body":{},"attachments-widget-body":{}}}),ns.layout.define("map-up",{"map-up":{map:{"map-city-complaint":{}},"map-actions":{}}});var n={"app service-box@":{404:{}}};Object(i.hasFeature)(s.Features.REACT_LAYOUT)||(n["app "+Daria.getDirectBlockLayoutInfo("messages-direct").name]={}),ns.layout.define("no-message",n,"common")}(),n(4888),n(4889),n(4890)},4888:function(e,t){ns.layout.define("layout-quick-reply-message",{"quick-reply-message":{message:{"message-head":{"message-head-sender-name&":{},"message-head-recipient&":{},"message-head-recipient-count&":{},"message-head-sender-wrap":{},"message-head-date":{},"message-head-labels":{}},"message-toolbar-fake":{},"message-body&":{}}}})},4889:function(e,t){ns.layout.define("message-head-sender-empty",{"message-head-sender@":{}}),ns.layout.define("message-head-sender-info",{"message-head-sender@":{"message-head-sender-info&":{}}})},4890:function(e,t){ns.layout.define("layout-thread-sidebar",{"thread-sidebar-box":{"message-prevnext-with-shortcuts":{},"thread-sidebar":{},"thread-sidebar-expand-button":{}}}),ns.layout.define("layout-thread-sidebar-item",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{}}}),ns.layout.define("layout-thread-sidebar-item-related",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{},"thread-sidebar-item-related&":{}}}),ns.layout.define("layout-thread-sidebar-item-attachments",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{},"thread-sidebar-item-attachments&":{}}}),ns.layout.define("layout-thread-sidebar-item-links",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{},"thread-sidebar-item-links&":{}}}),ns.layout.define("layout-thread-sidebar-item-same-author",{"thread-sidebar-item-box@":{"thread-sidebar-item-title":{},"thread-sidebar-item-same-author&":{}}})},4891:function(e,t,n){n(4892),n(4893),n(4894),n(4895),n(4896),n(4897),n(4898),n(4899),n(4900),n(4901),n(4902),n(4903),n(4904),n(4905),n(4906),n(4907),n(4908),n(4909),n(4910),n(4911),n(4912),n(4913),n(4914),n(4915),n(4916),n(4917),n(4918)},4892:function(e,t){ns.Model.define("do-send-promise-sms",{params:{phone:null,offset:null}})},4893:function(e,t){ns.Model.define("do-unsubscribe",{params:{ids:null}})},4894:function(e,t){ns.Model.define("get-event",{params:{data:null}})},4895:function(e,t){ns.Model.define("get-event-ics",{params:{ids:null,stid:null,inc_hid:null}},"base-calendar-event")},4896:function(e,t){ns.Model.define("get-event-by-ics",{params:{uid:null,icsUrl:null}})},4897:function(e,t){ns.Model.define("geo-coder",{params:{geocode:null,ll:null}})},4898:function(e,t){ns.Model.define("geo-ip",{methods:{getCoordinates:function(){var e=this.select(".get_coordinates_by_ip.latitude")[0],t=this.select(".get_coordinates_by_ip.longitude")[0];return e&&t?t+","+e:""}}})},4899:function(e,t){ns.Model.define("map-data",{params:{address:null}})},4900:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(137);n.n(i);ns.Model.define("message-in-reply-to-ng",{params:{message_id:null},methods:{_sortByDateDesc:function(e,t){return e.date>t.date?-1:e.date<t.date?1:0},getLastDraft:function(){if(!this.isValid())return null;var e=ns.Model.get("folders").getFolderBySymbol(i.WellKnownFolderSymbol.DRAFT);if(!e)return null;var t=null,n=e.fid;return this.getData().envelopes.sort(this._sortByDateDesc).some(function(e){return e.fid===n&&(t=e,!0)}),t},getLastMessage:function(){if(!this.isValid())return null;var e=ns.Model.get("folders").getFolderBySymbol(i.WellKnownFolderSymbol.DRAFT),t=e&&e.fid,n=this.getData().envelopes.filter(function(e){return e.fid!==t}).sort(this._sortByDateDesc);return n&&n[0]}}})},4901:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(370),s=n(538);ns.Model.define("message-nearest",{params:{ids:null},methods:{preprocessData:function(e){return _.forEach(e.message,function(e){if(e.mid){var t=ns.Model.get("message",{ids:e.mid});t.isValid()||t.get(".current")||t.setData(e)}}),e},getNearestMessages:function(){var e={prev:null,current:null,next:null};return(this.get(".message")||[]).forEach(function(t){["next","prev","current"].forEach(function(n){t[n]&&(e[n]=t)})}),e},getNextMid:function(){return this.select(".message[.next].mid")[0]||null},getPreviousMid:function(){return this.select(".message[.prev].mid")[0]||null},canShowPrevNext:function(){var e=this.getNearestMessages();return e.prev||e.next},isNew:function(e){return ns.Model.get("message",{ids:e}).isNew()},getNearestMids:function(){return(this.get(".message")||[]).filter(function(e){return e.mid&&!e.current}).map(function(e){return e.mid})},setError:function(){this.scenarioManager.hasActiveScenario(i.d)&&this.scenarioManager.getActiveScenario(i.d).logError(s.e),ns.Model.prototype.setError.apply(this,arguments)}}},"model-with-scenario-manager-mixin")},4902:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(137);n.n(i);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ns.Model.define("message-toolbar",{events:{"ns-model-before-destroyed":"onBeforeDestroyed"},params:{ids:null},ctor:function(){this.recalculateButtons=this.recalculateButtons.bind(this)},methods:{toShowUnsubscribeButton:function(e){return!(Daria.IS_CORP||!e||e.inFolderBySymbol(i.UnsubscribeDisabledFolders))&&e.isSubscriptionMessage()},SMART_BUTTON_ID_FALLBACK:Daria.Constants.TOOLBAR_BUTTONS.REPLY,onBeforeDestroyed:function(){this._unbindModelEvents()},request:function(){return ns.request(["message","message-body"],{ids:this.params.ids}).then(this._bindModelEvents,this)},_bindModelEvents:function(e){this.mMessage=_.find(e,"id","message"),this.mMessageBody=_.find(e,"id","message-body"),this.mMessage.on("ns-model-changed",this.recalculateButtons),this.recalculateButtons()},_unbindModelEvents:function(){this.mMessage.off("ns-model-changed",this.recalculateButtons)},_getComposeUrl:function(e){return ns.router.generateUrl("compose2",{ids:this.mMessage.params.ids,oper:e})},recalculateButtons:function(){var e=this.mMessage,t=this.mMessageBody,n=Daria.Constants.TOOLBAR_BUTTONS,o=e.inFolderBySymbol(i.WellKnownFolderSymbol.DRAFT),r=e.inFolderBySymbol(i.WellKnownFolderSymbol.ARCHIVE),u=e.isSpam(),l=e.isPinned(),d=_.contains(e.getSOLabels(),"12"),c=t.allowedReplyAll(),h=this.toShowUnsubscribeButton(e),g=e.isValidForPin(),f=e.isReplyLaterAllowed(),m=!d&&!o,p=e.isReplyLater(),b=this._getComposeUrl("reply"),v=this._getComposeUrl("reply-all"),y=this._getComposeUrl("forward"),w=[{id:n.REPLY,condition:m&&!c,href:b},{id:n.REPLY_ALL,condition:m&&c,href:v},{id:n.FORWARD,condition:!o&&!d,href:y},{id:n.DELETE,condition:!0},{id:n.SPAM,condition:!o&&!u&&!d},{id:n.NOT_SPAM,condition:!o&&u},{id:n.REPLY,condition:m&&c,href:b},{id:n.UNSUBSCRIBE_ONE,condition:h},{id:n.REPLY_LATER,condition:f},{id:n.ARCHIVE,condition:!o&&!r&&!p},{id:n.LABELS_ACTIONS,condition:!0},{id:n.FOLDERS_ACTIONS,condition:!p},{id:n.PIN,condition:g&&!l&&!p},{id:n.UNPIN,condition:g&&l&&!p},{id:n.TRANSLATE,condition:!0}],A=o?n.DRAFT_FINISH:this.SMART_BUTTON_ID_FALLBACK;w.some(function(e){return e.id===A})||w.unshift({id:A,condition:!0});var C=ns.Model.get("all-toolbar-buttons"),M=w.filter(function(e){return e.condition}).map(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},C.getButtonById(e.id),{href:e.href})}).filter(function(e){return Boolean(e)}),D=Daria.is3pv()?3:4,S=M.length>D,T=M.splice(0,D);S&&T.push(C.getButtonById(n.MORE));var E={visibleButtons:T,moreButtons:M};this.setData(E)}}})},4903:function(e,t){ns.Model.define("message-thread-nearest",{events:{"ns-model-init":"_onInit"},params:{ids:null},methods:{_onInit:function(){this.setData({})},getNearestMessages:ns.Model.infoLite("message-nearest").methods.getNearestMessages}},ns.ModelStatic)},4904:function(e,t){ns.Model.define("message-widget-state",{params:{ids:null},events:{"ns-model-init":function(){this.setData({show:{"message-widget-translate":!1}})}},methods:{isViewUserClose:function(e){return Boolean(this.get("."+e+"-user-close"))},setViewUserClose:function(e){this.set("."+e+"-user-close",!0),this.setIfChanged(".show."+e,!1)},resetViewUserClose:function(e,t){this.set("."+e+"-user-close",!1,t),this.setIfChanged(".show."+e,!1,t)},show:function(e,t){this.set("."+e+"-user-close",!1),this.setIfChanged(".show."+e,!0,t)},isShow:function(e){return Boolean(this.get(".show."+e))}}},ns.ModelStatic)},4905:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(137);n.n(i);ns.Model.define("message-draft",{params:{ids:null},methods:{request:function(){return ns.request("message-body",this.params).then(this._requestMessageInReplyTo,this).then(this._requestDraftMessage,this).then(this._requestApplyData,this)},getDraftMid:function(){var e=this.get(".mid");if(e){var t=ns.Model.get("message",{ids:e});t.isValid()&&!t.isDraftLike()&&(e=void 0,this.setIfChanged(".mid",e))}return e},_requestMessageInReplyTo:function(e){var t=_.find(e,"id","message-body").get(".info.message-id");return t?new vow.Promise(function(e){ns.forcedRequest("message-in-reply-to-ng",{message_id:t}).then(function(t){var n=t[0].getLastDraft(),i=n&&n.mid;e(i)},function(){e()})}):vow.Promise.resolve()},_requestDraftMessage:function(e){return e?new vow.Promise(function(t){ns.request(["message","message-body"],{ids:e}).then(function(n){var s=_.find(n,"id","message").getFolderId();s&&ns.Model.get("folders").isFolder(s,i.DraftLikeFoldersShort)?t(e):t()},function(){t()})}):vow.Promise.resolve()},_requestApplyData:function(e){this.setData({mid:e})}}})},4906:function(e,t){Daria.InfiniteModelCollection=function(){},no.inherit(Daria.InfiniteModelCollection,ns.ModelCollection,{canLoadMore:function(){return Boolean(this.get(".details.canLoadMore"))},isEmpty:function(){return!this.models||!this.models.length},loadMore:function(){var e=0;this.isValid()?e=this.models.length:this.clear();var t=_.assign({},this.params,{first:e});return ns.request(this.id,t).then(function(e){var t=e[0];this.data&&this.isValid()||(this.data={},this.status=this.STATUS.OK);var n=t.get(".details")||{},i=this.get(".details")||{},s=t.models;return this.set(".details",_.merge(i,n),{silent:!0}),this.insert(s),ns.Model.destroy(t),s},this)}})},4907:function(e,t){ns.Model.define("thread-attachments-item",{model:{"thread-attachments-item":!0},params:{"url-key":null},methods:{preprocessData:function(e){var t=Daria.getExtensionInfo(e.name);return t.class&&(e.icon=t.class),e}}})},4908:function(e,t){ns.Model.define("thread-attachments",{params:{thread_id:null,first:null},requiredFeatures:["web_search_extra_params"],split:{items:".attachments",params:{"url-key":".url-key"},model_id:"thread-attachments-item"}},Daria.InfiniteModelCollection)},4909:function(e,t){ns.Model.define("thread-sidebar-item",{params:{thread_id:null,id:null},methods:{getId:function(){return this.get(".id")}}})},4910:function(e,t){ns.Model.define("thread-sidebar",{events:{"ns-model-init":"_onInit"},params:{thread_id:null},split:{items:".items",params:{thread_id:".thread_id",id:".id"},model_id:"thread-sidebar-item"},methods:{_onInit:function(){this.setData({items:[]})}}},ns.ModelCollectionStatic)},4911:function(e,t){ns.Model.define("thread-sidebar-state",{events:{"ns-model-init":"_onInit"},ctor:function(){this.triggerUpdateDebounce=_.debounce(this.triggerUpdate.bind(this),50)},methods:{_onInit:function(){this.setData({activeItemId:1,flight:!1,body:{},relatedScrollTop:0,relatedScrollIntoView:!0,update:!1})},toggleItem:function(e){var t=this.get(".activeItemId");return t===e?(this.set(".activeItemId",null),!1):(null!==t&&(this.setIfChanged(".relatedScrollTop",0,{silent:!0}),this.setIfChanged(".relatedScrollIntoView",!0,{silent:!0})),this.set(".activeItemId",e),!0)},unsetActiveItem:function(){this.setIfChanged(".relatedScrollTop",0,{silent:!0}),this.setIfChanged(".relatedScrollIntoView",!0,{silent:!0}),this.setIfChanged(".activeItemId",1)},isActive:function(e){return this.get(".activeItemId")===e},isFlight:function(){return this.get(".flight")},shouldScrollRelatedIntoView:function(){return Boolean(this.get(".relatedScrollIntoView"))},disableScrollRelatedIntoViewFlag:function(){this.setIfChanged(".relatedScrollIntoView",!1,{silent:!0})},triggerUpdate:function(){this.set(".update",!0)},metrikaCount:function(){var e=Array.prototype.slice.call(arguments);e.unshift("Правая колонка",this.get(".flight")?"Плавающая правая колонка":"Статичная правая колонка"),Jane.c.apply(Jane,e)}}},ns.ModelStatic)},4912:function(e,t){ns.Model.define("messages-from",{params:{first:null,from:null},requiredFeatures:["web_search_extra_params"],split:{items:".envelopes",model_id:"messages-from-item",params:{ids:".mid"}}},Daria.InfiniteModelCollection)},4913:function(e,t){ns.Model.define("messages-from-item",{params:{ids:null},methods:{preprocessData:function(e){return e.subject&&"No subject"!==e.subject||(e.subject=i18n("%Без_темы")),e.date.view=Daria.MessageTime.getFormattedTime(e.date.timestamp),e},hasRelativeTime:function(){return this.get(".date.view.isRelative")},updateTime:function(){var e=Daria.MessageTime.getFormattedTime(this.get(".date.timestamp"));this.set(".date.view",e)}}})},4914:function(e,t){ns.Model.define("messages-thread-link",{params:{id:null},methods:{preprocessData:function(e){return e.host=$.url(e.src).Host,e}}})},4915:function(e,t){ns.Model.define("messages-thread-links",{params:{thread_id:null,first:null},requiredFeatures:["web_search_extra_params"],split:{items:".links",params:{id:".id"},model_id:"messages-thread-link"}},Daria.InfiniteModelCollection)},4916:function(e,t){ns.Model.define("message-widget",{events:{"ns-model-init":"_onInit"},params:{ids:null,type:null},methods:{_onInit:function(){this.setData({type:null})}}},ns.ModelStatic)},4917:function(e,t){ns.Model.define("message-widget-list",{isCollection:!0,events:{"ns-model-init":"_onInit"},params:{ids:null},methods:{_onInit:function(){this.setData({})},insertWidget:function(e){return this.insert(ns.Model.get("message-widget",_.extend({type:e},this.params)).setData({type:e}))}}},ns.ModelCollectionStatic)},4918:function(e,t){ns.Model.define("form-client-data",{params:{formId:null,withTitle:null,nonce:null}})},4919:function(e,t,n){Daria.message={},n(4920),n(4923),n(4924),n(4925),n(4926),n(4927),n(4928),n(4929),n(4930),n(4941),n(4942)},4920:function(e,t,n){!function(){var e={"audio-player":n(4921),"audio-player-large":n(4922)};Daria.message.audioPlayer={},Daria.message.audioPlayer.init=function(t){if(swfobject.hasFlashPlayerVersion("9.0.0")){var n,i=t.currentTarget,s=$(i),a=i.getAttribute("href")||i.getAttribute("data-href"),o=Boolean(i.getAttribute("data-large")),r=s.parent().find(".b-file__player"),u=r.children('[id ^= "attach-player-"]');if(u.length?n=u.attr("id"):(n="attach-player-"+Daria.getRandomNumber(),$("<span/>",{id:n}).appendTo(r)),this._players[n]||(this._players[n]={playLink:i}),this._players[n].url||(this._players[n].url=a),o?s.closest(".b-file").addClass("b-file_player"):s.hide(),$("#"+n).parent().removeClass("g-hidden"),!this._players[n].swf){this.pause();var l=e["audio-player"+(o?"-large":"")+".swf"];swfobject.embedSWF(l,n,o?80:160,o?96:20,"9.0.0",null,{player_id:n,audio_url:encodeURIComponent(this._players[n].url)},{wmode:"transparent",quality:"high",bgcolor:"#ffffff",allowScriptAccess:"always"},{id:n}),this._players[n].swf=!0,this.playerAction(n,"play")}}else Daria.Dialog.open({title:"Flash",body:i18n("%Message_Audio_No_Flash")})},Daria.message.audioPlayer._players={},Daria.message.audioPlayer._activePlayer=null,Daria.message.audioPlayer.pause=function(){if(this._activePlayer)try{$("#"+this._activePlayer)[0].pausePlayer()}catch(e){}},Daria.message.audioPlayer.playerAction=window.playerAction=function(e,t){switch(t){case"play":e!==this._activePlayer&&this.pause(),this._players[e].status="playing",this._activePlayer=e;break;case"pause":this._players[e].status="paused";break;case"close":e===this._activePlayer&&this.pause(),$("#"+e).parent().addClass("g-hidden"),$(this._players[e].playLink).show()}},Daria.message.audioPlayer.reset=function(){for(var e in this._players)swfobject.removeSWF(e),$(this._players[e].playLink).show(),delete this._players[e]}}()},4921:function(e,t,n){e.exports=n.p+"_/b90101dc0b89f64a70383b1f7a81f7a7-audio-player.swf"},4922:function(e,t,n){e.exports=n.p+"_/a46524573a02d4ea8db5c9c5a3cc5af6-audio-player-large.swf"},4923:function(e,t){var n=new RegExp("(^|\\.)yandex\\.(".concat(Daria.Config.domainZonesForReg,")$")),i=String(i18n("%Confirm_site_out_Yandex")).replace(/\s*\\n\s*/g,"\n"),s=String(i18n("%Form_submit_disallowed")).replace(/\s*\\n\s*/g,"\n");Daria.message.formWarning=function(e){var t=e.target,a=t.getAttribute("action");if(!/^https?:\/\//.test(a))return window.alert(s),!1;var o=t.action.split("/")[2];return!(!o||!n.test(o))||(Jane.ErrorLog.send({event:"formWarning",host:a}),window.confirm(i))}},4924:function(e,t){Daria.message.getLinkStaffByEmail=function(e){return Daria.email.isCorp(e)?Daria.Config["staff-host"]+"/"+e.split("@")[0]:""}},4925:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(347);function s(e){"@babel/helpers - typeof";return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onresize=this.onresize.bind(this),this.ondocumentclick=this.ondocumentclick.bind(this),this.onmousewheel=this.onmousewheel.bind(this),this.onclose=this.onclose.bind(this)}return function(e,t,n){t&&u(e.prototype,t),n&&u(e,n)}(e,[{key:"_resetCache",value:function(){this.attachObjects={},this.$currentAttach=null}},{key:"_initComponent",value:function(){this.$currentAttach=null,this.$content=$(Jane.tt("message:attach-viewer",{count:this.attaches.length,attachment:this.attaches})),this.$title=this.$content.find(".b-attach-viewer__title"),this.$download=this.$content.find(".b-attach-viewer__download"),this.$fullsize=this.$content.find(".b-attach-viewer__fullsize"),this.$page=this.$content.find(".b-attach-viewer__page"),this.$subject=this.$content.find(".b-attach-viewer__subject"),this.$from=this.$content.find(".b-attach-viewer__from"),this.$to=this.$content.find(".b-attach-viewer__to"),this.$date=this.$content.find(".b-attach-viewer__date"),this.$print=this.$content.find(".b-attach-viewer__print"),this.$gallery=this.$content.find(".b-attach-viewer__gallery-i")}},{key:"_isImage",value:function(e){return"image"===e.type&&"svg+xml"!==e.subtype}},{key:"_updateLoadingState",value:function(){var e=this.currentIndex,t=this.attaches[e];this.$currentAttach=this.attachObjects[e],this.$currentAttach.addClass("b-attach-viewer__image_current"),this.$content.toggleClass("b-attach-viewer_loading",this._isImage(t)&&!this.$currentAttach[0].complete)}},{key:"_addListeners",value:function(){$(window).on("resize",this.onresize),$(document).on("click",this.ondocumentclick),this.$gallery.on("mousewheel",this.onmousewheel),$.Shortcuts.modalListOn("attach-viewer")}},{key:"_removeListeners",value:function(){$(window).off("resize",this.onresize),$(document).off("click",this.ondocumentclick),this.$gallery.off("mousewheel",this.onmousewheel),$.Shortcuts.modalListOff("attach-viewer")}},{key:"_initScrollTop",value:function(){this.originalScrollTop=$(window).scrollTop()}},{key:"_restoreScrollTop",value:function(){"originalScrollTop"in this&&($(window).scrollTop(this.originalScrollTop),delete this.originalScrollTop)}},{key:"_initState",value:function(){this.ppyrus=!this.attaches[0].mid,this.ppyrus&&this.$content.find(".b-attach-viewer__meta").hide(),1===this.attaches.length?this.$content.addClass("b-attach-viewer_single"):Jane.c("Просмотрщик аттачей","Показ стрелок"),this.$content.addClass("b-attach-viewer_loading")}},{key:"openAttaches",value:function(e,t){var n=this;$.isArray(e)||(e=[]),e.length&&(this.attaches=e.map(function(e){return n.getAttachData(e)}),this._resetCache(),this._initComponent(),this._initState(),this._initScrollTop(),Daria.Layer.open({body:this.$content,onclose:this.onclose}),this.updateLayout(),this._addListeners(),this.select(t))}},{key:"showSavePopup",value:function(e){if(!Object(i.getPddRestrictNotificationsModel)().showPopup()){var t=this.attaches[this.currentIndex];ns.View.create("disk-widget-save-popup").open({mid:t.mid,hid:t.hid,popup:{where:e,withTail:!1,appendTo:".js-attach-viewer"},countLocationName:"in image viewer"}),Jane.c(["Attachments",'click on "save to disc"',"in image viewer"])}}},{key:"open",value:function(e,t,n){var i=this,s={ids:e};n&&(s.hid=n),ns.request(["message-body","message"],s).then(function(n){var s=(n[0].data.attachment||[]).filter(function(e){return"image"===e.class&&e["browser-supports"]}),a=s.map(function(t){return o({mid:e},t)}),r=Math.max(_.findIndex(s,function(e){return e.hid===t}),0);i.openAttaches(a,r)})}},{key:"onclose",value:function(){this._removeListeners(),this._restoreScrollTop(),this._resetCache(),this.attaches=[],Jane.c("Просмотрщик вложений","Закрытие")}},{key:"onresize",value:function(){this.$content.find(".b-attach-viewer__container, .b-attach-viewer__arrow").css({width:"",height:""}),this.updateLayout()}},{key:"ondocumentclick",value:function(e){var t=$(e.target);t.closest(".b-attach-viewer__gallery").length||this.hideGallery(),t.closest(".b-attach-viewer").length||Daria.Layer.close();var n=t.closest(".js-show-save-popup");n.length&&(e.preventDefault(),e.stopPropagation(),this.showSavePopup(n.get(0)))}},{key:"onmousewheel",value:function(e){var t=e.originalEvent;this.scrollGallery(-t.wheelDelta||t.detail,50,!0)}},{key:"createAttach",value:function(e){var t=this;if(!this.attachObjects[e]){var n=this.attaches[e],i=$(Jane.tt("message:attach-viewer-item-content",n));this._isImage(n)&&(this.$content.addClass("b-attach-viewer_loading"),i.one("load",function(){t.$currentAttach&&t.$currentAttach.length&&t._updateLoadingState()})),i.css({maxWidth:this.maxAttachSize[0],maxHeight:this.maxAttachSize[1]}),i.appendTo(this.$content.find(".b-attach-viewer__container")),this.attachObjects[e]=i}}},{key:"updateCurrentAttach",value:function(){var e=this.currentIndex,t=this.attaches[e];this.$currentAttach&&this.$currentAttach.removeClass("b-attach-viewer__image_current"),this.createAttach(e),this.createAttach(this.getNextIndex(e)),this.createAttach(this.getPrevIndex(e)),this._updateLoadingState(),this.$title.html(t.name),this.$title.attr("title",t.name),this.$download.attr("href",t.downloadUrl),this.$page.html(this.currentIndex+1),this.$subject.html(t.subject),this.$subject.attr("href",t.emailUrl),this.$from.html(t.from),this.$to.html(t.to),this.$date.html(t.date),this.$content.find(".b-attach-viewer__preview").removeClass("b-attach-viewer__preview_current"),this.$content.find(".b-attach-viewer__preview_"+this.currentIndex).addClass("b-attach-viewer__preview_current"),t.fullSizeUrl?(this.$print.attr("data-params","src="+encodeURIComponent(t.fullSizeUrl)),this.$fullsize.attr("href",t.fullSizeUrl),this.$print.show(),this.$fullsize.show()):(this.$print.hide(),this.$fullsize.hide())}},{key:"updateLayout",value:function(){var e=$(window),t=e.width()-185,n=e.height()-100;this.ppyrus||(n-=this.$content.find(".b-attach-viewer__meta").height()),this.maxAttachSize=[t,n];var i=t/3,s=2*i;this.$content.find(".b-attach-viewer__content").css({width:e.width()-170}),this.$content.find(".b-attach-viewer__container").css({width:t,lineHeight:n+"px"}),this.$content.find(".b-attach-viewer__container, .b-attach-viewer__arrow").css("height",n),this.$content.find(".b-attach-viewer__image").css({maxWidth:t,maxHeight:n}),this.$content.find(".b-attach-viewer__arrow_prev").css({width:i}),this.$content.find(".b-attach-viewer__arrow_next").css({width:s,marginLeft:-s+"px",backgroundPosition:s-35+"px 50%"})}},{key:"getAttachData",value:function(e){var t,n,i,a,r,u,l,d;if("object"===s(e)&&e||(e={}),e.mid){var c=ns.Model.get("message",{ids:e.mid}),h=c.getEmails();t=Daria.url.attachment(e,e.mid),n=Daria.url.attachment(e,e.mid,{no_disposition:!0,exif_rotate:!0}),i=Daria.url.attachment(e,e.mid,{no_disposition:!0,thumb:!0,exif_rotate:!0}),a=h.from,r=h.to,u=_.escape(c.getSubject()),l="#message/"+e.mid,d=c.getDate()}else t=e.url,n=e.fullSizeUrl,i=e.thumbUrl,a=e.from||"",r=e.to||"",u=e.subject||"",l=e.emailUrl||"",d=e.date||"";return a=this.formatEmail(a),r=this.formatEmail(r),o({},e,{name:_.escape(e.name),filename:_.escape(e.filename),downloadUrl:t,fullSizeUrl:n,thumbUrl:i,from:a,to:r,subject:u,emailUrl:l,date:d})}},{key:"formatEmail",value:function(e){var t="";return e&&"object"==s(e)&&(t=_.escape(e.name||e.email),e.name&&e.email&&(t+=" &lt;"+_.escape(e.email)+"&gt;")),t}},{key:"next",value:function(){this.currentIndex=this.getNextIndex(this.currentIndex),this.updateCurrentAttach()}},{key:"getNextIndex",value:function(e){return(e+1)%this.attaches.length}},{key:"prev",value:function(){this.currentIndex=this.getPrevIndex(this.currentIndex),this.updateCurrentAttach()}},{key:"getPrevIndex",value:function(e){var t=this.attaches.length;return(e+t-1)%t}},{key:"select",value:function(e){(isNaN(e)||"number"!=typeof e)&&(e=0),e>=0&&e<this.attaches.length&&(this.currentIndex=e,this.updateCurrentAttach())}},{key:"toggleGallery",value:function(){this.$content.toggleClass("b-attach-viewer_gallery"),this.$gallery[0].scrollLeft=168*(this.currentIndex+1)-this.$gallery.width()/2,this.scrollGallery(1,1e-4,!0)}},{key:"hideGallery",value:function(){this.$content.removeClass("b-attach-viewer_gallery")}},{key:"isGalleryOpen",value:function(){return this.$content.hasClass("b-attach-viewer_gallery")}},{key:"scrollGallery",value:function(e,t,n){var i=this;t=t||800;var s=this.$gallery[0],a=s.scrollLeft+(e<0?-1:1)*t,o=function(){i.$content.find(".b-attach-viewer__gallery-arrow").removeClass("b-attach-viewer__gallery-arrow_disabled");var e=s.scrollLeft;0===e&&i.$content.find(".b-attach-viewer__gallery-arrow_left").addClass("b-attach-viewer__gallery-arrow_disabled"),e<a&&i.$content.find(".b-attach-viewer__gallery-arrow_right").addClass("b-attach-viewer__gallery-arrow_disabled")};n?s.scrollLeft=a:this.$gallery.animate({scrollLeft:a},500,"linear",o),o()}}]),e}();Daria.AttachViewer=new l},4926:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(347);function s(e){"@babel/helpers - typeof";return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Daria.ImageViewer={openImages:function(e,t){var n=this,i=this,s=$(window);$.isArray(e)?this.images=e:this.images=[],this.images.length&&(this.ppyrus=!1,this.images[0].mid||(this.ppyrus=!0),this.images=$.map(this.images,function(e){return i.getImageData(e)}),this.imgObjects={},this.$currentImage=null,this.$content=$(Jane.tt("message:image-viewer",{count:this.images.length,attachment:this.images})),this.$title=this.$content.find(".b-image-viewer__title"),this.$download=this.$content.find(".b-image-viewer__download"),this.$fullsize=this.$content.find(".b-image-viewer__fullsize"),this.$page=this.$content.find(".b-image-viewer__page"),this.$subject=this.$content.find(".b-image-viewer__subject"),this.$from=this.$content.find(".b-image-viewer__from"),this.$to=this.$content.find(".b-image-viewer__to"),this.$date=this.$content.find(".b-image-viewer__date"),this.$print=this.$content.find(".b-image-viewer__print"),this.$gallery=this.$content.find(".b-image-viewer__gallery-i"),this.ppyrus&&this.$content.find(".b-image-viewer__meta").hide(),this.originalScrollTop=s.scrollTop(),Daria.Layer.open({body:this.$content,onclose:function(){i.onclose()}}),1===this.images.length?this.$content.addClass("b-image-viewer_single"):Jane.c("Images viewer","Arrows show"),this.$content.addClass("b-image-viewer_loading"),this.updateLayout(),s.on("resize",this.onresize),this.$gallery.on("mousewheel",this.onmousewheel),setTimeout(function(){$(document).on("click",n.ondocumentclick)},0),$.Shortcuts.modalListOn("image-viewer"),isNaN(t)||"number"!=typeof t?this.currentIndex=0:(this.currentIndex=t,this.select(t)))},showSavePopup:function(e){if(!Object(i.getPddRestrictNotificationsModel)().showPopup()){var t=this.images[this.currentIndex];ns.View.create("disk-widget-save-popup").open({mid:t.mid,hid:t.hid,popup:{where:e,withTail:!1,appendTo:".js-image-viewer"},countLocationName:"in images viewer"}),Jane.c(["Attachments",'click on "save to disc"',"in images viewer"])}},open:function(e,t,n,i,s){this.mid=t,this.mailboxUid=s||null;var r=ns.Model.get("message-body",{ids:t,hid:i}),u=(r.data&&r.data.attachment&&r.data.attachment||[]).filter(function(e){return!e.inline&&"image"===e.class&&e["browser-supports"]}).map(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e,{mid:t})}),l=u.findIndex(function(e){return e.hid===n});this.openImages(u),this.select(l)},onclose:function(){var e=$(window);e.off("resize",this.onresize),$(document).off("click",this.ondocumentclick),this.$gallery.off("mousewheel",this.onmousewheel),$.Shortcuts.modalListOff("image-viewer"),"originalScrollTop"in this&&(e.scrollTop(this.originalScrollTop),delete this.originalScrollTop),this.images=[],this.imgObjects={},this.$currentImage=null,Jane.c("Images viewer","Close")},onresize:function(){var e=Daria.ImageViewer;e.$content.find(".b-image-viewer__container, .b-image-viewer__arrow").css({width:"",height:""}),e.updateLayout()},ondocumentclick:function(e){var t=$(e.target);t.closest(".b-image-viewer__gallery").length||Daria.ImageViewer.hideGallery(),t.closest(".b-image-viewer").length||Daria.Layer.close();var n=t.closest(".js-show-save-popup");n.length&&(e.preventDefault(),e.stopPropagation(),Daria.ImageViewer.showSavePopup(n.get(0)))},onmousewheel:function(e){var t=e.originalEvent;Daria.ImageViewer.scrollGallery(-t.wheelDelta||t.detail,50,!0)},updateImage:function(){var e=this.images[this.currentIndex];this.$currentImage&&this.$currentImage.removeClass("b-image-viewer__image_current"),this.createImage(this.currentIndex),this.createImage(this.getNextIndex(this.currentIndex)),this.createImage(this.getPrevIndex(this.currentIndex)),this.$currentImage=this.imgObjects[this.currentIndex],this.$currentImage.addClass("b-image-viewer__image_current"),this.$currentImage[0].complete?this.$content.removeClass("b-image-viewer_loading"):this.$content.addClass("b-image-viewer_loading"),this.$title.html(e.name),this.$title.attr("title",e.name),this.$download.attr("href",e.downloadUrl),this.$page.html(this.currentIndex+1),this.$subject.html(e.subject),this.$subject.attr("href",e.emailUrl),this.$from.html(e.from),this.$to.html(e.to),this.$date.html(e.date),this.$content.find(".b-image-viewer__preview").removeClass("b-image-viewer__preview_current"),this.$content.find(".b-image-viewer__preview_"+this.currentIndex).addClass("b-image-viewer__preview_current"),e.fullSizeUrl?(this.$print.attr("data-params","mid=".concat(this.mid,"&hid=").concat(e.hid,"&mailboxUid=").concat(this.mailboxUid)),this.$fullsize.attr("href",e.fullSizeUrl),this.$print.show(),this.$fullsize.show()):(this.$print.hide(),this.$fullsize.hide())},createImage:function(e){var t=this;if(!this.imgObjects[e]){this.$content.addClass("b-image-viewer_loading");var n=$('<img class="b-image-viewer__image">');n.appendTo(this.$content.find(".b-image-viewer__container")),n.one("load",function(){t.$currentImage&&t.$currentImage.length&&(t.$currentImage[0].complete?t.$content.removeClass("b-image-viewer_loading"):t.$content.addClass("b-image-viewer_loading"))});var i=this.images[e];i.fullSizeUrl?n.attr("src",i.fullSizeUrl):n.attr("src",i.downloadUrl),n.css({maxWidth:this.maxImageSize[0],maxHeight:this.maxImageSize[1]}),this.imgObjects[e]=n}},updateLayout:function(){var e=$(window),t=e.width()-185,n=e.height()-100;this.ppyrus||(n-=this.$content.find(".b-image-viewer__meta").height()),this.maxImageSize=[t,n];var i=t/3,s=2*i;this.$content.find(".b-image-viewer__content").css({width:e.width()-170}),this.$content.find(".b-image-viewer__container").css({width:t,lineHeight:n+"px"}),this.$content.find(".b-image-viewer__container, .b-image-viewer__arrow").css("height",n),this.$content.find(".b-image-viewer__image").css({maxWidth:t,maxHeight:n}),this.$content.find(".b-image-viewer__arrow_prev").css({width:i}),this.$content.find(".b-image-viewer__arrow_next").css({width:s,marginLeft:-s+"px",backgroundPosition:s-35+"px 50%"})},getImageData:function(e){var t,n,i,a,o,r,u,l;if("object"===s(e)&&e||(e={}),e.mid){var d=ns.Model.get("message",{ids:e.mid}),c=d.getEmails();t=Daria.url.attachment(e,e.mid),n=Daria.url.attachment(e,e.mid,{no_disposition:!0,exif_rotate:!0}),i=Daria.url.attachment(e,e.mid,{no_disposition:!0,thumb:!0,exif_rotate:!0}),a=c.from,o=c.to,r=_.escape(d.getSubject()),u="#message/"+e.mid,l=d.getDate()}else t=e.url,n=e.fullSizeUrl,i=e.thumbUrl,a=e.from||"",o=e.to||"",r=e.subject||"",u=e.emailUrl||"",l=e.date||"";return a=this.formatEmail(a),o=this.formatEmail(o),{name:_.escape(e.name),filename:_.escape(e.filename),downloadUrl:t,fullSizeUrl:n,thumbUrl:i,from:a,to:o,subject:r,emailUrl:u,date:l,mid:e.mid,hid:e.hid}},formatEmail:function(e){var t="";return e&&"object"==s(e)&&(t=_.escape(e.name||e.email),e.name&&e.email&&(t+=" &lt;"+_.escape(e.email)+"&gt;")),t},next:function(){this.currentIndex=this.getNextIndex(this.currentIndex),this.updateImage()},getNextIndex:function(e){var t=e+1;return t>=this.images.length&&(t=0),t},prev:function(){this.currentIndex=this.getPrevIndex(this.currentIndex),this.updateImage()},getPrevIndex:function(e){var t=e-1;return t<0&&(t=this.images.length-1),t},select:function(e){e>=0&&e<this.images.length&&(this.currentIndex=e,this.updateImage())},toggleGallery:function(){this.$content.toggleClass("b-image-viewer_gallery"),this.$gallery[0].scrollLeft=168*(this.currentIndex+1)-this.$gallery.width()/2,this.scrollGallery(1,1e-4,!0)},hideGallery:function(){this.$content.removeClass("b-image-viewer_gallery")},isGalleryOpen:function(){return this.$content.hasClass("b-image-viewer_gallery")},scrollGallery:function(e,t,n){t=t||800;var i=this.$gallery[0],s=i.scrollLeft+(e<0?-1:1)*t,a=this,o=function(){a.$content.find(".b-image-viewer__gallery-arrow").removeClass("b-image-viewer__gallery-arrow_disabled");var e=i.scrollLeft;0===e&&a.$content.find(".b-image-viewer__gallery-arrow_left").addClass("b-image-viewer__gallery-arrow_disabled"),e<s&&a.$content.find(".b-image-viewer__gallery-arrow_right").addClass("b-image-viewer__gallery-arrow_disabled")};n?i.scrollLeft=s:this.$gallery.animate({scrollLeft:s},500,"linear",o),o()},hasOpenedImages:function(){return Boolean(this.$currentImage)}}},4927:function(e,t){Daria.Layer={init:function(){this.$el=$('<div class="b-layer"><div class="b-layer__overlay"></div><div class="b-layer__content-wrap"><div class="b-layer__close ns-action" data-click-action="layer.close"></div><div class="b-layer__content"></div></div></div>'),this.$el.appendTo(document.body),this.$content=this.$el.find(".b-layer__content"),this.$window=$(window);var e=this;this.$window.resize(function(){e.opened&&e.$el.css({width:e.$window.width(),height:e.$window.height()})}),ns.events.on("ns-page-before-changed",function(){Daria.Layer.close()})},open:function(e){this.opened&&this.close(),this.opened=!0,this.$el||this.init(),this.onclose=e.onclose,this.$el.css({width:this.$window.width(),height:this.$window.height()}),this.$content.empty().append(e.body),window.scrollTo(0,0),$(document.documentElement).addClass("b-page_layer")},close:function(){this.opened=!1,$(document.documentElement).removeClass("b-page_layer"),"function"==typeof this.onclose&&this.onclose()}}},4928:function(e,t){function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Daria.message.Location=function(e){if(!(e instanceof jQuery))throw new Error("Node should be a jQuery object");if(!e.get(0).childNodes)throw new Error("Malformed address node");if(this._$node=e,this._parsed=null,this._highlighted=!1,this._address=e.data("address"),this._addressQuery=e.data("address-query"),!this._address)throw new Error("Passed node should have an address")},Daria.message.Location.prototype.getAddressQuery=function(){return this._addressQuery},Daria.message.Location.prototype._getMapData=function(){return ns.Model.get("map-data",{address:this.getAddressQuery()}).getData()},Daria.message.Location.prototype.findParsedMetadata=function(e){this._parsed=_.find(e,{geo_addr:this._address})},Daria.message.Location.prototype._needsHighlight=function(){return!!this.isKnownAddress()&&(!!this.inUserArea()||(this.hasCity()||this.isUnique()))},Daria.message.Location.prototype._doHighlight=function(){var e=this._$node.get(0),t=_.last(e.childNodes),n=t.textContent.lastIndexOf(" ");-1!==n?$(t.splitText(n+1)).wrap('<span class="mail-Message-Map-NoBreak"></span>').parent().append('<span class="mail-Message-Map-Link-Icon icon"></span>').parent().addClass("js-extracted-highlighted-address mail-Message-Map-Link"):this._$node.append('<span class="mail-Message-Map-Link-Icon icon"></span>').addClass("js-extracted-highlighted-address mail-Message-Map-Link")},Daria.message.Location.prototype.highlight=function(){this._needsHighlight()&&(this._doHighlight(),this._highlighted=!0)},Daria.message.Location.prototype.isHighlighted=function(){return this._highlighted},Daria.message.Location.prototype.isKnownAddress=function(){return Boolean(this._getMapData().addressLocation)},Daria.message.Location.prototype.inUserArea=function(){return this._getMapData().inUserArea},Daria.message.Location.prototype.isUnique=function(){return this.isKnownAddress()&&1===this._getMapData().addressLocation.precision},Daria.message.Location.prototype._checkHasMeta=function(){if("object"!==n(this._parsed))throw new Error("Set parsed address metadata from tomita using location.setParsedMeta()")},Daria.message.Location.prototype.hasCity=function(){return this._checkHasMeta(),Boolean(this._parsed.geo&&this._parsed.geo.city)},Daria.message.Location.prototype.hasStreet=function(){return this._checkHasMeta(),Boolean(this._parsed.addr&&this._parsed.addr.street)}},4929:function(e,t){Daria.VideoPlayer={flashPlayerVersion:swfobject.getFlashPlayerVersion().major,currentSWFOptions:{},currentHostingOptions:{},defaultSWFOptions:{width:425,height:355,flashvars:{}},SWFParams:{allowscriptaccess:"always",allowfullscreen:!0,quality:"high",bgcolor:"#000000"},expressInstallSWFUrl:"http://img.yandex.net/i/expressinstall.swf",hostingOptions:{youtube:{urlAddon:"&amp;enablejsapi=1&amp;playerapiid=ytplayer",pauseMethod:"pauseVideo"}},defaultHostingOptions:{flashPlayerVersion:8},open:function(e){if(!(e=$.extend({},this.defaultSWFOptions,e)).player_url||!e.hosting_name)return!0;var t=this.hostingOptions[e.hosting_name.toLowerCase().split(".")[0]];if(t=$.extend({},this.defaultHostingOptions,t),this.flashPlayerVersion<t.flashPlayerVersion)return!0;this.$popup||this.init(),e.width=parseInt(e.width,10),e.height=parseInt(e.height,10),e.player_url!==this.currentSWFOptions.player_url&&($(".b-movie-player").css({width:e.width+"px",height:e.height+"px"}),e.player_url=e.player_url.replace(/^https?:/,""),swfobject.embedSWF(e.player_url+(t.urlAddon||""),"movie-player",e.width,e.height,String(t.flashPlayerVersion),this.expressInstallSWFUrl,e.flashvars,this.SWFParams),this.currentSWFOptions=e,this.currentHostingOptions=t),this.$paranja.removeClass("g-hidden");var n=$(window),i=n.height(),s=n.scrollTop(),a=e.width+60,o=this.$popup.height(),r=o<i?(i-o)/2:0;this.$popup.css({width:a,"margin-right":-Math.round(a/2),top:s+Math.round(r)}),this.$popup.css("visibility","visible"),$("#movie-player").css("visibility","visible"),$.Shortcuts.modalListOn("video-player")},close:function(){this.$popup.css("visibility","hidden"),$("#movie-player").css("visibility","hidden"),this.$paranja.addClass("g-hidden"),$.Shortcuts.modalListOff();var e=this.currentHostingOptions.pauseMethod;if(e){var t=document.getElementById("movie-player");t[e]instanceof Function&&t[e]()}else swfobject.removeSWF("movie-player"),this.$popup.find(".b-movie-player").html('<div id="movie-player"></div>'),this.currentSWFOptions={},this.currentHostingOptions={}},init:function(){var e=Jane.tt("message:video-player");this.$popup=$(e),this.$popup.css("visibility","hidden").appendTo(document.body),this.$paranja=$('<div class="b-paranja b-paranja_mail"><iframe></iframe></div>').addClass("g-hidden").appendTo(document.body)}}},4930:function(e,t,n){!function(){"use strict";var e=Daria.MessageProcess={};n(4931),n(4932),n(4933),n(4934),e.QUOTES_CHUNK_SIZE=10,e.F_QUOTE={AUTHOR_NEXT:"an",AUTHOR_POSITION_SEARCH:"aps",BUBBLING_CONTENT:"bc",CONCAT:"cq",EXPANDED_ALL:"ea",FOUND_AUTHOR:"fa",LEVEL_FIRST:"lf",LEVEL_LAST:"ll",LEVEL_CENTER:"lc",SEARCH_AUTHOR:"sa",WRAP:"qw",WRAP_SEP:"qws"},e.BODY_PROCESS=null,e.getTopParent=function(t){return e.BODY_PROCESS||t},e.flagContains=function(e,t){return!!t&&(1===e.nodeType&&-1!==(" "+(e.getAttribute("data-processed")||"")+" ").indexOf(" "+t+" "))},e.flagAdd=function(e,t){if(1!==e.nodeType)return!1;var n=Array.prototype.slice.call(arguments);n.shift();var i=e.getAttribute("data-processed");i=i?" "+i+" ":" ";for(var s,a=!1,o=0;s=n[o++];)-1===i.indexOf(" "+s+" ")&&(i+=s+" ",a=!0);return!!a&&(e.setAttribute("data-processed",i.trim()),!0)},e.flagRemove=function(e,t){if(1!==e.nodeType)return!1;var n=Array.prototype.slice.call(arguments);n.shift();var i=e.getAttribute("data-processed");i=i?" "+i+" ":"";for(var s,a=!1,o=0;s=n[o++];)for(;-1!==i.indexOf(" "+s+" ");)i=i.replace(" "+s+" "," "),a=!0;return!!a&&(e.setAttribute("data-processed",i.trim()),!0)},e.getQuotesByLevel=function(t,n){return n?t.querySelectorAll?t.querySelectorAll('blockquote[data-level="'+n+'"]'):(n=Number(n),Array.prototype.filter.call(t.getElementsByTagName("blockquote"),function(t){return e.getQuoteLevel(t)===n})):t.getElementsByTagName("blockquote")},e.getQuoteLevel=function(e){return Number(e.getAttribute("data-level")||0)},e._findQuoteFirstLine=function(t){if(!t.hasChildNodes())return"";var n,i,s=/\n/g,a=0;if(Jane.DOM.eachInnerFollowingText(t,function(e,t){return!Jane.DOM.isBlockquote(e)&&(t=Jane.String.removeNonLetterString(t.trim()),!((i=(i=t.match(s))?i.length:0)!==a&&t.length>100)&&(n=t,void(a=i)))}),!n)return"";var o=!1;if(!(n=n.split("\n").filter(function(e){return!o&&!Jane.String.REG.NONLETTER_STR.test(e)||(o=!0,!1)})).length)return"";for(var r=n.length,u="",l=-1;r--;)u=n[r]+u,e.Author.parseAuthorText(u)&&(l=r);return-1!==l&&(n=n.slice(0,l)),n.length?n=Jane.String.substrWord(n.join(" "),0,200):""},e._removeEmptyNodeCheck=function(e){return!Jane.DOM.isBlockquote(e)&&(-1===["IMG","HR"].indexOf(e.nodeName)&&(!Jane.DOM.hasAttribute(e,"style")&&!Jane.DOM.classContains(e,"icon")))},e._quoteWrapSeparator=function(t){if(!e.flagContains(t,e.F_QUOTE.WRAP_SEP)){e.flagAdd(t,e.F_QUOTE.WRAP_SEP);var n=t.parentNode;Jane.DOM.removeEmptyNodeBefore(t,e._removeEmptyNodeCheck,n),Jane.DOM.removeEmptyNodeAfter(t,e._removeEmptyNodeCheck,n),Jane.DOM.eachBefore(t,function(e){return Jane.DOM.classContains(e,"js-quote-ignore")?"next":!Jane.DOM.isBlockquote(e)&&(!!Jane.DOM.isEmptyText($.text(e))||(Jane.DOM.classAdd(t,"b-quote__t_sep"),!1))},n),Jane.DOM.eachAfter(t,function(e){return Jane.DOM.classContains(e,"js-quote-ignore")?"next":!Jane.DOM.isBlockquote(e)&&(!!Jane.DOM.isEmptyText($.text(e))||(Jane.DOM.classAdd(t,"b-quote__b_sep"),!1))},n)}},e._quoteWrapSeparatorInner=function(e){Jane.DOM.eachInnerPrevious(e,function(t){return 3!==t.nodeType||Jane.DOM.isEmptyTextNode(t)?(!Jane.DOM.isBlockNode(t)||t===e)&&void 0:(Jane.DOM.classAdd(e,"b-quote__cb_sep"),!1)}),Jane.DOM.eachInnerFollowing(e,function(t){return 3!==t.nodeType||Jane.DOM.isEmptyTextNode(t)?(!Jane.DOM.isBlockNode(t)||t===e)&&void 0:(Jane.DOM.classAdd(e,"b-quote__ct_sep"),!1)})},e._bubblingQuoteContentCheckNode=function(e){return!Jane.DOM.hasAttribute(e,"style")},e._bubblingQuoteContent=function(t,n){if(!t.hasChildNodes())return t;for(var i=e.getQuotesByLevel(t,n),s=0,a=i.length;s<a;s++)e.flagContains(i[s],e.F_QUOTE.BUBBLING_CONTENT)||(Jane.DOM.bubblingDivContent(i[s],e._bubblingQuoteContentCheckNode),e.flagAdd(i[s],e.F_QUOTE.BUBBLING_CONTENT));return t},e._concatQuotes=function(t,n){if(!t.hasChildNodes())return t;var i,s,a,o,r=e.getQuotesByLevel(t,n),u=!n;for(a=0,o=r.length;a<o;a++)(i=r[a])&&(s=i.parentNode)&&e._concatChildQuotes(s,u);return t},e._concatChildQuotesIsEmptyNode=function(e){return Jane.DOM.isBr(e)||Jane.DOM.isEmptyTextNode(e)||Jane.DOM.isEmptyPreNode(e)},e._concatChildQuotes=function(t,n){for(var i,s,a,o,r,u,l=[t],d=[],c=t.ownerDocument.createElement("br");o=l.shift();)if(o.hasChildNodes()&&!e.flagContains(o,e.F_QUOTE.CONCAT)){for(s=o.firstChild,a=Jane.DOM.isBlockquote(s)?s:null;i=s.nextSibling;){if(Jane.DOM.isBlockquote(i)){if(a){if(d.length){for(u=!0,r=0;r<d.length;r++)u&&!Jane.DOM.isEmptyTextNode(d[r])&&(u=!1),a.appendChild(d[r]);d=[],u&&a.appendChild(c.cloneNode(!1))}else a.lastChild&&i.firstChild&&!Jane.DOM.isNewlineNode(a.lastChild)&&!Jane.DOM.isNewlineNode(i.firstChild)&&a.appendChild(c.cloneNode(!1));for(;i.firstChild;)a.appendChild(i.firstChild);s=i.previousSibling,i.parentNode.removeChild(i),n&&-1===l.indexOf(a)&&e.getQuotesByLevel(a).length>0&&l.push(a);continue}a=i}else a&&e._concatChildQuotesIsEmptyNode(i)?d.push(i):(d=[],a=null,n&&Jane.DOM.isBlockNode(s)&&-1===l.indexOf(s)&&e.getQuotesByLevel(s).length>0&&l.push(s));s=i}e.flagAdd(o,e.F_QUOTE.CONCAT)}return c=null,t},e.fixQuotesSync=function(t,n,i){e._bubblingQuoteContent(t,n),e._concatQuotes(t,n),e.Author.findAndRemoveQuoteAuthorSync(t,n,i)},e.fixQuotes=function(t,n,i){e._bubblingQuoteContent(t,n),e._concatQuotes(t,n),e.Author.findAndRemoveQuoteAuthor(t,n,i)},e.wrapQuote=function(t,n){if(e.flagContains(t,e.F_QUOTE.WRAP))return!1;e.flagAdd(t,e.F_QUOTE.WRAP),n=n||{};var i=e.Author.getQuoteAuthor(t);e.Author.removeQuoteAuthorData(t);var s=e._findQuoteFirstLine(t);e._quoteWrapSeparator(t),e._quoteWrapSeparatorInner(t);var a=t.cloneNode(!0);e._expandSmallQuotes(a);var o=$(a);o.wrapInner('<div class="b-quote_content js-quote_content"/>');var r=o.find("> .b-quote_content");r.contents().wrapAll('<div class="b-quote__i js-quote-content"/>'),r.prepend(Jane.tt("message:js-message-body-quote-ctrls",{ids:n.ids})),s&&r.prepend(Jane.tt("message:js-message-body-quote-firstline",{firstline:s})),i&&(i.mid=n.ids,r.prepend(Jane.tt("message:js-message-body-quote-author",i)));var u=$(Jane.tt("message:js-message-body-quote-toggler"));return r.after(u),t.parentNode.replaceChild(a,t),e.flagContains(a,e.F_QUOTE.EXPANDED_ALL)&&(e.flagRemove(a,e.F_QUOTE.EXPANDED_ALL),e.wrapQuotesSync(a,!1,function(e){Jane.DOM.classAdd(e,"b-quote_expanded")},n),Jane.DOM.classAdd(a,"b-quote_expanded")),!0},e.wrapQuotesSync=function(t,n,i,s,a){i=i||$.noop,e.fixQuotesSync(t,n,a);for(var o=e.getQuotesByLevel(t,n),r=0,u=o.length;r<u;r++)e.wrapQuote(o[r],s),i(o[r])},e.wrapQuotes=function(t,n,i){var s=$({});s.queue(function(n){e.fixQuotes(t,null,n)}),s.queue(function(n){var s=e.getQuotesByLevel(t),a=Math.ceil(s.length/e.QUOTES_CHUNK_SIZE),o=a;if(a)for(var r=0;r<a;r++)Promise.resolve().then(u(r));else n();function u(t){return function(){for(var a=t*e.QUOTES_CHUNK_SIZE,r=0;r<e.QUOTES_CHUNK_SIZE;r++){var u=s[a+r];u&&e.wrapQuote(u,i)}0===--o&&n()}}}),s.queue(n)},e.quoteExpandToggle=function(t,n,i,s){var a=Jane.DOM.classContains(t,"b-quote_expanded"),o=void 0===n;if(!1===n||o&&a)Jane.DOM.classRemove(t,"b-quote_expanded");else if(!0===n||o&&!a){var r=e.getQuoteLevel(t)+1;e.wrapQuotesSync(t,r,null,i,s),Jane.DOM.classAdd(t,"b-quote_expanded")}},e.quoteExpandAll=function(t,n,i){n=n||$.noop;var s=$(t).closest(".b-quote_lt").get(0);e.wrapQuotes(s,function(){n();for(var i=e.getQuotesByLevel(s),a=i.length;a--;)i[a]&&Jane.DOM.classAdd(i[a],"b-quote_expanded");s===t&&Jane.DOM.classAdd(s,"b-quote_expanded")},i)},e.processBody=function(t,n){var i,s,a,o,r=document.createElement("div");e.BODY_PROCESS=r;try{for(i=0,s=e.BODY_TRANSFORMERS.regs.length;i<s;i++)(o=(a=e.BODY_TRANSFORMERS.regs[i])[2])&&!o(n.ids)||(t=t.replace(a[0],a[1]));for(r.innerHTML=t,i=0,s=e.BODY_TRANSFORMERS.dom.length;i<s;i++)(a=e.BODY_TRANSFORMERS.dom[i])(r,n)}catch(e){Jane.ErrorLog.sendException("PROCESS_BODY_ERROR",e)}return e.BODY_PROCESS=null,r},e.initQuotesByPage=function(t){$(".js-quote-mini > * > .js-quote-content",t).each(function(){if(!(this.offsetHeight<160)){var t=this.parentNode.parentNode,n=!1;e.flagContains(t,e.F_QUOTE.LEVEL_LAST)?(n=!0,e.quoteExpandToggle(t,!1)):e.flagContains(t,e.F_QUOTE.LEVEL_FIRST)?Jane.DOM.classAdd(t,"b-quote_minimized","b-quote_minimized_first"):Jane.DOM.classAdd(t,"b-quote_minimized","b-quote_minimized_center"),n||setTimeout(function(){this.scrollTop=this.scrollHeight}.bind(this),50)}})},e._expandSmallQuotes=function(t){Jane.DOM.classContains(t,"b-quote_expanded")||$.text(t).length>200||e.getQuotesByLevel(t).length||Jane.DOM.classAdd(t,"b-quote_expanded")}}()},4931:function(e,t){!function(){"use strict";Daria.MessageProcess.Actions={},Daria.MessageProcess.Actions.quoteExpand=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).isRoot,n=$(e.target);if(n.closest("a,.js-quote-control-expand").length)return!0;var i=n.data(),s=n.closest(".b-quote").get(0);return Daria.MessageProcess.quoteExpandToggle(s,!0,i,this.node),t||Jane.c("Message view","Quote expand"),!0},Daria.MessageProcess.Actions.quoteExpandAll=function(e){var t=$(e.currentTarget),n=t.closest(".b-quote"),i=t.data();return n.addClass("b-quote_loading"),t.removeClass("ns-action"),Daria.MessageProcess.quoteExpandAll(n[0],function(){n.removeClass("b-quote_loading"),t.addClass("ns-action")},i),Jane.c("Message view","Quote expand all"),!0},Daria.MessageProcess.Actions.quoteExpandToggle=function(e){var t=$(e.currentTarget).closest(".b-quote").get(0),n=!t.classList.contains("b-quote_expanded");return Daria.MessageProcess.quoteExpandToggle(t),Jane.c("Message view","Quote toggler ".concat(n?"expand":"collapse")),!0},Daria.MessageProcess.Actions.quoteMaximize=function(e){$(e.currentTarget).closest(".b-quote").removeClass("b-quote_minimized b-quote_minimized_first b-quote_minimized_center b-quote_minimized_last"),Jane.c("Message view","Quote maximize")},Daria.MessageProcess.Actions.toggleQuote=function(e){this.quoteExpand(e,{isRoot:!0});var t=$(e.target);t.prev(".js-quote_content").removeClass("is-hidden"),t.addClass("is-hidden"),Jane.c("Message view","Show conversation")}}()},4932:function(e,t){!function(e){var t=e.Author={};function n(e){var t=e.nameGroup,n=e.emailGroup;return function(e){var i={weight:0},s=t&&e[t]?e[t].trim():null;s&&"*"!==s&&"."!==s&&(i.name=s,i.weight+=30);var a=n&&e[n]?Jane.FormValidation.getEmailFromString(e[n].trim()):null;return a&&(i.email=a,i.weight+=30),e[3]&&(i.weight+=5),i}}t.AUTHOR_CHUNK_SIZE=10,t.REG_AUTHOR_PART_CONTEXT=/^(?:\)?>)\s?(?:wrote|пишет|пише|піша|написав|напісаў|yazdı|yazıyor|написал(?:\(а\)))?\s?:/,t.PARSE_AUTHOR_FORMATS=[["?prefix","namefirst","?date","?time"],["?prefix","?time","?date","?time","namelast"]],t.PARSE_AUTHOR_PARTS={prefix:[[/^Sent from my (?:iPad|iPhone|iPod)/i,function(){return{weight:5}}]],date:[[/^(?:on\s)?(\d\d)\/(\d\d)\/(\d\d(?:\d\d)?)\s(?:at\s)?(\d{1,2}:\d\d(?::\d\d)?\s?(?:am|pm))/i,function(e){var t=Number(e[3]);t<100&&(t=2e3+t);var n=Date.UTC(t,Number(e[1])-1,Number(e[2]));return{weight:5,datetime:{date:e[2]+"."+e[1]+"."+e[3],ts:n,time:e[4]}}}],[/^\[?(?:on\s)?(\d\d)[\.\/\-](\d\d)[\.\/\-](\d\d(?:\d\d)?)\]?/i,function(e){var t=Number(e[3]);t<100&&(t=2e3+t);var n=Date.UTC(t,Number(e[2])-1,Number(e[1]));return{weight:5,datetime:{date:e[1]+"."+e[2]+"."+e[3],ts:!isNaN(n)&&n}}}],[/^\[?(?:on\s)?(\d{4})[\/\.\-](\d{2})[\/\.\-](\d{2})\]?/i,function(e){var t=Date.UTC(Number(e[1]),Number(e[2])-1,Number(e[3]));return{weight:5,datetime:{date:e[3]+"."+e[2]+"."+e[1],ts:!isNaN(t)&&t}}}],[/^\[?(?:on\s)?[^\s\d]*?\s?(\d{1,2})\s([^\s\d]+?)\s(\d{4})(?:\sг.)?\]?/i,function(e){var t,n=Jane.Date.getMonthByName(e[2]);return-1!==n&&(t=Date.UTC(Number(e[3]),n,Number(e[1]))),{weight:5,datetime:{date:e[1]+" "+e[2]+" "+e[3],ts:!(!t||isNaN(t))&&t}}}],[/^\[?(?:on\s)?[^\s\d]*?\s?([^\s\d]+?)\s(\d{1,2})\s(\d{4})(?:\sг.)?\]?/i,function(e){var t,n=Jane.Date.getMonthByName(e[1]);return-1!==n&&(t=Date.UTC(Number(e[3]),n,Number(e[2]))),{weight:5,datetime:{date:e[1]+" "+e[2]+" "+e[3],ts:!(!t||isNaN(t))&&t}}}],[/^\[?(?:on\s)?([^\s\d]+?)\s(\d{1,2})\s(\d{4})(?:\sг.)?\]?/i,function(e){var t,n=Jane.Date.getMonthByName(e[1]);return-1!==n&&(t=Date.UTC(Number(e[3]),n,Number(e[2]))),{weight:5,datetime:{date:e[1]+" "+e[2]+" "+e[3],ts:!(!t||isNaN(t))&&t}}}]],time:[[/^\[?(?:at\s|в\s)?(\d{1,2}:\d\d(?::\d\d)?\s?(?:am|pm)?\s?(?:(?:[A-Z]{3})?[+-]\d\d:?(?:\d\d)?)?)\]?/i,function(e){return{weight:5,datetime:{time:$.trim(e[1])}}}]],namefirst:[[/^\*\s(?:от\s|пользователь\s)?(?:"|\\")?([^"\\\[\]<>]*)(?:"|\\")?\s?(?:<([^<>]+)>)?/i,function(e){var t={weight:0},n=$.trim(e[1]);n&&(t.name=n,t.weight=t.weight+30);var i=Jane.FormValidation.getEmailFromString($.trim(e[2]));return i&&(t.email=i,t.weight=t.weight+30),t}]],namelast:[[/^(?:от\s|пользователь\s|from\s|user\s|ад\s|від\s|карыстальнік\s|користувач\s|kullanıcı\s)(?:"|\\")?([^\:]*?)(?:"|\\")?\s?(?:<([^<>]+)>)?(?:\s?"?:)?$/i,n({nameGroup:1,emailGroup:2})],[/^(?:"|\\")?([^\:\n]*?)(?:"|\\")?\s?(?:<([^<>]+)>)?\s?(wrote|пишет|пише|піша|написав|напісаў|yazdı|yazıyor|написал(?:\(а\))?)(?:\s?"?:)?$/i,n({nameGroup:1,emailGroup:2})],[/^(?:"|\\")?([^\:]*?)(?:"|\\")?\s?(?:<([^<>]+)>)(?:\s?"?:)?$/i,n({nameGroup:1,emailGroup:2})],[/^(?:"|\\")(?:<([^<>]+)>)(?:"|\\"):$/i,n({nameGroup:1,emailGroup:1})]]},t.getQuoteAuthor=function(e){var t=e.getAttribute("data-author");if(!t)return null;try{(t=JSON.parse(decodeURIComponent(t))).email&&(t.href=Daria.message.getLinkStaffByEmail(t.email))}catch(e){return null}return t},t.removeQuoteAuthorData=function(e){e.removeAttribute("data-author")},t.parseAuthorText=function(e){e=e.replace(/,/g," ").replace(/[^\S\n]+/g," ").trim();for(var n,i,s,a,o,r,u,l,d,c,h,g,f=t.PARSE_AUTHOR_FORMATS,m=t.PARSE_AUTHOR_PARTS,p=0;n=f[p++];){for(s=0,c=0,h={},g=e;i=n[s++];){for((a="?"!==i.charAt(0))||(i=i.substr(1)),d=null,l=null,o=m[i],u=0;r=o[u++];)if(l=g.match(r[0])){d=r[1](l);break}if(d)c+=d.weight,$.extend(!0,h,d);else if(a)break;l&&l[0]&&(g=g.substr(l[0].length).trim())}if(c>30)break}return h.weight=c,h.weight>30?h:null},t.findAndRemoveQuoteAuthorSync=function(e,n,i){for(var s,a=t._getQuotesAuthorNotProcessed(e,n),o=0;s=a[o++];)t._findAndRemoveQuoteAuthor(s);t._compareQuoteAuthorPosition(n,i)},t.findAndRemoveQuoteAuthor=function(e,n,i){i=i||$.noop;var s=t._getQuotesAuthorNotProcessed(e,n),a=s.length,o=Math.ceil(a/t.AUTHOR_CHUNK_SIZE),r=o;if(o)for(var u=0;u<o;u++)Promise.resolve().then(l(u));else i();function l(e){return function(){for(var a,o=e*t.AUTHOR_CHUNK_SIZE,u=0;u<t.AUTHOR_CHUNK_SIZE;u++)(a=s[o+u])&&t._findAndRemoveQuoteAuthor(a);0===--r&&(t._compareQuoteAuthorPosition(n),i())}}},t._findQuoteAuthorContentCheck=function(e,n,i,s){if(Jane.DOM.isBlockquote(e))return!1;var a=Jane.DOM.isBlockNode(e);if(i.author&&a)return!1;if(s&&!i.author&&a&&(i.firstBlockNode=!0),3!==e.nodeType)return!0;var o=Jane.String.countLines(n);if(o>4)return!1;if(o!==Jane.String.countActualLines(n))return!1;!i.firstNode&&n.length>0&&(i.firstNode=e);var r=t.parseAuthorText(n);if(r){if(i.author&&i.author.weight>r.weight)return!1;i.authorStr=n,i.author=r,i.lastNode=e,delete i.firstBlockNode}else{if(i.firstBlockNode)return!1;if(s&&!i.author&&i.tmpNode&&e.nodeValue){var u=e.nodeValue.match(t.REG_AUTHOR_PART_CONTEXT);if(u){var l=u[0];if(n=i.authorStr+l,r=t.parseAuthorText(n))return i.author=r,i.tmpNode&&(i.lastNode=i.tmpNode,delete i.tmpNode),")"===l[0]&&(i.lastNode.nodeValue+=")"),e.nodeValue=e.nodeValue.substr(l.length),!1}}i.tmpNode=e,i.authorStr=n}return!0},t._findQuoteAuthorCreateRange=function(e,t){var n;try{n=document.createRange(),e===t?n.selectNode(e):(n.setStartBefore(e),n.setEndAfter(t))}catch(i){n=[e,t]}return n},t._findQuoteAuthorInner=function(e){var n={};if(Jane.DOM.eachInnerFollowingText(e,function(e,i){return t._findQuoteAuthorContentCheck(e,Jane.String.ltrim(i),n,!0)}),!n.author||!n.lastNode||!n.firstNode)return null;var i=!1;return Jane.DOM.eachAfter(n.lastNode,function(e){return 3!==e.nodeType||Jane.DOM.isEmptyTextNode(e)?!Jane.DOM.isBlockquote(e)&&void 0:(i=!0,!1)},e),i?{range:t._findQuoteAuthorCreateRange(n.firstNode,n.lastNode),author:n.author}:null},t._findQuoteAuthor=function(e){var n={};return Jane.DOM.eachBeforeText(e,function(e,i){return t._findQuoteAuthorContentCheck(e,Jane.String.rtrim(i),n,!1)},e.parentNode),n.author&&n.lastNode&&n.firstNode?{range:t._findQuoteAuthorCreateRange(n.lastNode,n.firstNode),author:n.author}:null},t.__findAndRemoveQuoteAuthor=function(e){var n=t._findQuoteAuthor(e)||t._findQuoteAuthorInner(e);return n?(Array.isArray(n.range)?Jane.DOM.deleteRangeContents(n.range[0],n.range[1]):(n.range.deleteContents(),n.range.detach()),n.author):null},t._findAndRemoveQuoteAuthor=function(n){e.flagAdd(n,e.F_QUOTE.SEARCH_AUTHOR);var i=t.__findAndRemoveQuoteAuthor(n);return!!i&&(Jane.DOM.classAdd(n,"b-quote_a"),e.flagAdd(n,e.F_QUOTE.FOUND_AUTHOR),n.setAttribute("data-author",encodeURIComponent(JSON.stringify(i))),!0)},t.__getQuotesAuthorNotProcessed=function(t){return!e.flagContains(t,e.F_QUOTE.SEARCH_AUTHOR)},t._getQuotesAuthorNotProcessed=function(n,i){return Array.prototype.filter.call(e.getQuotesByLevel(n,i),t.__getQuotesAuthorNotProcessed)},t._compareQuoteAuthorPosition=function(t,n){var i=e.getTopParent(n);if(i)for(var s,a,o=e.getQuotesByLevel(i,t),r={},u=0;s=o[u++];)e.flagContains(s,e.F_QUOTE.AUTHOR_POSITION_SEARCH)||(r[a=e.getQuoteLevel(s)]?(Jane.DOM.classAdd(s,"b-quote_an"),e.flagAdd(s,e.F_QUOTE.AUTHOR_NEXT,e.F_QUOTE.AUTHOR_POSITION_SEARCH)):(e.flagContains(s,e.F_QUOTE.FOUND_AUTHOR)&&(r[a]=!0),e.flagAdd(s,e.F_QUOTE.AUTHOR_POSITION_SEARCH)))}}(Daria.MessageProcess)},4933:function(e,t){!function(){var e="message-body.transformers.location-facts",t=/\s/g,n={traverse:function(t,n,i){Daria.assert(t instanceof Node,"Top node should be an instance of Node",e),Daria.assert("function"==typeof n,"Criterion should be a function",e),Daria.assert("function"==typeof i,"Action should be a function",e),function e(t,n,i){n(t)&&(i(t),t.childNodes.length>0&&(t.normalize(),_.forEach(t.childNodes,function(t){e(t,n,i)})))}.apply(null,arguments)},contains:function(t,n,i){return Daria.assert(t instanceof Node&&n instanceof Node&&i instanceof Node,"All arguments should be nodes",e),function e(t,n,i){return n===t||null!==n.parentNode&&n!==i&&e(t,n.parentNode,i)}(t,n,i)},getSmallestContainingNodes:function(t,i){Daria.assert(t instanceof Node,"TopNode should be a Node",e),Daria.assert(i instanceof RegExp,"Regexp should be a RegExp",e);var s=[],a=function(e){var t=i.test(e);return i.lastIndex=0,t};return n.traverse(t,function(e){return a(e.textContent)},function(e){s.push(e)}),_.filter(s,function(e){return 0===e.childNodes.length||!s.some(function(i){return!(i===e||!n.contains(e,i,t))&&!a(e.textContent.replace(i.textContent))})})}},i=function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},s=function(e,t,n){this._char=e,this._position=t,this._node=n};s.prototype={getChar:function(){return this._char},getPosition:function(){return this._position},getNode:function(){return this._node}};var a=function(){this._stack=[]};a.prototype={push:function(e){this._stack.push(e)},getStart:function(){return this._stack[0]},getEnd:function(){return this._stack[this._stack.length-1]},getSize:function(){return this._stack.length},isEmpty:function(){return 0===this.getSize()},shift:function(){this._stack.shift()},pop:function(){this._stack.pop()},toString:function(){return _.map(this._stack,function(e){return e.getChar()?e.getChar():e.getNode().toString()}).join("")}};var o=function(e){this._fact=e,this._parsedAddress=e.geo_addr,this._addressQuery=e.geocoder_request||e.geo_addr,this._reset()};o.prototype={_reset:function(){this._parts=[],this._parsedPosition=0,this._matched=!1,this._prevsiousChar=""},getCurrentPart:function(){return 0===this._parts.length&&this.addPart(),this._parts[this._parts.length-1]},addPart:function(){this._parts.push(new a)},getExpectedChar:function(){return this._parsedAddress.charAt(this._parsedPosition)},shiftExpectedChar:function(){return this._parsedPosition++,this.getExpectedChar()},isSkippableNode:function(e){return 0===e.childNodes.length&&["br","wbr"].indexOf(e.nodeName.toLowerCase())>-1},spaceRe:/\s/,match:function(e){var t=this.getCurrentPart().isEmpty(),n=!1;if(t?this._previousSymbol&&(n=e.getNode()!==this._previousSymbol.getNode()):n=e.getNode()!==this.getCurrentPart().getEnd().getNode(),e.getChar()===this.getExpectedChar())!n||t||this.isSkippableNode(this.getCurrentPart().getEnd().getNode())||this.addPart(),this.getCurrentPart().push(e),this.shiftExpectedChar(),this._previousSymbol=e;else if(this.anyMatched()&&this.isSkippableNode(e.getNode()))this.getCurrentPart().push(e);else if(this.spaceRe.test(e.getChar())){if(" "!==this.getExpectedChar())return;this.getCurrentPart().push(e),this.shiftExpectedChar()}else" "===this.getExpectedChar()?(this.shiftExpectedChar(),this.match(e)):n&&!e.getChar()?this.addPart():1===this.numMatched()&&this._previousSymbol.getChar()&&e.getChar()===this._previousSymbol.getChar()?(this._reset(),this.match(e)):this._reset();this._matched=this.numMatched()===this._parsedAddress.length},anyMatched:function(){return this.numMatched()>0},numMatched:function(){return this._parsedPosition},matches:function(){return this._matched},getAnchor:function(){var e=this._fact.addr,t=null;return["street","quarter","km","metro","numbers"].some(function(n){return n in e&&(t=e[n].toLowerCase(),!0)}),t},partToRange:function(e){if(this.normalizePart(e),e.isEmpty())return null;var t=document.createRange();return t.setStart(e.getStart().getNode(),e.getStart().getPosition()),t.setEnd(e.getEnd().getNode(),e.getEnd().getPosition()+1),t},normalizePart:function(e){for(;!e.isEmpty()&&(u.test(e.getStart().getChar())||this.isSkippableNode(e.getStart().getNode()));)e.shift();for(;!e.isEmpty()&&(l.test(e.getEnd().getChar())||this.isSkippableNode(e.getEnd().getNode()));)e.pop()},selectPart:function(){if(this._parts.forEach(function(e){this.normalizePart(e)},this),this._parts=this._parts.filter(function(e){return!e.isEmpty()}),1===this._parts.length)return this.getCurrentPart();var e,t=this.getAnchor();return t&&this._parts.some(function(n){var i=this.partToRange(n);return!!(i&&i.toString().toLowerCase().indexOf(t)>-1)&&(e=n,!0)},this)?e:_.max(this._parts,function(e){return e.toString().length})},wrap:function(e){var t=this.partToRange(this.selectPart());if(t&&0===$(t.commonAncestorContainer).closest("a, .js-extracted-address").size()){var n=document.createElement("span");n.setAttribute("class","js-extracted-address"),n.setAttribute("data-address",this._parsedAddress),n.setAttribute("data-address-query",this._addressQuery),n.setAttribute("data-ids",e);var i=t.extractContents();t.insertNode(n),n.appendChild(i),t.commonAncestorContainer.normalize()}}};var r=function(e,t){this._topNode=e,this._addressFact=t,this._currentNode=null,this._currentPositionInsideNode=-1,this._nodesQueue=[],this.buildQueue()};r.prototype={start:function(e){for(var t,n=this.getNewAddress(),i=[];t=this.shiftSymbol();)n.match(t),n.matches()&&(i.push(n),n=this.getNewAddress());i.reverse().forEach(function(t){t.wrap(e)})},getNewAddress:function(){return new o(this._addressFact)},_getCharAtPosition:function(e,t){return 3===e.nodeType&&t<e.textContent.length?new s(e.textContent.charAt(t),t,e):null},shiftSymbol:function(){var e=this.getCurrentNode();this._currentPositionInsideNode+=1;var t=this._getCharAtPosition(e,this._currentPositionInsideNode);return t||((e=this.shiftNode())?(this._currentPositionInsideNode=0,(t=this._getCharAtPosition(e,this._currentPositionInsideNode))||(n.contains(this._topNode,e,this._topNode)?new s(null,this._currentPositionInsideNode,e):null)):null)},getCurrentNode:function(){return this._currentNode||this.shiftNode()},shiftNode:function(){if(!this._currentNode)return this._currentNode=this._nodesQueue[0],this._currentNode;var e=this._nodesQueue.indexOf(this._currentNode);return this._nodesQueue.length>e?(this._currentNode=this._nodesQueue[e+1],this._currentNode):null},buildQueue:function(){var e=this._nodesQueue;3===this._topNode.nodeType?e.push(this._topNode):n.traverse(this._topNode,function(){return!0},function(t){e.push(t)})}};var u=/^[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\d\u0022\u0027\u00AB\u00BB\u2018\u2019\u201A\u201B\u201C\u201D\u201E\u201F\u2039\u203A\u300C\u300D\u300E\u300F\u301D\u301E\u301F\uFE41\uFE42\uFE43\uFE44\uFF02\uFF07\uFF62\uFF63\u0028\u0029\u005B\u005D\u2045\u2046\u003C\u003E\u007B\u007D\u00AB\u00BB\u2039\u203A\u2308\u2309\u230A\u230B\u231C\u231D\u231E\u231F\u239B\u239C\u239D\u239E\u239F\u23A0\u23A1\u23A2\u23A3\u23A4\u23A5\u23A6\u23A7\u23A8\u23A9\u23AB\u23AC\u23AD\u23AA\u23B0\u23B1\u27E6\u27E7\u27E8\u27E9\u27EA\u27EB\u27EC\u27ED\u27EE\u27EF\u2983\u2984\u2985\u2986\u2987\u2988\u2989\u298A\u298B\u298C\u298D\u298E\u298F\u2990\u2991\u2992\u2993\u2994\u2995\u2996\u2997\u2998\u2E22\u2E23\u2E24\u2E25\u2329\u232A\uFF62\uFF63\u3008\u3009\u300A\u300B\u300C\u300D\u300E\u300F\u3010\u3011\uFF08\uFF09\uFF3B\uFF3D\uFF1C\uFF1E\uFF5B\uFF5D]+/,l=/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\d\u0022\u0027\u00AB\u00BB\u2018\u2019\u201A\u201B\u201C\u201D\u201E\u201F\u2039\u203A\u300C\u300D\u300E\u300F\u301D\u301E\u301F\uFE41\uFE42\uFE43\uFE44\uFF02\uFF07\uFF62\uFF63\u0028\u0029\u005B\u005D\u2045\u2046\u003C\u003E\u007B\u007D\u00AB\u00BB\u2039\u203A\u2308\u2309\u230A\u230B\u231C\u231D\u231E\u231F\u239B\u239C\u239D\u239E\u239F\u23A0\u23A1\u23A2\u23A3\u23A4\u23A5\u23A6\u23A7\u23A8\u23A9\u23AB\u23AC\u23AD\u23AA\u23B0\u23B1\u27E6\u27E7\u27E8\u27E9\u27EA\u27EB\u27EC\u27ED\u27EE\u27EF\u2983\u2984\u2985\u2986\u2987\u2988\u2989\u298A\u298B\u298C\u298D\u298E\u298F\u2990\u2991\u2992\u2993\u2994\u2995\u2996\u2997\u2998\u2E22\u2E23\u2E24\u2E25\u2329\u232A\uFF62\uFF63\u3008\u3009\u300A\u300B\u300C\u300D\u300E\u300F\u3010\u3011\uFF08\uFF09\uFF3B\uFF3D\uFF1C\uFF1E\uFF5B\uFF5D\.,?!]+$/,d=function(e){return e.replace(u,"").replace(l,"")};Daria.Transformers||(Daria.Transformers={}),Daria.Transformers.AddressTransformer=_.extend(function(e,s){var a=ns.Model.get("message-body",{ids:s.ids}).getLocations();a=_.uniq(a,function(e){return e.geo_addr}),_.forEach(a,function(e){e.geo_addr=d(e.geo_addr)}),_.sortBy(a,function(e){return-e.geo_addr.length}),_.forEach(a,function(a){var o=new RegExp(i(a.geo_addr).replace(t,"\\s*"),"g");n.getSmallestContainingNodes(e,o).forEach(function(e){new r(e,a).start(s.ids)})})},{transformerName:"location-facts",debugMode:e,trimPunctuation:d,escapeRegExp:i,Nodes:n,Symbol:s,Stack:a,Address:o,Parser:r})}()},4934:function(e,t,n){!function(e){var t=n(736),i=n(4935),s=n(4936),a=n(4937).default,o="/re.jsx?uid="+Daria.uid+"&c=LIZA&cv="+Daria.Config.version+"&",r='<a href="{url}" target="_blank" rel="noopener noreferrer" class="ns-action"data-click-action="message.video-player-open" data-params="{params}"><img src="'+i+'" class="b-mail-icon b-mail-icon_video-link" alt="" title="'+i18n("%Message_Video_Link")+'"/></a><a href="{url}" target="_blank" rel="noopener noreferrer">{url}</a>',u="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2018\\u2019\\u201c\\u201d \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000";function l(e){var t=e.style.backgroundImage&&-1!==e.style.backgroundImage.indexOf("url("),n=e.getAttribute("background");!t&&n&&(e.style.backgroundImage='url("'+n+'")'),e.removeAttribute("background")}e.REG_ATTACHMENTS_STOP_WORDS=new RegExp("(^|.*?["+u+"]+)("+s.join("|")+")($|["+u+"]+)","im"),e.REG_ATTACHMENTS_STOP_WORDS_LIGHT=new RegExp("("+s.join("|")+")","im"),e._checkParentAttachmentsSelect=function(e){var t=e.tagName;return"A"!==t&&"BLOCKQUOTE"!==t},e.attachmentsSelect=function(t){for(var n,i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,function(n){return e.REG_ATTACHMENTS_STOP_WORDS_LIGHT.test(n.data)&&e.REG_ATTACHMENTS_STOP_WORDS.test(n.data)&&Jane.DOM.passByParents(n,e._checkParentAttachmentsSelect,t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1),s=[];n=i.nextNode();)s.push(n);var a,o,r,u,l,d=document.createElement("span");d.className="b-pseudo-link b-pseudo-link_attach js-attachments-scroll";for(var c=0;(n=s.shift())&&(!(o=n.data.match(e.REG_ATTACHMENTS_STOP_WORDS))||(r=o.index+o[1].length)>=(u=r+o[2].length)||((a=document.createRange()).setStart(n,r),a.setEnd(n,u),a.surroundContents(d.cloneNode(!0)),a.detach(),(l=n.nextSibling&&n.nextSibling.nextSibling)&&l.nodeType===Node.TEXT_NODE&&l.data.length>0&&s.unshift(l),c++,Jane.c("Аттачи в тексте письма","Показ ссылки"),!(c>4))););c&&Jane.c("Аттачи в тексте письма","Количество открытий писем с подсвеченными ссылками")},e.BODY_TRANSFORMERS={regs:[[/(<img\s[^>]*?)src="([^"]*?)"(.*?\/?>)/gm,function(e,t,n,i){return t+'data-fake-img-src="'+n+'"'+i}]],dom:[Daria.Transformers.AddressTransformer,function(e){for(var t=$(e).find("*[background]"),n=t.length;n--;){l(t[n])}l(e)},function(e,t){for(var n=ns.Model.get("message-body",t).getData(),i=n["is-spam"],s=t.forceShowHrefs,a=n["is-support"],r=!1,u=e.getElementsByTagName("a"),l=u.length,d=o+"mid="+t.ids+"&";l--;){var c=u[l],h=c.getAttribute("href");if(h&&-1!==h.indexOf("/re.jsx?")){var g=h.slice(h.indexOf("&l=")+3);g&&(g=Daria.base64UrlDecode(g),c.setAttribute("data-vdir-href",h.replace("/re.jsx?",d)),c.setAttribute("data-orig-href",g),c.setAttribute("href",g))}if(h&&0===h.indexOf("mailto:")){var f=h.substr(7).split("?"),m=f.shift(),p=ns.parseQuery(f.shift()||""),_=Daria.lowerifyObjectKeys(p);_.mailto=m,Jane.DOM.classAdd(c,"ns-action"),c.setAttribute("data-click-action","common.go"),c.setAttribute("data-params","new_window&url="+encodeURIComponent(ns.router.generateUrl("compose2",_)))}else s||!i||a?(r=!0,Jane.DOM.classAdd(c,"daria-goto-anchor"),c.setAttribute("target","_blank"),c.setAttribute("rel","noopener noreferrer")):(r=!0,c.setAttribute("h_href",c.getAttribute("href")),c.removeAttribute("href"),Jane.DOM.classAdd(c,"ya-hidden-link"))}n["has-links"]=r},a,function(e,n){for(var i=n.forceShowImages,s=ns.Model.get("message-body",n).getData(),a=!1,o=s["hide-imgs"],r=s["has-links"],u=e.getElementsByTagName("img"),l=u.length;l--;){var d=u[l];if(a=!0,o&&!i){for(var c=d.attributes,h=document.createElement("img"),g=0,f=c.length;g<f;g++){var m=c[g],p=m.nodeName,_=m.nodeValue;"data-fake-img-src"===p?h.setAttribute("h_src",_):h.setAttribute("h_"+p,_)}h.setAttribute("src",t),h.setAttribute("class","ya-hidden-image"+(r?" ya-without-notice":"")),d.parentNode.replaceChild(h,d)}else{var b=d.getAttribute("data-fake-img-src");null!==b&&(d.removeAttribute("data-fake-img-src"),d.setAttribute("src",b))}}s["has-img"]=a},function(e){var t=e.getElementsByTagName("object"),n=t.length;if(!n)return e;var i=document.createElement("param");for(i.setAttribute("name","wmode"),i.setAttribute("value","opaque");n--;)t[n].appendChild(i.cloneNode(!1));i=null},function(e){for(var t=e.getElementsByTagName("embed"),n=t.length;n--;)t[n].setAttribute("wmode","opaque")},function(e){for(var t,n=e.getElementsByTagName("form"),i=n.length;i--;)(t=n[i]).className+=" js-message-form",t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer"),t.removeAttribute("formaction")},function(e){for(var t=e.getElementsByTagName("area"),n=t.length;n--;)t[n].setAttribute("target","_blank"),t[n].setAttribute("rel","noopener noreferrer")},function(e){$("span.wmi-video-link",e).each(function(){var e=$(this);e.replaceWith(Daria.supplant(r,{url:e.text(),params:this.getAttribute("params")}))})},function(t){for(var n,i,s=e.getQuotesByLevel(t),a=s.length,o=0,r={};o<a;o++){for(var u=n=s[o],l=0;u=u.parentNode;)if(Jane.DOM.isBlockquote(u)){l=e.getQuoteLevel(u);break}var d=l+1,c=(r[d]||0)+1;n.setAttribute("type","cite"),n.setAttribute("data-level",String(d)),n.removeAttribute("style"),i="b-quote",0===l&&(i+=" b-quote_lt"),i+=d%2?" b-quote_odd":" b-quote_even",n.className=i,r[d]=c}},function(t){e.fixQuotesSync(t,1)},function(t){for(var n,i,s=e.getQuotesByLevel(t),a=s.length,o=0,r={};o<a;o++)n=s[o],r[i=e.getQuoteLevel(n)]?(Jane.DOM.classAdd(n,"b-quote_lc"),e.flagAdd(n,e.F_QUOTE.LEVEL_CENTER)):(Jane.DOM.classAdd(n,"b-quote_lf"),e.flagAdd(n,e.F_QUOTE.LEVEL_FIRST)),r[i]=n;for(var u in r)n=r[u],Jane.DOM.classAdd(n,"b-quote_ll"),Jane.DOM.classRemove(n,"b-quote_lc"),e.flagAdd(n,e.F_QUOTE.LEVEL_LAST),e.flagRemove(n,e.F_QUOTE.LEVEL_CENTER);r=null},function(t,n){for(var i,s=e.getQuotesByLevel(t,1),a=s.length,o=0,r=ns.Model.get("message",{ids:n.ids}).isBodyAutoExpand(),u=a>1;o<a;o++)i=s[o],e.flagContains(i,e.F_QUOTE.LEVEL_LAST)||(r||u)&&(e.flagAdd(i,e.F_QUOTE.EXPANDED_ALL),u&&Jane.DOM.classAdd(i,"js-quote-mini"))},function(t,n){for(var i=e.getQuotesByLevel(t,1),s=i.length,a=0;a<s;a++)e.wrapQuote(i[a],n)},function(e,t){var n=Daria.MessageProcess.getQuotesByLevel(e,1);if(1===n.length&&!ns.Model.get("message",{ids:t.ids}).isForward()){var i=n[0],s=i.querySelector(".js-quote_content"),a=i.querySelector(".js-mail-Quote-Toggler");s&&a&&(Jane.DOM.classAdd(s,"is-hidden"),Jane.DOM.classRemove(a,"is-hidden"))}}]}}(Daria.MessageProcess)},4935:function(e,t,n){e.exports=n.p+"_/7a4dd71dafbb1404bfd494dae3fe02fd-b-mail-icon_video-link.gif"},4936:function(e,t){e.exports=["attach","аттач","прилагается","приложил","прикладываю","прикрепляю","приложенный","приложенном","вложил","вложение","вложенном","вложенный","вкладываю","прилагаю","см. файл","см.файл","лови файл","прикрепил","во вложении","в приложении","attachment","attachments","attached"]},4937:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(349),s=(n.n(i),n(4938));t.default=function(e,t){if(function(e){if(!Object(i.hasFeature)(i.Features.WEB_RICH_LINK_PREVIEW))return!1;var t=ns.Model.get("message-body",e).get(".is-spam"),n=e.forceShowHrefs;if(t&&!n)return!1;return!0}(t)){for(var n=ns.Model.get("message",{ids:t.ids}).getMessageLinksInfo().reduce(function(e,t){return e[t.url]=t,e},{}),a=e.getElementsByTagName("a"),o=0;o<a.length;++o){var r=a[o],u=n[r.getAttribute("href")];u&&Object(s.b)(r,u)&&Object(s.a)(r,u)}return e}}},4938:function(e,t,n){"use strict";t.a=function(e,t){return e.classList.add(r),Object(a.render)(function(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=s;else if(o>1){for(var r=new Array(o),u=0;u<o;u++)r[u]=arguments[u+3];t.children=r}if(t&&a)for(var l in a)void 0===t[l]&&(t[l]=a[l]);else t||(t=a||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}(o.a,{className:r,favicon:t.favicon,title:t.title}),e),e},t.b=function(e){var t=e.getAttribute("href"),n=e.textContent;if(_.trim(t)!==_.trim(n))return!1;var i=e.parentElement;if(i&&i.style.length)return!1;return!0};var i,s=n(135),a=(n.n(s),n(139)),o=(n.n(a),n(4939));var r="mail-RichLinkPreview"},4939:function(e,t,n){"use strict";n.d(t,"a",function(){return m});var i,s=n(135),a=n.n(s),o=n(338),r=n.n(o),u=n(4940);n.n(u);function l(e){"@babel/helpers - typeof";return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t,n,s){i||(i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,o=arguments.length-3;if(t||0===o||(t={children:void 0}),1===o)t.children=s;else if(o>1){for(var r=new Array(o),u=0;u<o;u++)r[u]=arguments[u+3];t.children=r}if(t&&a)for(var l in a)void 0===t[l]&&(t[l]=a[l]);else t||(t=a||{});return{$$typeof:i,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var m=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,h(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,a.a.PureComponent),function(e,t,n){t&&d(e.prototype,t),n&&d(e,n)}(t,[{key:"render",value:function(){var e=this.props,t=e.favicon,n=e.title,i=e.className;return a.a.createElement(a.a.Fragment,null,f("img",{className:"".concat(i,"_icon"),src:t}),f("span",{className:"".concat(i,"_title")},void 0,n))}}]),t}();m.propTypes={favicon:r.a.string.isRequired,title:r.a.string.isRequired,className:r.a.string.isRequired}},4940:function(e,t){},4941:function(e,t){!function(e){var t=function(t,n){this._$main=e(t),this._onViewScrollBinded=e.proxy(this._onViewScroll,this),this._$blocks=this._$main.on("scroll.fixedscroll",_.debounce(this.recalc.bind(this),50)).find(n).on("scroll.fixedscroll",this._onViewScrollBinded),this.recalc()};t.prototype={addBlock:function(e){return this._$blocks=this._$blocks.add(e),e.on("scroll.fixedscroll",this._onViewScrollBinded),this},destroy:function(){this._$main.off(".fixedscroll"),this._$blocks.off(".fixedscroll"),this._$scroller&&(this._$scroller.off(".fixedscroll").remove(),delete this._$scroller)},_getCustomScroller:function(t){return this._$scroller||t||(this._$scroller=e('<div class="jquery-fixedscroll" style="display: none;"><div class="jquery-fixedscroll__i"></div></div>').on("scroll.fixedscroll",e.proxy(this._onCustomScroll,this)).appendTo(this._$main)),this._$scroller},_onCustomScroll:function(e){this._curBlock&&(this._curBlock.scrollLeft=e.currentTarget.scrollLeft)},_onViewScroll:function(e){var t=e.currentTarget;this._curBlock&&this._curBlock===t&&this._getCustomScroller().scrollLeft(t.scrollLeft)},recalc:function(){for(var t=0,n=this._$blocks.length;t<n;t++){var i=this._$blocks[t];if(i.scrollWidth>i.offsetWidth){var s=e(i),a=this._$main.offset(),o=this._$main[0].scrollTop,r=s.offset().top-a.top+o,u=r+i.offsetHeight,l=o+this._$main[0].offsetHeight;if((o<=r&&r<=l||o>=r&&u>=l)&&!(o<=u&&u<=l)){this._setScroller(i);continue}}this._resetScroller(i)}},_setScroller:function(e){if(e!=this._curBlock||e.offsetWidth!=this._curBlockWidth){var t=this._getCustomScroller();this._curBlock=e,this._curBlockWidth=e.offsetWidth,t.width(this._curBlockWidth),t.find(":first").width(e.scrollWidth),t.show(),t.scrollLeft(e.scrollLeft)}},_resetScroller:function(e){if(e==this._curBlock){var t=this._getCustomScroller(!0);t&&t.hide(),delete this._curBlockWidth,delete this._curBlock}}},e.fn.fixedScroll=function(e){return new t(this,e)}}(jQuery)},4942:function(e,t){function n(e){"@babel/helpers - typeof";return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){var t=e.scrollTo=function(t,n,i){return e(window).scrollTo(t,n,i)};function i(t){return e.isFunction(t)||"object"==n(t)?t:{top:t,left:t}}t.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1,limit:!0},t.window=function(t){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){if(this.nodeName&&-1==e.inArray(this.nodeName.toLowerCase(),["iframe","#document","html","body"]))return this;var t=(this.contentWindow||this).document||this.ownerDocument||this;return/webkit/i.test(navigator.userAgent)||"BackCompat"==t.compatMode?t.body:t.documentElement})},e.fn.scrollTo=function(s,a,o){return"object"==n(a)&&(o=a,a=0),"function"==typeof o&&(o={onAfter:o}),"max"==s&&(s=9e9),o=e.extend({},t.defaults,o),a=a||o.duration,o.queue=o.queue&&o.axis.length>1,o.queue&&(a/=2),o.offset=i(o.offset),o.over=i(o.over),this._scrollable().each(function(){if(null!=s){var r,u=this,l=e(u),d=s,c={},h=l.is("html,body");switch(n(d)){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(d)){d=i(d);break}if(!(d=h?e(d):e(d,this)).length)return;case"object":(d.is||d.style)&&(r=(d=e(d)).offset())}var g=e.isFunction(o.offset)&&o.offset(u,d)||o.offset;e.each(o.axis.split(""),function(e,n){var i="x"==n?"Left":"Top",s=i.toLowerCase(),a="scroll"+i,m=u[a],p=t.max(u,n);if(r)c[a]=r[s]+(h?0:m-l.offset()[s]),o.margin&&(c[a]-=parseInt(d.css("margin"+i))||0,c[a]-=parseInt(d.css("border"+i+"Width"))||0),c[a]+=g[s]||0,o.over[s]&&(c[a]+=d["x"==n?"width":"height"]()*o.over[s]);else{var _=d[s];c[a]=_.slice&&"%"==_.slice(-1)?parseFloat(_)/100*p:_}o.limit&&/^\d+$/.test(c[a])&&(c[a]=c[a]<=0?0:Math.min(c[a],p)),!e&&o.queue&&(m!=c[a]&&f(o.onAfterFirst),delete c[a])}),f(o.onAfter)}function f(e){l.animate(c,a,o.easing,e&&function(){e.call(this,d,o)})}}).end()},t.max=function(t,n){var i="x"==n?"Width":"Height",s="scroll"+i;if(!e(t).is("html,body"))return t[s]-e(t)[i.toLowerCase()]();var a="client"+i,o=t.ownerDocument.documentElement,r=t.ownerDocument.body;return Math.max(o[s],r[s])-Math.min(o[a],r[a])}}(jQuery)},4943:function(e,t,n){n(4944),n(4945),n(4946),n(4947),n(4948),n(4949),n(4950),n(4951),n(4953),n(4955),n(4956),n(4957),n(4958),n(4959),n(4960),n(4961),n(4962),n(4963),n(4964),n(4965),n(4966),n(4967),n(4968),n(4969),n(4970),n(4971),n(4972),n(4973),n(4974),n(4975),n(4993),n(4994),n(4995),n(4999),n(5e3),n(5001),n(5002),n(5003),n(5004),n(5005),n(5006),n(5007),n(5008),n(5009),n(5010),n(5011),n(5012),n(5013),n(5014),n(5015),n(5016),n(5017),n(5018),n(5019),n(5020),n(5021),n(5022),n(5023),n(5024),n(5025),n(5026),ns.View.define("react-message-viewer",n(1593).ReactMessageViewer)},4944:function(e,t){ns.View.define("attached-message",{events:{"ns-view-show":"onShow","click .js-attachments-scroll":"scrollToAttachments"},models:{message:!1,"message-body":!1},params:{ids:null,hid:null,subj:null},yateModule:"message",methods:{onShow:function(){ns.events.trigger("daria:vApp:changeAppWidth")},scrollToAttachments:function(){Jane.DOM.scrollIntoView(this.$node.find(".js-attachments-snippet")[0]),Jane.c("Аттачи в тексте письма","Клик")}}})},4945:function(e,t){ns.View.define("attached-message-popup",{models:{dimensions:{"ns-model-changed":"keepValid",resize:"_updatePosition"}},events:{"ns-view-destroyed":"_onDestroyed","wheel window":"onWheel"},params:{ids:null,hid:null,subj:null},yateModule:"message",ctor:function(){["_destroyContent","_onOpenedPopup","_onClosedPopup","_onDestroyedPopup","_onContentSetPopup","_updatePosition"].forEach(function(e){this[e]=this[e].bind(this)},this),this._nbPopup=null,this._vContent=null,this._contentNode=null},methods:{open:function(e){this._destroyContent();var t=this.getPopup();t.isOpen()?this._resetContentPopup():(this._show(),t.open(e))},close:function(){this.getPopup().close()},getPopup:function(){return this._nbPopup?this._nbPopup:(this._nbPopup=nb.find("attached-message-popup-"+this.params.ids+"-"+this.params.hid),this._nbPopup||(this._nbPopup=nb.block(ns.renderNode(this.params,"js-attached-message-popup","message"))),this._nbPopup.on("nb-opened",this._onOpenedPopup),this._nbPopup.on("nb-closed",this._onClosedPopup),this._nbPopup.on("nb-destroyed",this._onDestroyedPopup),this._nbPopup.on("nb-content-set",this._onContentSetPopup),this._nbPopup)},_resetContentPopup:function(){this._contentNode=ns.renderNode({},"js-attached-message-popup-loader","message"),this.getPopup().setContent(this._contentNode)},_destroyContent:function(){this._vContent&&(this._vContent.destroy(),this._vContent=null),this._contentNode=null},_destroyPopup:function(){this._nbPopup&&(this._nbPopup.$node.off("click",this._updatePosition),this._nbPopup.destroy(),this._nbPopup=null),this.hideAndUnbindEvents()},_updatePosition:function(){var e=this;setTimeout(function(){e._nbPopup&&e._nbPopup.$node&&e._nbPopup.$node.position({at:"center",of:window})},100)},_onContentSetPopup:function(){this._vContent=ns.View.create("attached-message",this.params),this._vContent._setNode(this._contentNode),this._vContent.invalidate(),this._vContent.updateByLayout("attached-message-preview",this.params,{execFlag:ns.U.EXEC.PARALLEL}).then(function(){var e=this.getPopup().$node,t=e.find("._nb-popup-content");if(Modernizr.ie10||Modernizr.ie11){var n=e.cssUnit("max-height"),i=e.find("._nb-popup-title"),s=n[0]-i.outerHeight();t.css("max-height",s+"px")}e.position({at:"center",of:window}),t.attr("tabindex","1").focus(),ns.events.trigger("daria:vApp:changeAppWidth")},this)},_onOpenedPopup:function(){this._resetContentPopup();var e=this.getPopup();e.$node.on("click",this._updatePosition),e.node.widget.option("beforeClose",this._onClosedPopup.bind(this))},_onClosedPopup:function(){setTimeout(function(){this.trigger("closed"),this._destroyPopup()}.bind(this),0)},_onDestroyedPopup:function(){this._destroyContent()},_onDestroyed:function(){this._destroyPopup()},getScrollContent:function(e){return $(e.target).parents("._nb-popup-content")[0]}}},"prevent-scroll-propagation-mixin",ns.View)},4946:function(e,t){ns.View.define("3pane-scroller",{events:{"ns-view-show":"onShow"},params:function(e){return{ids:e.thread_id||e.ids}},yateModule:"message",methods:{onShow:function(){this.$node.closest(".js-message-scroll-area").scrollTop(0)}}})},4947:function(e,t){ns.View.define("map",{ctor:function(){this._map=null,this.initMap=this.initMap.bind(this),this.destroyMap=this.destroyMap.bind(this)},events:{"ns-view-htmlinit":"onhtmlinit"},yateModule:"message",methods:{onhtmlinit:function(){this.$frame=this.$node.find(".js-mail-message-map-frame"),ns.events.on("daria:vMap:initMap",this.initMap),ns.events.on("daria:vMap:closeMap",this.destroyMap)},initMap:function(e,t){var n=this;Daria.Libs("Ya.Maps",function(){ymaps.ready(function(){var e=new ymaps.Map(n.$frame.get(0),{center:[t.lat,t.lon],behaviors:["default","scrollZoom"],zoom:15,type:"yandex#map",controls:["zoomControl","geolocationControl"]},{copyrightLogoVisible:!1,copyrightProvidersVisible:!1,copyrightUaVisible:!1,suppressMapOpenBlock:!0});e.controls.add(new ymaps.control.RulerControl({options:{position:{bottom:10,right:10}}})),e.controls.add("trafficControl",{float:"left",size:"small"});var i=new ymaps.Placemark([t.lat,t.lon],{},{preset:"islands#redDotIcon"});e.geoObjects.add(i),n._map=e})})},destroyMap:function(){this._map&&(ns.events.off("daria:vMap:initMap",this.initMap),ns.events.off("daria:vMap:closeMap",this.destroyMap),this._map.destroy(),this._map=null)}}})},4948:function(e,t){ns.View.define("map-actions",{yateModule:"message",models:{"map-data":!1}})},4949:function(e,t){ns.View.define("map-up",{params:{ids:null,address:null},yateModule:"message",methods:{open:function(e){var t=this,n=ns.layout.page("map-up",this.params);return new ns.Update(this,n,this.params).render().then(function(){var n=Jane.tt("message:map-up"),i=nb.block(n);i.setContent(t.node),i.open({where:$("body").get(0),autoclose:!0,width:684,height:500});var s=function(e){e.keyCode===Jane.Common.keyCode.ESC&&(i.trigger("nb-closed"),e.preventDefault(),e.stopPropagation())},a=_.once(function(){window.removeEventListener("keydown",s,!0),_.defer(function(){ns.events.trigger("daria:vMap:closeMap"),i.destroy(),i=null})});i.on("nb-closed",a),window.addEventListener("keydown",s,!0);var o=e||ns.Model.get("map-data",{address:t.params.address}).getData().addressLocation;ns.events.trigger("daria:vMap:initMap",{lat:o.lat,lon:o.lon}),Jane.c("Карты в письмах","Показ попапа с картой")})}}})},4950:function(e,t){ns.View.define("map-city-complaint",{models:{"message-body":!1,"map-data":!1},events:{"ns-view-htmlinit":"_onNsViewHtmlinit","ns-view-destroyed":"_onNsViewDestroyed","click .js-next":"_onClickNext","click .js-prev":"_onClickPrev","submit@show .js-form":"_onClickSubmit"},ctor:function(){this.slides=[]},yateModule:"message",methods:{_onNsViewHtmlinit:function(){this.slides=[".js-slide1",".js-slide2",".js-slide3"].map(function(e){return this.$node.find(e)},this),_.defer(this._initMapCityComplaint.bind(this))},_onNsViewDestroyed:function(){clearTimeout(this._errorTimeout);var e=nb.$block(".js-city",this.node);e&&e.hideError(),this.slides=[]},_onClickNext:function(){this._animateSlide(1,!0),this._animateSlide(2,!1)},_onClickPrev:function(e){e.stopPropagation(),this._animateSlide(1,!1),this._animateSlide(2,!0)},_onClickSubmit:function(e){e&&e.preventDefault(),this._sendMapCityComplaint()&&this._closeMapCityComplaint()},_initMapCityComplaint:function(){var e=this;Daria.hasSid(669)&&(e._getSlide(1).removeClass("js-init"),e._getSlide(2).css({bottom:-500}).each(function(){e._toggleSlide(2,!1,$(this))}).each(function(){var e=$(this);e.css({bottom:-1*e.outerHeight()})}).each(function(){e._toggleSlide(2,!0,$(this))}))},_getSlide:function(e){var t=$();return e>=1&&e<=this.slides.length&&(t=this.slides[e-1]),t},_toggleSlide:function(e,t,n){return(n=n||this._getSlide(e)).toggleClass("js-init",t)},_animateSlide:function(e,t,n){var i=this;return n=n||i._getSlide(e),t||(n=i._toggleSlide(e,t,n)),_.contains([1,3],e)?_.defer(function(){n=n.toggleClass("js-hide",t)}):2===e&&(t&&nb.$block(".js-city",n).hideError().blur(),_.defer(function(){var e=t?-1*n.outerHeight():"";n.css({bottom:e})}),t||n.afterTransition(function(){nb.$block(".js-city",n).focus()})),t&&(n=n.afterTransition(function(){i._toggleSlide(e,t,n)})),n},_closeMapCityComplaint:function(){var e=this,t=Daria.timify({seconds:2});e._animateSlide(2,!0);var n=e._animateSlide(3,!1).afterTransition(function(){setTimeout(function(){e._animateSlide(3,!0,n)},t)})},_serializeMessage:function(e){return _(e).map(function(e,t){return[t,JSON.stringify(e)]}).invoke("join",":\n").join("\n\n")},_sendMapCityComplaint:function(){var e=this._getSlide(2).find(".js-form")[0],t=$.trim(e.city.value);if(!t.length){clearTimeout(this._errorTimeout);var n=nb.$block(".js-city",this.node);return n.showError().focus(),this._errorTimeout=setTimeout(function(){n.hideError().focus()},1e3),!1}var i={"Корректировка пользователя":t,"Подчеркнули":this.params.address,"Факты":this.getModel("message-body").get(".facts")},s={ttype:"plain",to:Daria.Config.mapComplaintEmail,nosave:"yes",subj:"Неправильный город",send:this._serializeMessage(i)};return e.attach.checked&&(s.ign_overwrite="yes",s.ids=this.params.ids),Daria.SendMail.send({params:s}),!0}}})},4951:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(370),s=n(516),a=n(487),o=n(4952),r=n(347),u=n(551);ns.View.edefine("message",{models:{"account-information":!1,labels:!1,message:{"ns-model-changed":function(e,t){if(this.isVisible()){var n,i=this.getModel("message");if(".lid"===t||".new"===t)switch(n=this.$node.hasClass("b-message")?this.$node:this.$node.find(".b-message"),t){case".lid":n.toggleClass("b-message_important",i.isImportant());break;case".new":var s=i.isNew();n.toggleClass("b-message_unread",s),n.toggleClass("is-unread",s),n.toggleClass("b-message_read",!s)}}else this.invalidate()}},"messages-checked":!1,"module-compose":!1,"module-message":!1,"scroller-message":!1,settings:!1,"state-message-thread-item":{"ns-model-changed":!1,"ns-model-changed.shouldBeInViewport":"placeInViewport","ns-model-destroyed":"keepValid"}},events:{"ns-view-init":"oninit","ns-view-show":"onshow","ns-view-touch":"ontouch","ns-view-hide":"onhide","ns-view-htmldestroy":"onhtmldestroy","daria:vMessage:message-body-loaded":function(){this.$node.addClass("b-message_loaded"),nb.init(this.node),this._initAttachments()},"daria:vToolbarButton:label":"_onLabelToolbarButton","daria:vToolbarButton:unlabel":"_onUnlabelToolbarButton","daria:vToolbarButton:mark":"_onToolbarButton","daria:vToolbarButton:unmark":"_onUnmarkToolbarButton","daria:vToolbarButton:move":"_onMoveToolbarButton","daria:vToolbarButton:remove":"_onRemoveToolbarButton","daria:vToolbarButton:tospam":"_onTospamToolbarButton","daria:vToolbarButton:notspam":"_onNotspamToolbarButton","daria:vToolbarButton:archive":"_onArchiveToolbarButton","daria:vToolbarButton:infolder":"_onInfolderToolbarButton","daria:vToolbarButton:unsubscribe":"_onToolbarButton","daria:vToolbarButton:reply":"_onReplyToolbarButton","daria:vToolbarButton:reply-all":"_onReplyAllToolbarButton","daria:vToolbarButton:reply-tmpl":"_replyHelper","daria:vToolbarButton:sendon":"_replyHelper","dragndrop.drop@show":"_onDrop","hotkeys.print":"print","hotkeys.alignOpenMessage":"onAlignOpenMessage","daria:folder-remove-done@show":"_onFolderRemove","daria:MOPS:action-complete@show":"onActionComplete","daria:MOPS:action-failed@show":"onActionFailed","click .js-attachments-scroll":"scrollToAttachments","click .js-message-close-button":"onCloseMessage","click .js-open-quick-reply":"openQuickReply","daria:reactQuickReply:close":"onReactQuickReplyClose","daria:vScrollerMessage:scroll@show":"onScroll","daria:layout-changed@show":"onScroll","folder.cleared@show":"onFolderCleared","resize@show window":"onResizeDebounce"},yateModule:"message",ctor:function(){this.onResizeDebounce=_.debounce(this.onResize.bind(this),50,{maxWait:50}),this._fixedToolbar=_.throttle(this._fixedToolbar.bind(this),20,{trailing:!0,leading:!0})},methods:{openQuickReply:function(){var e=this.getMessagesCheckedInstance();if(!Object(r.getPddRestrictNotificationsModel)().showPopup(function(){return Object(u.b)(e,!0)})){var t=this.$node.find(".js-react-quick-reply")[0];Daria.openQuickReply({oper:"reply-all",quickReplyNode:t,ids:e.getIds().ids}),this.$node.find(".js-react-quick-reply-placeholder").hide(0),Jane.c("Quick Reply (new)","click on","reply")}},onReactQuickReplyClose:function(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).shouldSaveDraft?Daria.React.QuickReply.saveDraftAndDestroy():Daria.React.QuickReply.destroy(),this.$node.find(".js-react-quick-reply-placeholder").show(0)},oninit:function(){this.mMessagesChecked=ns.Model.get("messages-checked",{mid:this.params.ids}),this.mMessagesChecked.on("run-action",this._runAction.bind(this)),this._startMessageViewScenarioIfNotActive()},onshow:function(){this.onResize(),this.placeInViewport();var e=this.params;ns.events.trigger("user.action.log",{action:"show",eventObject:{params:e,ids:{ids:[e.ids],mids:[e.ids]}}});var t=this.getModel("message");this.mMessagesChecked.check(t,!0);var n=Daria.isMessagePage()?"Show Message on separate page":"Show Message in messages list";Jane.c("Message view",Daria.is2pane()?"2pane":"3pane",n),this.writeToUserJournal("startReading"),Daria.is3pane()&&Daria.lom.save(ns.page.current.params),Promise.resolve().then(function(){ns.events.trigger("quick-reply:open-last-draft")}),ns.events.trigger("search.blur-input"),Daria.isMessagePage()||this.getModel("scroller-message").init(),this._startMessageViewScenarioIfNotActive(),this._stepSuccessMessageViewScenario(),this.$node.find(".js-react-quick-reply-placeholder").show(0)},onScroll:function(){this._fixedToolbar()},ontouch:function(){this._reSetMessagesChecked()},_reSetMessagesChecked:function(){this.mMessagesChecked.touch()},onhide:function(){this.mMessagesChecked.check(this.getModel("message"),!1,{silent:!0}),this._fixedToolbar.cancel(),this.getModel("scroller-message").clean(),this.resetFixedToolbar(),this._finishMessageViewScenarioOnLeave(),Daria.React.QuickReply&&Daria.React.QuickReply.saveDraftAndDestroy()},_startMessageViewScenarioIfNotActive:function(){this.scenarioManager.hasActiveScenario(i.d)?this._initialScenario=this.scenarioManager.getActiveScenario(i.d):this._initialScenario=this.scenarioManager.startScenario(i.d,s.a)},_finishMessageViewScenarioOnLeave:function(){var e=this.scenarioManager.hasActiveScenario(i.d)&&this.scenarioManager.getActiveScenario(i.d),t=this._initialScenario!==e;if(this._initialScenario=null,e&&!t){var n=a.b;Daria.isMessageOpenedInList()||Daria.isMessagePage()?n=a.c:Daria.isMessagesListPage()&&(n=a.a),this.scenarioManager.finishScenarioIfActive(i.d,n)}},_stepSuccessMessageViewScenario:function(){if(this.scenarioManager.hasActiveScenario(i.d)){var e=this.scenarioManager.getActiveScenario(i.d),t=e.getTimeFromStart();e.logStep(o.a,{duration:t})}},scrollToAttachments:function(){var e=this.getModel("scroller-message"),t=e.getScrollOffset(),n=Daria.is2pane()?this.$node.offset().top:this.node.offsetTop;e.setScrollTop(n-t,!0),Jane.c("Аттачи в тексте письма","Клик")},onhtmldestroy:function(){$(window).off(".b-message")},_initAttachments:function(){var e=this.$node.find("#message-attachments-"+this.params.ids);if(e.length){var t=this.$node,n=t.find(".b-message-head"),i=this.attachments={blocks:{head:n.find(".b-message-head__field_attachments-expand"),body:e},shrinked:{head:!1,body:!1},view:{head:null,body:null}};this.attachments.buttons={head:n.find(".js-attachments-view"),body:i.blocks.body.find(".js-attachments-view")};t.find(".b-file__actions").each(function(){var e=$(".b-mail-button_light",this);e.length>1&&(e.eq(0).addClass("b-mail-button_first"),e.slice(1,-1).addClass("b-mail-button_middle"),e.eq(-1).addClass("b-mail-button_last"))}),$.each(i.blocks,function(e,t){t.find(".js-attachments-view-btn").attr("data-params",function(t,n){return(n?n+"&":"")+"metrika=attach:"+e+":viewfile"}).end().find(".js-attachments-get-btn").attr("data-params",function(t,n){return(n?n+"&":"")+"metrika=attach:"+e+":loadfile"})}),i.blocks.head.length||(Jane.c("attach","onefile","show"),n.find(".js-attachments-view-btn").attr("data-params","metrika=attach:head:viewone").end().find(".js-attachments-get-btn").attr("data-params","metrika=attach:head:loadone"))}},_onMoveMopsFulfilled:function(){ns.events.trigger("daria:vToolbarButton:loader:end"),this.invalidate()},_moveHelper:function(e,t){t=t||{};var n=_.last(e.split(":")),i=_.clone(t);i=_.extend({ids:this.mMessagesChecked.getIds()},i),$(document).trigger("b-mail-dropdown-closeall");var s=Daria.messages.whereToGoAfterMove(n,this.mMessagesChecked,i);return Daria.MOPS[n](this.mMessagesChecked,_.extend(t,s)).then(function(){this._onMoveMopsFulfilled()},this)},_onArchiveToolbarButton:function(e,t){return this._moveHelper("archive",t)},_onMoveToolbarButton:function(e,t){return this._moveHelper("move",t)},_onInfolderToolbarButton:function(e,t){return this._moveHelper("infolder",t)},_onRemoveToolbarButton:function(){return this._moveHelper("remove")},_onTospamToolbarButton:function(){return this._moveHelper("tospam")},_onNotspamToolbarButton:function(){return this._moveHelper("notspam")},_onMarkToolbarButton:function(e,t){return this._onToolbarButton("mark",t)},_onUnmarkToolbarButton:function(e,t){return this._onToolbarButton("unmark",t)},_onLabelToolbarButton:function(){var e=["daria:vToolbarButton:label"];return Array.prototype.push.apply(e,Array.prototype.slice.call(arguments,1)),this._onToolbarButton.apply(this,e)},_onUnlabelToolbarButton:function(){var e=["daria:vToolbarButton:unlabel"];return Array.prototype.push.apply(e,Array.prototype.slice.call(arguments,1)),this._onToolbarButton.apply(this,e)},_onReplyToolbarButton:function(e,t){return this._replyHelper("reply",t)},_onToolbarButton:function(e,t){if((t=t||{})._viewKey&&t._viewKey!==this.key)return Vow.reject("no common view keys");var n,i=this,s=_.last(e.split(":"));$(document).trigger("b-mail-dropdown-closeall");return n=-1===["label","mark","unlabel"].indexOf(s),Daria.MOPS.updateHelper(s,this.mMessagesChecked,t).then(function(){if(ns.events.trigger("daria:vToolbarButton:loader:end"),"unmark"===s&&!Daria.is3pane()||"unsubscribe"===s){var e=i.getModel("message").getFolderId();ns.page.go(ns.router.generateUrl("messages",{current_folder:e}))}else n&&i.update(ns.page.current.params)})},getMessagesCheckedInstance:function(){return this.mMessagesChecked},_onCloseDropdown:function(){$(".js-message-toolbar-dropdown",this.node).filter(function(){return nb.block(this).isOpen()}).each(function(){nb.block(this).close()})},markUnread:function(){this._onToolbarButton("daria:vToolbarButton:mark")},_runAction:function(e,t){if(this.isVisible()){var n="_on"+Daria.capitalize(t.action)+"ToolbarButton";_.isFunction(this[n])&&this[n](e,t.params)}},_onFolderRemove:function(e,t){var n=this.getModel("message");this.getModel("message").getFolderId()===t&&n.invalidate()},placeInViewport:function(){this.getModel("state-message-thread-item").get(".shouldBeInViewport")&&Jane.DOM.placeInViewport(this.node)},_redirectAfterAction:function(e){var t,n=Daria.isMessagePage()&&Daria.is2pane()||_.has(e,".whereToGo.updateRequired");switch(e.action){case"delete":case"unmark":case"move":case"tospam":case"notspam":"delete"===e.action&&this.invalidate(),n&&((t=_.get(e,".whereToGo.where"))||(t=Daria.messages.whereToGoAfterMove(e.action,this.mMessagesChecked,e).where),_.delay(ns.page.go,300,t))}},onActionComplete:function(e,t){this._redirectAfterAction(t)},onActionFailed:function(e,t){this._redirectAfterAction(t)},onAlignOpenMessage:function(e,t){ns.page.current.params.ids===this.params.ids&&t.scroller.scrollIntoView(this.node,t.alignOptions)},getFocusableChildren:function(){return[this]},onFocusEvent:function(e){switch(e.type){case"focus":this.focusOn();break;case"blur":this.focusOff();break;case"enter":ns.page.go(Daria.Page.generateUrl.closeMessage());break;case"print":this.print()}},print:function(){Daria.Printer.printMessage(this.params.ids)},toggleCheck:function(){var e=this.getModel("message");this.getModel("messages-checked").toggleCheck(e)},focusOn:function(){"message"!==ns.page.current.page&&this.$node.addClass("is-focused")},focusOff:function(){this.$node.removeClass("is-focused")},onCloseMessage:function(){Daria.isMessagePage()&&ns.page.go("#inbox")},isOpen:function(){var e=ns.page.current.params;return Boolean(e.thread_id||e.ids)},onFolderCleared:function(e,t){this.isOpen()&&this.getModel("message").getFolderId()===t&&ns.page.go(ns.router.generateUrl("messages",{current_folder:t}))},onResize:function(){Daria.isMessagePage()&&this.$node.toggleClass("mail-Message_wide",this.$node.width()<1e3)}}},"message-dimensions-mixin","fixed-message-toolbar-mixin","journal-log-mixin","message-actions","scenario-manager-mixin")},4952:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i="successful-open"},4953:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(136),s=n.n(i),a=n(135),o=n.n(a),r=n(139),u=n.n(r),l=n(1593);n.n(l);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ns.View.define("message-react",{params:{ids:null},events:{"ns-view-init":"onInit","ns-view-show":"onShow","ns-view-hide":"onHide","daria:MOPS:action-complete@show":"onActionComplete"},models:{"message-body":!1,"module-message":!1,"module-compose":!1},yateModule:"message",methods:{onInit:function(){this.mMessage=ns.Model.get("message",{ids:this.params.ids}),this._runAction=this._runAction.bind(this)},onShow:function(){this.messageContainer=this.node.querySelector(".js-message-container"),u.a.render(o.a.createElement(l.ReactMessageViewer,{params:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},this.params,{insideThread:Daria.isThreadOpenedInList()})}),this.messageContainer);var e=ns.Model.get("messages-checked",{mid:this.params.ids});e.on("run-action",this._runAction),e.check(this.mMessage,!0),this.writeToUserJournal("startReading")},onHide:function(){var e=ns.Model.get("messages-checked",{mid:this.params.ids});e.check(this.mMessage,!1),e.off("run-action",this._runAction),u.a.unmountComponentAtNode(this.messageContainer)},_runAction:function(e,t){var n=this.mMessage.getMessagesCheckedModel();switch(t.action){case"label":case"unlabel":case"mark":case"unmark":return void Daria.MOPS.updateHelper(t.action,n,t.params&&t.params.lid);case"move":return void Daria.MOPS.move(n,t.params)}},onActionComplete:function(e,t){if((Daria.isMessagePage()&&Daria.is2pane()||s.a.has(t,".whereToGo.updateRequired"))&&-1!==["delete","unmark","move","tospam","notspam"].indexOf(t.action)){var n=s.a.get(t,".whereToGo.where");if(!n){var i=t.mMessagesChecked||this.mMessagesChecked;n=Daria.messages.whereToGoAfterMove(t.action,i,t).where}s.a.delay(ns.page.go,300,n)}},getFocusableChildren:function(){return[this]},onFocusEvent:function(e){switch(e.type){case"focus":"message"!==ns.page.current.page&&this.$node.addClass("is-focused");break;case"blur":this.$node.removeClass("is-focused")}}}},"journal-log-mixin")},4954:function(e,t){e.exports={placeholder:"react-message__placeholder--3Dn12"}},4955:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(88),s=n.n(i);ns.View.define("message-body",{models:{settings:{"ns-model-changed":!1},message:!1,"message-body":{"ns-model-changed":!1,"daria:mMessageBody:moved":"_onMessageMove","daria:vMessageWidgetTranslate:translate":"_onMessageWidgetTranslateTranslate","daria:vMessageWidgetTranslate:revert":"_onMessageWidgetTranslateRevert"}},ctor:function(){this.anyLocationsHighlighted=!1,this.fireResizeBodyDebounce=_.debounce(this.fireResizeBody.bind(this),50),this._isHtmlInitWithoutShow=!1},events:{"ns-view-async":"_onNsViewAsync","ns-view-htmlinit":"_onNsViewHtmlinit","ns-view-show":"_onNsViewShow","ns-view-hide":"_onNsViewHide","ns-view-htmldestroy":"_onNsViewHtmldestroy","daria:vThreadSidebarBox:flight@show":"onThreadSidebarFlight","daria:vMessageWidgetSpam:showContent@show":"_onMessageWidgetSpamShowContent","click .daria-goto-anchor":"changeLinkHref","mousedown@show .daria-goto-anchor":"changeLinkHref","mousemove@show .daria-goto-anchor":"resetLinkHref","mouseleave@show .daria-goto-anchor":"resetLinkHref","daria:vMessageBody:showLocations@show":"showLocations","messages-thread.open-body":"onMessagesThreadOpenBody","click .js-attachments-switch-view":"onSwitchAttachmentsView","click .js-extracted-highlighted-address":"_onClickExtractedAddress","click .js-message-audio-play":"_onClickMessageAudioPlay","click .js-quote-expand":Daria.MessageProcess.Actions.quoteExpand,"click .js-quote-expand-all":Daria.MessageProcess.Actions.quoteExpandAll,"click .js-quote-maximize":Daria.MessageProcess.Actions.quoteMaximize,"click .js-quote-expand-toggle":Daria.MessageProcess.Actions.quoteExpandToggle,"click .js-mail-Quote-Toggler":"toggleQuote","submit .js-message-form":Daria.message.formWarning,'click [mailcollectorson="1"]':"collectorsRambler","resize@show window":"fireResizeBodyDebounce"},yateModule:"message",methods:{BODY_LOADING_TIMEOUT:200,MESSAGE_HEAD_HEIGHT:51,MESSAGE_TOOLBAR_HEIGHT:28,MAIL_TOOLBAR_HEIGHT:59,CLASS_MESSAGE_SCROLL_AREA:"js-message-scroll-area",_timerOpenLoader:0,_translating:!1,_onMessageMove:function(){delete this.forceShowImages,delete this.forceShowHrefs,this.invalidate()},_onNsViewAsync:function(){var e=this.$node;this._timerOpenLoader=setTimeout(function(){e.find(".js-body-loading").removeClass("g-hidden")},this.BODY_LOADING_TIMEOUT)},_onNsViewHtmlinit:function(e,t){clearTimeout(this._timerOpenLoader),this._timerOpenLoader=null;var n=this.getModel("message-body").getHTML(_.extend({},t,{forceShowImages:this.forceShowImages,forceShowHrefs:this.forceShowHrefs}));this.$node.append(n),ns.events.trigger("daria:vMessage:message-body-loaded");var i=this.$node.find("#message-attachments-"+t.ids);if(i.length){var s=this.$node.closest(".b-message").find(".b-message-head"),a=this.attachments={blocks:{head:s.find(".b-message-head__field_attachments-expand"),body:i},shrinked:{head:!1,body:!1},view:{head:null,body:null}};this.attachments.buttons={head:s.find(".js-attachments-view"),body:a.blocks.body.find(".js-attachments-view")};this.$node.find(".b-file__actions").each(function(){var e=$(".b-mail-button_light",this);e.length>1&&(e.eq(0).addClass("b-mail-button_first"),e.slice(1,-1).addClass("b-mail-button_middle"),e.eq(-1).addClass("b-mail-button_last"))}),$.each(a.blocks,function(e,t){t.find(".js-attachments-view-btn").attr("data-params",function(t,n){return(n?n+"&":"")+"metrika=attach:"+e+":viewfile"}),t.find(".js-attachments-get-btn").attr("data-params",function(t,n){return(n?n+"&":"")+"metrika=attach:"+e+":loadfile"})}),a.blocks.head.length||(Jane.c("attach","onefile","show"),s.find(".js-attachments-view-btn").attr("data-params","metrika=attach:head:viewone"),s.find(".js-attachments-get-btn").attr("data-params","metrika=attach:head:loadone"))}Daria.MessageProcess.initQuotesByPage(this.node),this.waitForImages(t),this._timerColumnSizeRecalculate=setTimeout(function(){this._timerColumnSizeRecalculate=null,n&&this.getModel("message-body").getOnlyNotInlineAttachments().length&&this.$node.closest(".js-message-wrap").find(".js-attachments-snippet").length&&Daria.MessageProcess.attachmentsSelect(n),ns.events.trigger("daria:vMessageThreadList:checkVisible"),this.fireResizeBodyDebounce()}.bind(this),300),this.showLocations(),this._isHtmlInitWithoutShow=!0},initFixedScroll:function(){this._fixedScroll=this.$node.closest(".js-message-scroll-area").fixedScroll(this.$node),this._fixedScrollRecalc=_.debounce(this._fixedScroll.recalc.bind(this._fixedScroll),50),this.__bindFixedScrollEvents()},destroyFixedScroll:function(){this.__unbindFixedScrollEvents(),this._fixedScroll&&(this._fixedScroll.destroy(),this._fixedScroll=null,delete this._fixedScrollRecalc)},changeLinkHref:function(e){var t=e.currentTarget,n=t.getAttribute("data-vdir-href");n&&t.href!==n&&("click"===e.type||2===e.which||e.ctrlKey)&&(t.href=n);var i=t.href.replace(/^[^#]*(.*)$/,"$1"),s=decodeURIComponent(i);if(Daria.isInnerMailLinkHostname(t.hostname)&&s){var a=this.$node.find(s+', a[name="'+s.substr(1)+'"]')[0];if(a){var o,r=0;return(o=this.$node.closest(".js-message-body").closest("._nb-popup-content")[0])||(r=Daria.isMessagePage()?this.MAIL_TOOLBAR_HEIGHT:this.MESSAGE_HEAD_HEIGHT+this.MESSAGE_TOOLBAR_HEIGHT,o=Daria.isMessagePage()?window:this.$node.closest("."+this.CLASS_MESSAGE_SCROLL_AREA)[0]),Jane.DOM.placeInViewport(a,{top:r},{nodePositionBelow:"top",nodePositionAbove:"top"},o),!1}}return!0},resetLinkHref:function(e){var t=e.currentTarget,n=t.getAttribute("data-orig-href");n&&t.href!==n&&(t.href=n)},collectorsRambler:function(){if(-1!==this.getModel("message").type.indexOf(12))return ns.page.go("#setup/collectors"),!1},waitForImages:function(){var e=this.$node.find("img"),t=0,n=[],i=this;e.each(function(){n.push($.Deferred())}),e.one("load",function(){n[t++].resolve()}).one("error",function(){n[t++].reject();var e=this.src;e&&e.indexOf("cache.mail.yandex.net")>-1&&Jane.ErrorLog.send({event:"imgNotLoaded",src:e})}),$.when.apply($,n).then(function(){i.fireResizeBodyDebounce()})},__bindFixedScrollEvents:function(){!this._eventsBinded&&this._fixedScroll&&(this._eventsBinded=!0,$(window).on("resize.b-message-body",this._fixedScrollRecalc),ns.events.on("layout-ratio-change",this._fixedScrollRecalc))},__unbindFixedScrollEvents:function(){this._eventsBinded&&this._fixedScroll&&(this._eventsBinded=!1,$(window).off(".b-message-body"),ns.events.off("layout-ratio-change",this._fixedScrollRecalc))},_onNsViewShow:function(e,t,n){this.logTimings(n,[s.a.message,s.a.body]);try{this.sendOpenPGPEvent()}catch(e){Jane.ErrorLog.sendException("Daria.vMessageBody.sendOpenPGPEvent",e)}this.attachments&&(Jane.c("attach","show"),this.switchAttachmentsViewEverywhere()),this.initFixedScroll(),this.fireResizeBodyDebounce(),this._isHtmlInitWithoutShow=!1},_onNsViewHide:function(){this._timerOpenLoader&&(clearTimeout(this._timerOpenLoader),this._timerOpenLoader=null),this._timerColumnSizeRecalculate&&(clearTimeout(this._timerColumnSizeRecalculate),this._timerColumnSizeRecalculate=null),this.fireResizeBodyDebounce.cancel(),this._onMessageWidgetTranslateRevert(),this._onMessageWidgetTranslateResetVisibility(),Daria.message.audioPlayer.reset(),this.destroyFixedScroll(),this.sendHidePGPEvent()},_onNsViewHtmldestroy:function(){$("#att-buttons").appendTo($(".b-layout")).addClass("g-hidden")},onSwitchAttachmentsView:function(e){var t=e.currentTarget.getAttribute("data-where"),n=e.currentTarget.getAttribute("data-view");this.switchAttachmentsView(t,n),Jane.c("attach",t,n+"view")},onMessagesThreadOpenBody:function(){this.switchAttachmentsViewEverywhere()},switchAttachmentsViewEverywhere:function(){$.each(["head","body"],function(e,t){this.switchAttachmentsView(t)}.bind(this))},switchAttachmentsView:function(e,t){var n=this.attachments;if(n&&n.view[e]!==t){var i=n.buttons[e],s=n.blocks[e],a="attach-"+e+"-view",o=["icons","list"];t=t||Daria.getCookie(a),-1===$.inArray(t,o)&&(t=o[0]),n.view[e]=t,$.each(o,function(e,n){var a=t===n;i.find(".js-attachments-"+n).toggleClass("b-mail-button_light-selected",a);var o=s.find(".js-attachments-"+n+"-view").toggleClass("g-hidden",!a);a||o.find("object").attr("id",function(e,t){Daria.message.audioPlayer.playerAction(t,"close")})}),t===o[0]&&this.shrinkAttachmentsNames(e),Daria.setCookie(a,t,90)}"body"===e&&this.$node.find(".b-file__pic:visible").length&&Jane.c("Images viewer","Preview show")},shrinkAttachmentsNames:function(e){var t=this.attachments.shrinked;if(!t[e]){var n=this.attachments.blocks[e].find(".js-attachments-icons-view");n.is(":visible")&&(t[e]=!0,n.find(".b-shrinker").each(function(){var e=$(this),t=e.find(".b-shrinker__right").width();e.css("margin-right",t)}))}},_onMessageWidgetSpamShowContent:function(){this.forceShowImages=!0,this.forceShowHrefs=!0,this.invalidate(),this.update({is_spam:!1}).then(function(){Jane.c("Сообщение о непоказе картинок и ссылок в спаме","Клик по Включить")})},sendOpenPGPEvent:function(){var e=this.getModel("message-body"),t=this.params.ids;e.hasPGP()&&e.getPGP().then(function(e){window.postMessage({mid:t,data:e,type:"PGP_MESSAGE_SHOWN"},"*")})},sendHidePGPEvent:function(){window.postMessage({mid:this.params.ids,type:"PGP_MESSAGE_HIDDEN"},"*")},parseLocations:function(e,t){return _.map(e.find(".js-extracted-address").get(),function(e){var n=new Daria.message.Location($(e));return n.findParsedMetadata(t),n})},showLocations:function(){var e=this,t=this.$node,n=this.getModel("message-body").getLocations(),i=this.parseLocations(t,n),s=i.map(function(e){return{id:"map-data",params:{address:e.getAddressQuery()}}});s.length>0&&(Daria.Libs("Ya.Maps"),ns.request(s).then(function(){i.forEach(function(e){e.highlight()}),_.filter(i,function(e){return e.isHighlighted()}).length>0&&(e.anyLocationsHighlighted=!0)}))},_onClickMessageAudioPlay:function(e){Daria.message.audioPlayer.init(e),e.preventDefault()},_onClickExtractedAddress:function(e){var t=$(e.currentTarget),n=t.data("address-query"),i=t.data("ids");n&&i&&ns.View.create("map-up",{address:n,ids:i}).open()},_onMessageWidgetTranslateTranslate:function(e,t){if(!this._translating){this._translating=!0;var n=this.$node.html(),i=this.getModel("message").getSubject(),s=Date.now(),a=this,o=this.getModel("message-body");o.trigger("daria:vMessageBody:startTranslate"),Daria.Translate.translate(t.langFrom,t.langTo,[{value:i,format:"text"},{value:n,format:"html"}]).then(function(e){a._translating=!1;var r=a.params.ids;Jane.ErrorLog.send({event:"translate",duration:(Date.now()-s)/1e3,langs:t.langFrom+"-"+t.langTo,mid:r}),ns.events.trigger("daria:vMessageBody:setSubject",e[0]),a.$node.html(e[1]),Daria.Translate.getCache(r)||Daria.Translate.setCache(r,[i,n]),o.trigger("daria:vMessageBody:stopTranslate",!0)},function(){a._translating=!1,Daria.Dialog.notice({body:i18n("%Translate_Fail"),width:350}),o.trigger("daria:vMessageBody:stopTranslate",!1)})}},_onMessageWidgetTranslateRevert:function(){var e=Daria.Translate.getCache(this.params.ids);e&&(ns.events.trigger("daria:vMessageBody:setSubject",e[0]),this.$node.html(e[1]),Daria.Translate.clearCache(this.params.ids)),this.getModel("message-body").trigger("daria:vMessageBody:revertTranslate")},_onMessageWidgetTranslateResetVisibility:function(){this.getModel("message-body").trigger("daria:vMessageBody:resetTranslateWidgetVisibility")},toggleQuote:function(e){Daria.MessageProcess.Actions.toggleQuote(e)},fireResizeBody:function(){if(this.node&&this.node.firstChild){var e=this.node.firstChild,t={scrollWidth:e.scrollWidth,clientWidth:e.clientWidth};ns.Model.get("thread-sidebar-state").set(".body",t),ns.events.trigger("message-body-full-load",this.$node.width())}},onThreadSidebarFlight:function(e,t){this.$node.children().css("margin-right",t||"")}}})},4956:function(e,t){ns.View.define("message-close-button",{yateModule:"message"})},4957:function(e,t){ns.View.define("message-head-date-eml",{models:{"message-body":{"ns-model-changed":!1,"ns-model-changed.info.date.view":"updateSelf"}},yateModule:"message",methods:{updateSelf:function(){this.invalidate(),this.update(null,{execFlag:ns.U.EXEC.PARALLEL})}}})},4958:function(e,t){ns.View.define("message-head-date",{models:{message:{"ns-model-changed":!1,"ns-model-changed.date.view":"forceUpdate"}},yateModule:"message"})},4959:function(e,t){ns.View.define("message-head-go-to-thread",{models:{message:!1},methods:{getGoToThreadLink:function(){var e=this.getModel("message"),t=e.getThreadId();return ns.router.generateUrl("messages",{current_folder:e.get(".fid"),thread_id:t})}},yateModule:"message"})},4960:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(370),s=n(1076),a=n(1075),o=n(349);n.n(o);ns.View.edefine("message-headline",{events:{"ns-view-touch":"_onTouch",click:"onClick","ns-view-htmlinit":"addMgTheme"},yateModule:"message",methods:{checkShow:function(){return Boolean(Daria.getPrevPageSearchContext())&&!(Object(o.hasFeature)(o.Features.WEB_REACT_TOOLBAR)||Object(o.hasFeature)(o.Features.REACT_LAYOUT))},_onTouch:function(){var e=Daria.getPrevPageSearchContext(),t="";e&&(e.request&&(t+=i18n("%Message_Headline_Query",e.url,_.escape(e.request))+" "),t+=i18n("%Message_Headline_Back_To_Search",e.url),this.$node.html(t))},onClick:function(){this.scenarioManager.finishScenarioIfActive(i.e,a.a),this.scenarioManager.startScenario(i.e,s.c)}}},"scenario-manager-mixin","mg-theme-mixin")},4961:function(e,t){var n={Public:{Verified:"mail--Locked",NotVerified:"mail--Unlocked"},Corp:{Verified:"mail--YaVerified",NotVerified:"mail--YaNotVerified"}};ns.View.define("message-head-dkim",{params:{ids:null},models:{message:"keepValid","message-body":"keepValid"},events:{"ns-view-show":"onShow",click:"onClick"},yateModule:"message",methods:{getTitle:function(){switch(this.getModel("message").getTrustLevel()){case 1:return i18n("%TrustButtonTooltip_level_1");case 2:return i18n("%TrustButtonTooltip_level_2");case 3:return i18n("%TrustButtonTooltip_level_3",this.getSenderDomain());case 4:return i18n("%TrustButtonTooltip_level_4");case 5:return i18n("%TrustButtonTooltip_level_5");case 6:return i18n("%TrustButtonTooltip_level_6")}},getIcon:function(e){var t=Daria.IS_CORP?n.Corp:n.Public;if(Daria.IS_CORP){var i=Daria.email.isCorp(this._getSender());return e>3&&i?t.Verified:t.NotVerified}return e>3?t.Verified:t.NotVerified},getTrustLevel:function(){var e=this.getModel("message").getTrustLevel();if(!Daria.IS_CORP)return e;if(null===e){var t=this.getModel("message-body").get(".info.dkimStatus"),n=this.getModel("message-body").get(".info.dkim")||{};"string"==typeof t&&"pass"===t&&(e=Daria.email.isCorp("any".concat(n.headeri))?4:null)}return e},_getSender:function(){return((this.getModel("message").get(".field")||[]).filter(function(e){return"from"===e.type})[0]||{}).email||""},getPopupContent:function(){return{collectorEmail:this.getCollectorEmail(),description:this.getDescription(),encryption:this.getEncryption(),senderDomain:this.getSenderDomain(),sign:this.getSign(),spam:this.getSpam()}},getCollectorEmail:function(){var e=this.getModel("message-body").get(".info.collectedRpopEmail");return e||(this.isCollected()?i18n("%CollectedEmail"):void 0)},getDescription:function(){switch(this.getTrustLevel()){case 1:return i18n("%TrustPopupDescription_level_1");case 2:return i18n("%TrustPopupDescription_level_2");case 3:return i18n("%TrustPopupDescription_level_3",this.getSenderDomain());case 4:return i18n("%TrustPopupDescription_level_4");case 5:return i18n("%TrustPopupDescription_level_5");case 6:return i18n("%TrustPopupDescription_level_6")}},getEncryption:function(){return this.getModel("message-body").get(".info.encrypted")?i18n("%Да"):i18n("%Нет")},isCollected:function(){return Boolean(this.getModel("message-body").get(".info.collectedRpopId"))},getSenderDomain:function(){return this.getModel("message-body").get(".info.senderDomain")},getSign:function(){var e=this.getModel("message-body").get(".info.dkimStatus"),t=this.getModel("message-body").get(".info.signedBy");return"string"==typeof e?"pass"===e?t:"fail"===e?i18n("%СhangedАfterSending"):i18n("%Нет"):t||i18n("%Нет")},getSpam:function(){return this.getModel("message-body").get(".info.isSpam")?i18n("%Да"):null},sendMetric:function(e){var t=this.getModel("message").getTrustLevel();Jane.c("Медальки (DKIM)","Медалька тип ".concat(t),e)},onShow:function(){this.getModel("message").getTrustLevel()?this.sendMetric("Показ"):Jane.c("Медальки (DKIM)","Нет данных для показа")},onClick:function(e){e.preventDefault(),e.stopPropagation();var t=nb.find(this.key);t&&t.open({where:this.$node.find(".js-dkim-icon"),how:{at:"bottom",my:"top"}}),this.sendMetric("Клик в медальку (показ поп-апа)")}}})},4962:function(e,t){ns.View.define("message-head-eml",{events:{"click .js-mail-Message-Head-Recievers_more":"toggleMoreRecievers"},models:{message:!1,"message-head-state":!1,"message-body":!1},params:function(e){return e},yateModule:"message",methods:{toggleMoreRecievers:function(){var e,t=this.$node.find(".js-mail-Message-Head-Recievers");e=t.hasClass("with-tooManyRecipients")?t.hasClass("is-folded"):this.getModel("message-head-state").toggleRecieversOpened(),t.toggleClass("is-folded",!e)}}})},4963:function(e,t){ns.View.define("message-head-folder",{params:{ids:null},models:{message:{"ns-model-changed":"keepValid","ns-model-changed.fid":"forceUpdate","ns-model-changed.tabId":"forceUpdate"}},yateModule:"message",methods:{_viewCheckHide:function(){var e=ns.page.current.params||{},t=e.current_folder,n=e.tabId,i=this.getModel("message");if(Daria.areFoldersTabsEnabled()&&i.isInTab()&&i.getTabId()!==n)return!1;if(!t)return!0;var s=i.getFolderId();return!s||t===s}}})},4964:function(e,t){ns.View.define("message-head",{models:{folders:!1,settings:!1,"message-head-state":!1,message:!1},events:{"daria:vMessageBody:setSubject@show":"_onMessageBodySetSubject","click .js-toggle-message-head":"_onClickToggleMessageHead"},yateModule:"message",methods:{_viewSenderFolded:function(){return this.getModel("message-head-state").get(".sender-closed")},_onClickToggleMessageHead:function(){var e=this.getModel("message-head-state").toggleSenderOpened();this.$node.toggleClass("is-folded",e)},_onMessageBodySetSubject:function(e,t){this.$node.find(".js-subject-content").text(t)},_onReadUnreadMessage:function(){this.getModel("message").toggleMark()},_selfUpdate:function(){this.update()}}})},4965:function(e,t){ns.View.define("message-head-labels",{models:{message:{"ns-model-changed":!1,"ns-model-changed.lid":"forceUpdate"}},yateModule:"message"})},4966:function(e,t){ns.View.define("message-head-recipient-count",{events:{"ns-view-htmlinit":"_checkCorpMaillists",click:"toggleMoreRecievers"},models:{message:!1,"message-body":!1,"message-head-state":!1},yateModule:"message",methods:{toggleMoreRecievers:function(){this.getModel("message-head-state").toggleRecieversOpened()},patchTree:function(){var e=this.super_.patchTree.call(this),t=this.getModel("message"),n=this.getModel("message-body"),i=n.isValid()?n:t;return e.isRecipient=i.isRecipient(),e},_maillistsCount:-1,getMaillistsCount:function(){return this._maillistsCount},_checkCorpMaillists:function(){if(-1===this._maillistsCount){var e=this.getModel("message-body"),t=_(e.getRecipients(!0,!0)).values().flatten().pluck("email").compact().uniq().value(),n=this;if(Daria.IS_CORP){var i=t.filter(Daria.email.isCorp);i.length&&ns.Model.get("get-maillists-static").getMaillists(i).then(function(e){n.setMaillists(e),n.forceUpdate()})}}},setMaillists:function(e){this._maillistsCount=e.length}}})},4967:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(62);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ns.View.define("message-head-recipient",{params:function(e){return e},models:{message:!1,"message-body":!1,"message-head-state":{"ns-model-changed":!1,"ns-model-changed.recievers-opened":"onRecieversOpenedToggled"},settings:!1},events:{"ns-view-show":"onViewShow","ns-view-hide":"onViewHide","click .js-contact-actions-dropdown":"_onClickContactActionsDropdown","click .js-mail-Message-Head-Recievers_more":"toggleMoreRecievers"},yateModule:"message",ctor:function(){this.onCopyEmails=this.onCopyEmails.bind(this)},methods:{onViewShow:function(){this.$node.on("copy",this.onCopyEmails),this.getModel("message-body").hasTooManyRecipients()&&this.getModel("message-head-state").setRecieversOpened(!1)},onViewHide:function(){this.$node.off("copy",this.onCopyEmails)},toggleMoreRecievers:function(){this.getModel("message-head-state").toggleRecieversOpened()},onRecieversOpenedToggled:function(){var e=!this.getModel("message-head-state").getRecieversOpened();this.$node.toggleClass("is-folded",e)},_onClickContactActionsDropdown:function(e){var t=e.currentTarget,n=ns.parseQuery($(t).data("params"));ns.action.run("mail-common.contact-actions",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},n,{node:t}))},onCopyEmails:function(e){e.stopPropagation(),e.preventDefault();var t=window.getSelection(),n=t.getRangeAt(0),i=$(n.startContainer),s=i.closest(".js-email").data("index"),a=i.hasClass(".js-email")?i.data("index"):s,o="number"==typeof a?a:0,r=t.getRangeAt(t.rangeCount-1),u=$(r.endContainer),l=u.closest(".js-email").data("index"),d=u.hasClass(".js-email")?u.data("index"):l,c="number"==typeof d,h=this.$node.find("[data-email]").length-1,g=c?d:h;c&&0===u.closest(".js-user-name").length&&g>o&&g--;for(var f=this.extractEmails(o,g),m=[],p=0;p<t.rangeCount;p++)m.push(t.getRangeAt(p));this.copyTextToClipboardAndResetSelection(f,t,m)},extractEmails:function(e,t){var n=Daria.Constants.CONTACTS.DELIMITER;return this.$node.find(".js-email").filter(function(n){return n>=e&&n<=t}).map(function(e,t){return $(t).data("email")}).toArray().join(n)},copyTextToClipboardAndResetSelection:function(e,t,n){var i=document.createElement("textarea");i.className="mail-Message-Head-Recievers-TempTextarea",i.value=e,document.body.appendChild(i),i.select();try{document.execCommand("copy")}catch(e){}document.body.removeChild(i),t.removeAllRanges(),n.forEach(function(e){return t.addRange(e)})},getMeetingLink:function(){var e=this.getModel("message"),t=Daria.Config["timeline-yandex-host-event"],n=Object(i.a)({name:e.get(".subject")||e.get(".firstline")||"",attendees:_.uniq(e.get(".field").map(function(e){return e.email}))});return"".concat(t,"?").concat(n)}}})},4968:function(e,t){function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s={absence:"%gap_workflow_absence_today",vacation:"%gap_workflow_vacation_today",trip:"%gap_workflow_trip_today",paid_day_off:"%gap_workflow_paid_day_off_today",conference_trip:"%gap_workflow_conference_trip_today",illness:"%gap_workflow_illness_today",conference:"%gap_workflow_conference_today",maternity:"%gap_workflow_maternity_today",learning:"%gap_workflow_learning_today"},a={absence:"%gap_workflow_absence_till",vacation:"%gap_workflow_vacation_till",trip:"%gap_workflow_trip_till",paid_day_off:"%gap_workflow_paid_day_off_till",conference_trip:"%gap_workflow_conference_trip_till",illness:"%gap_workflow_illness_till",conference:"%gap_workflow_conference_till",maternity:"%gap_workflow_maternity_till",learning:"%gap_workflow_learning_till"};ns.View.define("message-head-sender-info",{params:function(e){var t=ns.Model.get("message",{ids:e.ids}).getEmailInfoParams()||{};return{email:t.email,ref:t.ref,ids:e.ids}},models:{message:!1,"email-info-v2":!0,settings:!1},events:{"ns-view-htmlinit":"_onInit","click .js-social-button":"_onClickSocialButton","click .js-call-staff":"_onClickCallStaff"},yateModule:"message",methods:{CLASS_PHONE_DISABLED:"is-disabled",TIME_PHONE_DISABLED:5e3,_onInit:function(){this.$node.children().length&&this.$node.closest(".mail-Message-Head-Content").find(".js-toggle-message-head").addClass("mail-ui-HoverLink")},getGap:function(){var e=(this.getModel("email-info-v2").get(".staff.gaps")||[])[0];if(e)return function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach(function(t){i(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}({},e,{text:this.getGapText(e)})},getGapText:function(e){var t=new Date,n=new Date(e.date_to);return e.full_day&&n.setSeconds(-1),Jane.Date.isSameDay(t,n)?i18n(s[e.workflow]):i18n(a[e.workflow],Jane.Date.format("%Date_dB",n))},_onClickCallStaff:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget);if(!t.hasClass(this.CLASS_PHONE_DISABLED)){var n=this.getModel("email-info-v2").get(".staff.phones.work"),i=this;n&&((new Image).src=Daria.Config["staff-host"]+"/api/call/"+encodeURIComponent(n)),t.addClass(this.CLASS_PHONE_DISABLED),_.delay(function(){t.removeClass(i.CLASS_PHONE_DISABLED)},this.TIME_PHONE_DISABLED)}},_onClickSocialButton:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target).closest(".nb-button");if("enable-social"===t.data("value"))this.getModel("settings").setSettingOn("show_socnet_avatars");else{var n=t.find("a"),i=window.open(n.attr("href"),n.attr("target"));i&&i.focus()}}}})},4969:function(e,t){var n=["startrek","wiki"];ns.View.define("message-head-sender-name",{models:{message:!1},events:{click:"showPersonPopup"},yateModule:"message",methods:{isCorpService:function(){var e=this.getAbookContactParams(),t=Daria.email.getLogin(e.email||"");return-1!==n.indexOf(t)},showPersonPopup:function(){if(this.vPopup&&this.vPopup.isValid())return this.vPopup.close(),void(this.vPopup=null);Daria.IS_CORP&&this.isCorpService()||Jane.Services.run("#contacts",function(){this.vPopup=ns.View.create("abook-person-popup");var e=this.getAbookContactParams();ns.request("abook-contact",{email:e.email}).then(function(t){var n=t[0],i=n.get(".cid"),s=n.get(".isShared");e.shared=s,i&&!s&&(e.cid=i),this.vPopup.open(this.getPopupOptions(),e)},function(){this.vPopup.open(this.getPopupOptions(),e)},this).finally(function(){var t=e.shared?"общий":"личный";Daria.vAbook.Metrika.c("Карточка контакта","В Почте",t,"показ карточки (клик на имейл)")})}.bind(this))},getAbookContactParams:function(){var e=this.getFieldFrom()||{};return _.extend({email:e.email,ref:e.ref},this.params)},getFieldFrom:function(){return this.getModel("message").getFieldsByType("from")[0]},getPopupOptions:function(){return Daria.is2pane()?{where:this.$node,how:{my:"left top",at:"left-52 top"}}:{where:$(window),how:{my:"center",at:"center"}}}}})},4970:function(e,t){ns.View.define("message-head-sender-name-eml",{events:{click:"showPersonPopup"},models:{"message-body":!1},yateModule:"message",methods:{getFieldFrom:function(){return this.getModel("message-body").getFieldsByType("from")[0]}}},"message-head-sender-name")},4971:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(137);n.n(i);ns.View.define("message-head-sender-wrap",{models:{folders:!1,message:!1,settings:{"ns-model-changed":!1,"ns-model-changed.show_socnet_avatars":"forceUpdate"}},yateModule:"message",methods:{patchLayout:function(){return this._patchLayoutCheckSenderInfo()?"message-head-sender-info":"message-head-sender-empty"},_patchLayoutCheckSenderInfo:function(){var e=this.getModel("message");return!!e.isValid()&&(!e.hasSocialLabels()&&(!this.getModel("folders").isFolder(e.getFolderId(),i.SenderInfoDisabledFolders)&&(!!this.getModel("settings").isSet("show_avatars")&&!!e.getEmailInfoParams())))}}})},4972:function(e,t){ns.View.edefine("message-head-subject-eml",{events:{"daria:vApp:changeAppWidth@show":"onShow","click .js-toggle-title":"_onClickToggleTitle"},models:{message:!1},params:function(e){return e},yateModule:"message",methods:{onShow:function(){this._toggleTitleToggler()},CLASS_LONG_TITLE:"mail-Message-Toolbar_longTitle",_onClickToggleTitle:function(){return this.$node.find(".js-thread-toolbar").toggleClass("is-folded"),!1},_toggleTitleToggler:function(){var e=this.$node,t=e.find(".js-thread-toolbar");if(t.hasClass("is-folded")){var n=e.find(".js-toolbar-subject")[0],i=n.scrollWidth,s=!i||n.offsetWidth>=i-1;s&&t.addClass("is-folded"),t.toggleClass(this.CLASS_LONG_TITLE,!s)}}}})},4973:function(e,t){ns.View.edefine("message-head-subject",{events:{"ns-view-show":"onShow","ns-view-hide":"onHide","ns-view-htmlinit":"onInit","resize@show window":"_toggleTitleTogglerLazy","mouseenter .js-toolbar-subject":"onHoverSubjectOn","mouseleave .js-toolbar-subject":"onHoverSubjectOff"},ctor:function(){this._toggleTitleTogglerLazy=_.throttle(this._toggleTitleToggler.bind(this),20),this.recalculateHeaderFixedState=_.throttle(this.recalculateHeaderFixedState.bind(this),20,{trailing:!0,leading:!0})},models:{message:{"ns-model-changed":!1,"ns-model-changed.subject":"invalidate","ns-model-changed.subject_prefix":"invalidate"},settings:{"ns-model-changed":"keepValid","ns-model-changed.liza_minified":"lazyFixedRecalc","ns-model-changed.liza_minified_header":"lazyFixedRecalc"},"scroller-message":!1},yateModule:"message",methods:{CLASS_LONG_TITLE:"mail-Message-Toolbar_longTitle",onInit:function(){this._$toolbar=this.$node.find(".js-thread-toolbar"),this._$toolbarSubject=this.$node.find(".js-toolbar-subject")},onHoverSubjectOn:function(){this.$node.find(".js-mail-Message-Toolbar").addClass("with-subject-hovered")},onHoverSubjectOff:function(){this.$node.find(".js-mail-Message-Toolbar").removeClass("with-subject-hovered")},_toggleTitleToggler:function(){if(this._$toolbarSubject&&this._$toolbarSubject.length){var e=this.initialHeight||this._$toolbarSubject[0].offsetHeight,t=this._$toolbarSubject[0].scrollHeight<=e;t||this.initialHeight||(this.initialHeight=this._$toolbarSubject[0].offsetHeight),this._$toolbarSubject.css("max-height",t?"":this._$toolbarSubject[0].scrollHeight),this._$toolbar.toggleClass(this.CLASS_LONG_TITLE,!t)}},onShow:function(){this.onShowMarkAsRead(),this.fixedElementStart(),this._toggleTitleToggler()},onHide:function(){this.fixedElementStop(),this.recalculateHeaderFixedState.cancel(),this._toggleTitleTogglerLazy.cancel()},onShowMarkAsRead:function(){var e=this.getModel("message"),t=ns.Model.get("messages-checked",{mid:e.get(".mid")});t.check(e,!0),Daria.MOPS.updateHelper("mark",t,{})}}},"fixed-element-in-message-mixin")},4974:function(e,t){ns.View.define("message-toolbar-fake",{params:{ids:null},yateModule:"message"})},4975:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(407),s=n(1592),a=n(1594),o=(n.n(a),n(347));function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}ns.View.define("message-toolbar",{params:{ids:null},models:{"message-toolbar":!0,message:!1,settings:!1},events:{"ns-view-show":"onShow","click .js-toolbar-item-reply":"_onReplyToolbarButton","click .js-toolbar-item-reply-all":"_onReplyAllToolbarButton","click .js-toolbar-item-forward":"_onForwardToolbarButton","click .js-toolbar-item-delete":"_onRemoveToolbarButton","click .js-toolbar-item-spam":"_onTospamToolbarButton","click .js-toolbar-item-not-spam":"_onNotspamToolbarButton","click .js-toolbar-item-unsubscribe-one":"_onUnsubscribeToolbarButton","click .js-toolbar-item-archive":"_onArchiveToolbarButton","click .js-toolbar-item-draft-finish":"_onDraftFinishToolbarButton","click .js-toolbar-item-labels-actions":"_openLabelsDropdown","click .js-toolbar-item-folders-actions":"_openFoldersDropdown","click .js-toolbar-item-pin":"_onPinToolbarButton","click .js-toolbar-item-unpin":"_onUnpinToolbarButton","click .js-toolbar-item-more":"_onMoreToolbarButton","click .js-toolbar-item-reply-later":"_onReplyLaterToolbarButton","click .js-toolbar-item-translate":"_onTranslateToolbarButton","daria:vMessageToolbar:reply":"onReplyHotkey"},yateModule:"message",methods:{onShow:function(){ns.events.atrigger("daria:vMessageToolbar:toolbar-didRendered")},_onReplyToolbarButton:Object(s.a)(function(){Daria.startScenarioForCompose(i.n),Jane.ToolbarMetric.messageToolbar("reply"),this.showQuickReply(!1),this.closePopup()}),_onReplyAllToolbarButton:Object(s.a)(function(){Daria.startScenarioForCompose(i.k),Jane.ToolbarMetric.messageToolbar("reply all"),this.showQuickReply(!0),this.closePopup()}),_onReplyLaterToolbarButton:Object(s.a)(function(e){Jane.ToolbarMetric.messageToolbar("reply later");var t=null;this.params.ids&&(t=ns.Model.get("message",{ids:this.params.ids}).getReplyLaterDate()),Object(a.renderReplyLaterPopup)({anchor:{current:e.currentTarget},direction:"left",onSelectedDate:this._onSelectReplyLaterDate.bind(this),remindDate:t,onRemoveReminder:this._onRemoveReminder.bind(this)})}),_onTranslateToolbarButton:Object(s.a)(function(){Jane.ToolbarMetric.messageToolbar("translate"),Object(o.getMessageViewerBridge)().showTranslateBar(this.params.ids),this.closePopup()}),_onSelectReplyLaterDate:function(e){this._onToolbarButton("reply-later-create",{date:e})},_onRemoveReminder:function(){this._onToolbarButton("reply-later-remove")},_onDraftFinishToolbarButton:Object(s.a)(function(){ns.page.go(ns.router.generateUrl("compose2",{ids:this.params.ids}))}),_onRemoveToolbarButton:function(){return Jane.ToolbarMetric.messageToolbar("remove"),this._onToolbarButton("remove",{ignoreUnsavedDraft:!0})},_onTospamToolbarButton:Object(s.a)(function(){return Jane.ToolbarMetric.messageToolbar("spam"),this._onToolbarButton("tospam")}),_onNotspamToolbarButton:Object(s.a)(function(){return Jane.ToolbarMetric.messageToolbar("not spam"),this._onToolbarButton("notspam")}),_onUnsubscribeToolbarButton:Object(s.a)(function(){return Jane.ToolbarMetric.messageToolbar("unsubscribe-one"),this._onToolbarButton("unsubscribe-one")}),_onArchiveToolbarButton:Object(s.a)(function(){return Jane.ToolbarMetric.messageToolbar("archive"),this._onToolbarButton("archive")}),_onPinToolbarButton:Object(s.a)(function(){return Jane.ToolbarMetric.messageToolbar("pin"),this._onToolbarButton("pin")}),_onUnpinToolbarButton:Object(s.a)(function(){return Jane.ToolbarMetric.messageToolbar("unpin"),this._onToolbarButton("unpin")}),_onMarkImportantToolbarButton:Object(s.a)(function(){Jane.ToolbarMetric.messageToolbar("Important","add");var e=ns.Model.get("labels").getImportantLID();return this._onToolbarButton("label",{lid:e})}),_onMarkUnimportantToolbarButton:Object(s.a)(function(){Jane.ToolbarMetric.messageToolbar("Important","remove");var e=ns.Model.get("labels").getImportantLID();return this._onToolbarButton("unlabel",{lid:e})}),_onToolbarButton:function(e,t){t=t||{},Daria.DEBUG&&console.log(e),this.closePopup();var n=t.mMessagesChecked||this.getMessagesCheckedInstance();return Daria.MOPS[e](n,t)},getMessagesCheckedInstance:function(){return this._mMessagesChecked=ns.Model.get("messages-checked",{mid:this.params.ids}).checkByMidInParams(),this._mMessagesChecked},_openLabelsDropdown:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"label",this.getModel("message")),this._openDropdown("labels",e)},_openFoldersDropdown:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"move",this.getModel("message")),this._openDropdown("folders",e)},_openDropdown:function(e,t){var n=$(t.currentTarget);if(!n.hasClass("js-open-dropdown")){var i=ns.View.create("".concat(e,"-actions")),s=ns.Model.get("messages-checked",{mid:this.params.ids}).checkByMidInParams(),a=ns.Model.get("labels").getImportantLID();i.open(t.currentTarget,s,{isInDropdown:!0,isInMore:!0,logMetrika:function(e,t){var n,i=["метка",e===a?"флажок":"пользовательская метка"];i=i.concat("label"===t?"проставление":"снятие"),(n=Jane.ToolbarMetric).messageToolbar.apply(n,r(i))}}).then(function(){n.addClass("js-open-dropdown"),i.nbPopup.on("nb-closed",function(){n.removeClass("js-open-dropdown")})})}},_onMoreToolbarButton:function(e){if(this.vPopup&&this.vPopup.isValid())return this.vPopup.closePopup(),void(this.vPopup=null);this.vPopup=ns.View.create("message-toolbar-popup",this.params),this.vPopup.open({where:e.currentTarget})},closePopup:function(){this.vPopup&&this.vPopup.closePopup()}}},"message-actions")},4993:function(e,t){ns.View.edefine("message-toolbar-popup",{params:{ids:null},models:{"message-toolbar":!0,"message-body":!0,message:!0},events:{"click .js-toolbar-item-reply":"_onReplyToolbarButton","click .js-toolbar-item-reply-all":"_onReplyAllToolbarButton","click .js-toolbar-item-forward":"_onForwardToolbarButton","click .js-toolbar-item-delete":"_onRemoveToolbarButton","click .js-toolbar-item-spam":"_onTospamToolbarButton","click .js-toolbar-item-not-spam":"_onNotspamToolbarButton","click .js-toolbar-item-unsubscribe":"_onUnsubscribeToolbarButton","click .js-toolbar-item-archive":"_onArchiveToolbarButton","click .js-toolbar-item-draft-finish":"_onDraftFinishToolbarButton","click .js-toolbar-item-labels-actions":"_openLabelsDropdown","click .js-toolbar-item-folders-actions":"_openFoldersDropdown","click .js-toolbar-item-pin":"_onPinToolbarButton","click .js-toolbar-item-unpin":"_onUnpinToolbarButton","click .js-toolbar-item-mark-important":"_onMarkImportantToolbarButton","click .js-toolbar-item-mark-unimportant":"_onMarkUnimportantToolbarButton","click .js-toolbar-item-message-properties":"_onClickMessageProperties","click .js-toolbar-item-filters-create":"_onClickFiltersCreate","click .js-kbd-print":"_onPrintToolbarButton","daria:vScrollerMessage:scroll@show":"closePopup"},yateModule:"message",methods:{open:function(e){this.update({},{execFlag:ns.U.EXEC.PARALLEL}).then(function(){this.nbPopup=nb.block(this.node),this.nbPopup.open(e),this.nbPopup.on("nb-closed",this.destroySelf.bind(this))},this)},closePopup:function(){this.nbPopup&&this.nbPopup.close()},_onClickMessageProperties:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"message-source",this.getModel("message")),this.closePopup()},destroySelf:function(){var e=this;_.defer(function(){e.nbPopup&&(e.nbPopup.destroy(),e.nbPopup=null),e.destroy()})},_onPrintToolbarButton:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"print",this.getModel("message"))},_onClickFiltersCreate:function(e){var t=ns.action.getParams(e.currentTarget);Jane.ToolbarMetric.setToolbarMetrics(e,t,"filters-create",this.getModel("message"))}}},"message-toolbar")},4994:function(e,t){ns.View.define("message-widget-common",{methods:{_onNsViewDestroyed:function(){this.destroyed||this.getModel("message-widget-state").setViewUserClose(this.id)}}})},4995:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4996);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,s=!1,a=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==r.return||r.return()}finally{if(s)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var a=null,o="default",r="custom",u="hide";ns.View.define("message-widget-confirm-classification",{params:{ids:null},models:{message:!1,"message-body":!1,"message-widget-state":!1,"state-message-thread-item":{"ns-model-changed":!1,"ns-model-changed.isOpened":"closeOnMessageClose"}},events:{"ns-view-init":"onInit","ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-htmldestroy":"onHtmlDestroy","ns-view-destroyed":"_onNsViewDestroyed","ns-page-before-load":"closeOnMessagePageClose","click .js-refute-classification":"refute","click .js-confirm-classification":"confirm","click .js-custom-classification":"showOwnVariant","click .js-hide-classification":"hide","click .js-send-custom-classification":"sendOwnVariant","click .js-not-understand-classification":"notUnderstand","click .js-disturb-classification":"disturb"},yateModule:"message",ctor:function(){this.onShow=_.once(this.onShow.bind(this))},methods:{onInit:function(){a||(a=new i.a),this._type=a.selectType(this.getTypes()),this._category=a.getCategory(this._type),this._presentation=a.getPresentationData(this._category),this._state=o},onHtmlInit:function(){var e=this;this._state===r&&(this.nbCustomClassification=nb.$block(".js-custom-classification-input",this.node),this.nbCustomClassification.on("input",function(){return e.onCustomInput()}))},onShow:function(){this._sendLog("show"),this._sendMetric("Показ плашки")},onHtmlDestroy:function(){this.nbCustomClassification&&(this.nbCustomClassification.destroy(),this.nbCustomClassification=null)},onCustomInput:function(){this.nbCustomClassification.$control.removeClass("_nb-input-controller_highlight");var e=this.nbCustomClassification.getValue();e.length>50&&this.nbCustomClassification.setValue(e.slice(0,50))},changeState:function(e){this._state=e,this.forceUpdate()},showOwnVariant:function(){this.changeState(r),this._sendMetric("свой вариант"),this._sendLog("own_variant")},sendOwnVariant:function(){var e=this.nbCustomClassification.getValue().trim().slice(0,50);if(e.length<=0)return this.nbCustomClassification.$control.addClass("_nb-input-controller_highlight"),void this.nbCustomClassification.focus();this._sendLog("own_variant_send",{value:e}),this.destroy()},hide:function(){this._sendLog("hide"),this._sendMetric("скрыть"),this.isHideState()?this.destroy():this.changeState(u)},refute:function(){this._sendMetric("нет"),this._sendLog("no"),this.destroy()},confirm:function(){this._sendMetric("да"),this._sendLog("yes"),this.destroy()},notUnderstand:function(){this._sendLog("dontunderstand"),this._sendMetric("не понимаю"),this.destroy()},disturb:function(){this._sendLog("disturb"),this._sendMetric("мешает"),this.destroy()},getTypes:function(){var e=this.getModel("message").get(".type");return Array.isArray(e)?e:[]},isCustomState:function(){return this._state===r},isHideState:function(){return this._state===u},getPresentation:function(){return this._presentation},_sendMetric:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=Jane).c.apply(e,["Классификатор типов писем","Запрос к пользователю",this._type].concat(n))},_sendLog:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({action:"classification",mid:this.getModel("message").get(".mid"),types:this.getTypes().join(","),show_type:this._type,category:this._category,state:this._state},t,{target:e}),i=ns.request.addRequestParams({data:JSON.stringify(n)});Daria.actionLog.send(i)},closeOnMessageClose:function(){this._state!==o&&this.getModel("message-widget-state").setViewUserClose(this.id)},closeOnMessagePageClose:function(e,t){var n=s(t,2),i=n[0],a=n[1],r=i.page,u=i.params,l=a.page,d=a.params;r===l&&_.isEqual(u,d)||this._state===o||this.getModel("message-widget-state").setViewUserClose(this.id)}}},"message-widget-common")},4996:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var i=n(349),s=(n.n(i),n(1177)),a=n.n(s),o=n(4997),r=n(1599);function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var l=a.a.meta,d=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._config=Object(o.a)(Object(i.getFeatureParams)(i.Features.WEB_EMAIL_CLASSIFICATION)||{})}return function(e,t,n){t&&u(e.prototype,t),n&&u(e,n)}(e,[{key:"selectType",value:function(e){var t=null;return this._config.types.some(function(n){return e.indexOf(n.id)>-1&&(t=n.id),t}),null!==t?t:e[0]}},{key:"getCategory",value:function(e){var t=this._config,n=t.types,i=t.categories,s=_.find(n,function(t){return t.id===e});return s?i[s.category]?s.category:(Object(r.a)("category_not_found",{category:s.category,fallback:this._config.fallback}),this._config.fallback):this._config.fallback}},{key:"getDataByCategory",value:function(e){return this._config.categories[e]||{}}},{key:"getPresentationData",value:function(e){var t=this.getDataByCategory(e),n=t.buttons||{},i=Object.keys(n).reduce(function(e,t){var i=n[t];return i&&(e[t]=!i.title||i18n("%".concat(i.title))),e},{}),s=l.requiredCategoryFields.reduce(function(e,n){return e[n]=i18n("%".concat(t[n])),e},{});return Object.assign({theme:this._config.theme},s,i)}}]),e}()},4997:function(e,t,n){"use strict";t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_.defaultsDeep({},_.omit(e,"types"),_.omit(a,"types"));return t.types=e&&Array.isArray(e.types)?e.types:a.types,t.categories=Object(i.a)(Object(i.b)(t.categories)),t.fallback=t.categories[t.fallback]?t.fallback:a.fallback,t};var i=n(4998),s=n(1177),a=n.n(s).a.default},4998:function(e,t,n){"use strict";t.b=function(e){return Object.keys(e).reduce(function(t,n){return!function(e){return a.requiredCategoryFields.every(function(t){return e[t]&&"string"==typeof e[t]})}(e[n])?Object(i.a)("invalid_category",{category:n}):t[n]=e[n],t},{})},t.a=function(e){return Object.keys(e).forEach(function(t){e[t].buttons&&(e[t].buttons=function(e){var t=_.clone(e),n=a.buttons;return Object.keys(t).forEach(function(e){n[e]&&(t[e]=_.defaults({},t[e],n[e]))}),t}(e[t].buttons))}),e};var i=n(1599),s=n(1177),a=n.n(s).a.meta},4999:function(e,t){ns.View.define("message-widget-download-full",{params:{ids:null},models:{"message-body":!1,"message-widget-state":!1},events:{"ns-view-show":"_onNsViewShow","ns-view-destroyed":"_onNsViewDestroyed"},yateModule:"message",methods:{_onNsViewShow:function(){Jane.c("Скачать письмо целиком","показ"),Jane.ErrorLog.send({event:"message.trimmed",stid:this.getModel("message-body").getSTID()})}}},"message-widget-common")},5000:function(e,t){ns.View.define("message-widget-ignore-thread",{params:{ids:null},models:{settings:!1,message:!1,"message-widget-state":!1},events:{"ns-view-show":"_onNsViewShow","ns-view-destroyed":"_onNsViewDestroyed","click .js-unignore":"_onClickUnignore"},yateModule:"message",methods:{_onNsViewShow:function(){Jane.c("Статуслайн игнорирования треда","Показ в письме")},_onClickUnignore:function(){var e=this.getModel("message").getThreadId();Daria.MOPS.unignore({tids:e}),this.destroy()}}},"message-widget-common")},5001:function(e,t){ns.View.define("message-widget-imap-deleted",{params:{ids:null},models:{settings:!1,"message-widget-state":!1},events:{"ns-view-destroyed":"_onNsViewDestroyed","click .js-close":"_onClickClose"},yateModule:"message",methods:{_onClickClose:function(){this.getModel("settings").setSettingOn("hide-imap-deleted"),this.destroy()}}},"message-widget-common")},5002:function(e,t){ns.View.define("message-widget-noreply",{params:{ids:null},models:{message:!1,labels:!1,"message-widget-state":!1},events:{"ns-view-destroyed":"_onNsViewDestroyed","click .js-stop-waitreply":"_onClickStopWaitreply"},yateModule:"message",methods:{_onClickStopWaitreply:function(){var e=this.getModel("labels").getWaitingForReplyLabel(),t=e&&e.lid;t&&ns.events.trigger("daria:vToolbarButton:unlabel",{lid:t}),this.destroy()}}},"message-widget-common")},5003:function(e,t){ns.View.define("message-widget-translate",{params:{ids:null},models:{message:!1,"message-body":{"ns-model-changed":!1,"daria:vMessageBody:startTranslate":"onMessageBodyStartTranslate","daria:vMessageBody:stopTranslate":"onMessageBodyStopTranslate","daria:vMessageBody:revertTranslate":"onMessageBodyRevertTranslate","daria:vMessageBody:resetTranslateWidgetVisibility":"onMessageBodyResetWidgetVisibility"},"message-widget-state":!1,"translate-langs":!1},events:{"ns-view-show":"onShow","ns-view-destroyed":"_onNsViewDestroyed","click .js-open-translate-menu":"onClickOpenTranslateMenu","click .js-translate":"onClickTranslate","click .js-revert":"onClickRevert","click .js-reply-using-translator":"onReplyUsingTranslator","click .js-send-help-click-metric":"sendHelpClickMetric","click .js-close":"onClickClose"},yateModule:"message",ctor:function(){this._langTo=null,this._langFrom=null,this._isLoaded=!1,this._isTranslated=!1,this.sendMetricOnce=_.once(this.sendMetric.bind(this))},methods:{onShow:function(){this.sendMetricOnce("Показ")},getLangFromDefault:function(){return Daria.Translate.getLangByMid(this.params.ids)||Daria.Translate.defineLanguage(this.getModel("message-body").getComposeHTML())},getLangFrom:function(){return this._langFrom||this.getLangFromDefault()},getLangTo:function(){return this._langTo||Daria.Translate.getDefaultLangTo(this.getLangFrom())},isLoaded:function(){return this._isLoaded},isTranslated:function(){return this._isTranslated},onClickOpenTranslateMenu:function(e){var t=this,n=ns.parseQuery($(e.currentTarget).data("params")),i=n.dir,s="_popupTranslateSelectLang_"+i,a=this[s],o="to"===i?'Click "Translate on"':'Click "Message language"';a?a.close():(t.sendMetric(o,"Popup opening"),(a=ns.View.create("translate-select-lang",{currentLang:n.lang})).on("selected",function(e,n){if(this.close(),"to"===i){var s=t.getLangTo();t.getLangFrom()===n&&(t._langFrom=s),t.sendMetric(o,"".concat(s," -> ").concat(n)),t._langTo=n}else{var a=t.getLangFrom();t.getLangTo()===n&&(t._langTo=a),t.sendMetric(o,"".concat(a," -> ").concat(n)),t._langFrom=n}t.forceUpdate()}),a.on("closed",function(){delete t[s]}),a.open({where:e.currentTarget}),this[s]=a)},onClickTranslate:function(){this.getModel("message-body").trigger("daria:vMessageWidgetTranslate:translate",{langFrom:this.getLangFrom(),langTo:this.getLangTo()}),this.sendMetric('Click on "Translate"',"".concat(this.getLangFrom()," -> ").concat(this.getLangTo()))},onClickRevert:function(){this.getModel("message-body").trigger("daria:vMessageWidgetTranslate:revert"),this.sendMetric('Click on "Reverse"')},onReplyUsingTranslator:function(){this.sendMetric('Click on "Answer with translate"')},sendHelpClickMetric:function(){this.sendMetric('Click on "i"')},onMessageBodyStartTranslate:function(){this._isLoaded=!0,this.forceUpdate()},onMessageBodyStopTranslate:function(e,t){this._isTranslated=t,this._isLoaded=!1,this.forceUpdate()},onMessageBodyRevertTranslate:function(){this._isTranslated&&(this._isTranslated=!1,this._isLoaded=!1,this.forceUpdate())},onMessageBodyResetWidgetVisibility:function(){this.getModel("message-widget-state").resetViewUserClose(this.id)},onClickClose:function(){this.getModel("message-widget-state").setViewUserClose(this.id),this.sendMetric("Click on cross")},sendMetric:function(){for(var e,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=Jane).c.apply(e,["Message view","Translate widget",Daria.is2pane()?"2pane":"3pane"].concat(n))}}},"message-widget-common")},5004:function(e,t){ns.View.define("message-widget-spam",{params:{ids:null},models:{message:{"ns-model-changed":!1,"ns-model-changed.lid":"onMessageLidChange"},"message-body":!1,"message-widget-state":!1},events:{"ns-view-show":"_onNsViewShow","click .js-show-content":"_onClickShowContent","click .js-delete":"_onClickDelete"},yateModule:"message",methods:{patchTree:function(){var e=this.super_.patchTree.call(this),t=this.getModel("message-body");return e.isPhishing=this._isPhishing(),e.hasImg=t.get(".has-img"),e.hasLinks=t.get(".has-links"),e},onMessageLidChange:function(){this.getModel("message-body").hasPhishingBody()||(this.getModel("message").isSpam()?this.forceUpdate():this._isPhishing()||this.getModel("message-widget-state").setViewUserClose(this.id))},_isPhishing:function(){return this.getModel("message").isPhishing()||this.getModel("message-body").hasPhishingBody()},_onNsViewShow:function(){this._isPhishing()?Jane.c("Message view","show message about phishing"):Jane.c("Сообщение о непоказе картинок и ссылок в спаме","Показ")},_onClickDelete:function(){ns.events.trigger("daria:vToolbarButton:remove"),this.getModel("message-widget-state").setViewUserClose(this.id)},_onClickShowContent:function(){ns.events.trigger("daria:vMessageWidgetSpam:showContent"),this.getModel("message-widget-state").setViewUserClose(this.id)}}})},5005:function(e,t){ns.ViewCollection.define("message-widget",{params:{ids:null},models:{message:!1,"message-body":!1,"message-widget-list":!1,"message-widget-state":{"ns-model-changed":!1,"ns-model-changed.show":"onChangeStateShow"}},events:{"ns-view-show":"onShow"},split:{byModel:"message-widget-list",intoViews:function(e){return e.get(".type")}},yateModule:"message",methods:{onShow:function(){this.updateListOfWidgets()},onChangeStateShow:function(){this.updateListOfWidgets()},updateListOfWidgets:function(){var e=this.getModel("message-widget-list");e.clear(),Daria.MessageWidget.creatingListOfWidgets(e),_.defer(function(){this.isVisible()&&this.update(this.params,{execFlag:ns.U.EXEC.PARALLEL})}.bind(this))}}})},5006:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);n.n(i);ns.View.define("no-message",{events:{"ns-view-hide":"onhide","ns-view-show":"onshow","click .js-goto-inbox":"onClick"},yateModule:"message",methods:{onhide:function(){$(".ns-view-app").removeClass("g-hidden").append(this.node)},onshow:function(){ns.Model.invalidate("message"),ns.Model.invalidate("messages"),ns.Model.invalidate("messages-item-state"),$(".ns-view-app").addClass("g-hidden").before(this.node),Jane.c({"Переход к недоступному письму":"Показ плашки"}),Jane.ErrorLog.log({source:i.ErrorSource.Logic,sourceMethod:i.ErrorSourceMethod.NoSuchMessage,block:i.ErrorBlock.Message,type:i.ErrorType.View,method:"onshow",pageType:ns.page.current.page||"",pageReferrer:Daria.Page.referrer||"",pagePrevious:ns.page.history.getPrevious()||"",params:ns.params2query(ns.page.current.params)})},onClick:function(){Jane.c({"Переход к недоступному письму":"клик по 'Вернуться в почту'"})}}})},5007:function(e,t){ns.View.define("message-fake-list",{events:{"ns-view-show":"onShow","ns-view-hide":"onHide","ns-view-htmldestroy":"onHtmlDestroy"},models:{message:!1},params:function(e){return{ids:e.thread_id||e.ids}},ctor:function(){this.forceUpdate=_.debounce(this.forceUpdate.bind(this),50)},yateModule:"message",methods:{onShow:function(){this.getMessages().on("ns-model-insert",this.forceUpdate)},onHide:function(){this.getMessages().off("ns-model-insert",this.forceUpdate)},onHtmlDestroy:function(){this.$node.children().each(this._childrenIterate)},getMessages:function(){var e=this.getModel("message").getThreadId();return ns.Model.get("messages",{thread_id:e})},_childrenIterate:function(){this._nsView?this._nsView.destroy():$(this).remove()}}})},5008:function(e,t){Daria.InfiniteViewCollection=function(){},no.inherit(Daria.InfiniteViewCollection,ns.ViewCollection,{fillList:function(){!this.__lockLoadMore&&this.canLoadMore()&&this.isVisible()&&(this.node.scrollHeight-this.node.offsetHeight>44||(this.__lockLoadMore=!0,_.method("loadMoreStart")(this),this.loadMore().then(function(){return this.update()},this).then(function(){this.setFullyLoadedStateIfNeeded(),this.__lockLoadMore=!1,_.method("loadMoreStop")(this)},this).then(function(){_.delay(this.fillList.bind(this),50)},this)))},loadMoreByScrolling:_.debounce(function(){!this.__lockLoadMore&&this.canLoadMore()&&(this.node.scrollHeight-this.node.scrollTop-this.node.clientHeight>54||(this.__lockLoadMore=!0,_.method("loadMoreStart")(this),this.loadMore().then(function(){return this.update()},this).then(function(){this.setFullyLoadedStateIfNeeded(),this.__lockLoadMore=!1,_.method("loadMoreStop")(this)},this)))},50),setFullyLoadedStateIfNeeded:function(){this.$node.toggleClass("mail-ThreadSidebar-Item-FullyLoaded",!this.canLoadMore())}})},5009:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(137);n.n(i);ns.View.define("thread-sidebar-wrap",{models:{message:!1,"thread-sidebar-state":{"ns-model-changed":!1,"ns-model-changed.flight":"onChangeFlightDebounce","ns-model-changed.update":"update"}},params:{ids:null},yateModule:"message",events:{"ns-view-show":"onShow","ns-view-hide":"onHide"},ctor:function(){this.onChangeFlightDebounce=_.debounce(this.onChangeFlight.bind(this),0)},methods:{onShow:function(){if(this.checkShow()){var e=this.getModel("message").getThreadId(),t=this.getMenuItems();ns.Model.get("thread-sidebar",{thread_id:e}).setData({items:t});var n=this.updateParams(),i=this.node.appendChild(this.node.ownerDocument.createElement("div"));this.vThreadSidebar=ns.View.create("thread-sidebar-box",n),this.vThreadSidebar._setNode(i),this.vThreadSidebar.invalidate(),this.vThreadSidebar.updateByLayout("layout-thread-sidebar",n,{execFlag:ns.U.EXEC.PARALLEL}).then(this.onChangeFlight,this)}},update:function(){this.vThreadSidebar&&this.vThreadSidebar.update(this.updateParams(),{execFlag:ns.U.EXEC.PARALLEL})},onHide:function(){this.onChangeFlightDebounce.cancel(),this.vThreadSidebar&&(this.vThreadSidebar.destroy(),this.vThreadSidebar=null)},updateParams:function(){var e=this.getModel("message");return{thread_id:e.getThreadId(),ids:this.params.ids,mid:e.get(".mid"),from:e.get('.field[.type=="from"].email')[0]}},checkShow:function(){return!this.getModel("message").inFolderBySymbol(i.ThreadSidebarDisabledFolders)},onChangeFlight:function(){var e="";this.getModel("thread-sidebar-state").isFlight()&&(e=this.$node.closest(".js-message-wrap").find(".js-message-heads").height(),e-=1),this.$node.css("min-height",e),ns.events.trigger("daria:vApp:changeRightColumSize")},getMenuItems:function(){var e=this.getModel("message"),t=e.getThreadId(),n=[{id:1,layout:"layout-thread-sidebar-item-related",thread_id:t,title:i18n("%Thread_Sidebar_Related_Title"),metrika_onshow_title:"Показ Писем на тему",className:"qa-thread-sidebar-related"}];return e.hasSocialLabels()||n.push({id:2,layout:"layout-thread-sidebar-item-attachments",thread_id:t,title:i18n("%Thread_Sidebar_Attachments_Title"),metrika_onshow_title:"Показ Вложения",className:"qa-thread-sidebar-attachments"},{id:3,layout:"layout-thread-sidebar-item-links",thread_id:t,title:i18n("%Thread_Sidebar_Links_Title"),metrika_onshow_title:"Показ Ссылки",className:"qa-thread-sidebar-links"}),n.push({id:4,layout:"layout-thread-sidebar-item-same-author",thread_id:t,title:i18n("%Thread_Sidebar_Same_Author_Title",e.get('.field[.type=="from"].name')[0]),metrika_onshow_title:"Показ Письма от",className:"qa-thread-sidebar-same-author"}),n}}})},5010:function(e,t){ns.ViewCollection.define("thread-sidebar",{events:{"ns-page-before-load@show":"onPageBeforeLoad","ns-view-show":"toggleExpand"},models:{"thread-sidebar":!1,"thread-sidebar-state":{"ns-model-changed":!1,"ns-model-changed.activeItemId":"onStateChange","ns-model-changed.update":"onStateChange","ns-model-changed.flight":"toggleExpand"},settings:{"ns-model-changed":!1,"ns-model-changed.right_column_expanded":"toggleExpand"}},params:{thread_id:null,ids:null,mid:null,from:null},split:{byModel:"thread-sidebar",intoViews:"thread-sidebar-item"},yateModule:"message",methods:{isColumnFlight:function(){return this.getModel("thread-sidebar-state").isFlight()},toggleExpand:function(){var e=this.getModel("settings").getSign("right_column_expanded");this.$node.toggleClass("is-collapsed",this.isColumnFlight()&&!e)},onStateChange:function(){this.update(null,{execFlag:ns.U.EXEC.PARALLEL})},onPageBeforeLoad:function(e,t){var n=this.getModel("thread-sidebar-state");_.get(t[0],".page")!==_.get(t[1],".page")?n.unsetActiveItem():n.trigger("daria:thread-sidebar:save-scroll-in-related")}}})},5011:function(e,t){ns.View.define("thread-sidebar-box",{events:{"ns-view-show":"onShow"},models:{"thread-sidebar-state":{"ns-model-changed":!1,"ns-model-changed.flight":"onChangeFlight","ns-model-changed.body":"checkFlight"}},yateModule:"message",methods:{onShow:function(){this.checkFlight(),this.getModel("thread-sidebar-state").metrikaCount("Показ")},onChangeFlight:function(){var e=this.getModel("thread-sidebar-state");this.$node.toggleClass("is-flight",e.isFlight()),this.getModel("thread-sidebar-state").metrikaCount("Показ")},checkFlight:function(){var e=this.getModel("thread-sidebar-state"),t=e.get(".body");if(!_.isEmpty(t)){var n=t.scrollWidth-t.clientWidth>20;n?ns.events.trigger("daria:vThreadSidebarBox:flight",this.$node.outerWidth(!0)):ns.events.trigger("daria:vThreadSidebarBox:flight",0),e.setIfChanged(".flight",n)}}}})},5012:function(e,t){ns.View.define("thread-sidebar-item",{models:{"thread-sidebar-item":!1,"thread-sidebar-state":!1},params:{thread_id:null,ids:null,mid:null,from:null,id:null},yateModule:"message",methods:{patchLayout:function(){return this.getModel("thread-sidebar-state").get(".activeItemId")===this.params.id?this.getModel("thread-sidebar-item").get(".layout"):"layout-thread-sidebar-item"}}})},5013:function(e,t){ns.View.define("thread-sidebar-item-save-scroll",{methods:{scrollInit:function(){ns.assert(this.getModel("thread-sidebar-state"),"Daria.vThreadSidebarItemSaveScroll","требует наличия модели thread-sidebar-state в зависимостях"),_.bindAll(this,["_saveScrollTopPosition"])},scrollStart:function(){var e=this.getModel("thread-sidebar-state");e.shouldScrollRelatedIntoView()?(e.disableScrollRelatedIntoViewFlag(),this._scrollCurrentLetterIntoView()):this._restoreScrollTopPosition(),this.getModel("thread-sidebar-state").on("daria:thread-sidebar:save-scroll-in-related",this._saveScrollTopPosition)},scrollStop:function(){this.getModel("thread-sidebar-state").off("daria:thread-sidebar:save-scroll-in-related",this._saveScrollTopPosition)},_saveScrollTopPosition:function(){this.getModel("thread-sidebar-state").set(".relatedScrollTop",this.$node.scrollTop(),{silent:!0})},_scrollCurrentLetterIntoView:function(){var e=this.$node.find(".mail-ThreadSidebar-List-Item.is-selected")[0];e&&(this.node.scrollTop=e.offsetTop-(this.node.offsetHeight-e.offsetHeight)/2)},_restoreScrollTopPosition:function(){var e=this.getModel("thread-sidebar-state");this.$node.scrollTop(e.get(".relatedScrollTop"))}}})},5014:function(e,t){ns.View.define("thread-sidebar-item-title",{events:{click:"toggleItem"},models:{"thread-sidebar-item":!1,"thread-sidebar-state":{"ns-model-changed":"keepValid","ns-model-changed.activeItemId":"onActiveChanged"}},params:{thread_id:null,id:null},yateModule:"message",ctor:function(){var e=this;this.metrikaBlockCount=_.once(function(t){e._metrikaBlockCount.call(e,t)})},methods:{toggleItem:function(){var e=this.getModel("thread-sidebar-state"),t=this.getModel("thread-sidebar-item");e.toggleItem(t.getId())&&this.metrikaBlockCount(t.get(".metrika_onshow_title"))},_metrikaBlockCount:function(e){Jane.c("Правая колонка","Блоки правых колонок",e)},onActiveChanged:function(){var e=this.getModel("thread-sidebar-state"),t=this.getModel("thread-sidebar-item");this.$node.toggleClass("mail-ThreadSidebar-Item_title_active",e.isActive(t.getId()))}}})},5015:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(370),s=n(516),a=n(487);ns.View.edefine("thread-sidebar-item-click-scenario-mixin",{events:{click:"onClick"},methods:{onClick:function(){this.$node.hasClass("is-selected")||this._startMessageViewScenario()},_startMessageViewScenario:function(){this.scenarioManager.finishScenarioIfActive(i.d,a.c),this.scenarioManager.startScenario(i.d,s.j)}}},"scenario-manager-mixin")},5016:function(e,t){ns.ViewCollection.edefine("thread-sidebar-item-related",{models:{messages:!1,"thread-sidebar-state":!1},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","scroll@show":"loadMoreByScrolling"},params:function(e){return{thread_id:e.thread_id,prevent_update:!0}},split:{byModel:"messages",intoViews:"thread-sidebar-item-related-item"},yateModule:"message",methods:{outputError:no.true,onHtmlInit:function(){this.setFullyLoadedStateIfNeeded(),this.scrollInit()},onShow:function(){this.scrollStart(),this.fillList()},onHide:function(){this.scrollStop(),this.loadMoreByScrolling.cancel()},canLoadMore:function(){return this.getModel("messages").canLoadMore()},loadMore:function(){return this.getModel("messages").loadMore()}}},"async-view-loading-fix-mixin","thread-sidebar-item-save-scroll",Daria.InfiniteViewCollection)},5017:function(e,t){ns.View.edefine("thread-sidebar-item-related-item",{models:{message:{"ns-model-changed":!1,"ns-model-changed.date.view":"onDateChange"}},yateModule:"message",methods:{onDateChange:function(){this.invalidate(),ns.Model.get("thread-sidebar-state").triggerUpdateDebounce()}}},"thread-sidebar-item-click-scenario-mixin")},5018:function(e,t){ns.ViewCollection.edefine("thread-sidebar-item-attachments",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","scroll@show":"loadMoreByScrolling"},models:{"thread-attachments":!0,"thread-sidebar-state":!1},split:{byModel:"thread-attachments",intoViews:"thread-sidebar-item-attachments-item"},params:{thread_id:null},yateModule:"message",methods:{outputError:no.true,onHtmlInit:function(){this.setFullyLoadedStateIfNeeded(),this.scrollInit()},onShow:function(){this.scrollStart()},onHide:function(){this.scrollStop(),this.loadMoreByScrolling.cancel()},canLoadMore:function(){return this.getModel("thread-attachments").canLoadMore()},loadMore:function(){return this.getModel("thread-attachments").loadMore()}}},"thread-sidebar-item-save-scroll",Daria.InfiniteViewCollection)},5019:function(e,t){ns.View.defineNg("thread-sidebar-item-attachments-item",{models:{"thread-attachments-item":!0},events:{"click .js-image-preview":"previewImage","click .js-docviewer-preview":"onDocviewerPreviewClick","click .js-download-attach":"attachmentDownloadMetrika"},params:{"url-key":null},yateModule:"message",methods:{attachmentDownloadMetrika:function(){Jane.c(["Правая колонка","Блоки правых колонок","Показ Вложения","Клик во вложение","Скачивание вложения"])},onDocviewerPreviewClick:function(){Jane.c(["Правая колонка","Блоки правых колонок","Показ Вложения","Клик во вложение","Показ вложения"])},previewImage:function(e){var t=Daria.parseQuery($(e.currentTarget).data("params")),n=t.mid||this.params.ids,i=t.hid,s=this.params.hid;Daria.ImageViewer.open("",n,i,s),Jane.c(["Правая колонка","Блоки правых колонок","Показ Вложения","Клик во вложение","Показ вложения"]),e.preventDefault()},countSaveToDisk:function(){Jane.c(["Правая колонка","Блоки правых колонок","Показ Вложения","Клик во вложение","Сохранить на Диск"])}}},"save-to-disk-mixin","count-attachments-ops-mixin",ns.View)},5020:function(e,t){ns.View.define("thread-sidebar-item-link",{models:{"messages-thread-link":!0},yateModule:"message"})},5021:function(e,t){ns.ViewCollection.edefine("thread-sidebar-item-links",{events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","scroll@show":"loadMoreByScrolling"},models:{"messages-thread-links":!1,"thread-sidebar-state":!1},split:{byModel:"messages-thread-links",intoViews:"thread-sidebar-item-link"},yateModule:"message",methods:{outputError:no.true,onHtmlInit:function(){this.setFullyLoadedStateIfNeeded(),this.scrollInit()},onShow:function(){this.scrollStart()},onHide:function(){this.scrollStop(),this.loadMoreByScrolling.cancel()},canLoadMore:function(){return this.getModel("messages-thread-links").canLoadMore()},loadMore:function(){return this.getModel("messages-thread-links").loadMore()}}},"thread-sidebar-item-save-scroll",Daria.InfiniteViewCollection)},5022:function(e,t){ns.ViewCollection.edefine("thread-sidebar-item-same-author",{models:{"messages-from":!1,"thread-sidebar-state":!1},yateModule:"message",split:{byModel:"messages-from",intoViews:"thread-sidebar-item-same-author-item"},events:{"ns-view-htmlinit":"onHtmlInit","ns-view-show":"onShow","ns-view-hide":"onHide","scroll@show":"loadMoreByScrolling"},methods:{outputError:no.true,onHtmlInit:function(){this.setFullyLoadedStateIfNeeded(),this.scrollInit()},onShow:function(){this.scrollStart()},onHide:function(){this.scrollStop(),this.loadMoreByScrolling.cancel()},canLoadMore:function(){return this.getModel("messages-from").canLoadMore()},loadMore:function(){return this.getModel("messages-from").loadMore()}}},"thread-sidebar-item-save-scroll",Daria.InfiniteViewCollection)},5023:function(e,t){ns.View.edefine("thread-sidebar-item-same-author-item",{models:{"messages-from-item":{"ns-model-changed":!1,"ns-model-changed.date.view":"onDateChange"},message:!1},yateModule:"message",methods:{onDateChange:function(){this.invalidate(),ns.Model.get("thread-sidebar-state").triggerUpdateDebounce()}}},"thread-sidebar-item-click-scenario-mixin")},5024:function(e,t){ns.View.define("thread-sidebar-expand-button",{events:{"click@show":"onClick"},yateModule:"message",models:{"thread-sidebar-state":{"ns-model-changed":!1,"ns-model-changed.flight":"_update"},settings:{"ns-model-changed":!1,"ns-model-changed.right_column_expanded":"_update"}},methods:{_update:function(){this.invalidate(),this.getModel("thread-sidebar-state").triggerUpdate()},onClick:function(){var e=this.getModel("settings").getSign("right_column_expanded"),t=e?'Клик в "Свернуть"':'Клик в "Развернуть"';Jane.c("Правая колонка","Плавающая правая колонка",t),this.getModel("settings").setSettings({right_column_expanded:!e})}}})},5025:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,s=n(510),a=n.n(s),o=n(701),r=n.n(o),u=n(370),l=n(516),d=n(487);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=(c(i={},r.a.PREV+a.a.CLICK,l.h),c(i,r.a.PREV+a.a.HOTKEY,l.i),c(i,r.a.NEXT+a.a.CLICK,l.f),c(i,r.a.NEXT+a.a.HOTKEY,l.g),i);ns.View.edefine("message-prevnext",{events:{"click .js-message-prevnext":"onPrevNextClick","ns-view-show":"onShow","ns-view-hide":"onHide"},models:{"message-nearest":!1,folders:!0},yateModule:"message",ctor:function(){this._update=this._update.bind(this)},methods:{onPrevNextClick:function(e){var t=$(e.currentTarget).data("direction");t&&this._startMessageViewScenario(t,a.a.CLICK)},_startMessageViewScenario:function(e,t){this.scenarioManager.finishScenarioIfActive(u.d,d.c);var n=h[e+t];this.scenarioManager.startScenario(u.d,n)},onShow:function(){var e=this;this.getModel("message-nearest").getNearestMids().forEach(function(t){return ns.Model.get("message",{ids:t}).on("ns-model-changed.new",e._update)})},onHide:function(){var e=this;this.getModel("message-nearest").getNearestMids().forEach(function(t){return ns.Model.get("message",{ids:t}).off("ns-model-changed.new",e._update)}),this.invalidate()},_update:function(){this.isVisible()&&this.forceUpdate()}}},"scenario-manager-mixin")},5026:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(510),s=n.n(i);ns.View.edefine("message-prevnext-with-shortcuts",{events:{"daria:vMessagePrevNextInMessage:changeMessage@show":"onChangeMessage"},models:{"message-nearest":!1,folders:!0},yateModule:"message",ctor:function(){this._update=this._update.bind(this)},methods:{onChangeMessage:function(e,t){if(t.direction){var n=this.getModel("message-nearest").getNearestMessages()[t.direction],i=n&&n.mid;i&&(ns.page.go(ns.router.generateUrl("message",{ids:i})),this._startMessageViewScenario(t.direction,s.a.HOTKEY))}}}},"message-prevnext")},5027:function(e,t){yr.externals["event-pretty-date"]=function(e){var t=Jane.Common.n,n=[],i=new Date(e),s=new Date,a=i.getFullYear(),o=i.getMonth(),r=i.getDate(),u=i.getHours(),l=i.getMinutes(),d=s.getFullYear(),c=s.getMonth(),h=s.getDate();return d===a&&c===o&&h===r?n.push(i18n("%Сегодня")):new Date(a,o,r)-new Date(d,c,h)==864e5&&n.push(i18n("%Завтра")),n.push(Jane.Date.format("%Date_dBY_year",i)),n.push(' <input class="b-calendar-event__time__input" type="text" value="'+t(u)+":"+t(l)+'" maxlength="5">'),n.join(", ")},yr.externals.lang2index=function(e){var t=Daria.Translate.langs.all.s.indexOf(e);return t>-1?t:0},yr.externals["remove-http-protocol"]=function(e){return e.replace(/^https?:\/\/(www\.)?/,"")}},516:function(e,t,n){"use strict";n.d(t,"b",function(){return i}),n.d(t,"c",function(){return s}),n.d(t,"d",function(){return a}),n.d(t,"e",function(){return o}),n.d(t,"k",function(){return r}),n.d(t,"l",function(){return u}),n.d(t,"h",function(){return l}),n.d(t,"i",function(){return d}),n.d(t,"f",function(){return c}),n.d(t,"g",function(){return h}),n.d(t,"n",function(){return g}),n.d(t,"m",function(){return f}),n.d(t,"j",function(){return m}),n.d(t,"a",function(){return p});var i="messages-list-message-click",s="messages-list-message-hotkey",a="messages-list-thread-click",o="messages-list-thread-hotkey",r="thread-message-click",u="thread-message-hotkey",l="message-prev-click",d="message-prev-hotkey",c="message-next-click",h="message-next-hotkey",g="thread-prev-click",f="thread-next-click",m="message-right-column-message-click",p="direct-url"},736:function(e,t,n){e.exports=n.p+"_/325472601571f31e1bf00674c368d335-b-ico.gif"}});